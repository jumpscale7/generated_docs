<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>JumpScale.grid.osis.OSISFactory &mdash; Jumpscale Doc 7.0 documentation</title>
    
    <link rel="stylesheet" href="../../../../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../../../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../../',
        VERSION:     '7.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../../_static/doctools.js"></script>
    <link rel="top" title="Jumpscale Doc 7.0 documentation" href="../../../../index.html" />
    <link rel="up" title="Module code" href="../../../index.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../../../../index.html">Jumpscale Doc 7.0 documentation</a> &raquo;</li>
          <li><a href="../../../index.html" accesskey="U">Module code</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <h1>Source code for JumpScale.grid.osis.OSISFactory</h1><div class="highlight"><pre>
<span class="kn">from</span> <span class="nn">JumpScale</span> <span class="kn">import</span> <span class="n">j</span>
<span class="kn">from</span> <span class="nn">OSISCMDS</span> <span class="kn">import</span> <span class="n">OSISCMDS</span>
<span class="kn">from</span> <span class="nn">OSISClientForCat</span> <span class="kn">import</span> <span class="n">OSISClientForCat</span>
<span class="kn">from</span> <span class="nn">OSISBaseObject</span> <span class="kn">import</span> <span class="n">OSISBaseObject</span>
<span class="kn">from</span> <span class="nn">OSISBaseObjectComplexType</span> <span class="kn">import</span> <span class="n">OSISBaseObjectComplexType</span>
<span class="kn">import</span> <span class="nn">JumpScale.portal.codegentools</span>

<span class="kn">import</span> <span class="nn">inspect</span>
<span class="kn">import</span> <span class="nn">imp</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">ujson</span>
<span class="kn">import</span> <span class="nn">lz4</span>


<div class="viewcode-block" id="FileLikeStreamObject"><a class="viewcode-back" href="../../../../API/JumpScale.grid.osis.html#JumpScale.grid.osis.OSISFactory.FileLikeStreamObject">[docs]</a><span class="k">class</span> <span class="nc">FileLikeStreamObject</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">out</span><span class="o">=</span><span class="s">&quot;&quot;</span>

<div class="viewcode-block" id="FileLikeStreamObject.write"><a class="viewcode-back" href="../../../../API/JumpScale.grid.osis.html#JumpScale.grid.osis.OSISFactory.FileLikeStreamObject.write">[docs]</a>    <span class="k">def</span> <span class="nf">write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">buf</span><span class="p">,</span><span class="o">**</span><span class="n">args</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">buf</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span><span class="o">.</span><span class="n">splitlines</span><span class="p">():</span>
            <span class="c">#print &quot;###%s&quot;%line</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">out</span><span class="o">+=</span><span class="s">&quot;</span><span class="si">%s</span><span class="se">\n</span><span class="s">&quot;</span><span class="o">%</span><span class="n">line</span>
</div></div>
<div class="viewcode-block" id="ClassEmpty"><a class="viewcode-back" href="../../../../API/JumpScale.grid.osis.html#JumpScale.grid.osis.OSISFactory.ClassEmpty">[docs]</a><span class="k">class</span> <span class="nc">ClassEmpty</span><span class="p">():</span>
    <span class="k">pass</span>
</div>
<div class="viewcode-block" id="NameSpaceClient"><a class="viewcode-back" href="../../../../API/JumpScale.grid.osis.html#JumpScale.grid.osis.OSISFactory.NameSpaceClient">[docs]</a><span class="k">class</span> <span class="nc">NameSpaceClient</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">client</span><span class="p">,</span> <span class="n">namespace</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_client</span> <span class="o">=</span> <span class="n">client</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_namespace</span> <span class="o">=</span> <span class="n">namespace</span>
        <span class="k">for</span> <span class="n">category</span> <span class="ow">in</span> <span class="n">client</span><span class="o">.</span><span class="n">listNamespaceCategories</span><span class="p">(</span><span class="n">namespace</span><span class="p">):</span>
            <span class="n">cclient</span> <span class="o">=</span> <span class="n">j</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">osis</span><span class="o">.</span><span class="n">getClientForCategory</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_client</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_namespace</span><span class="p">,</span> <span class="n">category</span><span class="p">)</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">category</span><span class="p">,</span> <span class="n">cclient</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__getattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">category</span><span class="p">):</span>
        <span class="n">categories</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_client</span><span class="o">.</span><span class="n">listNamespaceCategories</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_namespace</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">category</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">categories</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s">&quot;Category </span><span class="si">%s</span><span class="s"> does not exists in namespace </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">category</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_namespace</span><span class="p">))</span>

        <span class="n">cclient</span> <span class="o">=</span> <span class="n">j</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">osis</span><span class="o">.</span><span class="n">getClientForCategory</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_client</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_namespace</span><span class="p">,</span> <span class="n">category</span><span class="p">)</span>
        <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">category</span><span class="p">,</span> <span class="n">cclient</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">cclient</span>

</div>
<div class="viewcode-block" id="OSISFactory"><a class="viewcode-back" href="../../../../API/JumpScale.grid.osis.html#JumpScale.grid.osis.OSISFactory.OSISFactory">[docs]</a><span class="k">class</span> <span class="nc">OSISFactory</span><span class="p">:</span>

    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">_redirect</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_out</span><span class="o">=</span><span class="n">FileLikeStreamObject</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sysstdout</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_sysstdout</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stdout</span>
        <span class="c"># sys.stdout=self._out</span>

    <span class="k">def</span> <span class="nf">_stopRedirect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">pprint</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sysstdout</span><span class="p">:</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_sysstdout</span>
        <span class="n">out</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_out</span><span class="p">:</span>
            <span class="n">out</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_out</span><span class="o">.</span><span class="n">out</span>
            <span class="k">if</span> <span class="n">pprint</span><span class="p">:</span>
                <span class="k">print</span> <span class="n">out</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_out</span><span class="o">=</span><span class="bp">None</span> 
        <span class="k">return</span> <span class="n">out</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_sysstdout</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">osisConnections</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">osisConnectionsCat</span><span class="o">=</span><span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nodeguids</span><span class="o">=</span><span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">osisModels</span><span class="o">=</span><span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">namespacesInited</span><span class="o">=</span><span class="p">{}</span>
        

<div class="viewcode-block" id="OSISFactory.encrypt"><a class="viewcode-back" href="../../../../API/JumpScale.grid.osis.html#JumpScale.grid.osis.OSISFactory.OSISFactory.encrypt">[docs]</a>    <span class="k">def</span> <span class="nf">encrypt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">obj</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">j</span><span class="o">.</span><span class="n">basetype</span><span class="o">.</span><span class="n">string</span><span class="o">.</span><span class="n">check</span><span class="p">(</span><span class="n">obj</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">j</span><span class="o">.</span><span class="n">basetype</span><span class="o">.</span><span class="n">dictionary</span><span class="o">.</span><span class="n">check</span><span class="p">(</span><span class="n">obj</span><span class="p">):</span>
                <span class="n">val</span><span class="o">=</span><span class="n">obj</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">val</span><span class="o">=</span><span class="n">obj</span><span class="o">.</span><span class="n">__dict__</span>
            <span class="n">val</span><span class="o">=</span><span class="n">ujson</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">val</span> <span class="o">=</span> <span class="n">obj</span>
        <span class="n">val</span><span class="o">=</span><span class="n">lz4</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
        <span class="n">val</span><span class="o">=</span><span class="n">j</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">serializers</span><span class="o">.</span><span class="n">blowfish</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">val</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">val</span>
</div>
<div class="viewcode-block" id="OSISFactory.decrypt"><a class="viewcode-back" href="../../../../API/JumpScale.grid.osis.html#JumpScale.grid.osis.OSISFactory.OSISFactory.decrypt">[docs]</a>    <span class="k">def</span> <span class="nf">decrypt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">val</span><span class="p">,</span><span class="n">json</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">j</span><span class="o">.</span><span class="n">basetype</span><span class="o">.</span><span class="n">string</span><span class="o">.</span><span class="n">check</span><span class="p">(</span><span class="n">val</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s">&quot;needs to be string&quot;</span><span class="p">)</span>
        <span class="n">val</span><span class="o">=</span><span class="n">j</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">serializers</span><span class="o">.</span><span class="n">blowfish</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">val</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">)</span>
        <span class="n">val</span><span class="o">=</span><span class="n">lz4</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">json</span><span class="p">:</span>
            <span class="n">val</span><span class="o">=</span><span class="n">ujson</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">val</span>
</div>
<div class="viewcode-block" id="OSISFactory.getLocal"><a class="viewcode-back" href="../../../../API/JumpScale.grid.osis.html#JumpScale.grid.osis.OSISFactory.OSISFactory.getLocal">[docs]</a>    <span class="k">def</span> <span class="nf">getLocal</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">,</span> <span class="n">overwriteHRD</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">overwriteImplementation</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">namespacename</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        create local instance starting from path</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">osis</span><span class="o">=</span><span class="n">OSISCMDS</span><span class="p">()</span>
        <span class="n">osis</span><span class="o">.</span><span class="n">init</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">osis</span>
</div>
<div class="viewcode-block" id="OSISFactory.startDaemon"><a class="viewcode-back" href="../../../../API/JumpScale.grid.osis.html#JumpScale.grid.osis.OSISFactory.OSISFactory.startDaemon">[docs]</a>    <span class="k">def</span> <span class="nf">startDaemon</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">,</span> <span class="n">overwriteHRD</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">overwriteImplementation</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">,</span><span class="n">port</span><span class="o">=</span><span class="mi">5544</span><span class="p">,</span><span class="n">superadminpasswd</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">dbconnections</span><span class="o">=</span><span class="p">{},</span><span class="n">hrd</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        start deamon</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">hrd</span><span class="o">&lt;&gt;</span><span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">hrd</span><span class="o">=</span><span class="n">hrd</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="o">=</span><span class="n">key</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">superadminpasswd</span><span class="o">=</span><span class="n">superadminpasswd</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dbconnections</span><span class="o">=</span><span class="n">dbconnections</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">superadminpasswd</span><span class="o">==</span><span class="s">&quot;&quot;</span><span class="p">:</span>
             <span class="n">j</span><span class="o">.</span><span class="n">events</span><span class="o">.</span><span class="n">inputerror_critical</span><span class="p">(</span><span class="s">&quot;cannot start osis, superadminpasswd needs to be specified&quot;</span><span class="p">)</span>

        <span class="n">daemon</span> <span class="o">=</span> <span class="n">j</span><span class="o">.</span><span class="n">servers</span><span class="o">.</span><span class="n">geventws</span><span class="o">.</span><span class="n">getServer</span><span class="p">(</span><span class="n">port</span><span class="o">=</span><span class="n">port</span><span class="p">)</span>
        <span class="n">OSISCMDS</span><span class="o">.</span><span class="n">dbconnections</span> <span class="o">=</span> <span class="n">dbconnections</span>
        <span class="n">daemon</span><span class="o">.</span><span class="n">addCMDsInterface</span><span class="p">(</span><span class="n">OSISCMDS</span><span class="p">,</span> <span class="n">category</span><span class="o">=</span><span class="s">&quot;osis&quot;</span><span class="p">)</span>  <span class="c"># pass as class not as object !!!</span>
        <span class="n">daemon</span><span class="o">.</span><span class="n">daemon</span><span class="o">.</span><span class="n">cmdsInterfaces</span><span class="p">[</span><span class="s">&quot;osis&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">init</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="n">path</span><span class="p">)</span><span class="c">#,esip=elasticsearchip,esport=elasticsearchport,db=db)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cmds</span><span class="o">=</span><span class="n">daemon</span><span class="o">.</span><span class="n">daemon</span><span class="o">.</span><span class="n">cmdsInterfaces</span><span class="p">[</span><span class="s">&quot;osis&quot;</span><span class="p">]</span>
        <span class="n">daemon</span><span class="o">.</span><span class="n">schedule</span><span class="p">(</span><span class="s">&quot;checkchangelog&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cmds</span><span class="o">.</span><span class="n">checkChangeLog</span><span class="p">)</span>
        <span class="n">daemon</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="OSISFactory.getClient"><a class="viewcode-back" href="../../../../API/JumpScale.grid.osis.html#JumpScale.grid.osis.OSISFactory.OSISFactory.getClient">[docs]</a>    <span class="k">def</span> <span class="nf">getClient</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ipaddr</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="mi">5544</span><span class="p">,</span><span class="n">user</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">passwd</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">ssl</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span><span class="n">gevent</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>

        <span class="k">if</span> <span class="n">ipaddr</span><span class="o">==</span><span class="bp">None</span> <span class="ow">or</span> <span class="n">user</span><span class="o">==</span><span class="bp">None</span> <span class="ow">or</span> <span class="n">passwd</span><span class="o">==</span><span class="bp">None</span><span class="p">:</span>
            <span class="n">osisjp</span><span class="o">=</span><span class="n">j</span><span class="o">.</span><span class="n">packages</span><span class="o">.</span><span class="n">findNewest</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&quot;osis_client&quot;</span><span class="p">,</span><span class="n">domain</span><span class="o">=</span><span class="s">&quot;jumpscale&quot;</span><span class="p">)</span>
            <span class="n">inames</span><span class="o">=</span><span class="n">osisjp</span><span class="o">.</span><span class="n">getInstanceNames</span><span class="p">()</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">inames</span><span class="p">)</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
                <span class="n">osisjp</span><span class="o">=</span><span class="n">osisjp</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">instance</span><span class="o">=</span><span class="n">inames</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>                        
                <span class="n">hrd</span><span class="o">=</span><span class="n">osisjp</span><span class="o">.</span><span class="n">hrd_instance</span>
                <span class="k">if</span> <span class="n">ipaddr</span><span class="o">==</span><span class="bp">None</span><span class="p">:</span>
                    <span class="n">ipaddr</span><span class="o">=</span><span class="n">hrd</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;osis.client.addr&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">user</span><span class="o">==</span><span class="bp">None</span><span class="p">:</span>
                    <span class="n">user</span><span class="o">=</span><span class="n">hrd</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;osis.client.login&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">passwd</span><span class="o">==</span><span class="bp">None</span><span class="p">:</span>
                    <span class="n">passwd</span><span class="o">=</span><span class="n">hrd</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;osis.client.passwd&quot;</span><span class="p">)</span>
                <span class="n">port</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">hrd</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;osis.client.port&quot;</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">ipaddr</span><span class="o">&lt;&gt;</span><span class="bp">None</span><span class="p">:</span>
            <span class="n">ips</span> <span class="o">=</span> <span class="p">[</span><span class="n">ipaddr</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">j</span><span class="o">.</span><span class="n">application</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="s">&#39;osis.ip&#39;</span><span class="p">):</span>
            <span class="n">ips</span> <span class="o">=</span> <span class="n">j</span><span class="o">.</span><span class="n">application</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">getList</span><span class="p">(</span><span class="s">&#39;osis.ip&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ips</span> <span class="o">=</span> <span class="p">[</span> <span class="n">j</span><span class="o">.</span><span class="n">application</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;grid.master.ip&#39;</span><span class="p">)</span> <span class="p">]</span>
        <span class="n">connections</span> <span class="o">=</span> <span class="p">[</span> <span class="p">(</span><span class="n">ip</span><span class="p">,</span> <span class="n">port</span><span class="p">)</span> <span class="k">for</span> <span class="n">ip</span> <span class="ow">in</span> <span class="n">ips</span> <span class="p">]</span>
        <span class="n">key</span> <span class="o">=</span> <span class="s">&quot;</span><span class="si">%s</span><span class="s">_</span><span class="si">%s</span><span class="s">_</span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">connections</span><span class="p">,</span> <span class="n">user</span><span class="p">,</span> <span class="n">passwd</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">osisConnections</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">osisConnections</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">user</span><span class="o">==</span><span class="bp">None</span> <span class="ow">or</span> <span class="n">user</span><span class="o">==</span><span class="s">&quot;node&quot;</span><span class="p">:</span>
            <span class="n">user</span><span class="o">=</span><span class="s">&quot;node&quot;</span>
            <span class="n">passwd</span><span class="o">=</span><span class="n">j</span><span class="o">.</span><span class="n">application</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;grid.node.machineguid&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">user</span><span class="o">==</span><span class="s">&quot;root&quot;</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">passwd</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">j</span><span class="o">.</span><span class="n">application</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="s">&quot;osis.superadmin.passwd&quot;</span><span class="p">):</span>
                <span class="n">passwd</span><span class="o">=</span><span class="n">j</span><span class="o">.</span><span class="n">application</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;osis.superadmin.passwd&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s">&quot;Osis superadmin passwd has not been defined on this node, please put in #hrd (osis.superadmin.passwd) or use argument &#39;passwd&#39;.&quot;</span><span class="p">)</span>

        <span class="k">with</span> <span class="n">j</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">nostdout</span><span class="p">():</span>
            <span class="c">#client = j.core.zdaemon.getZDaemonHAClient(connections, category=&quot;osis&quot;, user=user, passwd=passwd,ssl=ssl,sendformat=&quot;j&quot;, returnformat=&quot;j&quot;,gevent=gevent)</span>
            <span class="n">client</span><span class="o">=</span> <span class="n">j</span><span class="o">.</span><span class="n">servers</span><span class="o">.</span><span class="n">geventws</span><span class="o">.</span><span class="n">getHAClient</span><span class="p">(</span><span class="n">connections</span><span class="p">,</span> <span class="n">user</span><span class="o">=</span><span class="n">user</span><span class="p">,</span> <span class="n">passwd</span><span class="o">=</span><span class="n">passwd</span><span class="p">,</span><span class="n">category</span><span class="o">=</span><span class="s">&quot;osis&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">osisConnections</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">client</span>
        <span class="k">return</span> <span class="n">client</span>
</div>
<div class="viewcode-block" id="OSISFactory.getClientByInstance"><a class="viewcode-back" href="../../../../API/JumpScale.grid.osis.html#JumpScale.grid.osis.OSISFactory.OSISFactory.getClientByInstance">[docs]</a>    <span class="k">def</span> <span class="nf">getClientByInstance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">instance</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">ssl</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">gevent</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span><span class="n">die</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">instance</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">instance</span> <span class="o">=</span> <span class="n">j</span><span class="o">.</span><span class="n">application</span><span class="o">.</span><span class="n">instanceconfig</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;osis.connection&#39;</span><span class="p">)</span>
        <span class="n">osisjp</span><span class="o">=</span><span class="n">j</span><span class="o">.</span><span class="n">packages</span><span class="o">.</span><span class="n">findNewest</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&quot;osis_client&quot;</span><span class="p">,</span><span class="n">domain</span><span class="o">=</span><span class="s">&quot;jumpscale&quot;</span><span class="p">)</span>
        <span class="n">osisjp</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">instance</span><span class="o">=</span><span class="n">instance</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">osisjp</span><span class="o">.</span><span class="n">isInstalled</span><span class="p">():</span>
            <span class="n">hrd</span><span class="o">=</span><span class="n">osisjp</span><span class="o">.</span><span class="n">hrd_instance</span>
            <span class="n">ipaddr</span><span class="o">=</span><span class="n">hrd</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;osis.client.addr&quot;</span><span class="p">)</span>
            <span class="n">port</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">hrd</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;osis.client.port&quot;</span><span class="p">))</span>
            <span class="n">user</span><span class="o">=</span><span class="n">hrd</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;osis.client.login&quot;</span><span class="p">)</span>
            <span class="n">passwd</span><span class="o">=</span><span class="n">hrd</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;osis.client.passwd&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">getClient</span><span class="p">(</span><span class="n">ipaddr</span><span class="o">=</span><span class="n">ipaddr</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="n">port</span><span class="p">,</span> <span class="n">user</span><span class="o">=</span><span class="n">user</span><span class="p">,</span> <span class="n">passwd</span><span class="o">=</span><span class="n">passwd</span><span class="p">,</span> <span class="n">ssl</span><span class="o">=</span><span class="n">ssl</span><span class="p">,</span> <span class="n">gevent</span><span class="o">=</span><span class="n">gevent</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">die</span><span class="p">:</span>
            <span class="n">j</span><span class="o">.</span><span class="n">events</span><span class="o">.</span><span class="n">inputerror_critical</span><span class="p">(</span><span class="s">&quot;Could not find osis_client with instance:</span><span class="si">%s</span><span class="s">, could not load osis,&quot;</span><span class="o">%</span><span class="n">instance</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="OSISFactory.getClientForNamespace"><a class="viewcode-back" href="../../../../API/JumpScale.grid.osis.html#JumpScale.grid.osis.OSISFactory.OSISFactory.getClientForNamespace">[docs]</a>    <span class="k">def</span> <span class="nf">getClientForNamespace</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">namespace</span><span class="p">,</span> <span class="n">client</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">client</span><span class="o">==</span><span class="bp">None</span><span class="p">:</span>
            <span class="n">client</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getClientByInstance</span><span class="p">(</span><span class="s">&#39;main&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">NameSpaceClient</span><span class="p">(</span><span class="n">client</span><span class="p">,</span> <span class="n">namespace</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="OSISFactory.getClientForCategory"><a class="viewcode-back" href="../../../../API/JumpScale.grid.osis.html#JumpScale.grid.osis.OSISFactory.OSISFactory.getClientForCategory">[docs]</a>    <span class="k">def</span> <span class="nf">getClientForCategory</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">client</span><span class="p">,</span> <span class="n">namespace</span><span class="p">,</span> <span class="n">category</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        how to use</span>

<span class="sd">        client=j.core.osis.getClient(&quot;localhost&quot;,port=5544,user=&quot;root&quot;,passwd=&quot;rooter&quot;,ssl=False)</span>
<span class="sd">        client4node=j.core.osis.getClientForCategory(client,&quot;system&quot;,&quot;node&quot;)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">client</span><span class="o">==</span><span class="bp">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s">&quot;Client cannot be None: getClientForCategory </span><span class="si">%s</span><span class="s">/</span><span class="si">%s</span><span class="s">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">namespace</span><span class="p">,</span> <span class="n">category</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">OSISClientForCat</span><span class="p">(</span><span class="n">client</span><span class="p">,</span> <span class="n">namespace</span><span class="p">,</span> <span class="n">category</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="OSISFactory.getOsisBaseObjectClass"><a class="viewcode-back" href="../../../../API/JumpScale.grid.osis.html#JumpScale.grid.osis.OSISFactory.OSISFactory.getOsisBaseObjectClass">[docs]</a>    <span class="k">def</span> <span class="nf">getOsisBaseObjectClass</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">OSISBaseObject</span>
</div>
<div class="viewcode-block" id="OSISFactory.getOSISBaseObjectComplexType"><a class="viewcode-back" href="../../../../API/JumpScale.grid.osis.html#JumpScale.grid.osis.OSISFactory.OSISFactory.getOSISBaseObjectComplexType">[docs]</a>    <span class="k">def</span> <span class="nf">getOSISBaseObjectComplexType</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">OSISBaseObjectComplexType</span>
</div>
<div class="viewcode-block" id="OSISFactory.getOsisImplementationParentClass"><a class="viewcode-back" href="../../../../API/JumpScale.grid.osis.html#JumpScale.grid.osis.OSISFactory.OSISFactory.getOsisImplementationParentClass">[docs]</a>    <span class="k">def</span> <span class="nf">getOsisImplementationParentClass</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">namespacename</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        return parent class for osis implementation (is the implementation from which each namespace &amp; category inherits)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">implpath</span> <span class="o">=</span> <span class="n">j</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">joinPaths</span><span class="p">(</span><span class="s">&quot;logic&quot;</span><span class="p">,</span> <span class="n">namespacename</span><span class="p">,</span> <span class="s">&quot;OSIS_parent.py&quot;</span><span class="p">)</span>
        <span class="n">classs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_loadModuleClass</span><span class="p">(</span><span class="n">implpath</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">classs</span>
</div>
    <span class="k">def</span> <span class="nf">_generateOsisModelClassFromSpec</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">namespace</span><span class="p">,</span><span class="n">specpath</span><span class="p">,</span><span class="n">modelName</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">,</span><span class="n">classpath</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        generate class files for spec (can be more than 1)</span>
<span class="sd">        generated in classpath/modelName/OsisGeneratedRootObject.py</span>
<span class="sd">        and also classpath/modelName/model.py</span>
<span class="sd">        @return classpath</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">import</span> <span class="nn">JumpScale.baselib.specparser</span>                
        <span class="n">j</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">specparser</span><span class="o">.</span><span class="n">parseSpecs</span><span class="p">(</span><span class="n">specpath</span><span class="p">,</span> <span class="n">appname</span><span class="o">=</span><span class="s">&quot;osismodel&quot;</span><span class="p">,</span> <span class="n">actorname</span><span class="o">=</span><span class="n">namespace</span><span class="p">)</span>
        <span class="c"># spec = j.core.specparser.getModelSpec(namespace, category, &quot;root&quot;)</span>

        <span class="n">modelNames</span> <span class="o">=</span> <span class="n">j</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">specparser</span><span class="o">.</span><span class="n">getModelNames</span><span class="p">(</span><span class="s">&quot;osismodel&quot;</span><span class="p">,</span> <span class="n">namespace</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">classpath</span><span class="o">==</span><span class="s">&quot;&quot;</span><span class="p">:</span>
            <span class="n">classpath</span><span class="o">=</span><span class="n">j</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">joinPaths</span><span class="p">(</span><span class="n">j</span><span class="o">.</span><span class="n">dirs</span><span class="o">.</span><span class="n">varDir</span><span class="p">,</span><span class="s">&quot;code&quot;</span><span class="p">,</span><span class="s">&quot;osismodel&quot;</span><span class="p">,</span><span class="n">namespace</span><span class="p">)</span>

        <span class="n">extpath</span><span class="o">=</span><span class="n">j</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">getDirName</span><span class="p">(</span><span class="n">inspect</span><span class="o">.</span><span class="n">getfile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getClient</span><span class="p">))</span>
        <span class="n">templpath</span><span class="o">=</span><span class="n">j</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">joinPaths</span><span class="p">(</span><span class="n">extpath</span><span class="p">,</span><span class="s">&quot;_templates&quot;</span><span class="p">,</span><span class="s">&quot;osiscomplextypes&quot;</span><span class="p">)</span>
        <span class="n">j</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">copyDirTree</span><span class="p">(</span><span class="n">templpath</span><span class="p">,</span> <span class="n">classpath</span><span class="p">,</span> <span class="n">keepsymlinks</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">eraseDestination</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> \
            <span class="n">skipProtectedDirs</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">overwriteFiles</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">applyHrdOnDestPaths</span><span class="o">=</span><span class="bp">None</span><span class="p">)</span>        
                
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">modelNames</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>

            <span class="k">for</span> <span class="n">modelName</span> <span class="ow">in</span> <span class="n">modelNames</span><span class="p">:</span>
                <span class="n">modelspec</span> <span class="o">=</span> <span class="n">j</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">specparser</span><span class="o">.</span><span class="n">getModelSpec</span><span class="p">(</span><span class="s">&quot;osismodel&quot;</span><span class="p">,</span> <span class="n">namespace</span><span class="p">,</span> <span class="n">modelName</span><span class="p">)</span>
                <span class="n">modeltags</span> <span class="o">=</span> <span class="n">j</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">tags</span><span class="o">.</span><span class="n">getObject</span><span class="p">(</span><span class="n">modelspec</span><span class="o">.</span><span class="n">tags</span><span class="p">)</span>

                <span class="c"># # will generate the tasklets</span>
                <span class="c"># modelHasTasklets = modeltags.labelExists(&quot;tasklets&quot;)</span>
                <span class="c"># if modelHasTasklets:</span>
                <span class="c">#     j.core.codegenerator.generate(modelspec, &quot;osis&quot;, codepath=actorpath, returnClass=False, args=args)</span>

                <span class="c"># if spec.hasTasklets:</span>
                <span class="c">#     self.loadOsisTasklets(actorobject, actorpath, modelName=modelspec.name)</span>

                <span class="n">code</span> <span class="o">=</span> <span class="n">j</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">codegenerator</span><span class="o">.</span><span class="n">getCodeJSModel</span><span class="p">(</span><span class="s">&quot;osismodel&quot;</span><span class="p">,</span> <span class="n">namespace</span><span class="p">,</span> <span class="n">modelName</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">modelspec</span><span class="o">.</span><span class="n">tags</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
                    <span class="n">modelspec</span><span class="o">.</span><span class="n">tags</span> <span class="o">=</span> <span class="s">&quot;&quot;</span>
                <span class="n">index</span> <span class="o">=</span> <span class="n">j</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">tags</span><span class="o">.</span><span class="n">getObject</span><span class="p">(</span><span class="n">modelspec</span><span class="o">.</span><span class="n">tags</span><span class="p">)</span><span class="o">.</span><span class="n">labelExists</span><span class="p">(</span><span class="s">&quot;index&quot;</span><span class="p">)</span>
                <span class="n">tags</span> <span class="o">=</span> <span class="n">j</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">tags</span><span class="o">.</span><span class="n">getObject</span><span class="p">(</span><span class="n">modelspec</span><span class="o">.</span><span class="n">tags</span><span class="p">)</span>

                <span class="n">classnameGenerated</span><span class="o">=</span><span class="s">&quot;JSModel_</span><span class="si">%s</span><span class="s">_</span><span class="si">%s</span><span class="s">_</span><span class="si">%s</span><span class="s">&quot;</span><span class="o">%</span><span class="p">(</span><span class="s">&quot;osismodel&quot;</span><span class="p">,</span> <span class="n">namespace</span><span class="p">,</span> <span class="n">modelName</span><span class="p">)</span>
                <span class="n">classnameNew</span><span class="o">=</span><span class="s">&quot;</span><span class="si">%s</span><span class="s">_</span><span class="si">%s</span><span class="s">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">namespace</span><span class="p">,</span><span class="n">modelName</span><span class="p">)</span>
                <span class="n">classnameNew2</span><span class="o">=</span><span class="s">&quot;</span><span class="si">%s</span><span class="s">_</span><span class="si">%s</span><span class="s">_osismodelbase&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">namespace</span><span class="p">,</span><span class="n">modelName</span><span class="p">)</span>
                <span class="n">code</span><span class="o">=</span><span class="n">code</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">classnameGenerated</span><span class="p">,</span><span class="n">classnameNew2</span><span class="p">)</span>

                <span class="n">classpathForModel</span><span class="o">=</span><span class="n">j</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">joinPaths</span><span class="p">(</span><span class="n">classpath</span><span class="p">,</span><span class="n">modelName</span><span class="p">)</span>
                <span class="n">j</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">createDir</span><span class="p">(</span><span class="n">classpathForModel</span><span class="p">)</span>
                <span class="n">classpath3</span><span class="o">=</span><span class="n">j</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">joinPaths</span><span class="p">(</span><span class="n">classpathForModel</span><span class="p">,</span><span class="s">&quot;</span><span class="si">%s</span><span class="s">_osismodelbase.py&quot;</span><span class="o">%</span><span class="n">classnameNew</span><span class="p">)</span>
                <span class="n">j</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">writeFile</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="n">classpath3</span><span class="p">,</span><span class="n">contents</span><span class="o">=</span><span class="n">code</span><span class="p">)</span>

                <span class="n">mpath</span><span class="o">=</span><span class="n">j</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">joinPaths</span><span class="p">(</span><span class="n">classpathForModel</span><span class="p">,</span><span class="s">&quot;model.py&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">j</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="n">mpath</span><span class="p">):</span>
                    <span class="n">j</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">copyFile</span><span class="p">(</span><span class="n">j</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">joinPaths</span><span class="p">(</span><span class="n">classpath</span><span class="p">,</span><span class="s">&quot;model_template.py&quot;</span><span class="p">),</span><span class="n">mpath</span><span class="p">)</span>
                    <span class="n">content</span><span class="o">=</span><span class="n">j</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">fileGetContents</span><span class="p">(</span><span class="n">mpath</span><span class="p">)</span>
                    <span class="n">content</span><span class="o">=</span><span class="n">content</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&quot;$modelbase&quot;</span><span class="p">,</span><span class="s">&quot;</span><span class="si">%s</span><span class="s">&quot;</span><span class="o">%</span><span class="n">classnameNew</span><span class="p">)</span>
                    <span class="n">j</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">writeFile</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="n">mpath</span><span class="p">,</span><span class="n">contents</span><span class="o">=</span><span class="n">content</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">classpath</span>

<div class="viewcode-block" id="OSISFactory.generateOsisModelDefaults"><a class="viewcode-back" href="../../../../API/JumpScale.grid.osis.html#JumpScale.grid.osis.OSISFactory.OSISFactory.generateOsisModelDefaults">[docs]</a>    <span class="k">def</span> <span class="nf">generateOsisModelDefaults</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">namespace</span><span class="p">,</span><span class="n">specpath</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">):</span>
        <span class="kn">import</span> <span class="nn">JumpScale.portal.codegentools</span>

        <span class="k">if</span> <span class="n">specpath</span><span class="o">==</span><span class="s">&quot;&quot;</span><span class="p">:</span>
            <span class="n">specpath</span><span class="o">=</span><span class="n">j</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">joinPaths</span><span class="p">(</span><span class="s">&quot;logic&quot;</span><span class="p">,</span> <span class="n">namespace</span><span class="p">,</span> <span class="s">&quot;model.spec&quot;</span><span class="p">)</span>

        <span class="n">basepathspec</span><span class="o">=</span><span class="n">j</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">getDirName</span><span class="p">(</span><span class="n">specpath</span><span class="p">)</span>


        <span class="k">if</span> <span class="n">j</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="n">specpath</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_generateOsisModelClassFromSpec</span><span class="p">(</span><span class="n">namespace</span><span class="p">,</span><span class="n">specpath</span><span class="o">=</span><span class="n">basepathspec</span><span class="p">,</span><span class="n">classpath</span><span class="o">=</span><span class="n">basepathspec</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="OSISFactory.getModelTemplate"><a class="viewcode-back" href="../../../../API/JumpScale.grid.osis.html#JumpScale.grid.osis.OSISFactory.OSISFactory.getModelTemplate">[docs]</a>    <span class="k">def</span> <span class="nf">getModelTemplate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">extpath</span><span class="o">=</span><span class="n">j</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">getDirName</span><span class="p">(</span><span class="n">inspect</span><span class="o">.</span><span class="n">getfile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getClient</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">j</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">joinPaths</span><span class="p">(</span><span class="n">extpath</span><span class="p">,</span><span class="s">&quot;_templates&quot;</span><span class="p">,</span><span class="s">&quot;model_template.py&quot;</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="OSISFactory.getOsisModelClass"><a class="viewcode-back" href="../../../../API/JumpScale.grid.osis.html#JumpScale.grid.osis.OSISFactory.OSISFactory.getOsisModelClass">[docs]</a>    <span class="k">def</span> <span class="nf">getOsisModelClass</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">namespace</span><span class="p">,</span><span class="n">category</span><span class="p">,</span><span class="n">specpath</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        returns class generated from spec file or from model.py file</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">key</span><span class="o">=</span><span class="s">&quot;</span><span class="si">%s</span><span class="s">_</span><span class="si">%s</span><span class="s">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">namespace</span><span class="p">,</span><span class="n">category</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">osisModels</span><span class="o">.</span><span class="n">has_key</span><span class="p">(</span><span class="n">key</span><span class="p">):</span>
            <span class="c"># #need to check if there is a specfile or we go from model.py  </span>
            <span class="k">if</span> <span class="n">specpath</span><span class="o">==</span><span class="s">&quot;&quot;</span><span class="p">:</span>
                <span class="n">specpath</span><span class="o">=</span><span class="n">j</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">joinPaths</span><span class="p">(</span><span class="s">&quot;logic&quot;</span><span class="p">,</span> <span class="n">namespace</span><span class="p">,</span> <span class="s">&quot;model.spec&quot;</span><span class="p">)</span>            

            <span class="n">basepathspec</span><span class="o">=</span><span class="n">j</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">getDirName</span><span class="p">(</span><span class="n">specpath</span><span class="p">)</span>            
            <span class="n">basepath</span><span class="o">=</span><span class="n">j</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">joinPaths</span><span class="p">(</span><span class="n">basepathspec</span><span class="p">,</span><span class="n">category</span><span class="p">)</span>            
            <span class="n">modelpath</span><span class="o">=</span><span class="n">j</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">joinPaths</span><span class="p">(</span><span class="n">basepath</span><span class="p">,</span><span class="s">&quot;model.py&quot;</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">j</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="n">modelpath</span><span class="p">):</span>                
                <span class="n">klass</span><span class="o">=</span> <span class="n">j</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">fileGetContents</span><span class="p">(</span><span class="n">modelpath</span><span class="p">)</span>
                <span class="n">name</span><span class="o">=</span><span class="s">&quot;&quot;</span>
                <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">klass</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&quot;(OsisBaseObject&quot;</span><span class="p">)</span><span class="o">&lt;&gt;-</span><span class="mi">1</span> <span class="ow">and</span> <span class="n">line</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&quot;class &quot;</span><span class="p">)</span><span class="o">&lt;&gt;-</span><span class="mi">1</span><span class="p">:</span>
                        <span class="n">name</span><span class="o">=</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&quot;(&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lstrip</span><span class="p">(</span><span class="s">&quot;class&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">name</span><span class="o">==</span><span class="s">&quot;&quot;</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s">&quot;could not find: class $modelName(OsisBaseObject) in model class file, should always be there&quot;</span><span class="p">)</span>

                <span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">basepath</span><span class="p">)</span>
                <span class="n">module</span> <span class="o">=</span> <span class="n">imp</span><span class="o">.</span><span class="n">load_source</span><span class="p">(</span><span class="n">key</span><span class="p">,</span><span class="n">modelpath</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">osisModels</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">=</span><span class="n">module</span><span class="o">.</span><span class="n">__dict__</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s">&quot;Could not find model.py in </span><span class="si">%s</span><span class="s">&quot;</span><span class="o">%</span><span class="n">basepath</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">osisModels</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
</div>
    <span class="k">def</span> <span class="nf">_loadModuleClass</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Load the Python module from disk using a random name&#39;&#39;&#39;</span>
        <span class="n">modname</span> <span class="o">=</span> <span class="s">&quot;osis_</span><span class="si">%s</span><span class="s">&quot;</span><span class="o">%</span><span class="n">path</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&quot;/&quot;</span><span class="p">,</span><span class="s">&quot;_&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&quot;logic_&quot;</span><span class="p">,</span><span class="s">&quot;&quot;</span><span class="p">)[:</span><span class="o">-</span><span class="mi">3</span><span class="p">]</span>
        
        <span class="c"># while modname in sys.modules:</span>
        <span class="c">#     modname = generate_module_name()</span>

        <span class="n">module</span> <span class="o">=</span> <span class="n">imp</span><span class="o">.</span><span class="n">load_source</span><span class="p">(</span><span class="n">modname</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span>
        <span class="c"># find main classname of module</span>
        <span class="c"># classes=[item for item in module.__dict__.keys() if (item&lt;&gt;&quot;q&quot; and item[0]&lt;&gt;&quot;_&quot;)]</span>
        <span class="c"># if len(classes)&lt;&gt;1:</span>
        <span class="c">#     j.errorconditionhandler.raiseBug(message=&quot;there must be only 1 class implemented in %s&quot;%path,category=&quot;osis.init&quot;)</span>
        <span class="c"># classname=classes[0]</span>
        <span class="c"># return module.__dict__[classname]</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">module</span><span class="o">.</span><span class="n">mainclass</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">,</span><span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s">&quot;Could not load module on </span><span class="si">%s</span><span class="s">, could not find &#39;mainclass&#39;, check code on path. Error:</span><span class="si">%s</span><span class="s">&quot;</span><span class="o">%</span> <span class="p">(</span><span class="n">path</span><span class="p">,</span><span class="n">e</span><span class="p">))</span>
            </div>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../../../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../../../../index.html">Jumpscale Doc 7.0 documentation</a> &raquo;</li>
          <li><a href="../../../index.html" >Module code</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
    </div>
  </body>
</html>