<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>JumpScale.core.system.fs &mdash; Jumpscale Doc 7.0 documentation</title>
    
    <link rel="stylesheet" href="../../../../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../../../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../../',
        VERSION:     '7.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../../_static/doctools.js"></script>
    <link rel="top" title="Jumpscale Doc 7.0 documentation" href="../../../../index.html" />
    <link rel="up" title="Module code" href="../../../index.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../../../../index.html">Jumpscale Doc 7.0 documentation</a> &raquo;</li>
          <li><a href="../../../index.html" accesskey="U">Module code</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <h1>Source code for JumpScale.core.system.fs</h1><div class="highlight"><pre>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">os.path</span>
<span class="kn">import</span> <span class="nn">hashlib</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">fnmatch</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">shutil</span>
<span class="kn">import</span> <span class="nn">errno</span>
<span class="kn">import</span> <span class="nn">tempfile</span>
<span class="kn">import</span> <span class="nn">codecs</span>
<span class="kn">import</span> <span class="nn">cPickle</span> <span class="kn">as</span> <span class="nn">pickle</span>
<span class="kn">from</span> <span class="nn">stat</span> <span class="kn">import</span> <span class="n">ST_MTIME</span>


<span class="c"># We import only jumpscale as the j.system.fs is used before jumpscale is initialized. Thus the q cannot be imported yet</span>


<span class="kn">from</span> <span class="nn">JumpScale</span> <span class="kn">import</span> <span class="n">j</span>
<span class="kn">import</span> <span class="nn">JumpScale.baselib.codetools</span> <span class="c">#requirement for parsePath</span>
<span class="kn">from</span> <span class="nn">text</span> <span class="kn">import</span> <span class="n">Text</span>

<span class="n">toStr</span> <span class="o">=</span> <span class="n">Text</span><span class="o">.</span><span class="n">toStr</span>
<span class="c">#from JumpScale.core.decorators import deprecated</span>

<span class="c"># We do not use the j.system.platformtype here nor do we import the PlatformType as this would</span>
<span class="c"># lead to circular imports and raise an exception</span>

<span class="k">if</span> <span class="ow">not</span> <span class="n">sys</span><span class="o">.</span><span class="n">platform</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;win&#39;</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="kn">import</span> <span class="nn">fcntl</span>
    <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
        <span class="k">pass</span>

<span class="n">_LOCKDICTIONARY</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>

<div class="viewcode-block" id="LockException"><a class="viewcode-back" href="../../../../API/JumpScale.core.system.html#JumpScale.core.system.fs.LockException">[docs]</a><span class="k">class</span> <span class="nc">LockException</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="o">=</span><span class="s">&#39;Failed to get lock&#39;</span><span class="p">,</span> <span class="n">innerException</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">innerException</span><span class="p">:</span>
            <span class="n">message</span> <span class="o">+=</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">Problem caused by:</span><span class="se">\n</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">innerException</span>
        <span class="ne">Exception</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">innerException</span> <span class="o">=</span> <span class="n">innerException</span>
</div>
<div class="viewcode-block" id="LockTimeoutException"><a class="viewcode-back" href="../../../../API/JumpScale.core.system.html#JumpScale.core.system.fs.LockTimeoutException">[docs]</a><span class="k">class</span> <span class="nc">LockTimeoutException</span><span class="p">(</span><span class="n">LockException</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="o">=</span><span class="s">&#39;Lock request timed out&#39;</span><span class="p">,</span> <span class="n">innerException</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="n">LockException</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">,</span> <span class="n">innerException</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Exceptions"><a class="viewcode-back" href="../../../../API/JumpScale.core.system.html#JumpScale.core.system.fs.Exceptions">[docs]</a><span class="k">class</span> <span class="nc">Exceptions</span><span class="p">:</span>
    <span class="n">LockException</span> <span class="o">=</span> <span class="n">LockException</span>
    <span class="n">LockTimeoutException</span> <span class="o">=</span> <span class="n">LockTimeoutException</span>

</div>
<div class="viewcode-block" id="cleanupString"><a class="viewcode-back" href="../../../../API/JumpScale.core.system.html#JumpScale.core.system.fs.cleanupString">[docs]</a><span class="k">def</span> <span class="nf">cleanupString</span><span class="p">(</span><span class="n">string</span><span class="p">,</span> <span class="n">replacewith</span><span class="o">=</span><span class="s">&quot;_&quot;</span><span class="p">,</span> <span class="n">regex</span><span class="o">=</span><span class="s">&quot;([^A-Za-z0-9])&quot;</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Remove all non-numeric or alphanumeric characters&#39;&#39;&#39;</span>
    <span class="c"># Please don&#39;t use the logging system here. The logging system</span>
    <span class="c"># needs this method, using the logging system here would</span>
    <span class="c"># introduce a circular dependency. Be careful not to call other</span>
    <span class="c"># functions that use the logging system.</span>
    <span class="k">return</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="n">regex</span><span class="p">,</span> <span class="n">replacewith</span><span class="p">,</span> <span class="n">string</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="lock"><a class="viewcode-back" href="../../../../API/JumpScale.core.system.html#JumpScale.core.system.fs.lock">[docs]</a><span class="k">def</span> <span class="nf">lock</span><span class="p">(</span><span class="n">lockname</span><span class="p">,</span> <span class="n">locktimeout</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span> <span class="n">reentry</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Take a system-wide interprocess exclusive lock. Default timeout is 60 seconds&#39;&#39;&#39;</span>
    <span class="n">j</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s">&#39;Lock with name: </span><span class="si">%s</span><span class="s">&#39;</span><span class="o">%</span> <span class="n">lockname</span><span class="p">,</span><span class="mi">6</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">lock_</span><span class="p">(</span><span class="n">lockname</span><span class="p">,</span> <span class="n">locktimeout</span><span class="p">,</span> <span class="n">reentry</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">LockException</span><span class="p">(</span><span class="n">innerException</span><span class="o">=</span><span class="n">e</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">result</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">LockTimeoutException</span><span class="p">(</span><span class="n">message</span><span class="o">=</span><span class="s">&quot;Cannot acquire lock [</span><span class="si">%s</span><span class="s">]&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">lockname</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">result</span>
</div>
<div class="viewcode-block" id="lock_"><a class="viewcode-back" href="../../../../API/JumpScale.core.system.html#JumpScale.core.system.fs.lock_">[docs]</a><span class="k">def</span> <span class="nf">lock_</span><span class="p">(</span><span class="n">lockname</span><span class="p">,</span> <span class="n">locktimeout</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span> <span class="n">reentry</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Take a system-wide interprocess exclusive lock.</span>

<span class="sd">    Works similar to j.system.fs.lock but uses return values to denote lock</span>
<span class="sd">    success instead of raising fatal errors.</span>

<span class="sd">    This refactoring was mainly done to make the lock implementation easier</span>
<span class="sd">    to unit-test.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="c">#TODO This no longer uses fnctl on Unix, why?</span>
    <span class="n">LOCKPATH</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">j</span><span class="o">.</span><span class="n">dirs</span><span class="o">.</span><span class="n">tmpDir</span><span class="p">,</span> <span class="s">&#39;locks&#39;</span><span class="p">)</span>
    <span class="n">lockfile</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">LOCKPATH</span><span class="p">,</span> <span class="n">cleanupString</span><span class="p">(</span><span class="n">lockname</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">reentry</span><span class="p">:</span>
        <span class="n">_LOCKDICTIONARY</span><span class="p">[</span><span class="n">lockname</span><span class="p">]</span> <span class="o">=</span> <span class="n">_LOCKDICTIONARY</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">lockname</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">islocked</span><span class="p">(</span><span class="n">lockname</span><span class="p">,</span> <span class="n">reentry</span><span class="o">=</span><span class="n">reentry</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">j</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">LOCKPATH</span><span class="p">):</span>
            <span class="n">j</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">createDir</span><span class="p">(</span><span class="n">LOCKPATH</span><span class="p">)</span>

        <span class="n">j</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">writeFile</span><span class="p">(</span><span class="n">lockfile</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getpid</span><span class="p">()))</span>
        <span class="k">return</span> <span class="bp">True</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">locked</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="n">locktimeout</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
            <span class="n">locked</span> <span class="o">=</span> <span class="n">islocked</span><span class="p">(</span><span class="n">lockname</span><span class="p">,</span> <span class="n">reentry</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">locked</span><span class="p">:</span>
                <span class="k">break</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">locked</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">lock_</span><span class="p">(</span><span class="n">lockname</span><span class="p">,</span> <span class="n">locktimeout</span><span class="p">,</span> <span class="n">reentry</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">False</span>
</div>
<div class="viewcode-block" id="islocked"><a class="viewcode-back" href="../../../../API/JumpScale.core.system.html#JumpScale.core.system.fs.islocked">[docs]</a><span class="k">def</span> <span class="nf">islocked</span><span class="p">(</span><span class="n">lockname</span><span class="p">,</span> <span class="n">reentry</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Check if a system-wide interprocess exclusive lock is set&#39;&#39;&#39;</span>
    <span class="n">isLocked</span> <span class="o">=</span> <span class="bp">True</span>
    <span class="n">LOCKPATH</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">j</span><span class="o">.</span><span class="n">dirs</span><span class="o">.</span><span class="n">tmpDir</span><span class="p">,</span> <span class="s">&#39;locks&#39;</span><span class="p">)</span>
    <span class="n">lockfile</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">LOCKPATH</span><span class="p">,</span> <span class="n">cleanupString</span><span class="p">(</span><span class="n">lockname</span><span class="p">))</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="c"># read the pid from the lockfile</span>
        <span class="k">if</span> <span class="n">j</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">lockfile</span><span class="p">):</span>
            <span class="n">pid</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">lockfile</span><span class="p">,</span><span class="s">&#39;rb&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">False</span>

    <span class="k">except</span> <span class="p">(</span><span class="ne">OSError</span><span class="p">,</span> <span class="ne">IOError</span><span class="p">),</span> <span class="n">e</span><span class="p">:</span>
        <span class="c"># failed to read the lockfile</span>
        <span class="k">if</span> <span class="n">e</span><span class="o">.</span><span class="n">errno</span> <span class="o">!=</span> <span class="n">errno</span><span class="o">.</span><span class="n">ENOENT</span><span class="p">:</span> <span class="c"># exception is not &#39;file or directory not found&#39; -&gt; file probably locked</span>
            <span class="k">raise</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c"># open succeeded without exceptions, continue</span>
        <span class="c"># check if a process with pid is still running</span>
        <span class="k">if</span> <span class="n">pid</span> <span class="ow">and</span> <span class="n">pid</span><span class="o">.</span><span class="n">isdigit</span><span class="p">():</span>
            <span class="n">pid</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">pid</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">reentry</span> <span class="ow">and</span> <span class="n">pid</span> <span class="o">==</span> <span class="n">os</span><span class="o">.</span><span class="n">getpid</span><span class="p">():</span>
                <span class="k">return</span> <span class="bp">False</span>
        <span class="k">if</span> <span class="n">j</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">lockfile</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="ow">not</span> <span class="n">pid</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">j</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">isPidAlive</span><span class="p">(</span><span class="n">pid</span><span class="p">)):</span>
            <span class="c">#cleanup system, pid not active, remove the lockfile</span>
            <span class="n">j</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">lockfile</span><span class="p">)</span>
            <span class="n">isLocked</span> <span class="o">=</span> <span class="bp">False</span>
    <span class="k">return</span> <span class="n">isLocked</span>
</div>
<div class="viewcode-block" id="unlock"><a class="viewcode-back" href="../../../../API/JumpScale.core.system.html#JumpScale.core.system.fs.unlock">[docs]</a><span class="k">def</span> <span class="nf">unlock</span><span class="p">(</span><span class="n">lockname</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Unlock system-wide interprocess lock&quot;&quot;&quot;</span>
    <span class="n">j</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s">&#39;UnLock with name: </span><span class="si">%s</span><span class="s">&#39;</span><span class="o">%</span> <span class="n">lockname</span><span class="p">,</span><span class="mi">6</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">unlock_</span><span class="p">(</span><span class="n">lockname</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span><span class="p">,</span> <span class="n">msg</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s">&quot;Cannot unlock [</span><span class="si">%s</span><span class="s">] with ERROR: </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">lockname</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">msg</span><span class="p">)))</span>
</div>
<div class="viewcode-block" id="unlock_"><a class="viewcode-back" href="../../../../API/JumpScale.core.system.html#JumpScale.core.system.fs.unlock_">[docs]</a><span class="k">def</span> <span class="nf">unlock_</span><span class="p">(</span><span class="n">lockname</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Unlock system-wide interprocess lock</span>

<span class="sd">    Works similar to j.system.fs.unlock but uses return values to denote unlock</span>
<span class="sd">    success instead of raising fatal errors.</span>

<span class="sd">    This refactoring was mainly done to make the lock implementation easier</span>
<span class="sd">    to unit-test.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">LOCKPATH</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">j</span><span class="o">.</span><span class="n">dirs</span><span class="o">.</span><span class="n">tmpDir</span><span class="p">,</span> <span class="s">&#39;locks&#39;</span><span class="p">)</span>
    <span class="n">lockfile</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">LOCKPATH</span><span class="p">,</span> <span class="n">cleanupString</span><span class="p">(</span><span class="n">lockname</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">lockname</span> <span class="ow">in</span> <span class="n">_LOCKDICTIONARY</span><span class="p">:</span>
        <span class="n">_LOCKDICTIONARY</span><span class="p">[</span><span class="n">lockname</span><span class="p">]</span> <span class="o">-=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">_LOCKDICTIONARY</span><span class="p">[</span><span class="n">lockname</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span>

    <span class="c"># read the pid from the lockfile</span>
    <span class="k">if</span> <span class="n">j</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">lockfile</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">pid</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">lockfile</span><span class="p">,</span><span class="s">&#39;rb&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">pid</span><span class="p">)</span> <span class="o">!=</span> <span class="n">os</span><span class="o">.</span><span class="n">getpid</span><span class="p">():</span>
            <span class="n">j</span><span class="o">.</span><span class="n">errorconditionhandler</span><span class="o">.</span><span class="n">raiseWarning</span><span class="p">(</span><span class="s">&quot;Lock </span><span class="si">%r</span><span class="s"> not owned by this process&quot;</span> <span class="o">%</span><span class="n">lockname</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="n">j</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">lockfile</span><span class="p">)</span>
    <span class="c"># else:</span>
    <span class="c">#     j.console.echo(&quot;Lock %r not found&quot;%lockname)</span>

</div>
<div class="viewcode-block" id="FileLock"><a class="viewcode-back" href="../../../../API/JumpScale.core.system.html#JumpScale.core.system.fs.FileLock">[docs]</a><span class="k">class</span> <span class="nc">FileLock</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Context manager for file-based locks</span>

<span class="sd">    Context managers were introduced in Python 2.5, see the documentation on the</span>
<span class="sd">    &#39;with&#39; statement for more information:</span>

<span class="sd">     * http://www.python.org/dev/peps/pep-0343/</span>
<span class="sd">     * http://pyref.infogami.com/with</span>

<span class="sd">    @see: L{lock}</span>
<span class="sd">    @see: L{unlock}</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lock_name</span><span class="p">,</span> <span class="n">reentry</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lock_name</span> <span class="o">=</span> <span class="n">lock_name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reentry</span> <span class="o">=</span> <span class="n">reentry</span>

    <span class="k">def</span> <span class="nf">__enter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">lock</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lock_name</span><span class="p">,</span> <span class="n">reentry</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">reentry</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__exit__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">exc_info</span><span class="p">):</span>
        <span class="n">unlock</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lock_name</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">func</span><span class="p">):</span>
        <span class="k">def</span> <span class="nf">wrapper</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
            <span class="n">lock</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lock_name</span><span class="p">,</span> <span class="n">reentry</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">reentry</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="k">finally</span><span class="p">:</span>
                <span class="n">unlock</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lock_name</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">wrapper</span>

</div>
<div class="viewcode-block" id="SystemFS"><a class="viewcode-back" href="../../../../API/JumpScale.core.system.html#JumpScale.core.system.fs.SystemFS">[docs]</a><span class="k">class</span> <span class="nc">SystemFS</span><span class="p">:</span>
    <span class="n">exceptions</span> <span class="o">=</span> <span class="n">Exceptions</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logenable</span><span class="o">=</span><span class="bp">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">loglevel</span><span class="o">=</span><span class="mi">5</span>

<div class="viewcode-block" id="SystemFS.log"><a class="viewcode-back" href="../../../../API/JumpScale.core.system.html#JumpScale.core.system.fs.SystemFS.log">[docs]</a>    <span class="k">def</span> <span class="nf">log</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">msg</span><span class="p">,</span><span class="n">level</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span><span class="n">category</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">):</span>
        <span class="c"># print msg</span>
        <span class="k">if</span> <span class="n">level</span><span class="o">&lt;</span><span class="bp">self</span><span class="o">.</span><span class="n">loglevel</span><span class="o">+</span><span class="mi">1</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">logenable</span><span class="p">:</span>
            <span class="n">j</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span><span class="n">category</span><span class="o">=</span><span class="s">&quot;system.fs.</span><span class="si">%s</span><span class="s">&quot;</span><span class="o">%</span><span class="n">category</span><span class="p">,</span><span class="n">level</span><span class="o">=</span><span class="n">level</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="SystemFS.copyFile"><a class="viewcode-back" href="../../../../API/JumpScale.core.system.html#JumpScale.core.system.fs.SystemFS.copyFile">[docs]</a>    <span class="k">def</span> <span class="nf">copyFile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fileFrom</span><span class="p">,</span> <span class="n">to</span> <span class="p">,</span><span class="n">createDirIfNeeded</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span><span class="n">skipProtectedDirs</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span><span class="n">overwriteFile</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Copy file</span>

<span class="sd">        Copies the file from C{fileFrom} to the file or directory C{to}.</span>
<span class="sd">        If C{to} is a directory, a file with the same basename as C{fileFrom} is</span>
<span class="sd">        created (or overwritten) in the directory specified.</span>
<span class="sd">        Permission bits are copied.</span>

<span class="sd">        @param fileFrom: Source file path name</span>
<span class="sd">        @type fileFrom: string</span>
<span class="sd">        @param to: Destination file or folder path name</span>
<span class="sd">        @type to: string</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="k">if</span> <span class="p">((</span><span class="n">fileFrom</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">to</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s">&quot;No parameters given to system.fs.copyFile from </span><span class="si">%s</span><span class="s">, to </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">fileFrom</span><span class="p">,</span> <span class="n">to</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">j</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">isFile</span><span class="p">(</span><span class="n">fileFrom</span><span class="p">):</span>
            <span class="c"># Create target folder first, otherwise copy fails</span>
            <span class="k">if</span> <span class="n">createDirIfNeeded</span><span class="p">:</span>
                <span class="n">target_folder</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">to</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">createDir</span><span class="p">(</span><span class="n">target_folder</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">overwriteFile</span><span class="o">==</span><span class="bp">False</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">to</span><span class="p">):</span>
                    <span class="k">return</span>
            <span class="k">if</span> <span class="n">skipProtectedDirs</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">j</span><span class="o">.</span><span class="n">dirs</span><span class="o">.</span><span class="n">checkInProtectedDir</span><span class="p">(</span><span class="n">to</span><span class="p">):</span>
                    <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s">&quot;did not copyFile from:</span><span class="si">%s</span><span class="s"> to:</span><span class="si">%s</span><span class="s"> because in protected dir&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">fileFrom</span><span class="p">,</span><span class="n">to</span><span class="p">))</span>
                    <span class="k">return</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">shutil</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">fileFrom</span><span class="p">,</span> <span class="n">to</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s">&quot;Copied file from </span><span class="si">%s</span><span class="s"> to </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">fileFrom</span><span class="p">,</span><span class="n">to</span><span class="p">),</span><span class="mi">6</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">,</span><span class="n">e</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s">&quot;Could not copy file from </span><span class="si">%s</span><span class="s"> to </span><span class="si">%s</span><span class="s">, error </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">fileFrom</span><span class="p">,</span><span class="n">to</span><span class="p">,</span><span class="n">e</span><span class="p">))</span>                
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s">&quot;Can not copy file, file: </span><span class="si">%s</span><span class="s"> does not exist in system.fs.copyFile&quot;</span> <span class="o">%</span> <span class="p">(</span> <span class="n">fileFrom</span> <span class="p">)</span> <span class="p">)</span>
</div>
<div class="viewcode-block" id="SystemFS.moveFile"><a class="viewcode-back" href="../../../../API/JumpScale.core.system.html#JumpScale.core.system.fs.SystemFS.moveFile">[docs]</a>    <span class="k">def</span> <span class="nf">moveFile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">destin</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Move a  File from source path to destination path</span>
<span class="sd">        @param source: string (Source file path)</span>
<span class="sd">        @param destination: string (Destination path the file should be moved to )</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s">&#39;Move file from </span><span class="si">%s</span><span class="s"> to </span><span class="si">%s</span><span class="s">&#39;</span><span class="o">%</span> <span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">destin</span><span class="p">),</span><span class="mi">6</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">((</span><span class="n">source</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">destin</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s">&quot;Not enough parameters given to system.fs.moveFile: move from </span><span class="si">%s</span><span class="s">, to </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">destin</span><span class="p">))</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">j</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">isFile</span><span class="p">(</span><span class="n">source</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s">&quot;The specified source path in system.fs.moveFile does not exist or is no file: </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">source</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">move</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">destin</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">,</span><span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s">&quot;File could not be moved...in system.fs.moveFile: from </span><span class="si">%s</span><span class="s"> to </span><span class="si">%s</span><span class="s"> , Error </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">destin</span><span class="p">,</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)))</span>
</div>
<div class="viewcode-block" id="SystemFS.renameFile"><a class="viewcode-back" href="../../../../API/JumpScale.core.system.html#JumpScale.core.system.fs.SystemFS.renameFile">[docs]</a>    <span class="k">def</span> <span class="nf">renameFile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filePath</span><span class="p">,</span> <span class="n">new_name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        OBSOLETE</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s">&quot;WARNING: renameFIle should not be used&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">move</span><span class="p">(</span><span class="n">filePath</span><span class="p">,</span><span class="n">new_name</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="SystemFS.removeIrrelevantFiles"><a class="viewcode-back" href="../../../../API/JumpScale.core.system.html#JumpScale.core.system.fs.SystemFS.removeIrrelevantFiles">[docs]</a>    <span class="k">def</span> <span class="nf">removeIrrelevantFiles</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">path</span><span class="p">,</span><span class="n">followSymlinks</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="n">ext</span><span class="o">=</span><span class="p">[</span><span class="s">&quot;pyc&quot;</span><span class="p">,</span><span class="s">&quot;bak&quot;</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">listFilesInDir</span><span class="p">(</span><span class="n">path</span><span class="p">,</span><span class="n">recursive</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span><span class="n">followSymlinks</span><span class="o">=</span><span class="n">followSymlinks</span><span class="p">):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">getFileExtension</span><span class="p">(</span><span class="n">path</span><span class="p">)</span> <span class="ow">in</span> <span class="n">ext</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="SystemFS.remove"><a class="viewcode-back" href="../../../../API/JumpScale.core.system.html#JumpScale.core.system.fs.SystemFS.remove">[docs]</a>    <span class="k">def</span> <span class="nf">remove</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Remove a File</span>
<span class="sd">        @param path: string (File path required to be removed</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s">&#39;Remove file with path: </span><span class="si">%s</span><span class="s">&#39;</span><span class="o">%</span><span class="n">path</span><span class="p">,</span><span class="mi">6</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">path</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span> <span class="ow">and</span> <span class="n">path</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">==</span><span class="n">os</span><span class="o">.</span><span class="n">sep</span><span class="p">:</span>
            <span class="n">path</span><span class="o">=</span><span class="n">path</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>        
        <span class="k">if</span> <span class="n">path</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s">&#39;Not enough parameters passed to system.fs.removeFile: </span><span class="si">%s</span><span class="s">&#39;</span><span class="o">%</span><span class="n">path</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">islink</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
            <span class="n">os</span><span class="o">.</span><span class="n">unlink</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s">&quot;File with path: </span><span class="si">%s</span><span class="s"> could not be removed</span><span class="se">\n</span><span class="s">Details: </span><span class="si">%s</span><span class="s">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">sys</span><span class="o">.</span><span class="n">exc_type</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s">&#39;Done removing file with path: </span><span class="si">%s</span><span class="s">&#39;</span><span class="o">%</span><span class="n">path</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="SystemFS.createEmptyFile"><a class="viewcode-back" href="../../../../API/JumpScale.core.system.html#JumpScale.core.system.fs.SystemFS.createEmptyFile">[docs]</a>    <span class="k">def</span> <span class="nf">createEmptyFile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Create an empty file</span>
<span class="sd">        @param filename: string (file path name to be created)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s">&#39;creating an empty file with name &amp; path: </span><span class="si">%s</span><span class="s">&#39;</span><span class="o">%</span><span class="n">filename</span><span class="p">,</span><span class="mi">9</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">filename</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ArithmeticError</span><span class="p">(</span><span class="s">&#39;Not enough parameters passed to system.fs.createEmptyFile: </span><span class="si">%s</span><span class="s">&#39;</span><span class="o">%</span><span class="n">filename</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s">&quot;w&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s">&#39;Empty file </span><span class="si">%s</span><span class="s"> has been successfully created&#39;</span><span class="o">%</span><span class="n">filename</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s">&quot;Failed to create an empty file with the specified filename: </span><span class="si">%s</span><span class="s">&quot;</span><span class="o">%</span><span class="n">filename</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="SystemFS.createDir"><a class="viewcode-back" href="../../../../API/JumpScale.core.system.html#JumpScale.core.system.fs.SystemFS.createDir">[docs]</a>    <span class="k">def</span> <span class="nf">createDir</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">newdir</span><span class="p">,</span><span class="n">skipProtectedDirs</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Create new Directory</span>
<span class="sd">        @param newdir: string (Directory path/name)</span>
<span class="sd">        if newdir was only given as a directory name, the new directory will be created on the default path,</span>
<span class="sd">        if newdir was given as a complete path with the directory name, the new directory will be created in the specified path</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">newdir</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&quot;file://&quot;</span><span class="p">)</span><span class="o">&lt;&gt;-</span><span class="mi">1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s">&quot;Cannot use file notation here&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s">&#39;Creating directory if not exists </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">toStr</span><span class="p">(</span><span class="n">newdir</span><span class="p">),</span> <span class="mi">8</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">skipProtectedDirs</span> <span class="ow">and</span> <span class="n">j</span><span class="o">.</span><span class="n">dirs</span><span class="o">.</span><span class="n">checkInProtectedDir</span><span class="p">(</span><span class="n">newdir</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s">&quot;did not create dir:</span><span class="si">%s</span><span class="s"> because in protected dir&quot;</span><span class="o">%</span><span class="n">newdir</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="k">if</span> <span class="n">newdir</span> <span class="o">==</span> <span class="s">&#39;&#39;</span> <span class="ow">or</span> <span class="n">newdir</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s">&#39;The newdir-parameter of system.fs.createDir() is None or an empty string.&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">isLink</span><span class="p">(</span><span class="n">newdir</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">unlink</span><span class="p">(</span><span class="n">newdir</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">isDir</span><span class="p">(</span><span class="n">newdir</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s">&#39;Directory trying to create: [</span><span class="si">%s</span><span class="s">] already exists&#39;</span> <span class="o">%</span> <span class="n">toStr</span><span class="p">(</span><span class="n">newdir</span><span class="p">),</span> <span class="mi">8</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">head</span><span class="p">,</span> <span class="n">tail</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">newdir</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">head</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">j</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">isDir</span><span class="p">(</span><span class="n">head</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">createDir</span><span class="p">(</span><span class="n">head</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">tail</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">newdir</span><span class="p">)</span>
                    <span class="c"># print &quot;mkdir:%s&quot;%newdir</span>
                <span class="k">except</span> <span class="ne">OSError</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">e</span><span class="o">.</span><span class="n">errno</span> <span class="o">!=</span> <span class="n">os</span><span class="o">.</span><span class="n">errno</span><span class="o">.</span><span class="n">EEXIST</span><span class="p">:</span> <span class="c">#File exists</span>
                        <span class="k">raise</span>
                    
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s">&#39;Created the directory [</span><span class="si">%s</span><span class="s">]&#39;</span> <span class="o">%</span> <span class="n">toStr</span><span class="p">(</span><span class="n">newdir</span><span class="p">),</span> <span class="mi">8</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="SystemFS.copyDirTree"><a class="viewcode-back" href="../../../../API/JumpScale.core.system.html#JumpScale.core.system.fs.SystemFS.copyDirTree">[docs]</a>    <span class="k">def</span> <span class="nf">copyDirTree</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">src</span><span class="p">,</span> <span class="n">dst</span><span class="p">,</span> <span class="n">keepsymlinks</span> <span class="o">=</span> <span class="bp">False</span><span class="p">,</span> <span class="n">eraseDestination</span> <span class="o">=</span> <span class="bp">False</span><span class="p">,</span> <span class="n">skipProtectedDirs</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">overwriteFiles</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span><span class="n">applyHrdOnDestPaths</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Recursively copy an entire directory tree rooted at src.</span>
<span class="sd">        The dst directory may already exist; if not,</span>
<span class="sd">        it will be created as well as missing parent directories</span>
<span class="sd">        @param src: string (source of directory tree to be copied)</span>
<span class="sd">        @param dst: string (path directory to be copied to...should not already exist)</span>
<span class="sd">        @param keepsymlinks: bool (True keeps symlinks instead of copying the content of the file)</span>
<span class="sd">        @param eraseDestination: bool (Set to True if you want to erase destination first, be carefull, this can erase directories)</span>
<span class="sd">        @param overwriteFiles: if True will overwrite files, otherwise will not overwrite when destination exists</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">src</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&quot;file://&quot;</span><span class="p">)</span><span class="o">&lt;&gt;-</span><span class="mi">1</span> <span class="ow">or</span> <span class="n">dst</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&quot;file://&quot;</span><span class="p">)</span><span class="o">&lt;&gt;-</span><span class="mi">1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s">&quot;Cannot use file notation here&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s">&#39;Copy directory tree from </span><span class="si">%s</span><span class="s"> to </span><span class="si">%s</span><span class="s">&#39;</span><span class="o">%</span> <span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">dst</span><span class="p">),</span><span class="mi">6</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">((</span><span class="n">src</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">dst</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s">&#39;Not enough parameters passed in system.fs.copyDirTree to copy directory from </span><span class="si">%s</span><span class="s"> to </span><span class="si">%s</span><span class="s"> &#39;</span><span class="o">%</span> <span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">dst</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">j</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">isDir</span><span class="p">(</span><span class="n">src</span><span class="p">):</span>
            <span class="n">names</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">src</span><span class="p">)</span>
 
            <span class="k">if</span> <span class="ow">not</span> <span class="n">j</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">dst</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">createDir</span><span class="p">(</span><span class="n">dst</span><span class="p">,</span><span class="n">skipProtectedDirs</span><span class="o">=</span><span class="n">skipProtectedDirs</span><span class="p">)</span>

            <span class="n">errors</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">names</span><span class="p">:</span>
                <span class="c">#is only for the name</span>
                <span class="k">if</span> <span class="n">applyHrdOnDestPaths</span><span class="o">&lt;&gt;</span><span class="bp">None</span><span class="p">:</span>
                    <span class="n">name2</span><span class="o">=</span><span class="n">applyHrdOnDestPaths</span><span class="o">.</span><span class="n">applyOnContent</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">name2</span><span class="o">=</span><span class="n">name</span>

                <span class="n">srcname</span> <span class="o">=</span> <span class="n">j</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">joinPaths</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
                <span class="n">dstname</span> <span class="o">=</span> <span class="n">j</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">joinPaths</span><span class="p">(</span><span class="n">dst</span><span class="p">,</span> <span class="n">name2</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">eraseDestination</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span> <span class="n">dstname</span> <span class="p">):</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">isDir</span><span class="p">(</span> <span class="n">dstname</span> <span class="p">,</span> <span class="bp">False</span> <span class="p">)</span> <span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">removeDirTree</span><span class="p">(</span> <span class="n">dstname</span> <span class="p">)</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">isLink</span><span class="p">(</span><span class="n">dstname</span><span class="p">):</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">unlink</span><span class="p">(</span> <span class="n">dstname</span> <span class="p">)</span>

                <span class="k">if</span> <span class="n">keepsymlinks</span> <span class="ow">and</span> <span class="n">j</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">isLink</span><span class="p">(</span><span class="n">srcname</span><span class="p">):</span>
                    <span class="n">linkto</span> <span class="o">=</span> <span class="n">j</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">readlink</span><span class="p">(</span><span class="n">srcname</span><span class="p">)</span>
                    <span class="n">j</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">symlink</span><span class="p">(</span><span class="n">linkto</span><span class="p">,</span> <span class="n">dstname</span><span class="p">,</span> <span class="n">overwriteFiles</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">j</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">isDir</span><span class="p">(</span><span class="n">srcname</span><span class="p">):</span>
                    <span class="c">#print &quot;1:%s %s&quot;%(srcname,dstname)</span>
                    <span class="n">j</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">copyDirTree</span><span class="p">(</span><span class="n">srcname</span><span class="p">,</span> <span class="n">dstname</span><span class="p">,</span> <span class="n">keepsymlinks</span><span class="p">,</span> <span class="n">eraseDestination</span><span class="p">,</span><span class="n">skipProtectedDirs</span><span class="o">=</span><span class="n">skipProtectedDirs</span><span class="p">,</span><span class="n">overwriteFiles</span><span class="o">=</span><span class="n">overwriteFiles</span><span class="p">,</span><span class="n">applyHrdOnDestPaths</span><span class="o">=</span><span class="n">applyHrdOnDestPaths</span> <span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c">#print &quot;2:%s %s&quot;%(srcname,dstname)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">copyFile</span><span class="p">(</span><span class="n">srcname</span><span class="p">,</span> <span class="n">dstname</span> <span class="p">,</span><span class="n">createDirIfNeeded</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span><span class="n">skipProtectedDirs</span><span class="o">=</span><span class="n">skipProtectedDirs</span><span class="p">,</span><span class="n">overwriteFile</span><span class="o">=</span><span class="n">overwriteFiles</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s">&#39;Source path </span><span class="si">%s</span><span class="s"> in system.fs.copyDirTree is not a directory&#39;</span><span class="o">%</span> <span class="n">src</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="SystemFS.removeDirTree"><a class="viewcode-back" href="../../../../API/JumpScale.core.system.html#JumpScale.core.system.fs.SystemFS.removeDirTree">[docs]</a>    <span class="k">def</span> <span class="nf">removeDirTree</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">onlyLogWarningOnRemoveError</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Recursively delete a directory tree.</span>
<span class="sd">            @param path: the path to be removed</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s">&#39;Removing directory tree with path: </span><span class="si">%s</span><span class="s">&#39;</span><span class="o">%</span><span class="n">path</span><span class="p">,</span><span class="mi">6</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">isLink</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">isFile</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">path</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&#39;Path is None in system.fs.removeDir&#39;</span><span class="p">)</span>
        <span class="k">if</span><span class="p">(</span><span class="n">j</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">path</span><span class="p">)):</span>
            <span class="k">if</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">isDir</span><span class="p">(</span><span class="n">path</span><span class="p">)):</span>
                <span class="k">if</span> <span class="n">onlyLogWarningOnRemoveError</span><span class="p">:</span>
                    <span class="k">def</span> <span class="nf">errorHandler</span><span class="p">(</span><span class="n">shutilFunc</span><span class="p">,</span> <span class="n">shutilPath</span><span class="p">,</span> <span class="n">shutilExc_info</span><span class="p">):</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s">&#39;WARNING: could not remove </span><span class="si">%s</span><span class="s"> while recursively deleting </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">shutilPath</span><span class="p">,</span> <span class="n">path</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s">&#39;Trying to remove Directory tree with path: </span><span class="si">%s</span><span class="s"> (warn on errors)&#39;</span><span class="o">%</span><span class="n">path</span><span class="p">)</span>
                    <span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">onerror</span><span class="o">=</span><span class="n">errorHandler</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s">&#39;Trying to remove Directory tree with path: </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">path</span><span class="p">)</span>
                    <span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
                    
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s">&#39;Directory tree with path: </span><span class="si">%s</span><span class="s"> is successfully removed&#39;</span> <span class="o">%</span> <span class="n">path</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;Specified path: </span><span class="si">%s</span><span class="s"> is not a Directory in system.fs.removeDirTree&quot;</span> <span class="o">%</span> <span class="n">path</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="SystemFS.removeDir"><a class="viewcode-back" href="../../../../API/JumpScale.core.system.html#JumpScale.core.system.fs.SystemFS.removeDir">[docs]</a>    <span class="k">def</span> <span class="nf">removeDir</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Remove a Directory</span>
<span class="sd">        @param path: string (Directory path that should be removed)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s">&#39;Removing the directory with path: </span><span class="si">%s</span><span class="s">&#39;</span><span class="o">%</span><span class="n">path</span><span class="p">,</span><span class="mi">6</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">path</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s">&#39;Path is None in system.fs.removeDir&#39;</span><span class="p">)</span>
        <span class="k">if</span><span class="p">(</span><span class="n">j</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">path</span><span class="p">)):</span>
            <span class="k">if</span><span class="p">(</span><span class="n">j</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">isDir</span><span class="p">(</span><span class="n">path</span><span class="p">)):</span>
                <span class="n">os</span><span class="o">.</span><span class="n">rmdir</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s">&#39;Directory with path: </span><span class="si">%s</span><span class="s"> is successfully removed&#39;</span><span class="o">%</span><span class="n">path</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;Path: </span><span class="si">%s</span><span class="s"> is not a Directory in system.fs.removeDir&quot;</span><span class="o">%</span> <span class="n">path</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s">&quot;Path: </span><span class="si">%s</span><span class="s"> does not exist in system.fs.removeDir&quot;</span><span class="o">%</span> <span class="n">path</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="SystemFS.changeDir"><a class="viewcode-back" href="../../../../API/JumpScale.core.system.html#JumpScale.core.system.fs.SystemFS.changeDir">[docs]</a>    <span class="k">def</span> <span class="nf">changeDir</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Changes Current Directory</span>
<span class="sd">        @param path: string (Directory path to be changed to)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s">&#39;Changing directory to: </span><span class="si">%s</span><span class="s">&#39;</span><span class="o">%</span><span class="n">path</span><span class="p">,</span><span class="mi">6</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">path</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s">&#39;Path is not given in system.fs.changeDir&#39;</span><span class="p">)</span>
        <span class="k">if</span><span class="p">(</span><span class="n">j</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">path</span><span class="p">)):</span>
            <span class="k">if</span><span class="p">(</span><span class="n">j</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">isDir</span><span class="p">(</span><span class="n">path</span><span class="p">)):</span>
                <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
                <span class="n">newcurrentPath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s">&#39;Directory successfully changed to </span><span class="si">%s</span><span class="s">&#39;</span><span class="o">%</span><span class="n">path</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">newcurrentPath</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;Path: </span><span class="si">%s</span><span class="s"> in system.fs.changeDir is not a Directory&quot;</span><span class="o">%</span> <span class="n">path</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s">&quot;Path: </span><span class="si">%s</span><span class="s"> in system.fs.changeDir does not exist&quot;</span><span class="o">%</span> <span class="n">path</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="SystemFS.moveDir"><a class="viewcode-back" href="../../../../API/JumpScale.core.system.html#JumpScale.core.system.fs.SystemFS.moveDir">[docs]</a>    <span class="k">def</span> <span class="nf">moveDir</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">destin</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Move Directory from source to destination</span>
<span class="sd">        @param source: string (Source path where the directory should be removed from)</span>
<span class="sd">        @param destin: string (Destination path where the directory should be moved into)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s">&#39;Moving directory from </span><span class="si">%s</span><span class="s"> to </span><span class="si">%s</span><span class="s">&#39;</span><span class="o">%</span> <span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">destin</span><span class="p">),</span><span class="mi">6</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">((</span><span class="n">source</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">destin</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s">&#39;Not enough passed parameters to moveDirectory from </span><span class="si">%s</span><span class="s"> to </span><span class="si">%s</span><span class="s"> in system.fs.moveDir &#39;</span><span class="o">%</span> <span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">destin</span><span class="p">))</span>
        <span class="k">if</span><span class="p">(</span><span class="n">j</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">isDir</span><span class="p">(</span><span class="n">source</span><span class="p">)):</span>
            <span class="n">j</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">move</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">destin</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s">&#39;Directory is successfully moved from </span><span class="si">%s</span><span class="s"> to </span><span class="si">%s</span><span class="s">&#39;</span><span class="o">%</span> <span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">destin</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s">&quot;Specified Source path: </span><span class="si">%s</span><span class="s"> does not exist in system.fs.moveDir&quot;</span><span class="o">%</span> <span class="n">source</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="SystemFS.joinPaths"><a class="viewcode-back" href="../../../../API/JumpScale.core.system.html#JumpScale.core.system.fs.SystemFS.joinPaths">[docs]</a>    <span class="k">def</span> <span class="nf">joinPaths</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Join one or more path components.</span>
<span class="sd">        If any component is an absolute path, all previous components are thrown away, and joining continues.</span>
<span class="sd">        @param path1: string</span>
<span class="sd">        @param path2: string</span>
<span class="sd">        @param path3: string</span>
<span class="sd">        @param .... : string</span>
<span class="sd">        @rtype: Concatenation of path1, and optionally path2, etc...,</span>
<span class="sd">        with exactly one directory separator (os.sep) inserted between components, unless path2 is empty.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">args</span> <span class="o">=</span> <span class="p">[</span> <span class="n">toStr</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">args</span> <span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s">&#39;Join paths </span><span class="si">%s</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">args</span><span class="p">)),</span><span class="mi">9</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">args</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s">&#39;Not enough parameters </span><span class="si">%s</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">args</span><span class="p">)))</span>
        <span class="k">if</span> <span class="n">j</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">platformtype</span><span class="o">.</span><span class="n">isWindows</span><span class="p">():</span>
            <span class="n">args2</span><span class="o">=</span><span class="p">[]</span>
            <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">args</span><span class="p">:</span>
                <span class="n">item</span><span class="o">=</span><span class="n">item</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&quot;/&quot;</span><span class="p">,</span><span class="s">&quot;</span><span class="se">\\</span><span class="s">&quot;</span><span class="p">)</span>
                <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">item</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span> <span class="ow">and</span> <span class="n">item</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">==</span><span class="s">&quot;</span><span class="se">\\</span><span class="s">&quot;</span><span class="p">:</span>
                    <span class="n">item</span><span class="o">=</span><span class="n">item</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
                <span class="n">args2</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
            <span class="n">args</span><span class="o">=</span><span class="n">args2</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">,</span><span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s">&quot;Failed to join paths: </span><span class="si">%s</span><span class="s">, Error </span><span class="si">%s</span><span class="s"> &quot;</span><span class="o">%</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">args</span><span class="p">),</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)))</span>
</div>
<div class="viewcode-block" id="SystemFS.getDirName"><a class="viewcode-back" href="../../../../API/JumpScale.core.system.html#JumpScale.core.system.fs.SystemFS.getDirName">[docs]</a>    <span class="k">def</span> <span class="nf">getDirName</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span><span class="n">lastOnly</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span><span class="n">levelsUp</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return a directory name from pathname path.</span>
<span class="sd">        @param path the path to find a directory within</span>
<span class="sd">        @param lastOnly means only the last part of the path which is a dir (overrides levelsUp to 0)</span>
<span class="sd">        @param levelsUp means, return the parent dir levelsUp levels up</span>
<span class="sd">         e.g. ...getDirName(&quot;/opt/qbase/bin/something/test.py&quot;, levelsUp=0) would return something</span>
<span class="sd">         e.g. ...getDirName(&quot;/opt/qbase/bin/something/test.py&quot;, levelsUp=1) would return bin</span>
<span class="sd">         e.g. ...getDirName(&quot;/opt/qbase/bin/something/test.py&quot;, levelsUp=10) would raise an error</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s">&#39;Get directory name of path: </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">path</span><span class="p">,</span><span class="mi">9</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">path</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s">&#39;Path is not passed in system.fs.getDirName&#39;</span><span class="p">)</span>
        <span class="n">dname</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
        <span class="n">dname</span><span class="o">=</span><span class="n">dname</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&quot;/&quot;</span><span class="p">,</span><span class="n">os</span><span class="o">.</span><span class="n">sep</span><span class="p">)</span>
        <span class="n">dname</span><span class="o">=</span><span class="n">dname</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&quot;//&quot;</span><span class="p">,</span><span class="n">os</span><span class="o">.</span><span class="n">sep</span><span class="p">)</span>
        <span class="n">dname</span><span class="o">=</span><span class="n">dname</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\\</span><span class="s">&quot;</span><span class="p">,</span><span class="n">os</span><span class="o">.</span><span class="n">sep</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">lastOnly</span><span class="p">:</span>
            <span class="n">dname</span><span class="o">=</span><span class="n">dname</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">sep</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">return</span> <span class="n">dname</span>
        <span class="k">if</span> <span class="n">levelsUp</span><span class="o">&lt;&gt;</span><span class="bp">None</span><span class="p">:</span>
            <span class="n">parts</span><span class="o">=</span><span class="n">dname</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">sep</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span><span class="o">-</span><span class="n">levelsUp</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">parts</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span><span class="o">-</span><span class="n">levelsUp</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">RuntimeError</span> <span class="p">(</span><span class="s">&quot;Cannot find part of dir </span><span class="si">%s</span><span class="s"> levels up, path </span><span class="si">%s</span><span class="s"> is not long enough&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">levelsUp</span><span class="p">,</span><span class="n">path</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">dname</span><span class="o">+</span><span class="n">os</span><span class="o">.</span><span class="n">sep</span>

</div>
<div class="viewcode-block" id="SystemFS.getBaseName"><a class="viewcode-back" href="../../../../API/JumpScale.core.system.html#JumpScale.core.system.fs.SystemFS.getBaseName">[docs]</a>    <span class="k">def</span> <span class="nf">getBaseName</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the base name of pathname path.&quot;&quot;&quot;</span>
        <span class="c"># self.log(&#39;Get basename for path: %s&#39;%path,9)</span>
        <span class="k">if</span> <span class="n">path</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s">&#39;Path is not passed in system.fs.getDirName&#39;</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">path</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">sep</span><span class="p">))</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">,</span><span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s">&#39;Failed to get base name of the given path: </span><span class="si">%s</span><span class="s">, Error: </span><span class="si">%s</span><span class="s">&#39;</span><span class="o">%</span> <span class="p">(</span><span class="n">path</span><span class="p">,</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)))</span>
</div>
<div class="viewcode-block" id="SystemFS.pathShorten"><a class="viewcode-back" href="../../../../API/JumpScale.core.system.html#JumpScale.core.system.fs.SystemFS.pathShorten">[docs]</a>    <span class="k">def</span> <span class="nf">pathShorten</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Clean path (change /var/www/../lib to /var/lib). On Windows, if the</span>
<span class="sd">        path exists, the short path name is returned.</span>

<span class="sd">        @param path: Path to clean</span>
<span class="sd">        @type path: string</span>
<span class="sd">        @return: Cleaned (short) path</span>
<span class="sd">        @rtype: string</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">cleanedPath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">normpath</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">j</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">platformtype</span><span class="o">.</span><span class="n">isWindows</span><span class="p">()</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">cleanedPath</span><span class="p">):</span>
            <span class="c"># Only execute on existing paths, otherwise an error will be raised</span>
            <span class="kn">import</span> <span class="nn">win32api</span>
            <span class="n">cleanedPath</span> <span class="o">=</span> <span class="n">win32api</span><span class="o">.</span><span class="n">GetShortPathName</span><span class="p">(</span><span class="n">cleanedPath</span><span class="p">)</span>
            <span class="c"># Re-add &#39;\&#39; if original path had one</span>
            <span class="n">sep</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">sep</span>
            <span class="k">if</span> <span class="n">path</span> <span class="ow">and</span> <span class="n">path</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="n">sep</span> <span class="ow">and</span> <span class="n">cleanedPath</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="n">sep</span><span class="p">:</span>
                <span class="n">cleanedPath</span> <span class="o">=</span> <span class="s">&quot;</span><span class="si">%s%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">cleanedPath</span><span class="p">,</span> <span class="n">sep</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">cleanedPath</span>
</div>
<div class="viewcode-block" id="SystemFS.pathClean"><a class="viewcode-back" href="../../../../API/JumpScale.core.system.html#JumpScale.core.system.fs.SystemFS.pathClean">[docs]</a>    <span class="k">def</span> <span class="nf">pathClean</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">path</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        goal is to get a equal representation in / &amp; \ in relation to os.sep</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">path</span><span class="o">=</span><span class="n">path</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&quot;/&quot;</span><span class="p">,</span><span class="n">os</span><span class="o">.</span><span class="n">sep</span><span class="p">)</span>
        <span class="n">path</span><span class="o">=</span><span class="n">path</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&quot;//&quot;</span><span class="p">,</span><span class="n">os</span><span class="o">.</span><span class="n">sep</span><span class="p">)</span>
        <span class="n">path</span><span class="o">=</span><span class="n">path</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\\</span><span class="s">&quot;</span><span class="p">,</span><span class="n">os</span><span class="o">.</span><span class="n">sep</span><span class="p">)</span>
        <span class="n">path</span><span class="o">=</span><span class="n">path</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\\\\</span><span class="s">&quot;</span><span class="p">,</span><span class="n">os</span><span class="o">.</span><span class="n">sep</span><span class="p">)</span>
        <span class="c">#path=self.pathNormalize(path)</span>
        <span class="n">path</span><span class="o">=</span><span class="n">path</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">path</span>
</div>
<div class="viewcode-block" id="SystemFS.pathDirClean"><a class="viewcode-back" href="../../../../API/JumpScale.core.system.html#JumpScale.core.system.fs.SystemFS.pathDirClean">[docs]</a>    <span class="k">def</span> <span class="nf">pathDirClean</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">path</span><span class="p">):</span>
        <span class="n">path</span><span class="o">=</span><span class="n">path</span><span class="o">+</span><span class="n">os</span><span class="o">.</span><span class="n">sep</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">pathClean</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="SystemFS.dirEqual"><a class="viewcode-back" href="../../../../API/JumpScale.core.system.html#JumpScale.core.system.fs.SystemFS.dirEqual">[docs]</a>    <span class="k">def</span> <span class="nf">dirEqual</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">path1</span><span class="p">,</span><span class="n">path2</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">pathDirClean</span><span class="p">(</span><span class="n">path1</span><span class="p">)</span><span class="o">==</span><span class="bp">self</span><span class="o">.</span><span class="n">pathDirClean</span><span class="p">(</span><span class="n">path1</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="SystemFS.pathNormalize"><a class="viewcode-back" href="../../../../API/JumpScale.core.system.html#JumpScale.core.system.fs.SystemFS.pathNormalize">[docs]</a>    <span class="k">def</span> <span class="nf">pathNormalize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span><span class="n">root</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        paths are made absolute &amp; made sure they are in line with os.sep</span>
<span class="sd">        @param path: path to normalize</span>
<span class="sd">        @root is std the application you are in, can overrule</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">root</span><span class="o">==</span><span class="s">&quot;&quot;</span><span class="p">:</span>
            <span class="n">root</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span>
        <span class="n">path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">pathClean</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">path</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span> <span class="ow">and</span> <span class="n">path</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">&lt;&gt;</span><span class="n">os</span><span class="o">.</span><span class="n">sep</span><span class="p">:</span>
            <span class="n">path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">joinPaths</span><span class="p">(</span><span class="n">root</span><span class="p">,</span><span class="n">path</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">path</span>
</div>
<div class="viewcode-block" id="SystemFS.pathRemoveDirPart"><a class="viewcode-back" href="../../../../API/JumpScale.core.system.html#JumpScale.core.system.fs.SystemFS.pathRemoveDirPart">[docs]</a>    <span class="k">def</span> <span class="nf">pathRemoveDirPart</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">path</span><span class="p">,</span><span class="n">toremove</span><span class="p">,</span><span class="n">removeTrailingSlash</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        goal remove dirparts of a dirpath e,g, a basepath which is not needed</span>
<span class="sd">        will look for part to remove in full path but only full dirs</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pathNormalize</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
        <span class="n">toremove</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pathNormalize</span><span class="p">(</span><span class="n">toremove</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pathClean</span><span class="p">(</span><span class="n">toremove</span><span class="p">)</span><span class="o">==</span><span class="bp">self</span><span class="o">.</span><span class="n">pathClean</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
            <span class="k">return</span> <span class="s">&quot;&quot;</span>
        <span class="n">path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">pathClean</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
        <span class="n">path</span><span class="o">=</span><span class="n">path</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pathDirClean</span><span class="p">(</span><span class="n">toremove</span><span class="p">),</span><span class="s">&quot;&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">removeTrailingSlash</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">path</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span> <span class="ow">and</span> <span class="n">path</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">==</span><span class="n">os</span><span class="o">.</span><span class="n">sep</span><span class="p">:</span>
                <span class="n">path</span><span class="o">=</span><span class="n">path</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
        <span class="n">path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">pathClean</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">path</span>
</div>
<div class="viewcode-block" id="SystemFS.getParentDirName"><a class="viewcode-back" href="../../../../API/JumpScale.core.system.html#JumpScale.core.system.fs.SystemFS.getParentDirName">[docs]</a>    <span class="k">def</span> <span class="nf">getParentDirName</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">path</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        returns parent of path (only for dirs)</span>
<span class="sd">        returns empty string when there is no parent</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">pathDirClean</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">sep</span><span class="p">))</span><span class="o">&gt;</span><span class="mi">2</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">j</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">getDirName</span><span class="p">(</span><span class="n">path</span><span class="p">,</span><span class="n">lastOnly</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span><span class="n">levelsUp</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="c">#go 1 level up to find name of parent</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="s">&quot;&quot;</span>
</div>
<div class="viewcode-block" id="SystemFS.processPathForDoubleDots"><a class="viewcode-back" href="../../../../API/JumpScale.core.system.html#JumpScale.core.system.fs.SystemFS.processPathForDoubleDots">[docs]</a>    <span class="k">def</span> <span class="nf">processPathForDoubleDots</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">path</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        /root/somepath/.. would become /root</span>
<span class="sd">        /root/../somepath/ would become /somepath</span>

<span class="sd">        result will always be with / slashes</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c"># print &quot;processPathForDoubleDots:%s&quot;%path</span>
        <span class="n">path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">pathClean</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
        <span class="n">path</span><span class="o">=</span><span class="n">path</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\\</span><span class="s">&quot;</span><span class="p">,</span><span class="s">&quot;/&quot;</span><span class="p">)</span>
        <span class="n">result</span><span class="o">=</span><span class="p">[]</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&quot;/&quot;</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">item</span><span class="o">==</span><span class="s">&quot;..&quot;</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">result</span><span class="o">==</span><span class="p">[]:</span>
                    <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s">&quot;Cannot processPathForDoubleDots for paths with only ..&quot;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">result</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
        <span class="k">return</span> <span class="s">&quot;/&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="SystemFS.getParent"><a class="viewcode-back" href="../../../../API/JumpScale.core.system.html#JumpScale.core.system.fs.SystemFS.getParent">[docs]</a>    <span class="k">def</span> <span class="nf">getParent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the parent of the path:</span>
<span class="sd">        /dir1/dir2/file_or_dir -&gt; /dir1/dir2/</span>
<span class="sd">        /dir1/dir2/            -&gt; /dir1/</span>
<span class="sd">        @todo why do we have 2 implementations which are almost the same see getParentDirName()</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">parts</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">sep</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">parts</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;&#39;</span><span class="p">:</span>
            <span class="n">parts</span><span class="o">=</span><span class="n">parts</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">parts</span><span class="o">=</span><span class="n">parts</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">parts</span><span class="o">==</span><span class="p">[</span><span class="s">&#39;&#39;</span><span class="p">]:</span>
            <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">sep</span>
        <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">sep</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="SystemFS.getFileExtension"><a class="viewcode-back" href="../../../../API/JumpScale.core.system.html#JumpScale.core.system.fs.SystemFS.getFileExtension">[docs]</a>    <span class="k">def</span> <span class="nf">getFileExtension</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">path</span><span class="p">):</span>
        <span class="n">extcand</span><span class="o">=</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&quot;.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">extcand</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
            <span class="n">ext</span><span class="o">=</span><span class="n">extcand</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ext</span><span class="o">=</span><span class="s">&quot;&quot;</span>
        <span class="k">return</span> <span class="n">ext</span>
</div>
<div class="viewcode-block" id="SystemFS.chown"><a class="viewcode-back" href="../../../../API/JumpScale.core.system.html#JumpScale.core.system.fs.SystemFS.chown">[docs]</a>    <span class="k">def</span> <span class="nf">chown</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">path</span><span class="p">,</span><span class="n">user</span><span class="p">):</span>
        <span class="kn">from</span> <span class="nn">pwd</span> <span class="kn">import</span> <span class="n">getpwnam</span>  
        <span class="n">getpwnam</span><span class="p">(</span><span class="n">user</span><span class="p">)[</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">uid</span><span class="o">=</span><span class="n">getpwnam</span><span class="p">(</span><span class="n">user</span><span class="p">)</span><span class="o">.</span><span class="n">pw_uid</span>
        <span class="n">gid</span><span class="o">=</span><span class="n">getpwnam</span><span class="p">(</span><span class="n">user</span><span class="p">)</span><span class="o">.</span><span class="n">pw_gid</span>
        <span class="n">os</span><span class="o">.</span><span class="n">chown</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">uid</span><span class="p">,</span> <span class="n">gid</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">root</span><span class="p">,</span> <span class="n">dirs</span><span class="p">,</span> <span class="n">files</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">walk</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>  
            <span class="k">for</span> <span class="n">ddir</span> <span class="ow">in</span> <span class="n">dirs</span><span class="p">:</span>  
                <span class="n">path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">ddir</span><span class="p">)</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">os</span><span class="o">.</span><span class="n">chown</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">uid</span><span class="p">,</span> <span class="n">gid</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">Exception</span><span class="p">,</span><span class="n">e</span><span class="p">:</span>
                    <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&quot;No such file or directory&quot;</span><span class="p">)</span><span class="o">==-</span><span class="mi">1</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%s</span><span class="s">&quot;</span><span class="o">%</span><span class="n">e</span><span class="p">)</span>                
            <span class="k">for</span> <span class="nb">file</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
                <span class="n">path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="nb">file</span><span class="p">)</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">os</span><span class="o">.</span><span class="n">chown</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">uid</span><span class="p">,</span> <span class="n">gid</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">Exception</span><span class="p">,</span><span class="n">e</span><span class="p">:</span>
                    <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&quot;No such file or directory&quot;</span><span class="p">)</span><span class="o">==-</span><span class="mi">1</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%s</span><span class="s">&quot;</span><span class="o">%</span><span class="n">e</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="SystemFS.chmod"><a class="viewcode-back" href="../../../../API/JumpScale.core.system.html#JumpScale.core.system.fs.SystemFS.chmod">[docs]</a>    <span class="k">def</span> <span class="nf">chmod</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">path</span><span class="p">,</span><span class="n">permissions</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        @param permissions e.g. 0o660 (USE OCTAL !!!)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">os</span><span class="o">.</span><span class="n">chmod</span><span class="p">(</span><span class="n">path</span><span class="p">,</span><span class="n">permissions</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">root</span><span class="p">,</span> <span class="n">dirs</span><span class="p">,</span> <span class="n">files</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">walk</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>  
            <span class="k">for</span> <span class="n">ddir</span> <span class="ow">in</span> <span class="n">dirs</span><span class="p">:</span>  
                <span class="n">path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">ddir</span><span class="p">)</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">os</span><span class="o">.</span><span class="n">chmod</span><span class="p">(</span><span class="n">path</span><span class="p">,</span><span class="n">permissions</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">Exception</span><span class="p">,</span><span class="n">e</span><span class="p">:</span>
                    <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&quot;No such file or directory&quot;</span><span class="p">)</span><span class="o">==-</span><span class="mi">1</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%s</span><span class="s">&quot;</span><span class="o">%</span><span class="n">e</span><span class="p">)</span>
                    
            <span class="k">for</span> <span class="nb">file</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
                <span class="n">path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="nb">file</span><span class="p">)</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">os</span><span class="o">.</span><span class="n">chmod</span><span class="p">(</span><span class="n">path</span><span class="p">,</span><span class="n">permissions</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">Exception</span><span class="p">,</span><span class="n">e</span><span class="p">:</span>
                    <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&quot;No such file or directory&quot;</span><span class="p">)</span><span class="o">==-</span><span class="mi">1</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%s</span><span class="s">&quot;</span><span class="o">%</span><span class="n">e</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="SystemFS.parsePath"><a class="viewcode-back" href="../../../../API/JumpScale.core.system.html#JumpScale.core.system.fs.SystemFS.parsePath">[docs]</a>    <span class="k">def</span> <span class="nf">parsePath</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">path</span><span class="p">,</span> <span class="n">baseDir</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">,</span><span class="n">existCheck</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">checkIsFile</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        parse paths of form /root/tmp/33_adoc.doc into the path, priority which is numbers before _ at beginning of path</span>
<span class="sd">        also returns filename</span>
<span class="sd">        checks if path can be found, if not will fail</span>
<span class="sd">        when filename=&quot;&quot; then is directory which has been parsed</span>
<span class="sd">        if basedir specified that part of path will be removed</span>

<span class="sd">        example:</span>
<span class="sd">        j.system.fs.parsePath(&quot;/opt/qbase3/apps/specs/myspecs/definitions/cloud/datacenter.txt&quot;,&quot;/opt/qbase3/apps/specs/myspecs/&quot;,existCheck=False)</span>
<span class="sd">        @param path is existing path to a file</span>
<span class="sd">        @param baseDir, is the absolute part of the path not required</span>
<span class="sd">        @return list of dirpath,filename,extension,priority</span>
<span class="sd">             priority = 0 if not specified</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c">#make sure only clean path is left and the filename is out</span>
        <span class="k">if</span> <span class="n">existCheck</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s">&quot;Cannot find file </span><span class="si">%s</span><span class="s"> when importing&quot;</span> <span class="o">%</span> <span class="n">path</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">checkIsFile</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">isFile</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s">&quot;Path </span><span class="si">%s</span><span class="s"> should be a file (not e.g. a dir), error when importing&quot;</span> <span class="o">%</span> <span class="n">path</span><span class="p">)</span>
        <span class="n">extension</span><span class="o">=</span><span class="s">&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">isDir</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
            <span class="n">name</span><span class="o">=</span><span class="s">&quot;&quot;</span>
            <span class="n">path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">pathClean</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">getBaseName</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
            <span class="n">path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">pathClean</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
            <span class="c">#make sure only clean path is left and the filename is out</span>
            <span class="n">path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">getDirName</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
            <span class="c">#find extension</span>
            <span class="n">regexToFindExt</span><span class="o">=</span><span class="s">&quot;\.\w*$&quot;</span>
            <span class="k">if</span> <span class="n">j</span><span class="o">.</span><span class="n">codetools</span><span class="o">.</span><span class="n">regex</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">regexToFindExt</span><span class="p">,</span><span class="n">name</span><span class="p">):</span>
                <span class="n">extension</span><span class="o">=</span><span class="n">j</span><span class="o">.</span><span class="n">codetools</span><span class="o">.</span><span class="n">regex</span><span class="o">.</span><span class="n">findOne</span><span class="p">(</span><span class="n">regexToFindExt</span><span class="p">,</span><span class="n">name</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&quot;.&quot;</span><span class="p">,</span><span class="s">&quot;&quot;</span><span class="p">)</span>
                <span class="c">#remove extension from name</span>
                <span class="n">name</span><span class="o">=</span><span class="n">j</span><span class="o">.</span><span class="n">codetools</span><span class="o">.</span><span class="n">regex</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">regexToFindExt</span><span class="p">,</span><span class="n">regexFindsubsetToReplace</span><span class="o">=</span><span class="n">regexToFindExt</span><span class="p">,</span> <span class="n">replaceWith</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">baseDir</span><span class="o">&lt;&gt;</span><span class="s">&quot;&quot;</span><span class="p">:</span>
            <span class="n">path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">pathRemoveDirPart</span><span class="p">(</span><span class="n">path</span><span class="p">,</span><span class="n">baseDir</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">name</span><span class="o">==</span><span class="s">&quot;&quot;</span><span class="p">:</span>
            <span class="n">dirOrFilename</span><span class="o">=</span><span class="n">j</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">getDirName</span><span class="p">(</span><span class="n">path</span><span class="p">,</span><span class="n">lastOnly</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">dirOrFilename</span><span class="o">=</span><span class="n">name</span>
        <span class="c">#check for priority</span>
        <span class="n">regexToFindPriority</span><span class="o">=</span><span class="s">&quot;^\d*_&quot;</span>
        <span class="k">if</span> <span class="n">j</span><span class="o">.</span><span class="n">codetools</span><span class="o">.</span><span class="n">regex</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">regexToFindPriority</span><span class="p">,</span><span class="n">dirOrFilename</span><span class="p">):</span>
            <span class="c">#found priority in path</span>
            <span class="n">priority</span><span class="o">=</span><span class="n">j</span><span class="o">.</span><span class="n">codetools</span><span class="o">.</span><span class="n">regex</span><span class="o">.</span><span class="n">findOne</span><span class="p">(</span><span class="n">regexToFindPriority</span><span class="p">,</span><span class="n">dirOrFilename</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&quot;_&quot;</span><span class="p">,</span><span class="s">&quot;&quot;</span><span class="p">)</span>
            <span class="c">#remove priority from path</span>
            <span class="n">name</span><span class="o">=</span><span class="n">j</span><span class="o">.</span><span class="n">codetools</span><span class="o">.</span><span class="n">regex</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">regexToFindPriority</span><span class="p">,</span><span class="n">regexFindsubsetToReplace</span><span class="o">=</span><span class="n">regexToFindPriority</span><span class="p">,</span> <span class="n">replaceWith</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">priority</span><span class="o">=</span><span class="mi">0</span>

        <span class="k">return</span> <span class="n">path</span><span class="p">,</span><span class="n">name</span><span class="p">,</span><span class="n">extension</span><span class="p">,</span><span class="n">priority</span>            <span class="c">#if name ==&quot;&quot; then is dir</span>

</div>
<div class="viewcode-block" id="SystemFS.getcwd"><a class="viewcode-back" href="../../../../API/JumpScale.core.system.html#JumpScale.core.system.fs.SystemFS.getcwd">[docs]</a>    <span class="k">def</span> <span class="nf">getcwd</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;get current working directory</span>
<span class="sd">        @rtype: string (current working directory path)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s">&#39;Get current working directory&#39;</span><span class="p">,</span><span class="mi">9</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s">&#39;Failed to get current working directory&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="SystemFS.readlink"><a class="viewcode-back" href="../../../../API/JumpScale.core.system.html#JumpScale.core.system.fs.SystemFS.readlink">[docs]</a>    <span class="k">def</span> <span class="nf">readlink</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Works only for unix</span>
<span class="sd">        Return a string representing the path to which the symbolic link points.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">while</span> <span class="n">path</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">==</span><span class="s">&quot;/&quot;</span> <span class="ow">or</span> <span class="n">path</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">==</span><span class="s">&quot;</span><span class="se">\\</span><span class="s">&quot;</span><span class="p">:</span>
            <span class="n">path</span><span class="o">=</span><span class="n">path</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s">&#39;Read link with path: </span><span class="si">%s</span><span class="s">&#39;</span><span class="o">%</span><span class="n">path</span><span class="p">,</span><span class="mi">8</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">path</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s">&#39;Path is not passed in system.fs.readLink&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">j</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">platformtype</span><span class="o">.</span><span class="n">isUnix</span><span class="p">():</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">readlink</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s">&#39;Failed to read link with path: </span><span class="si">%s</span><span class="s"> </span><span class="se">\n</span><span class="s">ERROR: </span><span class="si">%s</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)))</span>
        <span class="k">elif</span> <span class="n">j</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">platformtype</span><span class="o">.</span><span class="n">isWindows</span><span class="p">():</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s">&#39;Cannot readLink on windows&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="SystemFS.removeLinks"><a class="viewcode-back" href="../../../../API/JumpScale.core.system.html#JumpScale.core.system.fs.SystemFS.removeLinks">[docs]</a>    <span class="k">def</span> <span class="nf">removeLinks</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">path</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        find all links &amp; remove</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
            <span class="k">return</span>
        <span class="n">items</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_listAllInDir</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="n">path</span><span class="p">,</span> <span class="n">recursive</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">followSymlinks</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span><span class="n">listSymlinks</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="n">items</span><span class="o">=</span><span class="p">[</span><span class="n">item</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">items</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="n">j</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">isLink</span><span class="p">(</span><span class="n">item</span><span class="p">)]</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">items</span><span class="p">:</span>
            <span class="n">j</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">unlink</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>        
</div>
    <span class="k">def</span> <span class="nf">_listInDir</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span><span class="n">followSymlinks</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;returns array with dirs &amp; files in directory</span>
<span class="sd">        @param path: string (Directory path to list contents under)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">path</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s">&#39;Path is not passed in system.fs.listDir&#39;</span><span class="p">)</span>
        <span class="k">if</span><span class="p">(</span><span class="n">j</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">path</span><span class="p">)):</span>
            <span class="k">if</span><span class="p">(</span><span class="n">j</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">isDir</span><span class="p">(</span><span class="n">path</span><span class="p">))</span> <span class="ow">or</span> <span class="p">(</span><span class="n">followSymlinks</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">checkDirOrLink</span><span class="p">(</span><span class="n">path</span><span class="p">)):</span>
                <span class="n">names</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">names</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;Specified path: </span><span class="si">%s</span><span class="s"> is not a Directory in system.fs.listDir&quot;</span><span class="o">%</span> <span class="n">path</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s">&quot;Specified path: </span><span class="si">%s</span><span class="s"> does not exist in system.fs.listDir&quot;</span><span class="o">%</span> <span class="n">path</span><span class="p">)</span>

<div class="viewcode-block" id="SystemFS.listFilesInDir"><a class="viewcode-back" href="../../../../API/JumpScale.core.system.html#JumpScale.core.system.fs.SystemFS.listFilesInDir">[docs]</a>    <span class="k">def</span> <span class="nf">listFilesInDir</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">recursive</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="nb">filter</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">minmtime</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">maxmtime</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">depth</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">case_sensitivity</span><span class="o">=</span><span class="s">&#39;os&#39;</span><span class="p">,</span><span class="n">exclude</span><span class="o">=</span><span class="p">[],</span><span class="n">followSymlinks</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Retrieves list of files found in the specified directory</span>
<span class="sd">        @param path:       directory path to search in</span>
<span class="sd">        @type  path:       string</span>
<span class="sd">        @param recursive:  recursively look in all subdirs</span>
<span class="sd">        @type  recursive:  boolean</span>
<span class="sd">        @param filter:     unix-style wildcard (e.g. *.py) - this is not a regular expression</span>
<span class="sd">        @type  filter:     string</span>
<span class="sd">        @param minmtime:   if not None, only return files whose last modification time &gt; minmtime (epoch in seconds)</span>
<span class="sd">        @type  minmtime:   integer</span>
<span class="sd">        @param maxmtime:   if not None, only return files whose last modification time &lt; maxmtime (epoch in seconds)</span>
<span class="sd">        @Param depth: is levels deep wich we need to go</span>
<span class="sd">        @type  maxmtime:   integer</span>
<span class="sd">        @Param exclude: list of std filters if matches then exclude</span>
<span class="sd">        @rtype: list</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">depth</span><span class="o">&lt;&gt;</span><span class="bp">None</span><span class="p">:</span>
            <span class="n">depth</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">depth</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s">&#39;List files in directory with path: </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">path</span><span class="p">,</span><span class="mi">9</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">depth</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
            <span class="n">depth</span><span class="o">=</span><span class="bp">None</span>
        <span class="c"># if depth&lt;&gt;None:</span>
        <span class="c">#     depth+=1</span>
        <span class="n">filesreturn</span><span class="p">,</span><span class="n">depth</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_listAllInDir</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">recursive</span><span class="p">,</span> <span class="nb">filter</span><span class="p">,</span> <span class="n">minmtime</span><span class="p">,</span> <span class="n">maxmtime</span><span class="p">,</span><span class="n">depth</span><span class="p">,</span><span class="nb">type</span><span class="o">=</span><span class="s">&quot;f&quot;</span><span class="p">,</span> <span class="n">case_sensitivity</span><span class="o">=</span><span class="n">case_sensitivity</span><span class="p">,</span><span class="n">exclude</span><span class="o">=</span><span class="n">exclude</span><span class="p">,</span><span class="n">followSymlinks</span><span class="o">=</span><span class="n">followSymlinks</span><span class="p">,</span><span class="n">listSymlinks</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">filesreturn</span>
</div>
<div class="viewcode-block" id="SystemFS.listFilesAndDirsInDir"><a class="viewcode-back" href="../../../../API/JumpScale.core.system.html#JumpScale.core.system.fs.SystemFS.listFilesAndDirsInDir">[docs]</a>    <span class="k">def</span> <span class="nf">listFilesAndDirsInDir</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">recursive</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="nb">filter</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">minmtime</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">maxmtime</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">depth</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="nb">type</span><span class="o">=</span><span class="s">&quot;fd&quot;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Retrieves list of files found in the specified directory</span>
<span class="sd">        @param path:       directory path to search in</span>
<span class="sd">        @type  path:       string</span>
<span class="sd">        @param recursive:  recursively look in all subdirs</span>
<span class="sd">        @type  recursive:  boolean</span>
<span class="sd">        @param filter:     unix-style wildcard (e.g. *.py) - this is not a regular expression</span>
<span class="sd">        @type  filter:     string</span>
<span class="sd">        @param minmtime:   if not None, only return files whose last modification time &gt; minmtime (epoch in seconds)</span>
<span class="sd">        @type  minmtime:   integer</span>
<span class="sd">        @param maxmtime:   if not None, only return files whose last modification time &lt; maxmtime (epoch in seconds)</span>
<span class="sd">        @Param depth: is levels deep wich we need to go</span>
<span class="sd">        @type  maxmtime:   integer</span>
<span class="sd">        @param type is string with f &amp; d inside (f for when to find files, d for when to find dirs)</span>
<span class="sd">        @rtype: list</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">depth</span><span class="o">&lt;&gt;</span><span class="bp">None</span><span class="p">:</span>
            <span class="n">depth</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">depth</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s">&#39;List files in directory with path: </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">path</span><span class="p">,</span><span class="mi">9</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">depth</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
            <span class="n">depth</span><span class="o">=</span><span class="bp">None</span>
        <span class="c"># if depth&lt;&gt;None:</span>
        <span class="c">#     depth+=1</span>
        <span class="n">filesreturn</span><span class="p">,</span><span class="n">depth</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_listAllInDir</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">recursive</span><span class="p">,</span> <span class="nb">filter</span><span class="p">,</span> <span class="n">minmtime</span><span class="p">,</span> <span class="n">maxmtime</span><span class="p">,</span><span class="n">depth</span><span class="p">,</span><span class="nb">type</span><span class="o">=</span><span class="nb">type</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">filesreturn</span>

</div>
    <span class="k">def</span> <span class="nf">_listAllInDir</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">recursive</span><span class="p">,</span> <span class="nb">filter</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">minmtime</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">maxmtime</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">depth</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="nb">type</span><span class="o">=</span><span class="s">&quot;df&quot;</span><span class="p">,</span> <span class="n">case_sensitivity</span><span class="o">=</span><span class="s">&#39;os&#39;</span><span class="p">,</span><span class="n">exclude</span><span class="o">=</span><span class="p">[],</span><span class="n">followSymlinks</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span><span class="n">listSymlinks</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        # There are 3 possible options for case-sensitivity for file names</span>
<span class="sd">        # 1. `os`: the same behavior as the OS</span>
<span class="sd">        # 2. `sensitive`: case-sensitive comparison</span>
<span class="sd">        # 3. `insensitive`: case-insensitive comparison</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">dircontent</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_listInDir</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
        <span class="n">filesreturn</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">if</span> <span class="n">case_sensitivity</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s">&#39;sensitive&#39;</span><span class="p">:</span>
            <span class="n">matcher</span> <span class="o">=</span> <span class="n">fnmatch</span><span class="o">.</span><span class="n">fnmatchcase</span>
        <span class="k">elif</span> <span class="n">case_sensitivity</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s">&#39;insensitive&#39;</span><span class="p">:</span>
            <span class="k">def</span> <span class="nf">matcher</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="n">pattern</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">fnmatch</span><span class="o">.</span><span class="n">fnmatchcase</span><span class="p">(</span><span class="n">fname</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span> <span class="n">pattern</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">matcher</span> <span class="o">=</span> <span class="n">fnmatch</span><span class="o">.</span><span class="n">fnmatch</span>

        <span class="k">for</span> <span class="n">direntry</span> <span class="ow">in</span> <span class="n">dircontent</span><span class="p">:</span>
            <span class="n">fullpath</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">joinPaths</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">direntry</span><span class="p">)</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">isFile</span><span class="p">(</span><span class="n">fullpath</span><span class="p">)</span> <span class="ow">and</span> <span class="s">&quot;f&quot;</span> <span class="ow">in</span> <span class="nb">type</span><span class="p">:</span>
                <span class="n">includeFile</span> <span class="o">=</span> <span class="bp">False</span>
                <span class="k">if</span> <span class="p">(</span><span class="nb">filter</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">)</span> <span class="ow">or</span> <span class="n">matcher</span><span class="p">(</span><span class="n">direntry</span><span class="p">,</span> <span class="nb">filter</span><span class="p">):</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">minmtime</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">maxmtime</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">):</span>
                        <span class="n">mymtime</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">stat</span><span class="p">(</span><span class="n">fullpath</span><span class="p">)[</span><span class="n">ST_MTIME</span><span class="p">]</span>
                        <span class="k">if</span> <span class="p">(</span><span class="n">minmtime</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">mymtime</span> <span class="o">&gt;</span> <span class="n">minmtime</span><span class="p">):</span>
                            <span class="k">if</span> <span class="p">(</span><span class="n">maxmtime</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">mymtime</span> <span class="o">&lt;</span> <span class="n">maxmtime</span><span class="p">):</span>
                                <span class="n">includeFile</span> <span class="o">=</span> <span class="bp">True</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">includeFile</span> <span class="o">=</span> <span class="bp">True</span>
                <span class="k">if</span> <span class="n">includeFile</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">exclude</span><span class="o">&lt;&gt;</span><span class="p">[]:</span>
                        <span class="k">for</span> <span class="n">excludeItem</span> <span class="ow">in</span> <span class="n">exclude</span><span class="p">:</span>
                            <span class="k">if</span> <span class="n">matcher</span><span class="p">(</span><span class="n">direntry</span><span class="p">,</span> <span class="n">excludeItem</span><span class="p">):</span>
                                <span class="n">includeFile</span><span class="o">=</span><span class="bp">False</span>
                    <span class="k">if</span> <span class="n">includeFile</span><span class="p">:</span>
                        <span class="n">filesreturn</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fullpath</span><span class="p">)</span>                    
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">isDir</span><span class="p">(</span><span class="n">fullpath</span><span class="p">):</span>
                <span class="k">if</span> <span class="s">&quot;d&quot;</span> <span class="ow">in</span> <span class="nb">type</span><span class="p">:</span>                        
                    <span class="k">if</span> <span class="ow">not</span><span class="p">(</span><span class="n">listSymlinks</span><span class="o">==</span><span class="bp">False</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">isLink</span><span class="p">(</span><span class="n">fullpath</span><span class="p">)):</span>
                        <span class="n">filesreturn</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fullpath</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">recursive</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">depth</span><span class="o">&lt;&gt;</span><span class="bp">None</span> <span class="ow">and</span> <span class="n">depth</span><span class="o">&lt;&gt;</span><span class="mi">0</span><span class="p">:</span>
                        <span class="n">depth</span><span class="o">=</span><span class="n">depth</span><span class="o">-</span><span class="mi">1</span>
                    <span class="k">if</span> <span class="n">depth</span><span class="o">==</span><span class="bp">None</span> <span class="ow">or</span> <span class="n">depth</span><span class="o">&lt;&gt;</span><span class="mi">0</span><span class="p">:</span>
                        <span class="n">exclmatch</span><span class="o">=</span><span class="bp">False</span>
                        <span class="k">if</span> <span class="n">exclude</span><span class="o">&lt;&gt;</span><span class="p">[]:</span>
                            <span class="k">for</span> <span class="n">excludeItem</span> <span class="ow">in</span> <span class="n">exclude</span><span class="p">:</span>
                                <span class="k">if</span> <span class="n">matcher</span><span class="p">(</span><span class="n">fullpath</span><span class="p">,</span> <span class="n">excludeItem</span><span class="p">):</span>
                                    <span class="n">exclmatch</span><span class="o">=</span><span class="bp">True</span>
                        <span class="k">if</span> <span class="n">exclmatch</span><span class="o">==</span><span class="bp">False</span><span class="p">:</span>            
                            <span class="k">if</span> <span class="ow">not</span><span class="p">(</span><span class="n">followSymlinks</span><span class="o">==</span><span class="bp">False</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">isLink</span><span class="p">(</span><span class="n">fullpath</span><span class="p">)):</span>
                                <span class="n">r</span><span class="p">,</span><span class="n">depth</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_listAllInDir</span><span class="p">(</span><span class="n">fullpath</span><span class="p">,</span> <span class="n">recursive</span><span class="p">,</span> <span class="nb">filter</span><span class="p">,</span> <span class="n">minmtime</span><span class="p">,</span> <span class="n">maxmtime</span><span class="p">,</span><span class="n">depth</span><span class="o">=</span><span class="n">depth</span><span class="p">,</span><span class="nb">type</span><span class="o">=</span><span class="nb">type</span><span class="p">,</span><span class="n">exclude</span><span class="o">=</span><span class="n">exclude</span><span class="p">,</span><span class="n">followSymlinks</span><span class="o">=</span><span class="n">followSymlinks</span><span class="p">,</span><span class="n">listSymlinks</span><span class="o">=</span><span class="n">listSymlinks</span><span class="p">)</span>
                                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">r</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span> 
                                    <span class="n">filesreturn</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>


        <span class="k">return</span> <span class="n">filesreturn</span><span class="p">,</span><span class="n">depth</span>

<div class="viewcode-block" id="SystemFS.checkDirOrLink"><a class="viewcode-back" href="../../../../API/JumpScale.core.system.html#JumpScale.core.system.fs.SystemFS.checkDirOrLink">[docs]</a>    <span class="k">def</span> <span class="nf">checkDirOrLink</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">fullpath</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        check if path is dir or link to a dir</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">checkDirOrLinkToDir</span><span class="p">(</span><span class="n">fullpath</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="SystemFS.checkDirOrLinkToDir"><a class="viewcode-back" href="../../../../API/JumpScale.core.system.html#JumpScale.core.system.fs.SystemFS.checkDirOrLinkToDir">[docs]</a>    <span class="k">def</span> <span class="nf">checkDirOrLinkToDir</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">fullpath</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        check if path is dir or link to a dir</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">isLink</span><span class="p">(</span><span class="n">fullpath</span><span class="p">)</span> <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">fullpath</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">True</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">isLink</span><span class="p">(</span><span class="n">fullpath</span><span class="p">):</span>
            <span class="n">link</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">readlink</span><span class="p">(</span><span class="n">fullpath</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">isDir</span><span class="p">(</span><span class="n">link</span><span class="p">):</span>
                <span class="k">return</span> <span class="bp">True</span>
        <span class="k">return</span> <span class="bp">False</span>
</div>
<div class="viewcode-block" id="SystemFS.changeFileNames"><a class="viewcode-back" href="../../../../API/JumpScale.core.system.html#JumpScale.core.system.fs.SystemFS.changeFileNames">[docs]</a>    <span class="k">def</span> <span class="nf">changeFileNames</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">toReplace</span><span class="p">,</span><span class="n">replaceWith</span><span class="p">,</span><span class="n">pathToSearchIn</span><span class="p">,</span><span class="n">recursive</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="nb">filter</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">minmtime</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">maxmtime</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        @param toReplace e.g. {name}</span>
<span class="sd">        @param replace with e.g. &quot;jumpscale&quot;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">paths</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">listFilesInDir</span><span class="p">(</span><span class="n">pathToSearchIn</span><span class="p">,</span> <span class="n">recursive</span><span class="p">,</span> <span class="nb">filter</span><span class="p">,</span> <span class="n">minmtime</span><span class="p">,</span> <span class="n">maxmtime</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="n">paths</span><span class="p">:</span>
            <span class="n">path2</span><span class="o">=</span><span class="n">path</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">toReplace</span><span class="p">,</span><span class="n">replaceWith</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">path2</span><span class="o">&lt;&gt;</span><span class="n">path</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">renameFile</span><span class="p">(</span><span class="n">path</span><span class="p">,</span><span class="n">path2</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="SystemFS.replaceWordsInFiles"><a class="viewcode-back" href="../../../../API/JumpScale.core.system.html#JumpScale.core.system.fs.SystemFS.replaceWordsInFiles">[docs]</a>    <span class="k">def</span> <span class="nf">replaceWordsInFiles</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">pathToSearchIn</span><span class="p">,</span><span class="n">templateengine</span><span class="p">,</span><span class="n">recursive</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="nb">filter</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">minmtime</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">maxmtime</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        apply templateengine to list of found files</span>
<span class="sd">        @param templateengine =te  #example below</span>
<span class="sd">            te=j.codetools.templateengine.new()</span>
<span class="sd">            te.add(&quot;name&quot;,self.jpackages.name)</span>
<span class="sd">            te.add(&quot;description&quot;,self.jpackages.description)</span>
<span class="sd">            te.add(&quot;version&quot;,self.jpackages.version)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">paths</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">listFilesInDir</span><span class="p">(</span><span class="n">pathToSearchIn</span><span class="p">,</span> <span class="n">recursive</span><span class="p">,</span> <span class="nb">filter</span><span class="p">,</span> <span class="n">minmtime</span><span class="p">,</span> <span class="n">maxmtime</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="n">paths</span><span class="p">:</span>
            <span class="n">templateengine</span><span class="o">.</span><span class="n">replaceInsideFile</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="SystemFS.listDirsInDir"><a class="viewcode-back" href="../../../../API/JumpScale.core.system.html#JumpScale.core.system.fs.SystemFS.listDirsInDir">[docs]</a>    <span class="k">def</span> <span class="nf">listDirsInDir</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">path</span><span class="p">,</span><span class="n">recursive</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span><span class="n">dirNameOnly</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span><span class="n">findDirectorySymlinks</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Retrieves list of directories found in the specified directory</span>
<span class="sd">        @param path: string represents directory path to search in</span>
<span class="sd">        @rtype: list</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s">&#39;List directories in directory with path: </span><span class="si">%s</span><span class="s">, recursive = </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">recursive</span><span class="p">)),</span><span class="mi">9</span><span class="p">)</span>

        <span class="c">#if recursive:</span>
            <span class="c">#if not j.system.fs.exists(path):</span>
                <span class="c">#raise ValueError(&#39;Specified path: %s does not exist&#39; % path)</span>
            <span class="c">#if not j.system.fs.isDir(path):</span>
                <span class="c">#raise ValueError(&#39;Specified path: %s is not a directory&#39; % path)</span>
            <span class="c">#result = []</span>
            <span class="c">#os.path.walk(path, lambda a, d, f: a.append(&#39;%s%s&#39; % (d, os.path.sep)), result)</span>
            <span class="c">#return result</span>

        <span class="n">files</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_listInDir</span><span class="p">(</span><span class="n">path</span><span class="p">,</span><span class="n">followSymlinks</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="n">filesreturn</span><span class="o">=</span><span class="p">[]</span>
        <span class="k">for</span> <span class="nb">file</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
            <span class="n">fullpath</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span><span class="nb">file</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">findDirectorySymlinks</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">checkDirOrLink</span><span class="p">(</span><span class="n">fullpath</span><span class="p">))</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">isDir</span><span class="p">(</span><span class="n">fullpath</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">dirNameOnly</span><span class="p">:</span>
                    <span class="n">filesreturn</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">file</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">filesreturn</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fullpath</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">recursive</span><span class="p">:</span>
                    <span class="n">filesreturn</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">listDirsInDir</span><span class="p">(</span><span class="n">fullpath</span><span class="p">,</span><span class="n">recursive</span><span class="p">,</span><span class="n">dirNameOnly</span><span class="p">,</span><span class="n">findDirectorySymlinks</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">filesreturn</span>
</div>
<div class="viewcode-block" id="SystemFS.listPyScriptsInDir"><a class="viewcode-back" href="../../../../API/JumpScale.core.system.html#JumpScale.core.system.fs.SystemFS.listPyScriptsInDir">[docs]</a>    <span class="k">def</span> <span class="nf">listPyScriptsInDir</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span><span class="n">recursive</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="nb">filter</span><span class="o">=</span><span class="s">&quot;*.py&quot;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Retrieves list of python scripts (with extension .py) in the specified directory</span>
<span class="sd">        @param path: string represents the directory path to search in</span>
<span class="sd">        @rtype: list</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="nb">file</span> <span class="ow">in</span> <span class="n">j</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">listFilesInDir</span><span class="p">(</span><span class="n">path</span><span class="p">,</span><span class="n">recursive</span><span class="o">=</span><span class="n">recursive</span><span class="p">,</span> <span class="nb">filter</span><span class="o">=</span><span class="nb">filter</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">file</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s">&quot;.py&quot;</span><span class="p">):</span>
                <span class="n">filename</span> <span class="o">=</span> <span class="nb">file</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">sep</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">scriptname</span> <span class="o">=</span> <span class="n">filename</span><span class="o">.</span><span class="n">rsplit</span><span class="p">(</span><span class="s">&quot;.&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">scriptname</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span>
</div>
<div class="viewcode-block" id="SystemFS.move"><a class="viewcode-back" href="../../../../API/JumpScale.core.system.html#JumpScale.core.system.fs.SystemFS.move">[docs]</a>    <span class="k">def</span> <span class="nf">move</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">destin</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Main Move function</span>
<span class="sd">        @param source: string (If the specified source is a File....Calls moveFile function)</span>
<span class="sd">        (If the specified source is a Directory....Calls moveDir function)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">j</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">source</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%s</span><span class="s"> does not exist&#39;</span><span class="o">%</span><span class="n">source</span><span class="p">)</span>
        <span class="n">shutil</span><span class="o">.</span><span class="n">move</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">destin</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="SystemFS.exists"><a class="viewcode-back" href="../../../../API/JumpScale.core.system.html#JumpScale.core.system.fs.SystemFS.exists">[docs]</a>    <span class="k">def</span> <span class="nf">exists</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span><span class="n">followlinks</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Check if the specified path exists</span>
<span class="sd">        @param path: string</span>
<span class="sd">        @rtype: boolean (True if path refers to an existing path)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">path</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s">&#39;Path is not passed in system.fs.exists&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">path</span><span class="p">)</span> <span class="ow">or</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">islink</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">isLink</span><span class="p">(</span><span class="n">path</span><span class="p">)</span> <span class="ow">and</span> <span class="n">followlinks</span><span class="p">:</span>
                <span class="c">#self.log(&#39;path %s exists&#39; % str(path.encode(&quot;utf-8&quot;)),8)</span>
                <span class="n">relativelink</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">readlink</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
                <span class="n">newpath</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">joinPaths</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getParent</span><span class="p">(</span><span class="n">path</span><span class="p">),</span> <span class="n">relativelink</span><span class="p">)</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">newpath</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">True</span>
        <span class="c">#self.log(&#39;path %s does not exist&#39; % str(path.encode(&quot;utf-8&quot;)),8)</span>
        <span class="k">return</span> <span class="bp">False</span>

</div>
<div class="viewcode-block" id="SystemFS.symlink"><a class="viewcode-back" href="../../../../API/JumpScale.core.system.html#JumpScale.core.system.fs.SystemFS.symlink">[docs]</a>    <span class="k">def</span> <span class="nf">symlink</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">overwriteTarget</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Create a symbolic link</span>
<span class="sd">        @param path: source path desired to create a symbolic link for</span>
<span class="sd">        @param target: destination path required to create the symbolic link at</span>
<span class="sd">        @param overwriteTarget: boolean indicating whether target can be overwritten</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s">&#39;Getting symlink for path: </span><span class="si">%s</span><span class="s"> to target </span><span class="si">%s</span><span class="s">&#39;</span><span class="o">%</span> <span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">target</span><span class="p">),</span><span class="mi">7</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span> <span class="n">path</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s">&#39;Path is None in system.fs.symlink&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">target</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">==</span><span class="s">&quot;/&quot;</span><span class="p">:</span>
            <span class="n">target</span><span class="o">=</span><span class="n">target</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">overwriteTarget</span> <span class="ow">and</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">target</span><span class="p">)</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">isLink</span><span class="p">(</span><span class="n">target</span><span class="p">)):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">isLink</span><span class="p">(</span><span class="n">target</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">unlink</span><span class="p">(</span><span class="n">target</span><span class="p">)</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">isDir</span><span class="p">(</span><span class="n">target</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">removeDirTree</span><span class="p">(</span><span class="n">target</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">target</span><span class="p">)</span>

        <span class="nb">dir</span> <span class="o">=</span> <span class="n">j</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">getDirName</span><span class="p">(</span><span class="n">target</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">j</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="nb">dir</span><span class="p">):</span>
            <span class="n">j</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">createDir</span><span class="p">(</span><span class="nb">dir</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">j</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">platformtype</span><span class="o">.</span><span class="n">isUnix</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span>  <span class="s">&quot;Creating link from </span><span class="si">%s</span><span class="s"> to </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span><span class="p">(</span> <span class="n">path</span><span class="p">,</span> <span class="n">target</span><span class="p">)</span> <span class="p">)</span>
            <span class="n">os</span><span class="o">.</span><span class="n">symlink</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">target</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">j</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">platformtype</span><span class="o">.</span><span class="n">isWindows</span><span class="p">():</span>
            <span class="n">path</span><span class="o">=</span><span class="n">path</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&quot;+&quot;</span><span class="p">,</span><span class="s">&quot;:&quot;</span><span class="p">)</span>
            <span class="n">cmd</span><span class="o">=</span><span class="s">&quot;junction </span><span class="se">\&quot;</span><span class="si">%s</span><span class="se">\&quot;</span><span class="s"> </span><span class="se">\&quot;</span><span class="si">%s</span><span class="se">\&quot;</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pathNormalize</span><span class="p">(</span><span class="n">target</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\\</span><span class="s">&quot;</span><span class="p">,</span><span class="s">&quot;/&quot;</span><span class="p">),</span><span class="bp">self</span><span class="o">.</span><span class="n">pathNormalize</span><span class="p">(</span><span class="n">path</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\\</span><span class="s">&quot;</span><span class="p">,</span><span class="s">&quot;/&quot;</span><span class="p">))</span>
            <span class="k">print</span> <span class="n">cmd</span>
            <span class="n">j</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="SystemFS.hardlinkFile"><a class="viewcode-back" href="../../../../API/JumpScale.core.system.html#JumpScale.core.system.fs.SystemFS.hardlinkFile">[docs]</a>    <span class="k">def</span> <span class="nf">hardlinkFile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">destin</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Create a hard link pointing to source named destin. Availability: Unix.</span>
<span class="sd">        @param source: string</span>
<span class="sd">        @param destin: string</span>
<span class="sd">        @rtype: concatenation of dirname, and optionally linkname, etc.</span>
<span class="sd">        with exactly one directory separator (os.sep) inserted between components, unless path2 is empty</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s">&#39;Create a hard link pointing to </span><span class="si">%s</span><span class="s"> named </span><span class="si">%s</span><span class="s">&#39;</span><span class="o">%</span> <span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">destin</span><span class="p">),</span><span class="mi">7</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">source</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s">&#39;Source path is not passed in system.fs.hardlinkFile&#39;</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">j</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">platformtype</span><span class="o">.</span><span class="n">isUnix</span><span class="p">():</span>
                <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">link</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">destin</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s">&#39;Cannot create a hard link on windows&#39;</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s">&#39;Failed to hardLinkFile from </span><span class="si">%s</span><span class="s"> to </span><span class="si">%s</span><span class="s">&#39;</span><span class="o">%</span> <span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">destin</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="SystemFS.checkDirParam"><a class="viewcode-back" href="../../../../API/JumpScale.core.system.html#JumpScale.core.system.fs.SystemFS.checkDirParam">[docs]</a>    <span class="k">def</span> <span class="nf">checkDirParam</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">path</span><span class="p">):</span>
        <span class="k">if</span><span class="p">(</span><span class="n">path</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">==</span><span class="s">&quot;&quot;</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s">&quot;path parameter cannot be empty.&quot;</span><span class="p">)</span>
        <span class="n">path</span><span class="o">=</span><span class="n">path</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&quot;//&quot;</span><span class="p">,</span><span class="s">&quot;/&quot;</span><span class="p">)</span>
        <span class="n">path</span><span class="o">=</span><span class="n">path</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\\\\</span><span class="s">&quot;</span><span class="p">,</span><span class="s">&quot;/&quot;</span><span class="p">)</span>
        <span class="n">path</span><span class="o">=</span><span class="n">path</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\\</span><span class="s">&quot;</span><span class="p">,</span><span class="s">&quot;/&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">path</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">&lt;&gt;</span><span class="s">&quot;/&quot;</span><span class="p">:</span>
            <span class="n">path</span><span class="o">=</span><span class="n">path</span><span class="o">+</span><span class="s">&quot;/&quot;</span>
        <span class="n">path</span><span class="o">=</span><span class="n">path</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&quot;/&quot;</span><span class="p">,</span><span class="n">os</span><span class="o">.</span><span class="n">sep</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">path</span>

</div>
<div class="viewcode-block" id="SystemFS.isDir"><a class="viewcode-back" href="../../../../API/JumpScale.core.system.html#JumpScale.core.system.fs.SystemFS.isDir">[docs]</a>    <span class="k">def</span> <span class="nf">isDir</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">followSoftlink</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Check if the specified Directory path exists</span>
<span class="sd">        @param path: string</span>
<span class="sd">        @param followSoftlink: boolean</span>
<span class="sd">        @rtype: boolean (True if directory exists)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="p">(</span> <span class="n">path</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s">&#39;Directory path is None in system.fs.isDir&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">followSoftlink</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">isLink</span><span class="p">(</span> <span class="n">path</span> <span class="p">)</span> <span class="p">:</span>
            <span class="k">return</span> <span class="bp">False</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">checkDirOrLinkToDir</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="SystemFS.isEmptyDir"><a class="viewcode-back" href="../../../../API/JumpScale.core.system.html#JumpScale.core.system.fs.SystemFS.isEmptyDir">[docs]</a>    <span class="k">def</span> <span class="nf">isEmptyDir</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Check if the specified directory path is empty</span>
<span class="sd">        @param path: string</span>
<span class="sd">        @rtype: boolean (True if directory is empty)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="p">(</span> <span class="n">path</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s">&#39;Directory path is None in system.fs.isEmptyDir&#39;</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_listInDir</span><span class="p">(</span><span class="n">path</span><span class="p">)</span> <span class="o">==</span> <span class="p">[]):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s">&#39;path </span><span class="si">%s</span><span class="s"> is an empty directory&#39;</span><span class="o">%</span><span class="n">path</span><span class="p">,</span><span class="mi">9</span><span class="p">)</span>
                <span class="k">return</span> <span class="bp">True</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s">&#39;path </span><span class="si">%s</span><span class="s"> is not an empty directory&#39;</span><span class="o">%</span><span class="n">path</span><span class="p">,</span><span class="mi">9</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">False</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s">&#39;Failed to check if the specified path: </span><span class="si">%s</span><span class="s"> is an empty directory...in system.fs.isEmptyDir&#39;</span><span class="o">%</span> <span class="n">path</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="SystemFS.isFile"><a class="viewcode-back" href="../../../../API/JumpScale.core.system.html#JumpScale.core.system.fs.SystemFS.isFile">[docs]</a>    <span class="k">def</span> <span class="nf">isFile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">followSoftlink</span> <span class="o">=</span> <span class="bp">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Check if the specified file exists for the given path</span>
<span class="sd">        @param path: string</span>
<span class="sd">        @param followSoftlink: boolean</span>
<span class="sd">        @rtype: boolean (True if file exists for the given path)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s">&quot;isfile:</span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">path</span><span class="p">,</span><span class="mi">8</span><span class="p">)</span>


        <span class="k">if</span> <span class="p">(</span> <span class="n">path</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s">&#39;File path is None in system.fs.isFile&#39;</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">followSoftlink</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">isLink</span><span class="p">(</span> <span class="n">path</span> <span class="p">)</span> <span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s">&#39;path </span><span class="si">%s</span><span class="s"> is a file&#39;</span><span class="o">%</span><span class="n">path</span><span class="p">,</span><span class="mi">8</span><span class="p">)</span>
                <span class="k">return</span> <span class="bp">True</span>

            <span class="k">if</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">path</span><span class="p">)):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s">&#39;path </span><span class="si">%s</span><span class="s"> is a file&#39;</span><span class="o">%</span><span class="n">path</span><span class="p">,</span><span class="mi">8</span><span class="p">)</span>
                <span class="k">return</span> <span class="bp">True</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s">&#39;path </span><span class="si">%s</span><span class="s"> is not a file&#39;</span><span class="o">%</span><span class="n">path</span><span class="p">,</span><span class="mi">8</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">False</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s">&#39;Failed to check if the specified path: </span><span class="si">%s</span><span class="s"> is a file...in system.fs.isFile&#39;</span><span class="o">%</span> <span class="n">path</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="SystemFS.isLink"><a class="viewcode-back" href="../../../../API/JumpScale.core.system.html#JumpScale.core.system.fs.SystemFS.isLink">[docs]</a>    <span class="k">def</span> <span class="nf">isLink</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span><span class="n">checkJunction</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Check if the specified path is a link</span>
<span class="sd">        @param path: string</span>
<span class="sd">        @rtype: boolean (True if the specified path is a link)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">path</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">==</span><span class="n">os</span><span class="o">.</span><span class="n">sep</span><span class="p">:</span>
            <span class="n">path</span><span class="o">=</span><span class="n">path</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">if</span> <span class="p">(</span> <span class="n">path</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s">&#39;Link path is None in system.fs.isLink&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">checkJunction</span> <span class="ow">and</span> <span class="n">j</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">platformtype</span><span class="o">.</span><span class="n">isWindows</span><span class="p">():</span>
            <span class="n">cmd</span><span class="o">=</span><span class="s">&quot;junction </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">path</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">result</span><span class="o">=</span><span class="n">j</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">,</span><span class="n">e</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s">&quot;Could not execute junction cmd, is junction installed? Cmd was </span><span class="si">%s</span><span class="s">.&quot;</span><span class="o">%</span><span class="n">cmd</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">&lt;&gt;</span><span class="mi">0</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s">&quot;Could not execute junction cmd, is junction installed? Cmd was </span><span class="si">%s</span><span class="s">.&quot;</span><span class="o">%</span><span class="n">cmd</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">result</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&quot;substitute name&quot;</span><span class="p">)</span><span class="o">&lt;&gt;-</span><span class="mi">1</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">True</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">False</span>
            
        <span class="k">if</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">islink</span><span class="p">(</span><span class="n">path</span><span class="p">)):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s">&#39;path </span><span class="si">%s</span><span class="s"> is a link&#39;</span><span class="o">%</span><span class="n">path</span><span class="p">,</span><span class="mi">8</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s">&#39;path </span><span class="si">%s</span><span class="s"> is not a link&#39;</span><span class="o">%</span><span class="n">path</span><span class="p">,</span><span class="mi">8</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">False</span>
</div>
<div class="viewcode-block" id="SystemFS.isMount"><a class="viewcode-back" href="../../../../API/JumpScale.core.system.html#JumpScale.core.system.fs.SystemFS.isMount">[docs]</a>    <span class="k">def</span> <span class="nf">isMount</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return true if pathname path is a mount point:</span>
<span class="sd">        A point in a file system where a different file system has been mounted.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s">&#39;Check if path </span><span class="si">%s</span><span class="s"> is a mount point&#39;</span><span class="o">%</span><span class="n">path</span><span class="p">,</span><span class="mi">8</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">path</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s">&#39;Path is passed null in system.fs.isMount&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">ismount</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="SystemFS.statPath"><a class="viewcode-back" href="../../../../API/JumpScale.core.system.html#JumpScale.core.system.fs.SystemFS.statPath">[docs]</a>    <span class="k">def</span> <span class="nf">statPath</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Perform a stat() system call on the given path</span>
<span class="sd">        @rtype: object whose attributes correspond to the members of the stat structure</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">path</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s">&#39;Path is None in system.fs.statPath&#39;</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">stat</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">OSError</span><span class="p">(</span><span class="s">&#39;Failed to perform stat system call on the specific path: </span><span class="si">%s</span><span class="s"> in system.fs.statPath&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">path</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="SystemFS.renameDir"><a class="viewcode-back" href="../../../../API/JumpScale.core.system.html#JumpScale.core.system.fs.SystemFS.renameDir">[docs]</a>    <span class="k">def</span> <span class="nf">renameDir</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dirname</span><span class="p">,</span> <span class="n">newname</span><span class="p">,</span><span class="n">overwrite</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Rename Directory from dirname to newname</span>
<span class="sd">        @param dirname: string (Directory original name)</span>
<span class="sd">        @param newname: string (Directory new name to be changed to)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s">&#39;Renaming directory </span><span class="si">%s</span><span class="s"> to </span><span class="si">%s</span><span class="s">&#39;</span><span class="o">%</span> <span class="p">(</span><span class="n">dirname</span><span class="p">,</span> <span class="n">newname</span><span class="p">),</span><span class="mi">7</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">dirname</span> <span class="o">==</span> <span class="n">newname</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="k">if</span> <span class="p">((</span><span class="n">dirname</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">newname</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s">&#39;Not enough parameters passed to system.fs.renameDir...[</span><span class="si">%s</span><span class="s">, </span><span class="si">%s</span><span class="s">]&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">dirname</span><span class="p">,</span> <span class="n">newname</span><span class="p">))</span>
        <span class="k">if</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">isDir</span><span class="p">(</span><span class="n">dirname</span><span class="p">)):</span>
            <span class="k">if</span> <span class="n">overwrite</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">dirname</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">removeDirTree</span><span class="p">(</span><span class="n">dirname</span><span class="p">)</span>
            <span class="n">os</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">dirname</span><span class="p">,</span> <span class="n">newname</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&#39;Path: </span><span class="si">%s</span><span class="s"> is not a directory in system.fs.renameDir&#39;</span><span class="o">%</span><span class="n">dirname</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="SystemFS.unlinkFile"><a class="viewcode-back" href="../../../../API/JumpScale.core.system.html#JumpScale.core.system.fs.SystemFS.unlinkFile">[docs]</a>    <span class="k">def</span> <span class="nf">unlinkFile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Remove the file path (only for files, not for symlinks)</span>
<span class="sd">        @param filename: File path to be removed</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s">&#39;Unlink file with path: </span><span class="si">%s</span><span class="s">&#39;</span><span class="o">%</span><span class="n">filename</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">filename</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s">&#39;File name is None in QSstem.unlinkFile&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">isFile</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s">&quot;filename is not a file so cannot unlink&quot;</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">os</span><span class="o">.</span><span class="n">unlink</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">OSError</span><span class="p">(</span><span class="s">&#39;Failed to unlink the specified file path: </span><span class="si">%s</span><span class="s"> in system.fs.unlinkFile&#39;</span><span class="o">%</span> <span class="n">filename</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="SystemFS.unlink"><a class="viewcode-back" href="../../../../API/JumpScale.core.system.html#JumpScale.core.system.fs.SystemFS.unlink">[docs]</a>    <span class="k">def</span> <span class="nf">unlink</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Remove the given file if it&#39;s a file or a symlink</span>

<span class="sd">        @param filename: File path to be removed</span>
<span class="sd">        @type filename: string</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s">&#39;Unlink path: </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">filename</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">filename</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s">&#39;File name is None in system.fs.unlink&#39;</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">os</span><span class="o">.</span><span class="n">unlink</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">OSError</span><span class="p">(</span><span class="s">&#39;Failed to unlink the specified file path: [</span><span class="si">%s</span><span class="s">] in system.ds.unlink&#39;</span> <span class="o">%</span> <span class="n">filename</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="SystemFS.fileGetContents"><a class="viewcode-back" href="../../../../API/JumpScale.core.system.html#JumpScale.core.system.fs.SystemFS.fileGetContents">[docs]</a>    <span class="k">def</span> <span class="nf">fileGetContents</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span> 
        <span class="sd">&quot;&quot;&quot;Read a file and get contents of that file</span>
<span class="sd">        @param filename: string (filename to open for reading )</span>
<span class="sd">        @rtype: string representing the file contents</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">filename</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s">&#39;File name is None in system.fs.fileGetContents&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s">&#39;Opened file </span><span class="si">%s</span><span class="s"> for reading&#39;</span><span class="o">%</span> <span class="n">filename</span><span class="p">,</span><span class="mi">6</span><span class="p">)</span>
        <span class="c"># self.log(&#39;Reading file %s&#39;% filename,9)</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span> <span class="k">as</span> <span class="n">fp</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">fp</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s">&#39;File </span><span class="si">%s</span><span class="s"> is closed after reading&#39;</span><span class="o">%</span><span class="n">filename</span><span class="p">,</span><span class="mi">9</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">data</span>
</div>
<div class="viewcode-block" id="SystemFS.fileGetUncommentedContents"><a class="viewcode-back" href="../../../../API/JumpScale.core.system.html#JumpScale.core.system.fs.SystemFS.fileGetUncommentedContents">[docs]</a>    <span class="k">def</span> <span class="nf">fileGetUncommentedContents</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span> 
        <span class="sd">&quot;&quot;&quot;Read a file and get uncommented contents of that file</span>
<span class="sd">        @param filename: string (filename to open for reading )</span>
<span class="sd">        @rtype: list of lines of uncommented file contents</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">filename</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s">&#39;File name is None in system.fs.fileGetContents&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s">&#39;Opened file </span><span class="si">%s</span><span class="s"> for reading&#39;</span><span class="o">%</span> <span class="n">filename</span><span class="p">,</span><span class="mi">6</span><span class="p">)</span>
        <span class="c"># self.log(&#39;Reading file %s&#39;% filename,9)</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span> <span class="k">as</span> <span class="n">fp</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">fp</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
        <span class="n">uncommented</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;#&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">):</span>
                <span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">)</span>
                <span class="n">uncommented</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s">&#39;File </span><span class="si">%s</span><span class="s"> is closed after reading&#39;</span><span class="o">%</span><span class="n">filename</span><span class="p">,</span><span class="mi">9</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">uncommented</span>
</div>
<div class="viewcode-block" id="SystemFS.fileGetTextContents"><a class="viewcode-back" href="../../../../API/JumpScale.core.system.html#JumpScale.core.system.fs.SystemFS.fileGetTextContents">[docs]</a>    <span class="k">def</span> <span class="nf">fileGetTextContents</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Read a UTF-8 file and get contents of that file. Takes care of the [BOM](http://en.wikipedia.org/wiki/Byte_order_mark)</span>
<span class="sd">        @param filename: string (filename to open for reading)</span>
<span class="sd">        @rtype: string representing the file contents</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">filename</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s">&#39;File name is None in system.fs.fileGetTextContents&#39;</span><span class="p">)</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">s</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">bom</span> <span class="ow">in</span> <span class="p">[</span><span class="n">codecs</span><span class="o">.</span><span class="n">BOM_UTF8</span><span class="p">]:</span>  <span class="c"># we can add more BOMs later:</span>
            <span class="k">if</span> <span class="n">s</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">bom</span><span class="p">):</span>
                <span class="n">s</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">bom</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                <span class="k">break</span>
        <span class="k">return</span> <span class="n">s</span>
</div>
<div class="viewcode-block" id="SystemFS.touch"><a class="viewcode-back" href="../../../../API/JumpScale.core.system.html#JumpScale.core.system.fs.SystemFS.touch">[docs]</a>    <span class="k">def</span> <span class="nf">touch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">paths</span><span class="p">,</span><span class="n">overwrite</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        can be single path or multiple (then list)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span>  <span class="n">j</span><span class="o">.</span><span class="n">basetype</span><span class="o">.</span><span class="n">list</span><span class="o">.</span><span class="n">check</span><span class="p">(</span><span class="n">paths</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">paths</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">touch</span><span class="p">(</span><span class="n">item</span><span class="p">,</span><span class="n">overwrite</span><span class="o">=</span><span class="n">overwrite</span><span class="p">)</span>
        <span class="n">path</span><span class="o">=</span><span class="n">paths</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">createDir</span><span class="p">(</span><span class="n">j</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">getDirName</span><span class="p">(</span><span class="n">path</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">overwrite</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="n">path</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">writeFile</span><span class="p">(</span><span class="n">path</span><span class="p">,</span><span class="s">&quot;&quot;</span><span class="p">)</span>
        
</div>
<div class="viewcode-block" id="SystemFS.writeFile"><a class="viewcode-back" href="../../../../API/JumpScale.core.system.html#JumpScale.core.system.fs.SystemFS.writeFile">[docs]</a>    <span class="k">def</span> <span class="nf">writeFile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">filename</span><span class="p">,</span> <span class="n">contents</span><span class="p">,</span> <span class="n">append</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Open a file and write file contents, close file afterwards</span>
<span class="sd">        @param contents: string (file contents to be written)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">filename</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">contents</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s">&#39;Passed None parameters in system.fs.writeFile&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s">&#39;Opened file </span><span class="si">%s</span><span class="s"> for writing&#39;</span><span class="o">%</span> <span class="n">filename</span><span class="p">,</span><span class="mi">6</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">append</span><span class="o">==</span><span class="bp">False</span><span class="p">:</span>
            <span class="n">fp</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span><span class="s">&quot;wb&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">fp</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span><span class="s">&quot;ab&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s">&#39;Writing contents in file </span><span class="si">%s</span><span class="s">&#39;</span><span class="o">%</span><span class="n">filename</span><span class="p">,</span><span class="mi">9</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c">#if filename.find(&quot;avahi&quot;)&lt;&gt;-1:</span>
            <span class="c">#    ipshell()</span>
            <span class="n">fp</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">contents</span><span class="p">)</span>  <span class="c">#@todo P1 will this also raise an error and not be catched by the finally</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="n">fp</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="SystemFS.fileSize"><a class="viewcode-back" href="../../../../API/JumpScale.core.system.html#JumpScale.core.system.fs.SystemFS.fileSize">[docs]</a>    <span class="k">def</span> <span class="nf">fileSize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get Filesize of file in bytes</span>
<span class="sd">        @param filename: the file u want to know the filesize of</span>
<span class="sd">        @return: int representing file size</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s">&#39;Getting filesize of file: </span><span class="si">%s</span><span class="s">&#39;</span><span class="o">%</span><span class="n">filename</span><span class="p">,</span><span class="mi">8</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s">&quot;Specified file: </span><span class="si">%s</span><span class="s"> does not exist&quot;</span><span class="o">%</span> <span class="n">filename</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">getsize</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">OSError</span><span class="p">(</span><span class="s">&quot;Could not get filesize of </span><span class="si">%s</span><span class="se">\n</span><span class="s">Error: </span><span class="si">%s</span><span class="s">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)))</span>

</div>
<div class="viewcode-block" id="SystemFS.writeObjectToFile"><a class="viewcode-back" href="../../../../API/JumpScale.core.system.html#JumpScale.core.system.fs.SystemFS.writeObjectToFile">[docs]</a>    <span class="k">def</span> <span class="nf">writeObjectToFile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">filelocation</span><span class="p">,</span><span class="n">obj</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Write a object to a file(pickle format)</span>
<span class="sd">        @param filelocation: location of the file to which we write</span>
<span class="sd">        @param obj: object to pickle and write to a file</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">filelocation</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">obj</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;You should provide a filelocation or a object as parameters&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s">&quot;Creating pickle and write it to file: </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">filelocation</span><span class="p">,</span><span class="mi">6</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">pcl</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&quot;Could not create pickle from the object </span><span class="se">\n</span><span class="s">Error: </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)))</span>
        <span class="n">j</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">writeFile</span><span class="p">(</span><span class="n">filelocation</span><span class="p">,</span><span class="n">pcl</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">filelocation</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&quot;File isn&#39;t written to the filesystem&quot;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="SystemFS.readObjectFromFile"><a class="viewcode-back" href="../../../../API/JumpScale.core.system.html#JumpScale.core.system.fs.SystemFS.readObjectFromFile">[docs]</a>    <span class="k">def</span> <span class="nf">readObjectFromFile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">filelocation</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Read a object from a file(file contents in pickle format)</span>
<span class="sd">        @param filelocation: location of the file</span>
<span class="sd">        @return: object</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">filelocation</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;You should provide a filelocation as a parameter&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s">&quot;Opening file </span><span class="si">%s</span><span class="s"> for reading&quot;</span> <span class="o">%</span> <span class="n">filelocation</span><span class="p">,</span><span class="mi">6</span><span class="p">)</span>
        <span class="n">contents</span> <span class="o">=</span> <span class="n">j</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">fileGetContents</span><span class="p">(</span><span class="n">filelocation</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s">&quot;creating object&quot;</span><span class="p">,</span><span class="mi">9</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">obj</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">contents</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&quot;Could not create the object from the file contents </span><span class="se">\n</span><span class="s"> Error: </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)))</span>
        <span class="k">return</span> <span class="n">obj</span>
</div>
<div class="viewcode-block" id="SystemFS.md5sum"><a class="viewcode-back" href="../../../../API/JumpScale.core.system.html#JumpScale.core.system.fs.SystemFS.md5sum">[docs]</a>    <span class="k">def</span> <span class="nf">md5sum</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the hex digest of a file without loading it all into memory</span>
<span class="sd">        @param filename: string (filename to get the hex digest of it)</span>
<span class="sd">        @rtype: md5 of the file</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s">&#39;Get the hex digest of file </span><span class="si">%s</span><span class="s"> without loading it all into memory&#39;</span><span class="o">%</span><span class="n">filename</span><span class="p">,</span><span class="mi">8</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">filename</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">raise</span><span class="p">(</span><span class="s">&#39;File name is None in system.fs.md5sum&#39;</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">fh</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
                <span class="n">digest</span> <span class="o">=</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">md5</span><span class="p">()</span>
                <span class="k">while</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">buf</span> <span class="o">=</span> <span class="n">fh</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">4096</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">buf</span> <span class="o">==</span> <span class="s">&quot;&quot;</span><span class="p">:</span>
                        <span class="k">break</span>
                    <span class="n">digest</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">buf</span><span class="p">)</span>
            <span class="k">finally</span><span class="p">:</span>
                <span class="n">fh</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="k">return</span> <span class="n">digest</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s">&quot;Failed to get the hex digest of the file </span><span class="si">%s</span><span class="s">in system.fs.md5sum. Error: </span><span class="si">%s</span><span class="s">&quot;</span>  <span class="o">%</span> <span class="p">(</span><span class="n">filename</span><span class="p">,</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)))</span>
</div>
<div class="viewcode-block" id="SystemFS.walkExtended"><a class="viewcode-back" href="../../../../API/JumpScale.core.system.html#JumpScale.core.system.fs.SystemFS.walkExtended">[docs]</a>    <span class="k">def</span> <span class="nf">walkExtended</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">root</span><span class="p">,</span> <span class="n">recurse</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">dirPattern</span><span class="o">=</span><span class="s">&#39;*&#39;</span> <span class="p">,</span> <span class="n">filePattern</span><span class="o">=</span><span class="s">&#39;*&#39;</span><span class="p">,</span> <span class="n">followSoftLinks</span> <span class="o">=</span> <span class="bp">True</span><span class="p">,</span> <span class="n">dirs</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">files</span><span class="o">=</span><span class="bp">True</span> <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Extended Walk version: seperate dir and file pattern</span>
<span class="sd">        @param  root                : start directory to start the search.</span>
<span class="sd">        @type   root                : string</span>
<span class="sd">        @param  recurse             : search also in subdirectories.</span>
<span class="sd">        @type   recurse             : number</span>
<span class="sd">        @param  dirPattern          : search pattern to match directory names. Wildcards can be included.</span>
<span class="sd">        @type   dirPattern          : string</span>
<span class="sd">        @param  filePattern         : search pattern to match file names. Wildcards can be included.</span>
<span class="sd">        @type   filePattern         : string</span>
<span class="sd">        @param  followSoftLinks     : determine if links must be followed.</span>
<span class="sd">        @type   followSoftLinks     : boolean</span>
<span class="sd">        @param  dirs                : determine to return dir results.</span>
<span class="sd">        @type   dirs                : boolean</span>
<span class="sd">        @param  files               : determine to return file results.</span>
<span class="sd">        @type   files               : boolean</span>

<span class="sd">        @return                     : List of files and / or directories that match the search patterns.</span>
<span class="sd">        @rtype                      : list of strings</span>

<span class="sd">        General guidelines in the usage of the method be means of some examples come next. For the example in /tmp there is</span>

<span class="sd">        * a file test.rtt</span>
<span class="sd">        * and ./folder1/subfolder/subsubfolder/small_test/test.rtt</span>

<span class="sd">        To find the first test you can use</span>
<span class="sd">           j.system.fs.walkExtended(&#39;/tmp/&#39;, dirPattern=&quot;*tmp*&quot;, filePattern=&quot;*.rtt&quot;)</span>
<span class="sd">        To find only the second one you could use</span>
<span class="sd">           j.system.fs.walkExtended(&#39;tmp&#39;, recurse=0, dirPattern=&quot;*small_test*&quot;, filePattern=&quot;*.rtt&quot;, dirs=False)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s">&#39;Scanning directory (walk) </span><span class="si">%s</span><span class="s">&#39;</span><span class="o">%</span><span class="n">root</span><span class="p">,</span><span class="mi">6</span><span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">names</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">root</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">os</span><span class="o">.</span><span class="n">error</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">result</span>  <span class="c">#@todo P2 is this correct?</span>

        <span class="n">dirPattern</span> <span class="o">=</span> <span class="n">dirPattern</span> <span class="ow">or</span> <span class="s">&#39;*&#39;</span>
        <span class="n">dirPatList</span> <span class="o">=</span> <span class="n">dirPattern</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;;&#39;</span><span class="p">)</span>
        <span class="n">filePattern</span> <span class="o">=</span> <span class="n">filePattern</span> <span class="ow">or</span> <span class="s">&#39;*&#39;</span>
        <span class="n">filePatList</span> <span class="o">=</span> <span class="n">filePattern</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;;&#39;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">names</span><span class="p">:</span>
            <span class="n">fullname</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">normpath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">name</span><span class="p">))</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">isFile</span><span class="p">(</span><span class="n">fullname</span><span class="p">,</span> <span class="n">followSoftLinks</span><span class="p">):</span>
                <span class="n">fileOK</span> <span class="o">=</span> <span class="bp">False</span>
                <span class="n">dirOK</span> <span class="o">=</span> <span class="bp">False</span>
                <span class="k">for</span> <span class="n">fPat</span> <span class="ow">in</span> <span class="n">filePatList</span><span class="p">:</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">fnmatch</span><span class="o">.</span><span class="n">fnmatch</span><span class="p">(</span><span class="n">name</span><span class="p">,</span><span class="n">fPat</span><span class="p">)):</span>
                        <span class="n">fileOK</span> <span class="o">=</span> <span class="bp">True</span>
                <span class="k">for</span> <span class="n">dPat</span> <span class="ow">in</span> <span class="n">dirPatList</span><span class="p">:</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">fnmatch</span><span class="o">.</span><span class="n">fnmatch</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">fullname</span><span class="p">),</span><span class="n">dPat</span><span class="p">)):</span>
                        <span class="n">dirOK</span> <span class="o">=</span> <span class="bp">True</span>
                <span class="k">if</span> <span class="n">fileOK</span> <span class="ow">and</span> <span class="n">dirOK</span> <span class="ow">and</span> <span class="n">files</span><span class="p">:</span>
                    <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fullname</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">isDir</span><span class="p">(</span><span class="n">fullname</span><span class="p">,</span> <span class="n">followSoftLinks</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">dPat</span> <span class="ow">in</span> <span class="n">dirPatList</span><span class="p">:</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">fnmatch</span><span class="o">.</span><span class="n">fnmatch</span><span class="p">(</span><span class="n">name</span><span class="p">,</span><span class="n">dPat</span><span class="p">)</span> <span class="ow">and</span> <span class="n">dirs</span><span class="p">):</span>
                        <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fullname</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">recurse</span><span class="p">:</span>
                <span class="n">result</span> <span class="o">=</span> <span class="n">result</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">walkExtended</span><span class="p">(</span><span class="n">root</span>            <span class="o">=</span> <span class="n">fullname</span><span class="p">,</span>
                                                    <span class="n">recurse</span>         <span class="o">=</span> <span class="n">recurse</span><span class="p">,</span>
                                                    <span class="n">dirPattern</span>      <span class="o">=</span> <span class="n">dirPattern</span><span class="p">,</span>
                                                    <span class="n">filePattern</span>     <span class="o">=</span> <span class="n">filePattern</span><span class="p">,</span>
                                                    <span class="n">followSoftLinks</span> <span class="o">=</span> <span class="n">followSoftLinks</span><span class="p">,</span>
                                                    <span class="n">dirs</span>            <span class="o">=</span> <span class="n">dirs</span><span class="p">,</span>
                                                    <span class="n">files</span>           <span class="o">=</span> <span class="n">files</span> <span class="p">)</span>

        <span class="k">return</span> <span class="n">result</span>

    <span class="c">#WalkExtended = deprecated(&#39;j.system.fs.WalkExtended&#39;,&#39;j.system.fs.walkExtended&#39;, &#39;3.2&#39;)(walkExtended)</span>
</div>
<div class="viewcode-block" id="SystemFS.walk"><a class="viewcode-back" href="../../../../API/JumpScale.core.system.html#JumpScale.core.system.fs.SystemFS.walk">[docs]</a>    <span class="k">def</span> <span class="nf">walk</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">root</span><span class="p">,</span> <span class="n">recurse</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">pattern</span><span class="o">=</span><span class="s">&#39;*&#39;</span><span class="p">,</span> <span class="n">return_folders</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">return_files</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">followSoftlinks</span> <span class="o">=</span> <span class="bp">True</span><span class="p">,</span><span class="nb">unicode</span><span class="o">=</span><span class="bp">False</span> <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;This is to provide ScanDir similar function</span>
<span class="sd">        It is going to be used wherever some one wants to list all files and subfolders</span>
<span class="sd">        under one given directly with specific or none matchers</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">unicode</span><span class="p">:</span>
            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">supports_unicode_filenames</span><span class="o">=</span><span class="bp">True</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s">&#39;Scanning directory (walk)</span><span class="si">%s</span><span class="s">&#39;</span><span class="o">%</span><span class="n">root</span><span class="p">,</span><span class="mi">6</span><span class="p">)</span>
        <span class="c"># initialize</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c"># must have at least root folder</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">names</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">root</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">os</span><span class="o">.</span><span class="n">error</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">result</span>

        <span class="c"># expand pattern</span>
        <span class="n">pattern</span> <span class="o">=</span> <span class="n">pattern</span> <span class="ow">or</span> <span class="s">&#39;*&#39;</span>
        <span class="n">pat_list</span> <span class="o">=</span> <span class="n">pattern</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;;&#39;</span><span class="p">)</span>

        <span class="c"># check each file</span>
        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">names</span><span class="p">:</span>
            <span class="n">fullname</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">normpath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">name</span><span class="p">))</span>

            <span class="c"># grab if it matches our pattern and entry type</span>
            <span class="k">for</span> <span class="n">pat</span> <span class="ow">in</span> <span class="n">pat_list</span><span class="p">:</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">fnmatch</span><span class="o">.</span><span class="n">fnmatch</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">pat</span><span class="p">)):</span>

                    <span class="k">if</span> <span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">isFile</span><span class="p">(</span><span class="n">fullname</span><span class="p">,</span> <span class="n">followSoftlinks</span><span class="p">)</span> <span class="ow">and</span> <span class="n">return_files</span> <span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">return_folders</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">isDir</span><span class="p">(</span><span class="n">fullname</span><span class="p">,</span> <span class="n">followSoftlinks</span><span class="p">)):</span>
                        <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fullname</span><span class="p">)</span>
                    <span class="k">continue</span>

            <span class="c"># recursively scan other folders, appending results</span>
            <span class="k">if</span> <span class="n">recurse</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">isDir</span><span class="p">(</span><span class="n">fullname</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">isLink</span><span class="p">(</span><span class="n">fullname</span><span class="p">):</span>
                    <span class="n">result</span> <span class="o">=</span> <span class="n">result</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">walk</span><span class="p">(</span> <span class="n">fullname</span><span class="p">,</span> <span class="n">recurse</span><span class="p">,</span> <span class="n">pattern</span><span class="p">,</span> <span class="n">return_folders</span><span class="p">,</span> <span class="n">return_files</span><span class="p">,</span> <span class="n">followSoftlinks</span> <span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span>

    <span class="c">#Walk = deprecated(&#39;j.system.fs.Walk&#39;, &#39;j.system.fs.walk&#39;, &#39;3.2&#39;)(walk)</span>
</div>
<div class="viewcode-block" id="SystemFS.convertFileDirnamesUnicodeToAscii"><a class="viewcode-back" href="../../../../API/JumpScale.core.system.html#JumpScale.core.system.fs.SystemFS.convertFileDirnamesUnicodeToAscii">[docs]</a>    <span class="k">def</span> <span class="nf">convertFileDirnamesUnicodeToAscii</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">rootdir</span><span class="p">,</span><span class="n">spacesToUnderscore</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">supports_unicode_filenames</span><span class="o">=</span><span class="bp">True</span>
        <span class="k">def</span> <span class="nf">visit</span><span class="p">(</span><span class="n">arg</span><span class="p">,</span><span class="n">dirname</span><span class="p">,</span><span class="n">names</span><span class="p">):</span>
            <span class="n">dirname2</span><span class="o">=</span><span class="n">j</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">string</span><span class="o">.</span><span class="n">decodeUnicode2Asci</span><span class="p">(</span><span class="n">dirname</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">names</span><span class="p">:</span>
                <span class="n">name2</span><span class="o">=</span><span class="n">j</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">string</span><span class="o">.</span><span class="n">decodeUnicode2Asci</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">name2</span><span class="o">&lt;&gt;</span><span class="n">name</span><span class="p">:</span>
                    <span class="c">##print &quot;name not unicode&quot;</span>
                    <span class="n">source</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dirname</span><span class="p">,</span><span class="n">name</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">spacesToUnderscore</span><span class="p">:</span>
                        <span class="n">dirname</span><span class="o">=</span><span class="n">dirname</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&quot; &quot;</span><span class="p">,</span><span class="s">&quot;_&quot;</span><span class="p">)</span>
                        <span class="n">name2</span><span class="o">=</span><span class="n">name2</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&quot; &quot;</span><span class="p">,</span><span class="s">&quot;_&quot;</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">source</span><span class="p">):</span>
                        <span class="n">j</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">renameDir</span><span class="p">(</span><span class="n">source</span><span class="p">,</span><span class="n">j</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">joinPaths</span><span class="p">(</span><span class="n">dirname</span><span class="p">,</span><span class="n">name2</span><span class="p">))</span>
                    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">source</span><span class="p">):</span>
                        <span class="c">#  #print &quot;renamefile&quot;</span>
                        <span class="n">j</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">renameFile</span><span class="p">(</span><span class="n">source</span><span class="p">,</span><span class="n">j</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">joinPaths</span><span class="p">(</span><span class="n">dirname</span><span class="p">,</span><span class="n">name2</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">dirname2</span><span class="o">&lt;&gt;</span><span class="n">dirname</span><span class="p">:</span>
                <span class="c">#dirname not unicode</span>
                <span class="c">##print &quot;dirname not unicode&quot;</span>
                <span class="k">if</span> <span class="n">spacesToUnderscore</span><span class="p">:</span>
                    <span class="n">dirname2</span><span class="o">=</span><span class="n">dirname2</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&quot; &quot;</span><span class="p">,</span><span class="s">&quot;_&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">j</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">isDir</span><span class="p">(</span><span class="n">dirname</span><span class="p">):</span>
                    <span class="n">j</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">renameDir</span><span class="p">(</span><span class="n">dirname</span><span class="p">,</span><span class="n">dirname2</span><span class="p">)</span>
        <span class="n">arg</span><span class="o">=</span><span class="p">{}</span>
        <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">walk</span><span class="p">(</span><span class="n">rootdir</span><span class="p">,</span> <span class="n">visit</span><span class="p">,</span><span class="n">arg</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="SystemFS.convertFileDirnamesSpaceToUnderscore"><a class="viewcode-back" href="../../../../API/JumpScale.core.system.html#JumpScale.core.system.fs.SystemFS.convertFileDirnamesSpaceToUnderscore">[docs]</a>    <span class="k">def</span> <span class="nf">convertFileDirnamesSpaceToUnderscore</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">rootdir</span><span class="p">):</span>
        <span class="k">def</span> <span class="nf">visit</span><span class="p">(</span><span class="n">arg</span><span class="p">,</span><span class="n">dirname</span><span class="p">,</span><span class="n">names</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">dirname</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&quot; &quot;</span><span class="p">)</span><span class="o">&lt;&gt;-</span><span class="mi">1</span><span class="p">:</span>
                <span class="c">#dirname has space inside</span>
                <span class="n">dirname2</span><span class="o">=</span><span class="n">dirname</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&quot; &quot;</span><span class="p">,</span><span class="s">&quot;_&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">j</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">isDir</span><span class="p">(</span><span class="n">dirname</span><span class="p">):</span>
                    <span class="n">j</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">renameDir</span><span class="p">(</span><span class="n">dirname</span><span class="p">,</span><span class="n">dirname2</span><span class="p">)</span>
        <span class="n">arg</span><span class="o">=</span><span class="p">{}</span>
        <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">walk</span><span class="p">(</span><span class="n">rootdir</span><span class="p">,</span> <span class="n">visit</span><span class="p">,</span><span class="n">arg</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="SystemFS.getTmpDirPath"><a class="viewcode-back" href="../../../../API/JumpScale.core.system.html#JumpScale.core.system.fs.SystemFS.getTmpDirPath">[docs]</a>    <span class="k">def</span> <span class="nf">getTmpDirPath</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        create a tmp dir name and makes sure the dir exists</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">tmpdir</span><span class="o">=</span><span class="n">j</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">joinPaths</span><span class="p">(</span><span class="n">j</span><span class="o">.</span><span class="n">dirs</span><span class="o">.</span><span class="n">tmpDir</span><span class="p">,</span><span class="n">j</span><span class="o">.</span><span class="n">base</span><span class="o">.</span><span class="n">idgenerator</span><span class="o">.</span><span class="n">generateRandomInt</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">100000000</span><span class="p">))</span>
        <span class="n">j</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">createDir</span><span class="p">(</span><span class="n">tmpdir</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">tmpdir</span>

</div>
<div class="viewcode-block" id="SystemFS.getTmpFilePath"><a class="viewcode-back" href="../../../../API/JumpScale.core.system.html#JumpScale.core.system.fs.SystemFS.getTmpFilePath">[docs]</a>    <span class="k">def</span> <span class="nf">getTmpFilePath</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">cygwin</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Generate a temp file path</span>
<span class="sd">        Located in temp dir of qbase</span>
<span class="sd">        @rtype: string representing the path of the temp file generated</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c">#return tempfile.mktemp())</span>
        <span class="n">tmpdir</span><span class="o">=</span><span class="n">j</span><span class="o">.</span><span class="n">dirs</span><span class="o">.</span><span class="n">tmpDir</span>
        <span class="n">fd</span><span class="p">,</span> <span class="n">path</span> <span class="o">=</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">mkstemp</span><span class="p">(</span><span class="nb">dir</span><span class="o">=</span><span class="n">tmpdir</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">real_fd</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">fdopen</span><span class="p">(</span><span class="n">fd</span><span class="p">)</span>
            <span class="n">real_fd</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">except</span> <span class="p">(</span><span class="ne">IOError</span><span class="p">,</span> <span class="ne">OSError</span><span class="p">):</span>
            <span class="k">pass</span>
        <span class="k">if</span> <span class="n">cygwin</span><span class="p">:</span>
            <span class="n">path</span><span class="o">=</span><span class="n">path</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\\</span><span class="s">&quot;</span><span class="p">,</span><span class="s">&quot;/&quot;</span><span class="p">)</span>
            <span class="n">path</span><span class="o">=</span><span class="n">path</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&quot;//&quot;</span><span class="p">,</span><span class="s">&quot;/&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">path</span>
</div>
<div class="viewcode-block" id="SystemFS.getTempFileName"><a class="viewcode-back" href="../../../../API/JumpScale.core.system.html#JumpScale.core.system.fs.SystemFS.getTempFileName">[docs]</a>    <span class="k">def</span> <span class="nf">getTempFileName</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">dir</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Generates a temp file for the directory specified</span>
<span class="sd">        @param dir: Directory to generate the temp file</span>
<span class="sd">        @param prefix: string to start the generated name with</span>
<span class="sd">        @rtype: string representing the generated temp file path</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">dir</span><span class="o">==</span><span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">j</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">joinPaths</span><span class="p">(</span><span class="n">j</span><span class="o">.</span><span class="n">dirs</span><span class="o">.</span><span class="n">tmpDir</span><span class="p">,</span><span class="n">prefix</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">j</span><span class="o">.</span><span class="n">base</span><span class="o">.</span><span class="n">idgenerator</span><span class="o">.</span><span class="n">generateRandomInt</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1000000000000</span><span class="p">))</span><span class="o">+</span><span class="s">&quot;.tmp&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">dir</span> <span class="o">=</span> <span class="nb">dir</span> <span class="ow">or</span> <span class="n">j</span><span class="o">.</span><span class="n">dirs</span><span class="o">.</span><span class="n">tmpDir</span>
            <span class="k">return</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">mktemp</span><span class="p">(</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">prefix</span><span class="p">,</span> <span class="nb">dir</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="SystemFS.isAsciiFile"><a class="viewcode-back" href="../../../../API/JumpScale.core.system.html#JumpScale.core.system.fs.SystemFS.isAsciiFile">[docs]</a>    <span class="k">def</span> <span class="nf">isAsciiFile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">checksize</span><span class="o">=</span><span class="mi">4096</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Read the first &lt;checksize&gt; bytes of &lt;filename&gt;.</span>
<span class="sd">           Validate that only valid ascii characters (32-126), \r, \t, \n are</span>
<span class="sd">           present in the file&quot;&quot;&quot;</span>
        <span class="n">BLOCKSIZE</span> <span class="o">=</span> <span class="mi">4096</span>
        <span class="n">dataread</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="n">checksize</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">checksize</span> <span class="o">=</span> <span class="n">BLOCKSIZE</span>
        <span class="n">fp</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span><span class="s">&quot;r&quot;</span><span class="p">)</span>
        <span class="n">isAscii</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="k">while</span> <span class="n">dataread</span> <span class="o">&lt;</span> <span class="n">checksize</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">fp</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">BLOCKSIZE</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">data</span><span class="p">:</span>
                <span class="k">break</span>
            <span class="n">dataread</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="p">((</span><span class="nb">ord</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">&gt;=</span><span class="mi">32</span> <span class="ow">and</span> <span class="nb">ord</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">&lt;=</span><span class="mi">126</span><span class="p">)</span> <span class="ow">or</span> <span class="n">x</span><span class="o">==</span><span class="s">&#39;</span><span class="se">\r</span><span class="s">&#39;</span> <span class="ow">or</span> <span class="n">x</span><span class="o">==</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span> <span class="ow">or</span> <span class="n">x</span><span class="o">==</span><span class="s">&#39;</span><span class="se">\t</span><span class="s">&#39;</span><span class="p">):</span>
                    <span class="n">isAscii</span> <span class="o">=</span> <span class="bp">False</span>
                    <span class="k">break</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">isAscii</span><span class="p">:</span>
                <span class="k">break</span>
        <span class="n">fp</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">isAscii</span>
</div>
<div class="viewcode-block" id="SystemFS.isBinaryFile"><a class="viewcode-back" href="../../../../API/JumpScale.core.system.html#JumpScale.core.system.fs.SystemFS.isBinaryFile">[docs]</a>    <span class="k">def</span> <span class="nf">isBinaryFile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">checksize</span><span class="o">=</span><span class="mi">4096</span><span class="p">):</span>
        <span class="k">return</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">isAsciiFile</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">checksize</span><span class="p">)</span>
</div>
    <span class="n">lock</span> <span class="o">=</span> <span class="nb">staticmethod</span><span class="p">(</span><span class="n">lock</span><span class="p">)</span>
    <span class="n">lock_</span> <span class="o">=</span> <span class="nb">staticmethod</span><span class="p">(</span><span class="n">lock_</span><span class="p">)</span>
    <span class="n">islocked</span> <span class="o">=</span> <span class="nb">staticmethod</span><span class="p">(</span><span class="n">islocked</span><span class="p">)</span>
    <span class="n">unlock</span> <span class="o">=</span> <span class="nb">staticmethod</span><span class="p">(</span><span class="n">unlock</span><span class="p">)</span>
    <span class="n">unlock_</span> <span class="o">=</span> <span class="nb">staticmethod</span><span class="p">(</span><span class="n">unlock_</span><span class="p">)</span>

<div class="viewcode-block" id="SystemFS.validateFilename"><a class="viewcode-back" href="../../../../API/JumpScale.core.system.html#JumpScale.core.system.fs.SystemFS.validateFilename">[docs]</a>    <span class="k">def</span> <span class="nf">validateFilename</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">platform</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Validate a filename for a given (or current) platform</span>

<span class="sd">        Check whether a given filename is valid on a given platform, or the</span>
<span class="sd">        current platform if no platform is specified.</span>

<span class="sd">        Rules</span>
<span class="sd">        =====</span>
<span class="sd">        Generic</span>
<span class="sd">        -------</span>
<span class="sd">        Zero-length filenames are not allowed</span>

<span class="sd">        Unix</span>
<span class="sd">        ----</span>
<span class="sd">        Filenames can contain any character except 0x00. We also disallow a</span>
<span class="sd">        forward slash (&#39;/&#39;) in filenames.</span>

<span class="sd">        Filenames can be up to 255 characters long.</span>

<span class="sd">        Windows</span>
<span class="sd">        -------</span>
<span class="sd">        Filenames should not contain any character in the 0x00-0x1F range, &#39;&lt;&#39;,</span>
<span class="sd">        &#39;&gt;&#39;, &#39;:&#39;, &#39;&quot;&#39;, &#39;/&#39;, &#39;\&#39;, &#39;|&#39;, &#39;?&#39; or &#39;*&#39;. Names should not end with a</span>
<span class="sd">        dot (&#39;.&#39;) or a space (&#39; &#39;).</span>

<span class="sd">        Several basenames are not allowed, including CON, PRN, AUX, CLOCK$,</span>
<span class="sd">        NUL, COM[1-9] and LPT[1-9].</span>

<span class="sd">        Filenames can be up to 255 characters long.</span>

<span class="sd">        Information sources</span>
<span class="sd">        ===================</span>
<span class="sd">        Restrictions are based on information found at these URLs:</span>

<span class="sd">         * http://en.wikipedia.org/wiki/Filename</span>
<span class="sd">         * http://msdn.microsoft.com/en-us/library/aa365247.aspx</span>
<span class="sd">         * http://www.boost.org/doc/libs/1_35_0/libs/filesystem/doc/portability_guide.htm</span>
<span class="sd">         * http://blogs.msdn.com/brian_dewey/archive/2004/01/19/60263.aspx</span>

<span class="sd">        @param filename: Filename to check</span>
<span class="sd">        @type filename: string</span>
<span class="sd">        @param platform: Platform to validate against</span>
<span class="sd">        @type platform: L{PlatformType}</span>

<span class="sd">        @returns: Whether the filename is valid on the given platform</span>
<span class="sd">        @rtype: bool</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="kn">from</span> <span class="nn">JumpScale.core.enumerators</span> <span class="kn">import</span> <span class="n">PlatformType</span>
        <span class="n">platform</span> <span class="o">=</span> <span class="n">platform</span> <span class="ow">or</span> <span class="n">PlatformType</span><span class="o">.</span><span class="n">findPlatformType</span><span class="p">()</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">filename</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">False</span>

        <span class="c">#When adding more restrictions to check_unix or check_windows, please</span>
        <span class="c">#update the validateFilename documentation accordingly</span>

        <span class="k">def</span> <span class="nf">check_unix</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">255</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">False</span>

            <span class="k">if</span> <span class="s">&#39;</span><span class="se">\0</span><span class="s">&#39;</span> <span class="ow">in</span> <span class="n">filename</span> <span class="ow">or</span> <span class="s">&#39;/&#39;</span> <span class="ow">in</span> <span class="n">filename</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">False</span>

            <span class="k">return</span> <span class="bp">True</span>

        <span class="k">def</span> <span class="nf">check_windows</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">255</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">False</span>

            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">filename</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&#39;CON&#39;</span><span class="p">,</span> <span class="s">&#39;PRN&#39;</span><span class="p">,</span> <span class="s">&#39;AUX&#39;</span><span class="p">,</span> <span class="s">&#39;CLOCK$&#39;</span><span class="p">,</span> <span class="s">&#39;NUL&#39;</span><span class="p">):</span>
                <span class="k">return</span> <span class="bp">False</span>

            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">filename</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&#39;COM</span><span class="si">%d</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">9</span><span class="p">)):</span>
                <span class="k">return</span> <span class="bp">False</span>

            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">filename</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&#39;LPT</span><span class="si">%d</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">9</span><span class="p">)):</span>
                <span class="k">return</span> <span class="bp">False</span>

            <span class="c">#ASCII characters 0x00 - 0x1F are invalid in a Windows filename</span>
            <span class="c">#We loop from 0x00 to 0x20 (xrange is [a, b[), and check whether</span>
            <span class="c">#the corresponding ASCII character (which we get through the chr(i)</span>
            <span class="c">#function) is in the filename</span>
            <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x20</span><span class="p">):</span>
                <span class="k">if</span> <span class="nb">chr</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="ow">in</span> <span class="n">filename</span><span class="p">:</span>
                    <span class="k">return</span> <span class="bp">False</span>

            <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&#39;&lt;&#39;</span><span class="p">,</span> <span class="s">&#39;&gt;&#39;</span><span class="p">,</span> <span class="s">&#39;:&#39;</span><span class="p">,</span> <span class="s">&#39;&quot;&#39;</span><span class="p">,</span> <span class="s">&#39;/&#39;</span><span class="p">,</span> <span class="s">&#39;</span><span class="se">\\</span><span class="s">&#39;</span><span class="p">,</span> <span class="s">&#39;|&#39;</span><span class="p">,</span> <span class="s">&#39;?&#39;</span><span class="p">,</span> <span class="s">&#39;*&#39;</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">filename</span><span class="p">:</span>
                    <span class="k">return</span> <span class="bp">False</span>

            <span class="k">if</span> <span class="n">filename</span><span class="o">.</span><span class="n">endswith</span><span class="p">((</span><span class="s">&#39; &#39;</span><span class="p">,</span> <span class="s">&#39;.&#39;</span><span class="p">,</span> <span class="p">)):</span>
                <span class="k">return</span> <span class="bp">False</span>

            <span class="k">return</span> <span class="bp">True</span>

        <span class="k">if</span> <span class="n">platform</span><span class="o">.</span><span class="n">isWindows</span><span class="p">():</span>
            <span class="k">return</span> <span class="n">check_windows</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">platform</span><span class="o">.</span><span class="n">isUnix</span><span class="p">():</span>
            <span class="k">return</span> <span class="n">check_unix</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>

        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s">&#39;Filename validation on given platform not supported&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="SystemFS.fileConvertLineEndingCRLF"><a class="viewcode-back" href="../../../../API/JumpScale.core.system.html#JumpScale.core.system.fs.SystemFS.fileConvertLineEndingCRLF">[docs]</a>    <span class="k">def</span> <span class="nf">fileConvertLineEndingCRLF</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="nb">file</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Convert CRLF line-endings in a file to LF-only endings (\r\n -&gt; \n)</span>

<span class="sd">        @param file: File to convert</span>
<span class="sd">        @type file: string</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s">&quot;fileConvertLineEndingCRLF &quot;</span><span class="o">+</span><span class="nb">file</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>
        <span class="n">content</span><span class="o">=</span><span class="n">j</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">fileGetContents</span><span class="p">(</span><span class="nb">file</span><span class="p">)</span>
        <span class="n">lines</span><span class="o">=</span><span class="n">content</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
        <span class="n">out</span><span class="o">=</span><span class="s">&quot;&quot;</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
            <span class="n">line</span><span class="o">=</span><span class="n">line</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="s">&quot;&quot;</span><span class="p">)</span>
            <span class="n">line</span><span class="o">=</span><span class="n">line</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\r</span><span class="s">&quot;</span><span class="p">,</span><span class="s">&quot;&quot;</span><span class="p">)</span>
            <span class="n">out</span><span class="o">=</span><span class="n">out</span><span class="o">+</span><span class="n">line</span><span class="o">+</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">writeFile</span><span class="p">(</span><span class="nb">file</span><span class="p">,</span><span class="n">out</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="SystemFS.find"><a class="viewcode-back" href="../../../../API/JumpScale.core.system.html#JumpScale.core.system.fs.SystemFS.find">[docs]</a>    <span class="k">def</span> <span class="nf">find</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">startDir</span><span class="p">,</span><span class="n">fileregex</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Search for files or folders matching a given pattern</span>
<span class="sd">        this is a very weard function, don&#39;t use is better to use the list functions</span>
<span class="sd">        make sure you do changedir to the starting dir first</span>
<span class="sd">        example: find(&quot;*.pyc&quot;)</span>
<span class="sd">        @param fileregex: The regex pattern to match</span>
<span class="sd">        @type fileregex: string</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">j</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">changeDir</span><span class="p">(</span><span class="n">startDir</span><span class="p">)</span>
        <span class="kn">import</span> <span class="nn">glob</span>
        <span class="k">return</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">fileregex</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="SystemFS.grep"><a class="viewcode-back" href="../../../../API/JumpScale.core.system.html#JumpScale.core.system.fs.SystemFS.grep">[docs]</a>    <span class="k">def</span> <span class="nf">grep</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fileregex</span><span class="p">,</span> <span class="n">lineregex</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Search for lines matching a given regex in all files matching a regex</span>

<span class="sd">        @param fileregex: Files to search in</span>
<span class="sd">        @type fileregex: string</span>
<span class="sd">        @param lineregex: Regex pattern to search for in each file</span>
<span class="sd">        @type lineregex: string</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">import</span> <span class="nn">glob</span><span class="o">,</span> <span class="nn">re</span><span class="o">,</span> <span class="nn">os</span>
        <span class="k">for</span> <span class="n">filename</span> <span class="ow">in</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">fileregex</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
                <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s">&#39;r&#39;</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">f</span><span class="o">.</span><span class="n">xreadlines</span><span class="p">():</span>
                    <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">lineregex</span><span class="p">,</span> <span class="n">line</span><span class="p">):</span>
                        <span class="k">print</span> <span class="s">&quot;</span><span class="si">%s</span><span class="s">: </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span>
</div>
    <span class="n">cleanupString</span> <span class="o">=</span> <span class="nb">staticmethod</span><span class="p">(</span><span class="n">cleanupString</span><span class="p">)</span>

<div class="viewcode-block" id="SystemFS.constructDirPathFromArray"><a class="viewcode-back" href="../../../../API/JumpScale.core.system.html#JumpScale.core.system.fs.SystemFS.constructDirPathFromArray">[docs]</a>    <span class="k">def</span> <span class="nf">constructDirPathFromArray</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">array</span><span class="p">):</span>
        <span class="n">path</span><span class="o">=</span><span class="s">&quot;&quot;</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">array</span><span class="p">:</span>
            <span class="n">path</span><span class="o">=</span><span class="n">path</span><span class="o">+</span><span class="n">os</span><span class="o">.</span><span class="n">sep</span><span class="o">+</span><span class="n">item</span>
        <span class="n">path</span><span class="o">=</span><span class="n">path</span><span class="o">+</span><span class="n">os</span><span class="o">.</span><span class="n">sep</span>
        <span class="k">if</span> <span class="n">j</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">platformtype</span><span class="o">.</span><span class="n">isUnix</span><span class="p">():</span>
            <span class="n">path</span><span class="o">=</span><span class="n">path</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&quot;//&quot;</span><span class="p">,</span><span class="s">&quot;/&quot;</span><span class="p">)</span>
            <span class="n">path</span><span class="o">=</span><span class="n">path</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&quot;//&quot;</span><span class="p">,</span><span class="s">&quot;/&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">path</span>
</div>
<div class="viewcode-block" id="SystemFS.constructFilePathFromArray"><a class="viewcode-back" href="../../../../API/JumpScale.core.system.html#JumpScale.core.system.fs.SystemFS.constructFilePathFromArray">[docs]</a>    <span class="k">def</span> <span class="nf">constructFilePathFromArray</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">array</span><span class="p">):</span>
        <span class="n">path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">constructDirPathFromArray</span><span class="p">(</span><span class="n">array</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">path</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">==</span><span class="s">&quot;/&quot;</span><span class="p">:</span>
            <span class="n">path</span><span class="o">=</span><span class="n">path</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">path</span>
</div>
<div class="viewcode-block" id="SystemFS.pathToUnicode"><a class="viewcode-back" href="../../../../API/JumpScale.core.system.html#JumpScale.core.system.fs.SystemFS.pathToUnicode">[docs]</a>    <span class="k">def</span> <span class="nf">pathToUnicode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Convert path to unicode. Use the local filesystem encoding. Will return</span>
<span class="sd">        path unmodified if path already is unicode.</span>

<span class="sd">        Use this to convert paths you received from the os module to unicode.</span>

<span class="sd">        @param path: path to convert to unicode</span>
<span class="sd">        @type path: basestring</span>
<span class="sd">        @return: unicode path</span>
<span class="sd">        @rtype: unicode</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">jumpscale</span> <span class="kn">import</span> <span class="n">Dirs</span>
        <span class="k">return</span> <span class="n">Dirs</span><span class="o">.</span><span class="n">pathToUnicode</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="SystemFS.targzCompress"><a class="viewcode-back" href="../../../../API/JumpScale.core.system.html#JumpScale.core.system.fs.SystemFS.targzCompress">[docs]</a>    <span class="k">def</span> <span class="nf">targzCompress</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sourcepath</span><span class="p">,</span> <span class="n">destinationpath</span><span class="p">,</span><span class="n">followlinks</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span><span class="n">destInTar</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">,</span><span class="n">pathRegexIncludes</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;.[a-zA-Z0-9]*&#39;</span><span class="p">],</span> \
                      <span class="n">pathRegexExcludes</span><span class="o">=</span><span class="p">[],</span> <span class="n">contentRegexIncludes</span><span class="o">=</span><span class="p">[],</span> <span class="n">contentRegexExcludes</span><span class="o">=</span><span class="p">[],</span> <span class="n">depths</span><span class="o">=</span><span class="p">[],</span>\
                      <span class="n">extrafiles</span><span class="o">=</span><span class="p">[]):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        @param sourcepath: Source directory .</span>
<span class="sd">        @param destination: Destination filename.</span>
<span class="sd">        @param followlinks: do not tar the links, follow the link and add that file or content of directory to the tar</span>
<span class="sd">        @param pathRegexIncludes: / Excludes  match paths to array of regex expressions (array(strings))</span>
<span class="sd">        @param contentRegexIncludes: / Excludes match content of files to array of regex expressions (array(strings))</span>
<span class="sd">        @param depths: array of depth values e.g. only return depth 0 &amp; 1 (would mean first dir depth and then 1 more deep) (array(int))</span>
<span class="sd">        @param destInTar when not specified the dirs, files under sourcedirpath will be added to root of</span>
<span class="sd">                  tar.gz with this param can put something in front e.g. /qbase3/ prefix to dest in tgz</span>
<span class="sd">        @param extrafiles is array of array [[source,destpath],[source,destpath],...]  adds extra files to tar</span>
<span class="sd">        (TAR-GZ-Archive *.tar.gz)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">import</span> <span class="nn">os.path</span>
        <span class="kn">import</span> <span class="nn">tarfile</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">j</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">isDir</span><span class="p">(</span><span class="n">sourcepath</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s">&quot;Cannot find file (exists but is not a file or dir) </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">sourcepath</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s">&quot;Compressing directory </span><span class="si">%s</span><span class="s"> to </span><span class="si">%s</span><span class="s">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">sourcepath</span><span class="p">,</span> <span class="n">destinationpath</span><span class="p">))</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">j</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">j</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">getDirName</span><span class="p">(</span><span class="n">destinationpath</span><span class="p">)):</span>
            <span class="n">j</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">createDir</span><span class="p">(</span><span class="n">j</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">getDirName</span><span class="p">(</span><span class="n">destinationpath</span><span class="p">))</span>
        <span class="n">t</span> <span class="o">=</span> <span class="n">tarfile</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="n">destinationpath</span><span class="p">,</span> <span class="n">mode</span> <span class="o">=</span> <span class="s">&#39;w:gz&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span><span class="p">(</span><span class="n">followlinks</span><span class="o">&lt;&gt;</span><span class="bp">False</span> <span class="ow">or</span> <span class="n">destInTar</span><span class="o">&lt;&gt;</span><span class="s">&quot;&quot;</span> <span class="ow">or</span> <span class="n">pathRegexIncludes</span><span class="o">&lt;&gt;</span><span class="p">[</span><span class="s">&#39;.*&#39;</span><span class="p">]</span> <span class="ow">or</span> <span class="n">pathRegexExcludes</span><span class="o">&lt;&gt;</span><span class="p">[]</span> \
               <span class="ow">or</span> <span class="n">contentRegexIncludes</span><span class="o">&lt;&gt;</span><span class="p">[]</span> <span class="ow">or</span> <span class="n">contentRegexExcludes</span><span class="o">&lt;&gt;</span><span class="p">[]</span> <span class="ow">or</span> <span class="n">depths</span><span class="o">&lt;&gt;</span><span class="p">[]):</span>
            <span class="n">t</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">sourcepath</span><span class="p">,</span> <span class="s">&quot;/&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">def</span> <span class="nf">addToTar</span><span class="p">(</span><span class="n">params</span><span class="p">,</span><span class="n">path</span><span class="p">):</span>
                <span class="n">tarfile</span><span class="o">=</span><span class="n">params</span><span class="p">[</span><span class="s">&quot;t&quot;</span><span class="p">]</span>
                <span class="n">destInTar</span><span class="o">=</span><span class="n">params</span><span class="p">[</span><span class="s">&quot;destintar&quot;</span><span class="p">]</span>
                <span class="n">destpath</span><span class="o">=</span><span class="n">j</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">joinPaths</span><span class="p">(</span><span class="n">destInTar</span><span class="p">,</span><span class="n">j</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">pathRemoveDirPart</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">sourcepath</span><span class="p">))</span>
                <span class="k">if</span> <span class="n">j</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">isLink</span><span class="p">(</span><span class="n">path</span><span class="p">)</span> <span class="ow">and</span> <span class="n">followlinks</span><span class="p">:</span>
                    <span class="n">path</span><span class="o">=</span><span class="n">j</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">readlink</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s">&quot;fstar: add file </span><span class="si">%s</span><span class="s"> to tar&quot;</span> <span class="o">%</span> <span class="n">path</span><span class="p">,</span><span class="mi">7</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">j</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">platformtype</span><span class="o">.</span><span class="n">isWindows</span><span class="p">()</span> <span class="ow">and</span> <span class="n">j</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">windows</span><span class="o">.</span><span class="n">checkFileToIgnore</span><span class="p">(</span><span class="n">path</span><span class="p">)):</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">isFile</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
                        <span class="n">tarfile</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">path</span><span class="p">,</span><span class="n">destpath</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s">&quot;Cannot add file </span><span class="si">%s</span><span class="s"> to destpath&quot;</span><span class="o">%</span><span class="n">destpath</span><span class="p">)</span>
            <span class="n">params</span><span class="o">=</span><span class="p">{}</span>
            <span class="n">params</span><span class="p">[</span><span class="s">&quot;t&quot;</span><span class="p">]</span><span class="o">=</span><span class="n">t</span>
            <span class="n">params</span><span class="p">[</span><span class="s">&quot;destintar&quot;</span><span class="p">]</span><span class="o">=</span><span class="n">destInTar</span>
            <span class="n">j</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">fswalker</span><span class="o">.</span><span class="n">walk</span><span class="p">(</span><span class="n">sourcepath</span><span class="p">,</span> <span class="n">addToTar</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span>\
                                          <span class="bp">True</span><span class="p">,</span> <span class="bp">False</span><span class="p">,</span> \
                                          <span class="n">pathRegexIncludes</span><span class="p">,</span> <span class="n">pathRegexExcludes</span><span class="p">,</span> <span class="n">contentRegexIncludes</span><span class="p">,</span> \
                                          <span class="n">contentRegexExcludes</span><span class="p">,</span> <span class="n">depths</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">extrafiles</span><span class="o">&lt;&gt;</span><span class="p">[]:</span>
                <span class="k">for</span> <span class="n">extrafile</span> <span class="ow">in</span> <span class="n">extrafiles</span><span class="p">:</span>
                    <span class="n">source</span><span class="o">=</span><span class="n">extrafile</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">destpath</span><span class="o">=</span><span class="n">extrafile</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                    <span class="n">t</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">source</span><span class="p">,</span><span class="n">j</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">joinPaths</span><span class="p">(</span><span class="n">destInTar</span><span class="p">,</span><span class="n">destpath</span><span class="p">))</span>
        <span class="n">t</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="SystemFS.gzip"><a class="viewcode-back" href="../../../../API/JumpScale.core.system.html#JumpScale.core.system.fs.SystemFS.gzip">[docs]</a>    <span class="k">def</span> <span class="nf">gzip</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">sourceFile</span><span class="p">,</span><span class="n">destFile</span><span class="p">):</span>
        <span class="kn">import</span> <span class="nn">gzip</span>
        <span class="n">f_in</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">sourceFile</span><span class="p">,</span> <span class="s">&#39;rb&#39;</span><span class="p">)</span>
        <span class="n">f_out</span> <span class="o">=</span> <span class="n">gzip</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">destFile</span><span class="p">,</span> <span class="s">&#39;wb&#39;</span><span class="p">)</span>
        <span class="n">f_out</span><span class="o">.</span><span class="n">writelines</span><span class="p">(</span><span class="n">f_in</span><span class="p">)</span>
        <span class="n">f_out</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="n">f_in</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="SystemFS.gunzip"><a class="viewcode-back" href="../../../../API/JumpScale.core.system.html#JumpScale.core.system.fs.SystemFS.gunzip">[docs]</a>    <span class="k">def</span> <span class="nf">gunzip</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">sourceFile</span><span class="p">,</span><span class="n">destFile</span><span class="p">):</span>
        <span class="kn">import</span> <span class="nn">gzip</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">createDir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getDirName</span><span class="p">(</span><span class="n">destFile</span><span class="p">))</span>
        <span class="n">f_in</span> <span class="o">=</span> <span class="n">gzip</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">sourceFile</span><span class="p">,</span> <span class="s">&#39;rb&#39;</span><span class="p">)</span>
        <span class="n">f_out</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">destFile</span><span class="p">,</span> <span class="s">&#39;wb&#39;</span><span class="p">)</span>
        <span class="n">f_out</span><span class="o">.</span><span class="n">writelines</span><span class="p">(</span><span class="n">f_in</span><span class="p">)</span>
        <span class="n">f_out</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="n">f_in</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="SystemFS.targzUncompress"><a class="viewcode-back" href="../../../../API/JumpScale.core.system.html#JumpScale.core.system.fs.SystemFS.targzUncompress">[docs]</a>    <span class="k">def</span> <span class="nf">targzUncompress</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">sourceFile</span><span class="p">,</span><span class="n">destinationdir</span><span class="p">,</span><span class="n">removeDestinationdir</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        compress dirname recursive</span>
<span class="sd">        @param sourceFile: file to uncompress</span>
<span class="sd">        @param destinationpath: path of to destiniation dir, sourcefile will end up uncompressed in destination dir</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">removeDestinationdir</span><span class="p">:</span>
            <span class="n">j</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">removeDirTree</span><span class="p">(</span><span class="n">destinationdir</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">j</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">destinationdir</span><span class="p">):</span>
            <span class="n">j</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">createDir</span><span class="p">(</span><span class="n">destinationdir</span><span class="p">)</span>
        <span class="kn">import</span> <span class="nn">tarfile</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">j</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">destinationdir</span><span class="p">):</span>
            <span class="n">j</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">createDir</span><span class="p">(</span><span class="n">destinationdir</span><span class="p">)</span>

        <span class="c"># The tar of python does not create empty directories.. this causes manny problem while installing so we choose to use the linux tar here</span>
        <span class="k">if</span>  <span class="n">j</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">platformtype</span><span class="o">.</span><span class="n">isWindows</span><span class="p">():</span>
            <span class="n">tar</span> <span class="o">=</span> <span class="n">tarfile</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">sourceFile</span><span class="p">)</span>
            <span class="n">tar</span><span class="o">.</span><span class="n">extractall</span><span class="p">(</span><span class="n">destinationdir</span><span class="p">)</span>
            <span class="n">tar</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="c">#todo find better alternative for windows</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">cmd</span> <span class="o">=</span> <span class="s">&quot;tar xzf &#39;</span><span class="si">%s</span><span class="s">&#39; -C &#39;</span><span class="si">%s</span><span class="s">&#39;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">sourceFile</span><span class="p">,</span> <span class="n">destinationdir</span><span class="p">)</span>
            <span class="n">j</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span></div></div>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../../../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../../../../index.html">Jumpscale Doc 7.0 documentation</a> &raquo;</li>
          <li><a href="../../../index.html" >Module code</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
    </div>
  </body>
</html>