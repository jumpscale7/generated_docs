<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>JumpScale.lib.sheet.Sheet &mdash; Jumpscale Doc 7.0 documentation</title>
    
    <link rel="stylesheet" href="../../../../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../../../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../../',
        VERSION:     '7.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../../_static/doctools.js"></script>
    <link rel="top" title="Jumpscale Doc 7.0 documentation" href="../../../../index.html" />
    <link rel="up" title="Module code" href="../../../index.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../../../../index.html">Jumpscale Doc 7.0 documentation</a> &raquo;</li>
          <li><a href="../../../index.html" accesskey="U">Module code</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <h1>Source code for JumpScale.lib.sheet.Sheet</h1><div class="highlight"><pre>
<span class="kn">from</span> <span class="nn">JumpScale</span> <span class="kn">import</span> <span class="n">j</span>
<span class="kn">from</span> <span class="nn">Sheets</span> <span class="kn">import</span> <span class="o">*</span>


<span class="k">class</span> <span class="nc">Row</span><span class="p">(</span><span class="n">j</span><span class="o">.</span><span class="n">code</span><span class="o">.</span><span class="n">classGetBase</span><span class="p">()):</span>
<div class="viewcode-block" id="Row"><a class="viewcode-back" href="../../../../API/JumpScale.lib.sheet.html#JumpScale.lib.sheet.Sheet.Row">[docs]</a>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">,</span> <span class="n">ttype</span><span class="o">=</span><span class="s">&quot;float&quot;</span><span class="p">,</span> <span class="n">nrcols</span><span class="o">=</span><span class="mi">72</span><span class="p">,</span> <span class="n">aggregate</span><span class="o">=</span><span class="s">&quot;T&quot;</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">,</span> <span class="n">groupname</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">,</span> <span class="n">groupdescr</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">,</span>
                 <span class="n">format</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">,</span> <span class="n">defval</span><span class="o">=</span><span class="s">&quot;default&quot;</span><span class="p">,</span> <span class="n">nrfloat</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        @param ttype int,perc,float,empty,str,unknown</span>
<span class="sd">        @param aggregate= T,MIN,MAX,LAST,FIRST,AVG</span>
<span class="sd">        @format bold (if empty then normal)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="k">if</span> <span class="n">defval</span> <span class="o">==</span> <span class="s">&quot;default&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">ttype</span> <span class="o">==</span> <span class="s">&quot;float&quot;</span> <span class="ow">or</span> <span class="n">ttype</span> <span class="o">==</span> <span class="s">&quot;perc&quot;</span> <span class="ow">or</span> <span class="n">ttype</span> <span class="o">==</span> <span class="s">&quot;int&quot;</span><span class="p">:</span>
                <span class="n">defval</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="k">if</span> <span class="n">ttype</span> <span class="o">==</span> <span class="s">&quot;empty&quot;</span><span class="p">:</span>
                <span class="n">defval</span> <span class="o">=</span> <span class="s">&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">cells</span> <span class="o">=</span> <span class="p">[</span><span class="n">defval</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nrcols</span><span class="p">)]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">defval</span> <span class="o">=</span> <span class="n">defval</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ttype</span> <span class="o">=</span> <span class="n">ttype</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">format</span> <span class="o">=</span> <span class="n">format</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="n">description</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">groupname</span> <span class="o">=</span> <span class="n">groupname</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">groupdescr</span> <span class="o">=</span> <span class="n">groupdescr</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">aggregateAction</span> <span class="o">=</span> <span class="n">aggregate</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nrfloat</span> <span class="o">=</span> <span class="n">nrfloat</span>
        <span class="k">if</span> <span class="n">aggregate</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&quot;T&quot;</span><span class="p">,</span> <span class="s">&quot;MAX&quot;</span><span class="p">,</span> <span class="s">&quot;MIN&quot;</span><span class="p">,</span> <span class="s">&quot;LAST&quot;</span><span class="p">,</span> <span class="s">&quot;FIRST&quot;</span><span class="p">,</span> <span class="s">&quot;AVG&quot;</span><span class="p">]:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s">&quot;Cannot find action:</span><span class="si">%s</span><span class="s"> for agreggate&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">aggregateAction</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">ttype</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&quot;int&quot;</span><span class="p">,</span> <span class="s">&quot;perc&quot;</span><span class="p">,</span> <span class="s">&quot;float&quot;</span><span class="p">,</span> <span class="s">&quot;empty&quot;</span><span class="p">,</span> <span class="s">&quot;str&quot;</span><span class="p">,</span> <span class="s">&quot;unknown&quot;</span><span class="p">]:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s">&quot;only support format: int,perc,float,empty,str,unknown&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nrcols</span> <span class="o">=</span> <span class="n">nrcols</span>

    <span class="k">def</span> <span class="nf">setDefaultValue</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">defval</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">stop</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
<div class="viewcode-block" id="Row.setDefaultValue"><a class="viewcode-back" href="../../../../API/JumpScale.lib.sheet.html#JumpScale.lib.sheet.Sheet.Row.setDefaultValue">[docs]</a>        <span class="k">if</span> <span class="n">defval</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">defval</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">defval</span>
        <span class="k">if</span> <span class="n">defval</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">defval</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="k">if</span> <span class="n">stop</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">stop</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nrcols</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">stop</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">for</span> <span class="n">colid</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">stop</span><span class="p">)):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cells</span><span class="p">[</span><span class="n">colid</span><span class="p">]</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cells</span><span class="p">[</span><span class="n">colid</span><span class="p">]</span> <span class="o">=</span> <span class="n">defval</span>

    <span class="k">def</span> <span class="nf">indexation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">yearlyIndexationInPerc</span><span class="p">,</span> <span class="n">roundval</span><span class="o">=</span><span class="mi">100</span><span class="p">):</span></div>
<div class="viewcode-block" id="Row.indexation"><a class="viewcode-back" href="../../../../API/JumpScale.lib.sheet.html#JumpScale.lib.sheet.Sheet.Row.indexation">[docs]</a>
        <span class="k">for</span> <span class="n">year</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">7</span><span class="p">):</span>
            <span class="n">now</span> <span class="o">=</span> <span class="mi">12</span> <span class="o">*</span> <span class="p">(</span><span class="n">year</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">prev</span> <span class="o">=</span> <span class="mi">12</span> <span class="o">*</span> <span class="p">(</span><span class="n">year</span> <span class="o">-</span> <span class="mi">2</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cells</span><span class="p">[</span><span class="n">now</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cells</span><span class="p">[</span><span class="n">prev</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">yearlyIndexationInPerc</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setDefaultValue</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">roundval</span><span class="o">=</span><span class="n">roundval</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">makeGoHigher</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">makeGoHigher</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span></div>
<div class="viewcode-block" id="Row.makeGoHigher"><a class="viewcode-back" href="../../../../API/JumpScale.lib.sheet.html#JumpScale.lib.sheet.Sheet.Row.makeGoHigher">[docs]</a>        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        make sure each cell of row is higher than previous cell</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">prev</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">colid</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">nrcols</span><span class="p">):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cells</span><span class="p">[</span><span class="n">colid</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">prev</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cells</span><span class="p">[</span><span class="n">colid</span><span class="p">]</span> <span class="o">=</span> <span class="n">prev</span>
            <span class="n">prev</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cells</span><span class="p">[</span><span class="n">colid</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">aggregate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">period</span><span class="o">=</span><span class="s">&quot;Y&quot;</span><span class="p">):</span></div>
<div class="viewcode-block" id="Row.aggregate"><a class="viewcode-back" href="../../../../API/JumpScale.lib.sheet.html#JumpScale.lib.sheet.Sheet.Row.aggregate">[docs]</a>        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        @param period is Q or Y (Quarter/Year)</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">def</span> <span class="nf">calc</span><span class="p">(</span><span class="n">months</span><span class="p">):</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">aggregateAction</span> <span class="o">==</span> <span class="s">&quot;LAST&quot;</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">cells</span><span class="p">[</span><span class="n">months</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">aggregateAction</span> <span class="o">==</span> <span class="s">&quot;FIRST&quot;</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">cells</span><span class="p">[</span><span class="n">months</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
            <span class="n">result</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">aggregateAction</span> <span class="o">==</span> <span class="s">&quot;MIN&quot;</span><span class="p">:</span>
                <span class="n">result</span> <span class="o">=</span> <span class="mi">9999999999999999999</span>
            <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">months</span><span class="p">:</span>
                <span class="n">val</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cells</span><span class="p">[</span><span class="n">m</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">val</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s">&quot;Cannot aggregrate row </span><span class="si">%s</span><span class="s"> from group </span><span class="si">%s</span><span class="s">,</span><span class="se">\n</span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">groupname</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cells</span><span class="p">))</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">aggregateAction</span> <span class="o">==</span> <span class="s">&quot;T&quot;</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">aggregateAction</span> <span class="o">==</span> <span class="s">&quot;AVG&quot;</span><span class="p">:</span>
                    <span class="n">result</span> <span class="o">+=</span> <span class="n">val</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">aggregateAction</span> <span class="o">==</span> <span class="s">&quot;MIN&quot;</span><span class="p">:</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">val</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">val</span> <span class="o">&lt;</span> <span class="n">result</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">val</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">val</span> <span class="o">&gt;</span> <span class="n">result</span><span class="p">):</span>
                        <span class="n">result</span> <span class="o">=</span> <span class="n">val</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">aggregateAction</span> <span class="o">==</span> <span class="s">&quot;MAX&quot;</span><span class="p">:</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">val</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">val</span> <span class="o">&gt;</span> <span class="n">result</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">val</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">val</span> <span class="o">&lt;</span> <span class="n">result</span><span class="p">):</span>
                        <span class="n">result</span> <span class="o">=</span> <span class="n">val</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">aggregateAction</span> <span class="o">==</span> <span class="s">&quot;AVG&quot;</span><span class="p">:</span>
                <span class="n">result</span> <span class="o">=</span> <span class="n">result</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">months</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">result</span>

        <span class="c">#monthAttributes=[item.name for item in self.months[1].JSModel_MODEL_INFO.attributes]</span>
        <span class="k">if</span> <span class="n">period</span> <span class="o">==</span> <span class="s">&quot;Y&quot;</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.0</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">6</span><span class="p">)]</span>
            <span class="k">for</span> <span class="n">year</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">7</span><span class="p">):</span>
                <span class="n">months</span> <span class="o">=</span> <span class="p">[</span><span class="mi">12</span> <span class="o">*</span> <span class="p">(</span><span class="n">year</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">12</span><span class="p">)]</span>
                <span class="c"># name=self._getYearStringFromYearNr(year)</span>
                <span class="n">result</span><span class="p">[</span><span class="n">year</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">calc</span><span class="p">(</span><span class="n">months</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">period</span> <span class="o">==</span> <span class="s">&quot;Q&quot;</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.0</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">6</span> <span class="o">*</span> <span class="mi">4</span><span class="p">)]</span>
            <span class="k">for</span> <span class="n">quarter</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span> <span class="o">*</span> <span class="mi">6</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
                <span class="n">months</span> <span class="o">=</span> <span class="p">[</span><span class="mi">3</span> <span class="o">*</span> <span class="p">(</span><span class="n">quarter</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">)]</span>
                <span class="c"># name=self._getYearStringFromYearNr(year)</span>
                <span class="n">result</span><span class="p">[</span><span class="n">quarter</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">calc</span><span class="p">(</span><span class="n">months</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span>

    <span class="k">def</span> <span class="nf">interpolate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">stop</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">variation</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span></div>
<div class="viewcode-block" id="Row.interpolate"><a class="viewcode-back" href="../../../../API/JumpScale.lib.sheet.html#JumpScale.lib.sheet.Sheet.Row.interpolate">[docs]</a>        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        @param random if 5 means will put 5% variation on it while interpolating</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c"># tointerpolate=[]</span>
        <span class="c"># for item in self.cells:</span>
            <span class="c"># if item==0.0:</span>
                <span class="c"># item=None</span>
            <span class="c"># tointerpolate.append(item)</span>
        <span class="k">if</span> <span class="n">start</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">start</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="n">stop</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">stop</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cells</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
        <span class="n">tointerpolate</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cells</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">stop</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">interpolated</span> <span class="o">=</span> <span class="n">j</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">numtools</span><span class="o">.</span><span class="n">interpolateList</span><span class="p">(</span><span class="n">tointerpolate</span><span class="p">,</span> <span class="n">floatnr</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">nrfloat</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">print</span> <span class="s">&quot;could not interpolate row </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>
            <span class="kn">from</span> <span class="nn">JumpScale.core.Shell</span> <span class="kn">import</span> <span class="n">ipshellDebug</span><span class="p">,</span> <span class="n">ipshell</span>
            <span class="k">print</span> <span class="s">&quot;DEBUG NOW cannot interpolate, explore self &amp; tointerpolate&quot;</span>
            <span class="n">ipshell</span><span class="p">()</span>
        <span class="n">xx</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">stop</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cells</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="o">=</span> <span class="n">interpolated</span><span class="p">[</span><span class="n">xx</span><span class="p">]</span>
            <span class="n">xx</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">randomVariation</span><span class="p">(</span><span class="n">variation</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="nb">min</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="nb">max</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">randomVariation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">variation</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">stop</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span></div>
<div class="viewcode-block" id="Row.randomVariation"><a class="viewcode-back" href="../../../../API/JumpScale.lib.sheet.html#JumpScale.lib.sheet.Sheet.Row.randomVariation">[docs]</a>        <span class="k">if</span> <span class="n">variation</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="k">if</span> <span class="n">start</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">start</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="n">stop</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">stop</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cells</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
        <span class="c"># variation=float(self.getMax())/100*float(random)</span>
        <span class="n">variation</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">variation</span><span class="p">)</span> <span class="o">*</span> <span class="mf">100.0</span><span class="p">)</span>
        <span class="n">roundd</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ttype</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&quot;perc&quot;</span><span class="p">,</span> <span class="s">&quot;int&quot;</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">stop</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cells</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cells</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="o">-</span> <span class="n">variation</span> <span class="o">/</span> <span class="mi">200</span> <span class="o">+</span> <span class="nb">float</span><span class="p">(</span><span class="n">j</span><span class="o">.</span><span class="n">base</span><span class="o">.</span><span class="n">idgenerator</span><span class="o">.</span><span class="n">generateRandomInt</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">variation</span><span class="p">))</span> <span class="o">/</span> <span class="mi">100</span>
            <span class="k">if</span> <span class="n">roundd</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cells</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cells</span><span class="p">[</span><span class="n">x</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">complete</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">vvariation</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">hvariation</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">minvalue</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">maxvalue</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">lastpos</span><span class="o">=</span><span class="mi">70</span><span class="p">):</span></div>
<div class="viewcode-block" id="Row.complete"><a class="viewcode-back" href="../../../../API/JumpScale.lib.sheet.html#JumpScale.lib.sheet.Sheet.Row.complete">[docs]</a>        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        will copy beginning of row with certain variation to rest of row</span>
<span class="sd">        will start doing that from mentioned startpoint</span>
<span class="sd">        @param hvariation not implemented</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">stop</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cells</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
        <span class="n">blocksize</span> <span class="o">=</span> <span class="n">start</span> <span class="o">-</span> <span class="mi">1</span>
        <span class="n">halt</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">start</span>
        <span class="k">while</span> <span class="n">halt</span> <span class="o">==</span> <span class="bp">False</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">xInBlock</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">blocksize</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
                <span class="n">x</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">xorg</span> <span class="o">=</span> <span class="n">xInBlock</span>
                <span class="c"># print &quot;xorg:%s&quot;%xorg</span>
                <span class="k">if</span> <span class="n">x</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">nrcols</span><span class="p">:</span>
                    <span class="n">halt</span> <span class="o">=</span> <span class="bp">True</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">setCell</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nrcols</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">lastpos</span><span class="p">,</span> <span class="n">minvalue</span><span class="p">,</span> <span class="n">maxvalue</span><span class="p">)</span>
                    <span class="k">break</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cells</span><span class="p">[</span><span class="n">xorg</span><span class="p">]</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
                    <span class="n">val</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cells</span><span class="p">[</span><span class="n">xorg</span><span class="p">]</span>
                    <span class="c"># print val</span>
                    <span class="n">val</span> <span class="o">=</span> <span class="n">val</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_getVariationRelative</span><span class="p">(</span><span class="n">vvariation</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">setCell</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="n">minvalue</span><span class="p">,</span> <span class="n">maxvalue</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">setCell</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">posx</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">minvalue</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">maxvalue</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span></div>
<div class="viewcode-block" id="Row.setCell"><a class="viewcode-back" href="../../../../API/JumpScale.lib.sheet.html#JumpScale.lib.sheet.Sheet.Row.setCell">[docs]</a>        <span class="k">if</span> <span class="n">minvalue</span> <span class="o">!=</span> <span class="bp">None</span> <span class="ow">and</span> <span class="n">value</span> <span class="o">&lt;</span> <span class="n">minvalue</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="n">minvalue</span>
        <span class="k">if</span> <span class="n">maxvalue</span> <span class="o">!=</span> <span class="bp">None</span> <span class="ow">and</span> <span class="n">value</span> <span class="o">&gt;</span> <span class="n">maxvalue</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="n">maxvalue</span>
        <span class="k">if</span> <span class="n">posx</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">nrcols</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">print</span> <span class="s">&quot;out of range: x:</span><span class="si">%s</span><span class="s"> y:</span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">posx</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">None</span><span class="p">,</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cells</span><span class="p">[</span><span class="n">posx</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
        <span class="c"># print &quot;x:%s y:%s&quot; % (posx,value)</span>
        <span class="k">return</span> <span class="n">posx</span><span class="p">,</span> <span class="n">value</span>

    <span class="k">def</span> <span class="nf">_getVariationAbsoluteInt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="n">variation</span><span class="p">):</span></div>
        <span class="n">variation</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">variation</span><span class="p">)</span>
        <span class="n">changeMin</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">val</span> <span class="o">-</span> <span class="n">variation</span><span class="p">)</span>
        <span class="n">changeMax</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">val</span> <span class="o">+</span> <span class="n">variation</span><span class="p">)</span>
        <span class="n">gd</span> <span class="o">=</span> <span class="n">j</span><span class="o">.</span><span class="n">base</span><span class="o">.</span><span class="n">idgenerator</span><span class="o">.</span><span class="n">generateRandomInt</span><span class="p">(</span><span class="n">changeMin</span><span class="p">,</span> <span class="n">changeMax</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">gd</span>

    <span class="k">def</span> <span class="nf">_getVariationPositive</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">change</span><span class="p">,</span> <span class="n">variation</span><span class="p">):</span>
        <span class="n">change</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">change</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">change</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s">&quot;change needs to be positive&quot;</span><span class="p">)</span>
        <span class="n">variation</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">variation</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">variation</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">variation</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s">&quot;Variation cannot be more than 1 and not less than 0.&quot;</span><span class="p">)</span>
        <span class="n">changeMin</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mf">100.0</span> <span class="o">*</span> <span class="p">(</span><span class="n">change</span> <span class="o">-</span> <span class="n">variation</span> <span class="o">*</span> <span class="n">change</span><span class="p">))</span>
        <span class="n">changeMax</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mf">100.0</span> <span class="o">*</span> <span class="p">(</span><span class="n">change</span> <span class="o">+</span> <span class="n">variation</span> <span class="o">*</span> <span class="n">change</span><span class="p">))</span>
        <span class="n">gd</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">j</span><span class="o">.</span><span class="n">base</span><span class="o">.</span><span class="n">idgenerator</span><span class="o">.</span><span class="n">generateRandomInt</span><span class="p">(</span><span class="n">changeMin</span><span class="p">,</span> <span class="n">changeMax</span><span class="p">)</span> <span class="o">/</span> <span class="mf">100.0</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">gd</span>

    <span class="k">def</span> <span class="nf">goDown</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">stop</span><span class="p">,</span> <span class="n">godown</span><span class="p">,</span> <span class="n">nrSteps</span><span class="p">,</span> <span class="n">hvariation</span><span class="p">,</span> <span class="n">vvariation</span><span class="p">,</span> <span class="n">isActiveFunction</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
<div class="viewcode-block" id="Row.goDown"><a class="viewcode-back" href="../../../../API/JumpScale.lib.sheet.html#JumpScale.lib.sheet.Sheet.Row.goDown">[docs]</a>        <span class="n">start</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">start</span><span class="p">)</span>
        <span class="n">stop</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">stop</span><span class="p">)</span>
        <span class="n">blocksize</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">stop</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">start</span><span class="p">)</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="n">nrSteps</span><span class="p">)</span>
        <span class="n">runNr</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="n">start</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">nrcols</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">start</span><span class="p">,</span> <span class="bp">None</span>
        <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cells</span><span class="p">[</span><span class="n">start</span><span class="p">]</span>  <span class="c"># start height</span>
        <span class="k">if</span> <span class="n">y</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s">&quot;start position y needs to &lt;&gt; None&quot;</span><span class="p">)</span>
        <span class="n">y</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
        <span class="n">minvalue</span> <span class="o">=</span> <span class="n">y</span> <span class="o">-</span> <span class="n">godown</span>
        <span class="k">if</span> <span class="n">minvalue</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s">&quot;Minvalue in go down can not be &lt; 0&quot;</span><span class="p">)</span>
        <span class="n">godown</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">godown</span><span class="p">)</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="n">nrSteps</span><span class="p">)</span>
        <span class="n">maxvalue</span> <span class="o">=</span> <span class="n">y</span> <span class="o">-</span> <span class="mi">1</span>
        <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
            <span class="n">runNr</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">start2</span> <span class="o">=</span> <span class="n">start</span> <span class="o">+</span> <span class="n">blocksize</span> <span class="o">*</span> <span class="p">(</span><span class="n">runNr</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">isActiveFunction</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">isActiveFunction</span><span class="p">(</span><span class="n">start2</span><span class="p">):</span>
                    <span class="n">stop</span> <span class="o">+=</span> <span class="nb">int</span><span class="p">(</span><span class="n">blocksize</span><span class="p">)</span>
                    <span class="k">continue</span>
            <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_getVariationAbsoluteInt</span><span class="p">(</span><span class="n">start2</span><span class="p">,</span> <span class="n">hvariation</span><span class="p">)</span>
            <span class="n">y</span> <span class="o">=</span> <span class="n">y</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_getVariationPositive</span><span class="p">(</span><span class="n">godown</span><span class="p">,</span> <span class="n">vvariation</span><span class="p">)</span>
            <span class="n">y2</span> <span class="o">=</span> <span class="n">y</span>
            <span class="k">if</span> <span class="n">x</span> <span class="o">&gt;</span> <span class="n">stop</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">setCell</span><span class="p">(</span><span class="n">stop</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
            <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">setCell</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">minvalue</span><span class="p">,</span> <span class="n">maxvalue</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">y</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">setCell</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nrcols</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">y2</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">x</span><span class="p">,</span> <span class="n">y2</span>

    <span class="k">def</span> <span class="nf">goUp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">stop</span><span class="p">,</span> <span class="n">goup</span><span class="p">,</span> <span class="n">nrSteps</span><span class="p">,</span> <span class="n">hvariation</span><span class="p">,</span> <span class="n">vvariation</span><span class="p">,</span> <span class="n">isActiveFunction</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span></div>
<div class="viewcode-block" id="Row.goUp"><a class="viewcode-back" href="../../../../API/JumpScale.lib.sheet.html#JumpScale.lib.sheet.Sheet.Row.goUp">[docs]</a>        <span class="n">start</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">start</span><span class="p">)</span>
        <span class="n">stop</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">stop</span><span class="p">)</span>
        <span class="n">blocksize</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">stop</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">start</span><span class="p">)</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="n">nrSteps</span><span class="p">)</span>
        <span class="n">runNr</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="n">start</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">nrcols</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">start</span><span class="p">,</span> <span class="bp">None</span>
        <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cells</span><span class="p">[</span><span class="n">start</span><span class="p">]</span>  <span class="c"># start height</span>
        <span class="k">if</span> <span class="n">y</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s">&quot;start position y needs to &lt;&gt; None&quot;</span><span class="p">)</span>
        <span class="n">y</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
        <span class="n">minvalue</span> <span class="o">=</span> <span class="n">y</span>
        <span class="k">if</span> <span class="n">minvalue</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s">&quot;Minvalue in go up can not be &lt; 0&quot;</span><span class="p">)</span>
        <span class="n">maxvalue</span> <span class="o">=</span> <span class="n">y</span> <span class="o">+</span> <span class="n">goup</span>
        <span class="n">goup</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">goup</span><span class="p">)</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="n">nrSteps</span><span class="p">)</span>
        <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
            <span class="n">runNr</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">start2</span> <span class="o">=</span> <span class="n">start</span> <span class="o">+</span> <span class="n">blocksize</span> <span class="o">*</span> <span class="p">(</span><span class="n">runNr</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">isActiveFunction</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">isActiveFunction</span><span class="p">(</span><span class="n">start2</span><span class="p">):</span>
                    <span class="n">stop</span> <span class="o">+=</span> <span class="nb">int</span><span class="p">(</span><span class="n">blocksize</span><span class="p">)</span>
                    <span class="k">continue</span>
            <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_getVariationAbsoluteInt</span><span class="p">(</span><span class="n">start2</span><span class="p">,</span> <span class="n">hvariation</span><span class="p">)</span>
            <span class="n">y</span> <span class="o">=</span> <span class="n">y</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_getVariationPositive</span><span class="p">(</span><span class="n">goup</span><span class="p">,</span> <span class="n">vvariation</span><span class="p">)</span>
            <span class="n">y2</span> <span class="o">=</span> <span class="n">y</span>
            <span class="k">if</span> <span class="n">x</span> <span class="o">&gt;</span> <span class="n">stop</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">setCell</span><span class="p">(</span><span class="n">stop</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
            <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">setCell</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">minvalue</span><span class="p">,</span> <span class="n">maxvalue</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">y</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">setCell</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nrcols</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">y2</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span>

    <span class="k">def</span> <span class="nf">getMax</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">stop</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span></div>
<div class="viewcode-block" id="Row.getMax"><a class="viewcode-back" href="../../../../API/JumpScale.lib.sheet.html#JumpScale.lib.sheet.Sheet.Row.getMax">[docs]</a>        <span class="k">if</span> <span class="n">start</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">start</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="n">stop</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">stop</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cells</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
        <span class="n">r</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">stop</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cells</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">r</span><span class="p">:</span>
                <span class="n">r</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cells</span><span class="p">[</span><span class="n">x</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">r</span>

    <span class="k">def</span> <span class="nf">checkFilledIn</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">stop</span><span class="p">):</span></div>
<div class="viewcode-block" id="Row.checkFilledIn"><a class="viewcode-back" href="../../../../API/JumpScale.lib.sheet.html#JumpScale.lib.sheet.Sheet.Row.checkFilledIn">[docs]</a>        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">stop</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">start</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cells</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">True</span>
        <span class="k">return</span> <span class="bp">False</span>

    <span class="k">def</span> <span class="nf">_roundNrCumul</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">args</span><span class="p">):</span></div>
        <span class="n">nr</span> <span class="o">=</span> <span class="n">val</span>
        <span class="k">if</span> <span class="n">nr</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">nr</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="c"># print &quot;%s %s %s&quot; % (self.name,nr,self._cumul)</span>
        <span class="k">if</span> <span class="n">nr</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cumul</span> <span class="o">&gt;</span> <span class="mf">0.5</span> <span class="ow">and</span> <span class="n">nr</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cumul</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_cumul</span> <span class="o">=</span> <span class="n">nr</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cumul</span>
            <span class="n">nr2</span> <span class="o">=</span> <span class="n">j</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">numtools</span><span class="o">.</span><span class="n">roundDown</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_cumul</span> <span class="o">*</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_cumul</span> <span class="o">+=</span> <span class="n">nr</span> <span class="o">-</span> <span class="n">nr2</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_cumul</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cumul</span> <span class="o">-</span> <span class="n">nr2</span>
            <span class="c"># print &quot;&lt;10 %s %s&quot; % (nr2,self._cumul)</span>
            <span class="k">return</span> <span class="n">nr2</span>
        <span class="k">elif</span> <span class="n">nr</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cumul</span> <span class="o">==</span> <span class="mf">0.5</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_cumul</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="k">return</span> <span class="mf">0.5</span>
        <span class="k">elif</span> <span class="n">nr</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cumul</span> <span class="o">&lt;</span> <span class="mf">0.5</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_cumul</span> <span class="o">+=</span> <span class="n">nr</span>
            <span class="c"># print &quot;&lt;0.5 %s %s&quot; % (0,self._cumul)</span>
            <span class="k">return</span> <span class="mi">0</span>
        <span class="k">elif</span> <span class="n">nr</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cumul</span> <span class="o">&gt;=</span> <span class="mi">10</span><span class="p">:</span>
            <span class="n">nr2</span> <span class="o">=</span> <span class="n">j</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">numtools</span><span class="o">.</span><span class="n">roundDown</span><span class="p">(</span><span class="n">nr</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_cumul</span> <span class="o">+=</span> <span class="n">nr</span> <span class="o">-</span> <span class="n">nr2</span>
            <span class="k">return</span> <span class="n">nr2</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s">&quot;error in normalizing, should not get here&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">nr</span>

    <span class="k">def</span> <span class="nf">applyFunction</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ffunction</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">{}):</span>
<div class="viewcode-block" id="Row.applyFunction"><a class="viewcode-back" href="../../../../API/JumpScale.lib.sheet.html#JumpScale.lib.sheet.Sheet.Row.applyFunction">[docs]</a>        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        call ffunction with params (val of cell, x, args as dict)</span>
<span class="sd">        row gets modified</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">nrcols</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cells</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="o">=</span> <span class="n">ffunction</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cells</span><span class="p">[</span><span class="n">x</span><span class="p">],</span> <span class="n">x</span><span class="p">,</span> <span class="n">args</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">text2row</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">standstill</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">defval</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">startval</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="nb">round</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">interpolate</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span></div>
<div class="viewcode-block" id="Row.text2row"><a class="viewcode-back" href="../../../../API/JumpScale.lib.sheet.html#JumpScale.lib.sheet.Sheet.Row.text2row">[docs]</a>        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        convert string format 2:100,5:200 to an array with required length (month 2=100, ...)</span>
<span class="sd">        values can be 10%,0.1,100,1m,1k  m=million USD/EUR/CH/EGP/GBP are also understood</span>
<span class="sd">        result will be put into the given row</span>
<span class="sd">        data kan be 1 string or list</span>
<span class="sd">        if list then list need to be of length len(row)/12 so is a value per year</span>
<span class="sd">        standstill is first X nr of months which are made 0</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">def</span> <span class="nf">custom2rowvalues</span><span class="p">(</span><span class="n">datas</span><span class="p">):</span>
            <span class="n">interp</span> <span class="o">=</span> <span class="bp">False</span>
            <span class="n">maxpos</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="n">maxval</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="n">start</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="n">year</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
            <span class="k">for</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">datas</span><span class="p">:</span>
                <span class="n">year</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">if</span> <span class="ow">not</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&quot;,&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span> <span class="ow">and</span> <span class="nb">str</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&quot;:&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
                    <span class="c"># means custom value</span>
                    <span class="k">if</span> <span class="n">data</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&quot;I&quot;</span><span class="p">)</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                        <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&quot;I&quot;</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                        <span class="n">interp</span> <span class="o">=</span> <span class="bp">True</span>
                    <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&quot;&#39;&quot;</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                    <span class="n">splitted</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&quot;,&quot;</span><span class="p">)</span>
                    <span class="n">maxpos</span> <span class="o">=</span> <span class="mf">0.0</span>
                    <span class="n">maxval</span> <span class="o">=</span> <span class="mf">0.0</span>
                    <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">splitted</span><span class="p">:</span>
                        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&quot;:&quot;</span><span class="p">))</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">:</span>
                            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s">&quot;text2row input not properly formatted: </span><span class="si">%s</span><span class="s">, subpart: </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">item</span><span class="p">))</span>
                        <span class="n">pos</span><span class="p">,</span> <span class="n">value</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&quot;:&quot;</span><span class="p">)</span>
                        <span class="n">pos</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">pos</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="mi">12</span> <span class="o">*</span> <span class="n">year</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">start</span> <span class="o">==</span> <span class="bp">None</span> <span class="ow">and</span> <span class="n">interp</span><span class="p">:</span>
                            <span class="n">start</span> <span class="o">=</span> <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">j</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">numtools</span><span class="o">.</span><span class="n">roundDown</span><span class="p">((</span><span class="nb">float</span><span class="p">(</span><span class="n">pos</span><span class="p">)</span> <span class="o">/</span> <span class="mi">12</span><span class="p">))))</span> <span class="o">*</span> <span class="mi">12</span>
                        <span class="k">try</span><span class="p">:</span>
                            <span class="n">value</span> <span class="o">=</span> <span class="n">j</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">numtools</span><span class="o">.</span><span class="n">text2val</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
                        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                            <span class="k">print</span> <span class="s">&quot;error: </span><span class="si">%s</span><span class="s"> &quot;</span> <span class="o">%</span> <span class="n">e</span>
                            <span class="k">print</span> <span class="s">&quot;error in parsing input data for </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">datas</span>
                            <span class="k">print</span> <span class="s">&quot;error in element </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">data</span>
                            <span class="k">print</span> <span class="s">&quot;row:</span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>
                        <span class="k">if</span> <span class="n">value</span> <span class="o">&gt;</span> <span class="n">maxval</span><span class="p">:</span>
                            <span class="n">maxval</span> <span class="o">=</span> <span class="n">value</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">cells</span><span class="p">[</span><span class="n">pos</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
                        <span class="k">if</span> <span class="n">pos</span> <span class="o">&gt;</span> <span class="n">maxpos</span><span class="p">:</span>
                            <span class="n">maxpos</span> <span class="o">=</span> <span class="n">pos</span>
                        <span class="c"># calculate end of year of last found position where data was set</span>
            <span class="k">if</span> <span class="n">maxpos</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">stop</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">stop</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">j</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">numtools</span><span class="o">.</span><span class="n">roundUp</span><span class="p">((</span><span class="nb">float</span><span class="p">(</span><span class="n">maxpos</span><span class="p">)</span> <span class="o">/</span> <span class="mi">12</span><span class="p">)))</span>
            <span class="k">if</span> <span class="n">start</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">start</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">if</span> <span class="n">interpolate</span> <span class="o">==</span> <span class="bp">True</span> <span class="ow">or</span> <span class="p">(</span><span class="n">interp</span> <span class="ow">and</span> <span class="n">interpolate</span> <span class="o">==</span> <span class="bp">None</span><span class="p">):</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">datas</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">interpolate</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">stop</span> <span class="o">*</span> <span class="mi">12</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">interpolate</span><span class="p">()</span>
                <span class="n">maxval</span> <span class="o">=</span> <span class="n">value</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">maxval</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="c"># no interpolate</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setDefaultValue</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">defval</span><span class="p">,</span> <span class="n">stop</span> <span class="o">*</span> <span class="mi">12</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">stop</span><span class="p">,</span> <span class="n">maxval</span>

        <span class="k">if</span> <span class="n">defval</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">defval</span> <span class="o">=</span> <span class="n">defval</span>

        <span class="k">if</span> <span class="n">startval</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cells</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">startval</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">standstill</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">standstill</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cells</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">defval</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">j</span><span class="o">.</span><span class="n">basetype</span><span class="o">.</span><span class="n">list</span><span class="o">.</span><span class="n">check</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">data</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cells</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">startval</span><span class="p">)</span>
            <span class="k">elif</span> <span class="nb">str</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&quot;,&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span> <span class="ow">and</span> <span class="nb">str</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&quot;:&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                <span class="c"># is only 1 value so set all data</span>
                <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="o">==</span> <span class="s">&quot;&quot;</span> <span class="ow">or</span> <span class="n">data</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
                    <span class="n">data</span> <span class="o">=</span> <span class="s">&quot;0.0&quot;</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">setDefaultValue</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c"># is custom format, need to process</span>
                <span class="n">custom2rowvalues</span><span class="p">([</span><span class="n">data</span><span class="p">])</span>
            <span class="k">if</span> <span class="nb">round</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_cumul</span> <span class="o">=</span> <span class="mf">0.0</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">applyFunction</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_roundNrCumul</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">datas</span> <span class="o">=</span> <span class="n">data</span>
            <span class="n">stop</span><span class="p">,</span> <span class="n">maxval</span> <span class="o">=</span> <span class="n">custom2rowvalues</span><span class="p">(</span><span class="n">datas</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">stop</span> <span class="o">*</span> <span class="mi">12</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">nrcols</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">cells</span><span class="p">[</span><span class="n">stop</span> <span class="o">*</span> <span class="mi">12</span><span class="p">]</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cells</span><span class="p">[</span><span class="n">stop</span> <span class="o">*</span> <span class="mi">12</span><span class="p">]</span> <span class="o">=</span> <span class="n">maxval</span>
            <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">datas</span><span class="p">)):</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">datas</span><span class="p">[</span><span class="n">x</span><span class="p">]</span>
                <span class="n">year</span> <span class="o">=</span> <span class="n">x</span> <span class="o">+</span> <span class="mi">1</span>
                <span class="c"># print &quot;%s %s&quot; % (year,stop)</span>
                <span class="k">if</span> <span class="n">year</span> <span class="o">&gt;</span> <span class="n">stop</span><span class="p">:</span>
                    <span class="c"># print &quot;normal values in year %s&quot; % year</span>
                    <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&quot;,&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span> <span class="ow">and</span> <span class="nb">str</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&quot;:&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span> <span class="ow">and</span> <span class="n">data</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
                        <span class="c"># is only 1 value</span>
                        <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="o">==</span> <span class="s">&quot;&quot;</span><span class="p">:</span>
                            <span class="n">data</span> <span class="o">=</span> <span class="s">&quot;0.0&quot;</span>
                        <span class="n">data</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">cells</span><span class="p">[</span><span class="n">year</span> <span class="o">*</span> <span class="mi">12</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">interpolate</span><span class="p">(</span><span class="n">stop</span> <span class="o">*</span> <span class="mi">12</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setDefaultValue</span><span class="p">()</span>

        <span class="k">if</span> <span class="nb">round</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_cumul</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">applyFunction</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_roundNrCumul</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">recurring</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">row</span><span class="p">,</span> <span class="n">delay</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">churn</span><span class="p">,</span> <span class="n">nrmonths</span><span class="p">):</span></div>
<div class="viewcode-block" id="Row.recurring"><a class="viewcode-back" href="../../../../API/JumpScale.lib.sheet.html#JumpScale.lib.sheet.Sheet.Row.recurring">[docs]</a>        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        @param row is the row we will fill in with recurring calc</span>
<span class="sd">        @param start value to start with at month 0 (is first month)</span>
<span class="sd">        @param churn 2 means 2% churn</span>
<span class="sd">        @param delay is different beween selling &amp; being active</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c"># print &quot;churn:%s&quot; % churn</span>
        <span class="k">if</span> <span class="n">churn</span> <span class="o">==</span> <span class="s">&quot;1000%&quot;</span><span class="p">:</span>
            <span class="n">row</span><span class="o">.</span><span class="n">setDefaultValue</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">row</span>
        <span class="n">delay</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">delay</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">delaynr</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">delay</span><span class="p">):</span>
            <span class="n">row</span><span class="o">.</span><span class="n">cells</span><span class="p">[</span><span class="n">delaynr</span><span class="p">]</span> <span class="o">=</span> <span class="n">start</span>
        <span class="k">for</span> <span class="n">colid</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nrcols</span><span class="p">)):</span>
            <span class="n">nractive</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">start</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">colid</span> <span class="o">-</span> <span class="nb">int</span><span class="p">(</span><span class="n">nrmonths</span><span class="p">))</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">start2</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">start2</span> <span class="o">=</span> <span class="n">colid</span> <span class="o">-</span> <span class="nb">int</span><span class="p">(</span><span class="n">nrmonths</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">monthprevid</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">start2</span><span class="p">,</span> <span class="n">colid</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
                <span class="n">nractive</span> <span class="o">+=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cells</span><span class="p">[</span><span class="n">monthprevid</span><span class="p">])</span> <span class="o">*</span> <span class="p">((</span><span class="mi">1</span> <span class="o">-</span> <span class="nb">float</span><span class="p">(</span><span class="n">churn</span><span class="p">)</span> <span class="o">/</span> <span class="mi">12</span><span class="p">)</span> <span class="o">**</span> <span class="p">(</span><span class="n">colid</span> <span class="o">-</span> <span class="n">monthprevid</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">colid</span> <span class="o">+</span> <span class="n">delay</span> <span class="o">&lt;</span> <span class="n">row</span><span class="o">.</span><span class="n">nrcols</span><span class="p">:</span>
                <span class="n">row</span><span class="o">.</span><span class="n">cells</span><span class="p">[</span><span class="n">colid</span> <span class="o">+</span> <span class="n">delay</span><span class="p">]</span> <span class="o">=</span> <span class="n">nractive</span>

        <span class="n">row</span><span class="o">.</span><span class="n">round</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">row</span>

    <span class="k">def</span> <span class="nf">round</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nrfloat</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">roundval</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span></div>
<div class="viewcode-block" id="Row.round"><a class="viewcode-back" href="../../../../API/JumpScale.lib.sheet.html#JumpScale.lib.sheet.Sheet.Row.round">[docs]</a>        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        @param roundval if e.g. 100 means round will be done with values of 10, nr float will then be 0 (automatically)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">nrfloat</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">nrfloat</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nrfloat</span>
        <span class="k">if</span> <span class="n">roundval</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">nrfloat</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="k">for</span> <span class="n">colid</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nrcols</span><span class="p">)):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cells</span><span class="p">[</span><span class="n">colid</span><span class="p">]</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">roundval</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">cells</span><span class="p">[</span><span class="n">colid</span><span class="p">]</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cells</span><span class="p">[</span><span class="n">colid</span><span class="p">]</span> <span class="o">/</span> <span class="n">roundval</span><span class="p">,</span> <span class="n">nrfloat</span><span class="p">)</span> <span class="o">*</span> <span class="n">roundval</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ttype</span> <span class="o">==</span> <span class="s">&quot;int&quot;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">cells</span><span class="p">[</span><span class="n">colid</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cells</span><span class="p">[</span><span class="n">colid</span><span class="p">],</span> <span class="n">nrfloat</span><span class="p">))</span>
                <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">ttype</span> <span class="o">==</span> <span class="s">&quot;float&quot;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">cells</span><span class="p">[</span><span class="n">colid</span><span class="p">]</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cells</span><span class="p">[</span><span class="n">colid</span><span class="p">],</span> <span class="n">nrfloat</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">areCosts</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span></div>
<div class="viewcode-block" id="Row.areCosts"><a class="viewcode-back" href="../../../../API/JumpScale.lib.sheet.html#JumpScale.lib.sheet.Sheet.Row.areCosts">[docs]</a>        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        negate the values in the row</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">colid</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nrcols</span><span class="p">)):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cells</span><span class="p">[</span><span class="n">colid</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cells</span><span class="p">[</span><span class="n">colid</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">cells</span><span class="p">[</span><span class="n">colid</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">invert</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span></div>
<div class="viewcode-block" id="Row.invert"><a class="viewcode-back" href="../../../../API/JumpScale.lib.sheet.html#JumpScale.lib.sheet.Sheet.Row.invert">[docs]</a>        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        invert + becomes - and reverse</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">colid</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nrcols</span><span class="p">)):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cells</span><span class="p">[</span><span class="n">colid</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">cells</span><span class="p">[</span><span class="n">colid</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">delay</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">delay</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">defval</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span></div>
<div class="viewcode-block" id="Row.delay"><a class="viewcode-back" href="../../../../API/JumpScale.lib.sheet.html#JumpScale.lib.sheet.Sheet.Row.delay">[docs]</a>        <span class="k">if</span> <span class="n">defval</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">defval</span> <span class="o">=</span> <span class="n">defval</span>
        <span class="n">delay</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">delay</span><span class="p">)</span>
        <span class="n">out</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.0</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nrcols</span><span class="p">)]</span>
        <span class="n">nrmax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nrcols</span>
        <span class="k">if</span> <span class="n">delay</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">delay</span><span class="p">):</span>
                <span class="n">out</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">defval</span>
        <span class="n">delayed</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="k">if</span> <span class="n">delay</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="o">-</span><span class="n">delay</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
                <span class="c"># print &quot;delay: %s %s %s&quot; % (self.name,i,self.cells[i])</span>
                <span class="n">delayed</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cells</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="c"># print delayed</span>
        <span class="n">i</span> <span class="o">=</span> <span class="n">delay</span>
        <span class="k">for</span> <span class="n">cell</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cells</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">nrmax</span> <span class="ow">and</span> <span class="n">i</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                <span class="n">out</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">cell</span>
            <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="n">delay</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">out</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+=</span> <span class="n">delayed</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cells</span> <span class="o">=</span> <span class="n">out</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span></div>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">nrcols</span> <span class="o">&gt;</span> <span class="mi">18</span><span class="p">:</span>
            <span class="n">l</span> <span class="o">=</span> <span class="mi">18</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">l</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nrcols</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">]</span>
        <span class="n">result</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">cells</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">l</span><span class="p">)])</span>
        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>

    <span class="n">__repr__</span> <span class="o">=</span> <span class="n">__str__</span>

    <span class="k">def</span> <span class="nf">_dict2obj</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">[</span><span class="s">&quot;name&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cells</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">[</span><span class="s">&quot;cells&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ttype</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">[</span><span class="s">&quot;ttype&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">format</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">[</span><span class="s">&quot;format&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">[</span><span class="s">&quot;description&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">groupname</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">[</span><span class="s">&quot;groupname&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">groupdescr</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">[</span><span class="s">&quot;groupdescr&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">aggregateAction</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">[</span><span class="s">&quot;aggregateAction&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nrcols</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">[</span><span class="s">&quot;nrcols&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nrfloat</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">[</span><span class="s">&quot;nrfloat&quot;</span><span class="p">]</span>
        <span class="k">return</span> <span class="bp">self</span>


<span class="k">class</span> <span class="nc">Sheet</span><span class="p">(</span><span class="n">j</span><span class="o">.</span><span class="n">code</span><span class="o">.</span><span class="n">classGetBase</span><span class="p">()):</span></div>
<div class="viewcode-block" id="Sheet"><a class="viewcode-back" href="../../../../API/JumpScale.lib.sheet.html#JumpScale.lib.sheet.Sheet.Sheet">[docs]</a>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">nrcols</span><span class="o">=</span><span class="mi">72</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="p">[],</span> <span class="n">period</span><span class="o">=</span><span class="s">&quot;M&quot;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        @param period is M,Q or Y</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="s">&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nrcols</span> <span class="o">=</span> <span class="n">nrcols</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">remarks</span> <span class="o">=</span> <span class="s">&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">period</span> <span class="o">=</span> <span class="n">period</span>  <span class="c"># M, Q or Y</span>

        <span class="k">if</span> <span class="n">headers</span> <span class="o">==</span> <span class="p">[]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">headers</span> <span class="o">=</span> <span class="p">[</span><span class="n">item</span> <span class="o">+</span> <span class="mi">1</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nrcols</span><span class="p">)]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">headers</span> <span class="o">=</span> <span class="n">headers</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">nrcols</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">headers</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">rows</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rowNames</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c"># def _obj2dict(self):</span>
        <span class="c"># ddict={}</span>
        <span class="c"># ddict[&quot;name&quot;]=self.name</span>
        <span class="c"># ddict[&quot;headers&quot;]=self.headers</span>
        <span class="c"># ddict[&quot;nrcols&quot;]=self.nrcols</span>
        <span class="c">#ddict[&quot;rows&quot;]=[item.obj2dict() for item in self.rows]</span>
        <span class="c"># return ddict</span>

    <span class="k">def</span> <span class="nf">_dict2obj</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">[</span><span class="s">&quot;name&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">headers</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">[</span><span class="s">&quot;headers&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nrcols</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">[</span><span class="s">&quot;nrcols&quot;</span><span class="p">]</span>
        <span class="n">slf</span><span class="o">.</span><span class="n">period</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">[</span><span class="s">&quot;period&quot;</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">dict</span><span class="p">[</span><span class="s">&quot;rows&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">item</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">[</span><span class="s">&quot;rows&quot;</span><span class="p">][</span><span class="n">key</span><span class="p">]</span>
            <span class="n">row</span> <span class="o">=</span> <span class="n">j</span><span class="o">.</span><span class="n">code</span><span class="o">.</span><span class="n">dict2object</span><span class="p">(</span><span class="n">Row</span><span class="p">(),</span> <span class="n">item</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rows</span><span class="p">[</span><span class="n">row</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">row</span>

    <span class="k">def</span> <span class="nf">addRow</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">ttype</span><span class="o">=</span><span class="s">&quot;float&quot;</span><span class="p">,</span> <span class="n">aggregate</span><span class="o">=</span><span class="s">&quot;T&quot;</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">,</span> <span class="n">groupname</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">,</span> <span class="n">groupdescr</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">,</span> <span class="n">nrcols</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">format</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">,</span> <span class="n">values</span><span class="o">=</span><span class="p">[],</span>
<div class="viewcode-block" id="Sheet.addRow"><a class="viewcode-back" href="../../../../API/JumpScale.lib.sheet.html#JumpScale.lib.sheet.Sheet.Sheet.addRow">[docs]</a>               <span class="n">defval</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">nrfloat</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        @param ttype int,perc,float,empty,str</span>
<span class="sd">        @param aggregate= T,A,MIN,MAX</span>
<span class="sd">        @param values is array of values to insert</span>
<span class="sd">        @param defval is default value for each col</span>
<span class="sd">        @param round is only valid for float e.g. 2 after comma</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">nrcols</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">nrcols</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nrcols</span>
        <span class="k">if</span> <span class="n">ttype</span> <span class="o">==</span> <span class="s">&quot;float&quot;</span> <span class="ow">and</span> <span class="n">nrfloat</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">nrfloat</span> <span class="o">=</span> <span class="mi">2</span>
        <span class="n">row</span> <span class="o">=</span> <span class="n">Row</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">ttype</span><span class="p">,</span> <span class="n">nrcols</span><span class="p">,</span> <span class="n">aggregate</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="n">description</span><span class="p">,</span> <span class="n">groupname</span><span class="o">=</span><span class="n">groupname</span><span class="p">,</span>
                  <span class="n">groupdescr</span><span class="o">=</span><span class="n">groupdescr</span><span class="p">,</span> <span class="n">format</span><span class="o">=</span><span class="n">format</span><span class="p">,</span> <span class="n">defval</span><span class="o">=</span><span class="n">defval</span><span class="p">,</span> <span class="n">nrfloat</span><span class="o">=</span><span class="n">nrfloat</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rows</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">row</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rowNames</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">values</span> <span class="o">!=</span> <span class="p">[]:</span>
            <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nrcols</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">setCell</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">values</span><span class="p">[</span><span class="n">x</span><span class="p">])</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">rows</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>

    <span class="c"># def renting(self,row,interest,nrmonths):</span>
    <span class="c"># DOES NOT WORK, JUST COPY PASTE TO START DOING IT</span>
        <span class="c">#&quot;&quot;&quot;</span>
        <span class="c">#@param row is the row in which we need to fill in</span>
        <span class="c">#@param start value to start with at month 0 (is first month)</span>
        <span class="c">#@param churn 2 means 2% churn</span>
        <span class="c">#@param delay is different beween selling &amp; being active</span>
        <span class="c">#&quot;&quot;&quot;</span>
        <span class="c"># print &quot;churn:%s&quot; % churn</span>
        <span class="c"># if churn==&quot;1000%&quot;:</span>
            <span class="c"># row.setDefaultValue(0.0)</span>
            <span class="c"># return row</span>
        <span class="c"># delay=int(round(delay,0))</span>
        <span class="c"># for delaynr in range(0,delay):</span>
            <span class="c"># row.cells[delaynr]=start</span>
        <span class="c"># for colid in range(0,int(self.nrcols)):</span>
            <span class="c"># nractive=float(start)</span>
            <span class="c"># if (colid-int(nrmonths))&lt;0:</span>
                <span class="c"># start2=0</span>
            <span class="c"># else:</span>
                <span class="c"># start2=colid-int(nrmonths)</span>
            <span class="c"># for monthprevid in range(start2,colid+1):</span>
                <span class="c"># nractive+=float(self.cells[monthprevid])*((1-float(churn)/12)**(colid-monthprevid))</span>
            <span class="c"># if colid+delay&lt;row.nrcols:</span>
                <span class="c"># row.cells[colid+delay]=nractive</span>

        <span class="c"># row.round()</span>
        <span class="c"># return row</span>

    <span class="k">def</span> <span class="nf">aggregate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rownames</span><span class="o">=</span><span class="p">[],</span> <span class="n">period</span><span class="o">=</span><span class="s">&quot;Y&quot;</span><span class="p">):</span></div>
<div class="viewcode-block" id="Sheet.aggregate"><a class="viewcode-back" href="../../../../API/JumpScale.lib.sheet.html#JumpScale.lib.sheet.Sheet.Sheet.aggregate">[docs]</a>        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        @param rownames names of rows to aggregate</span>
<span class="sd">        @param period is Q or Y (Quarter/Year)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">rows</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">header</span> <span class="o">=</span> <span class="p">[</span><span class="s">&quot;&quot;</span><span class="p">]</span>
        <span class="n">headerDone</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="k">if</span> <span class="n">rownames</span> <span class="o">==</span> <span class="p">[]:</span>
            <span class="n">rownames</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rowNames</span>

        <span class="k">for</span> <span class="n">rowName</span> <span class="ow">in</span> <span class="n">rownames</span><span class="p">:</span>
            <span class="n">row</span> <span class="o">=</span> <span class="p">[</span><span class="n">rowName</span><span class="p">]</span>
            <span class="n">row2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getRow</span><span class="p">(</span><span class="n">rowName</span><span class="p">)</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">row2</span><span class="o">.</span><span class="n">aggregate</span><span class="p">(</span><span class="n">period</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="p">)):</span>
                <span class="k">if</span> <span class="n">headerDone</span> <span class="o">==</span> <span class="bp">False</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">period</span> <span class="o">==</span> <span class="s">&quot;Y&quot;</span><span class="p">:</span>
                        <span class="n">hid</span> <span class="o">=</span> <span class="s">&quot;Y</span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="nb">int</span><span class="p">(</span><span class="n">key</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">year</span> <span class="o">=</span> <span class="n">j</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">numtools</span><span class="o">.</span><span class="n">roundDown</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">key</span><span class="p">)</span> <span class="o">/</span> <span class="mi">4</span><span class="p">)</span>
                        <span class="n">Q</span> <span class="o">=</span> <span class="s">&quot;Q</span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="nb">int</span><span class="p">(</span><span class="n">j</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">numtools</span><span class="o">.</span><span class="n">roundDown</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">key</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">year</span> <span class="o">*</span> <span class="mi">4</span><span class="p">))</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)</span>
                        <span class="n">year</span> <span class="o">=</span> <span class="s">&quot;Y</span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="nb">int</span><span class="p">(</span><span class="n">year</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
                        <span class="n">hid</span> <span class="o">=</span> <span class="s">&quot;</span><span class="si">%s</span><span class="s"> </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">year</span><span class="p">,</span> <span class="n">Q</span><span class="p">)</span>
                    <span class="n">header</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">hid</span><span class="p">)</span>
                <span class="n">row</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>
            <span class="n">headerDone</span> <span class="o">=</span> <span class="bp">True</span>
            <span class="n">rows</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">rows</span><span class="p">,</span> <span class="n">header</span>

    <span class="k">def</span> <span class="nf">copyFrom</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sheets</span><span class="p">,</span> <span class="n">sheetname</span><span class="p">,</span> <span class="n">rowname</span><span class="p">,</span> <span class="n">newRowName</span><span class="p">,</span> <span class="n">newGroupName</span><span class="p">):</span></div>
<div class="viewcode-block" id="Sheet.copyFrom"><a class="viewcode-back" href="../../../../API/JumpScale.lib.sheet.html#JumpScale.lib.sheet.Sheet.Sheet.copyFrom">[docs]</a>        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        @param sheets if None then this sheetobject</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">sheets</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">sheetfrom</span> <span class="o">=</span> <span class="bp">self</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">sheetfrom</span> <span class="o">=</span> <span class="n">sheets</span><span class="o">.</span><span class="n">sheets</span><span class="p">[</span><span class="n">sheetname</span><span class="p">]</span>
        <span class="n">rowfrom</span> <span class="o">=</span> <span class="n">sheetfrom</span><span class="o">.</span><span class="n">rows</span><span class="p">[</span><span class="n">rowname</span><span class="p">]</span>
        <span class="n">newrow</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">addRow</span><span class="p">(</span><span class="n">newRowName</span><span class="p">,</span> <span class="n">groupname</span><span class="o">=</span><span class="n">newGroupName</span><span class="p">)</span>
        <span class="n">newrow</span><span class="o">.</span><span class="n">aggregateAction</span> <span class="o">=</span> <span class="n">rowfrom</span><span class="o">.</span><span class="n">aggregateAction</span>
        <span class="n">newrow</span><span class="o">.</span><span class="n">nrfloat</span> <span class="o">=</span> <span class="n">rowfrom</span><span class="o">.</span><span class="n">nrfloat</span>
        <span class="c"># newrow.groupname=rowfrom.groupname</span>
        <span class="n">newrow</span><span class="o">.</span><span class="n">ttype</span> <span class="o">=</span> <span class="n">rowfrom</span><span class="o">.</span><span class="n">ttype</span>
        <span class="n">newrow</span><span class="o">.</span><span class="n">format</span> <span class="o">=</span> <span class="n">rowfrom</span><span class="o">.</span><span class="n">format</span>
        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">rowfrom</span><span class="o">.</span><span class="n">nrcols</span><span class="p">):</span>
            <span class="n">newrow</span><span class="o">.</span><span class="n">cells</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="o">=</span> <span class="n">rowfrom</span><span class="o">.</span><span class="n">cells</span><span class="p">[</span><span class="n">x</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">newrow</span>

    <span class="k">def</span> <span class="nf">getSheetAggregated</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">period</span><span class="o">=</span><span class="s">&quot;Y&quot;</span><span class="p">):</span></div>
<div class="viewcode-block" id="Sheet.getSheetAggregated"><a class="viewcode-back" href="../../../../API/JumpScale.lib.sheet.html#JumpScale.lib.sheet.Sheet.Sheet.getSheetAggregated">[docs]</a>        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        @param period is Q or Y (Quarter/Year)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">rows</span><span class="p">,</span> <span class="n">headers</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">aggregate</span><span class="p">(</span><span class="n">period</span><span class="o">=</span><span class="n">period</span><span class="p">)</span>
        <span class="n">lenx</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">headers</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
        <span class="n">sheet2</span> <span class="o">=</span> <span class="n">j</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">sheet</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">nrcols</span><span class="p">,</span> <span class="n">headers</span><span class="p">)</span>
        <span class="n">sheet2</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">description</span>
        <span class="n">sheet2</span><span class="o">.</span><span class="n">remarks</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">remarks</span>
        <span class="n">sheet2</span><span class="o">.</span><span class="n">period</span> <span class="o">=</span> <span class="n">period</span>
        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">rows</span><span class="p">:</span>
            <span class="n">roworg</span> <span class="o">=</span> <span class="n">roworg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getRow</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">rownew</span> <span class="o">=</span> <span class="n">sheet2</span><span class="o">.</span><span class="n">addRow</span><span class="p">(</span><span class="n">roworg</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">roworg</span><span class="o">.</span><span class="n">ttype</span><span class="p">,</span> <span class="n">roworg</span><span class="o">.</span><span class="n">aggregateAction</span><span class="p">,</span> <span class="n">roworg</span><span class="o">.</span><span class="n">description</span><span class="p">,</span> <span class="n">roworg</span><span class="o">.</span><span class="n">groupname</span><span class="p">,</span> <span class="n">roworg</span><span class="o">.</span><span class="n">groupdescr</span><span class="p">,</span> <span class="n">lenx</span><span class="p">,</span>
                                   <span class="n">roworg</span><span class="o">.</span><span class="n">format</span><span class="p">,</span> <span class="n">nrfloat</span><span class="o">=</span><span class="n">roworg</span><span class="o">.</span><span class="n">nrfloat</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">roworg</span><span class="o">.</span><span class="n">ttype</span> <span class="o">==</span> <span class="s">&quot;float&quot;</span><span class="p">:</span>
                <span class="n">rownew</span><span class="o">.</span><span class="n">ttype</span> <span class="o">=</span> <span class="s">&quot;int&quot;</span>
                <span class="n">rownew</span><span class="o">.</span><span class="n">nrfloat</span> <span class="o">=</span> <span class="mi">0</span>

            <span class="n">rownew</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="n">roworg</span><span class="o">.</span><span class="n">description</span>
            <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">lenx</span><span class="p">):</span>
                <span class="n">rownew</span><span class="o">.</span><span class="n">cells</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="n">x</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
            <span class="n">rownew</span><span class="o">.</span><span class="n">round</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">sheet2</span>

    <span class="k">def</span> <span class="nf">getRow</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rowName</span><span class="p">):</span></div>
<div class="viewcode-block" id="Sheet.getRow"><a class="viewcode-back" href="../../../../API/JumpScale.lib.sheet.html#JumpScale.lib.sheet.Sheet.Sheet.getRow">[docs]</a>        <span class="k">if</span> <span class="n">rowName</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">rows</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s">&quot;Cannot find row with name </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">rowName</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">rows</span><span class="p">[</span><span class="n">rowName</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">getCell</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rowName</span><span class="p">,</span> <span class="n">month</span><span class="p">):</span></div>
<div class="viewcode-block" id="Sheet.getCell"><a class="viewcode-back" href="../../../../API/JumpScale.lib.sheet.html#JumpScale.lib.sheet.Sheet.Sheet.getCell">[docs]</a>        <span class="n">row</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getRow</span><span class="p">(</span><span class="n">rowName</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">row</span><span class="o">.</span><span class="n">cells</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">month</span><span class="p">)]</span>

    <span class="k">def</span> <span class="nf">setCell</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rowName</span><span class="p">,</span> <span class="n">month</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span></div>
<div class="viewcode-block" id="Sheet.setCell"><a class="viewcode-back" href="../../../../API/JumpScale.lib.sheet.html#JumpScale.lib.sheet.Sheet.Sheet.setCell">[docs]</a>        <span class="k">if</span> <span class="n">month</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">nrcols</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;max month = </span><span class="si">%s</span><span class="s">, </span><span class="si">%s</span><span class="s"> given&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nrcols</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">month</span><span class="p">))</span>
        <span class="n">row</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getRow</span><span class="p">(</span><span class="n">rowName</span><span class="p">)</span>

        <span class="n">row</span><span class="o">.</span><span class="n">cells</span><span class="p">[</span><span class="n">month</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

    <span class="k">def</span> <span class="nf">addCell</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rowName</span><span class="p">,</span> <span class="n">month</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span></div>
<div class="viewcode-block" id="Sheet.addCell"><a class="viewcode-back" href="../../../../API/JumpScale.lib.sheet.html#JumpScale.lib.sheet.Sheet.Sheet.addCell">[docs]</a>        <span class="k">if</span> <span class="n">month</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">nrcols</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;max month = </span><span class="si">%s</span><span class="s">, </span><span class="si">%s</span><span class="s"> given&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nrcols</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">month</span><span class="p">))</span>
        <span class="n">row</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getRow</span><span class="p">(</span><span class="n">rowName</span><span class="p">)</span>
        <span class="n">row</span><span class="o">.</span><span class="n">cells</span><span class="p">[</span><span class="n">month</span><span class="p">]</span> <span class="o">+=</span> <span class="n">value</span>

    <span class="k">def</span> <span class="nf">interpolate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rowname</span><span class="p">):</span></div>
<div class="viewcode-block" id="Sheet.interpolate"><a class="viewcode-back" href="../../../../API/JumpScale.lib.sheet.html#JumpScale.lib.sheet.Sheet.Sheet.interpolate">[docs]</a>        <span class="n">row</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getRow</span><span class="p">(</span><span class="n">rowname</span><span class="p">)</span>
        <span class="n">row</span><span class="o">.</span><span class="n">interpolate</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">row</span>

    <span class="c"># def delay(self,rowName,delay=0,defValue=0.0,copy2otherRowName=None):</span>
        <span class="c"># delay=int(delay)</span>
        <span class="c">#out=[0.0 for item in range(self.nrcols)]</span>
        <span class="c"># nrmax=self.nrcols</span>
        <span class="c"># for i in range(delay):</span>
            <span class="c"># out[i]=defValue</span>
        <span class="c"># i=delay</span>
        <span class="c"># row=self.getRow(rowName)</span>
        <span class="c"># for cell in row.cells:</span>
            <span class="c"># if i&lt;nrmax:</span>
                <span class="c"># out[i]=cell</span>
            <span class="c"># else:</span>
                <span class="c"># break</span>
            <span class="c"># i+=1</span>
        <span class="c"># i=0</span>
        <span class="c"># if copy2otherRowName&lt;&gt;None:</span>
            <span class="c"># check if row already exists</span>
            <span class="c"># if not self.rows.has_key(copy2otherRowName):</span>
                <span class="c"># self.addRow(copy2otherRowName,&quot;float&quot;)</span>
            <span class="c"># dest=copy2otherRowName</span>
        <span class="c"># else:</span>
            <span class="c"># dest=rowName</span>

        <span class="c"># for month in range(self.nrcols):</span>
            <span class="c"># self.setCell(dest,month,out[month])</span>

        <span class="c"># return self.rows[dest]</span>

    <span class="k">def</span> <span class="nf">accumulate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rowNameInput</span><span class="p">,</span> <span class="n">rowNameDest</span><span class="p">):</span></div>
<div class="viewcode-block" id="Sheet.accumulate"><a class="viewcode-back" href="../../../../API/JumpScale.lib.sheet.html#JumpScale.lib.sheet.Sheet.Sheet.accumulate">[docs]</a>        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        add previous month on top of current and keep on adding (accumulating)</span>
<span class="sd">        @param rowNameInput is name of row we would like to aggregate</span>
<span class="sd">        @param rowNameDest if empty will be same as rowNameInput1</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">previous</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">colnr</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nrcols</span><span class="p">):</span>
            <span class="nb">input</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getCell</span><span class="p">(</span><span class="n">rowNameInput</span><span class="p">,</span> <span class="n">colnr</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setCell</span><span class="p">(</span><span class="n">rowNameDest</span><span class="p">,</span> <span class="n">colnr</span><span class="p">,</span> <span class="nb">input</span> <span class="o">+</span> <span class="n">previous</span><span class="p">)</span>
            <span class="n">previous</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getCell</span><span class="p">(</span><span class="n">rowNameDest</span><span class="p">,</span> <span class="n">colnr</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">rows</span><span class="p">[</span><span class="n">rowNameDest</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">setDefaultValue</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rowNameInput</span><span class="p">,</span> <span class="n">defval</span><span class="o">=</span><span class="mf">0.0</span><span class="p">):</span></div>
<div class="viewcode-block" id="Sheet.setDefaultValue"><a class="viewcode-back" href="../../../../API/JumpScale.lib.sheet.html#JumpScale.lib.sheet.Sheet.Sheet.setDefaultValue">[docs]</a>        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        add previous month on top of current and keep on adding (accumulating)</span>
<span class="sd">        @param rowNameInput is name of row we would like to aggregate</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">previous</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">colnr</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nrcols</span><span class="p">):</span>
            <span class="nb">input</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getCell</span><span class="p">(</span><span class="n">rowNameInput</span><span class="p">,</span> <span class="n">colnr</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">input</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">setCell</span><span class="p">(</span><span class="n">rowNameInput</span><span class="p">,</span> <span class="n">colnr</span><span class="p">,</span> <span class="n">defval</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">rows</span><span class="p">[</span><span class="n">rowNameInput</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">applyFunction</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rowNames</span><span class="p">,</span> <span class="n">method</span><span class="p">,</span> <span class="n">rowNameDest</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="p">{}):</span></div>
<div class="viewcode-block" id="Sheet.applyFunction"><a class="viewcode-back" href="../../../../API/JumpScale.lib.sheet.html#JumpScale.lib.sheet.Sheet.Sheet.applyFunction">[docs]</a>        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        @param rowNames is array if names of row we would like to use as inputvalues</span>
<span class="sd">        @param rowNameDest if empty will be same as first rowName</span>
<span class="sd">        @param method is python function with params (sheet,**input) returns the result</span>
<span class="sd">            input is dict with as key the arguments &amp; the keys of params (so all collapsed in same input dict)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">rowNameDest</span> <span class="o">==</span> <span class="s">&quot;&quot;</span><span class="p">:</span>
            <span class="n">rowNameDest</span> <span class="o">=</span> <span class="n">rowNames</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">rowNameDest</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">rows</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">addRow</span><span class="p">(</span><span class="n">rowNameDest</span><span class="p">,</span> <span class="s">&quot;float&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">colnr</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nrcols</span><span class="p">):</span>
            <span class="nb">input</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">rowNames</span><span class="p">:</span>
                <span class="nb">input</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getCell</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">colnr</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">input</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
                    <span class="nb">input</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">params</span><span class="p">:</span>
                <span class="nb">input</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setCell</span><span class="p">(</span><span class="n">rowNameDest</span><span class="p">,</span> <span class="n">colnr</span><span class="p">,</span> <span class="n">method</span><span class="p">(</span><span class="o">**</span><span class="nb">input</span><span class="p">))</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">rows</span><span class="p">[</span><span class="n">rowNameDest</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">getColumnsWidth</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span></div>
<div class="viewcode-block" id="Sheet.getColumnsWidth"><a class="viewcode-back" href="../../../../API/JumpScale.lib.sheet.html#JumpScale.lib.sheet.Sheet.Sheet.getColumnsWidth">[docs]</a>        <span class="k">def</span> <span class="nf">getwidth</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
            <span class="n">width</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">if</span> <span class="n">value</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">width</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">valuepos</span> <span class="o">=</span> <span class="o">-</span><span class="n">value</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">valuepos</span> <span class="o">=</span> <span class="n">value</span>
            <span class="k">if</span> <span class="n">valuepos</span> <span class="o">&lt;</span> <span class="mi">1000</span><span class="p">:</span>
                <span class="k">pass</span>
            <span class="k">elif</span> <span class="n">valuepos</span> <span class="o">&lt;</span> <span class="mi">1000000</span><span class="p">:</span>
                <span class="n">width</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">elif</span> <span class="n">valuepos</span> <span class="o">&lt;</span> <span class="mi">1000000000</span><span class="p">:</span>
                <span class="n">width</span> <span class="o">+=</span> <span class="mi">2</span>
            <span class="k">elif</span> <span class="n">valuepos</span> <span class="o">&lt;</span> <span class="mi">1000000000000</span><span class="p">:</span>
                <span class="n">width</span> <span class="o">+=</span> <span class="mi">3</span>
            <span class="k">if</span> <span class="n">valuepos</span> <span class="o">&lt;</span> <span class="mi">1</span> <span class="ow">and</span> <span class="nb">round</span><span class="p">(</span><span class="n">valuepos</span><span class="p">)</span> <span class="o">!=</span> <span class="n">valuepos</span><span class="p">:</span>
                <span class="n">width</span> <span class="o">+=</span> <span class="mi">3</span>
            <span class="k">elif</span> <span class="n">valuepos</span> <span class="o">&lt;</span> <span class="mi">10</span> <span class="ow">and</span> <span class="nb">round</span><span class="p">(</span><span class="n">valuepos</span><span class="p">)</span> <span class="o">!=</span> <span class="n">valuepos</span><span class="p">:</span>
                <span class="n">width</span> <span class="o">+=</span> <span class="mi">2</span>
            <span class="n">valueposround</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">valuepos</span><span class="p">))</span>
            <span class="n">width</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">valueposround</span><span class="p">))</span>
            <span class="k">return</span> <span class="n">width</span>

        <span class="n">cols</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">rows</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">row</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rows</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">colnr</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">row</span><span class="o">.</span><span class="n">cells</span><span class="p">)):</span>
                <span class="k">if</span> <span class="n">colnr</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">cols</span><span class="p">:</span>
                    <span class="n">cols</span><span class="p">[</span><span class="n">colnr</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">w</span> <span class="o">=</span> <span class="n">getwidth</span><span class="p">(</span><span class="n">row</span><span class="o">.</span><span class="n">cells</span><span class="p">[</span><span class="n">colnr</span><span class="p">])</span>
                <span class="k">if</span> <span class="n">w</span> <span class="o">&gt;</span> <span class="n">cols</span><span class="p">[</span><span class="n">colnr</span><span class="p">]:</span>
                    <span class="n">cols</span><span class="p">[</span><span class="n">colnr</span><span class="p">]</span> <span class="o">=</span> <span class="n">w</span>
        <span class="k">return</span> <span class="n">cols</span>

    <span class="k">def</span> <span class="nf">addRows</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rows2create</span><span class="p">,</span> <span class="n">aggregation</span><span class="p">):</span></div>
<div class="viewcode-block" id="Sheet.addRows"><a class="viewcode-back" href="../../../../API/JumpScale.lib.sheet.html#JumpScale.lib.sheet.Sheet.Sheet.addRows">[docs]</a>        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        @para rows2create {groupname:[rownames,...]}</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">group</span> <span class="ow">in</span> <span class="n">rows2create</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">rownames</span> <span class="o">=</span> <span class="n">rows2create</span><span class="p">[</span><span class="n">group</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">rowname</span> <span class="ow">in</span> <span class="n">rownames</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">rowname</span> <span class="ow">in</span> <span class="n">aggregation</span><span class="p">:</span>
                    <span class="n">aggr</span> <span class="o">=</span> <span class="n">aggregation</span><span class="p">[</span><span class="n">rowname</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">aggr</span> <span class="o">=</span> <span class="s">&quot;T&quot;</span>
                <span class="n">rowx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">addRow</span><span class="p">(</span><span class="n">rowname</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">,</span> <span class="n">nrfloat</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">aggregate</span><span class="o">=</span><span class="n">aggr</span><span class="p">)</span>
                <span class="n">rowx</span><span class="o">.</span><span class="n">groupname</span> <span class="o">=</span> <span class="n">group</span>

    <span class="k">def</span> <span class="nf">applyFunctionOnValuesFromRows</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rownames</span><span class="p">,</span> <span class="n">method</span><span class="p">,</span> <span class="n">rowDest</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="p">{}):</span></div>
<div class="viewcode-block" id="Sheet.applyFunctionOnValuesFromRows"><a class="viewcode-back" href="../../../../API/JumpScale.lib.sheet.html#JumpScale.lib.sheet.Sheet.Sheet.applyFunctionOnValuesFromRows">[docs]</a>        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        @param rows is array if of rows we would like to use as inputvalues</span>
<span class="sd">        @param rowDest if empty will be same as first row</span>
<span class="sd">        @param method is python function with params (values,params) values are inputvalues from the rows</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">colnr</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">rowDest</span><span class="o">.</span><span class="n">nrcols</span><span class="p">):</span>
            <span class="nb">input</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">rowname</span> <span class="ow">in</span> <span class="n">rownames</span><span class="p">:</span>
                <span class="n">val</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getCell</span><span class="p">(</span><span class="n">rowname</span><span class="p">,</span> <span class="n">colnr</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">val</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
                    <span class="n">val</span> <span class="o">=</span> <span class="mf">0.0</span>
                <span class="nb">input</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>

            <span class="n">rowDest</span><span class="o">.</span><span class="n">cells</span><span class="p">[</span><span class="n">colnr</span><span class="p">]</span> <span class="o">=</span> <span class="n">method</span><span class="p">(</span><span class="nb">input</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">rowDest</span>

    <span class="k">def</span> <span class="nf">sumRows</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rownames</span><span class="p">,</span> <span class="n">newRow</span><span class="p">):</span></div>
<div class="viewcode-block" id="Sheet.sumRows"><a class="viewcode-back" href="../../../../API/JumpScale.lib.sheet.html#JumpScale.lib.sheet.Sheet.Sheet.sumRows">[docs]</a>        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        make sum of rows</span>
<span class="sd">        @param rownames is list of rows to add specified by list or rownames</span>
<span class="sd">        @param newRow is the row where the result will be stored (can also be the name of the new row then row will be looked for)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">j</span><span class="o">.</span><span class="n">basetype</span><span class="o">.</span><span class="n">string</span><span class="o">.</span><span class="n">check</span><span class="p">(</span><span class="n">newRow</span><span class="p">):</span>
            <span class="n">newRow</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getRow</span><span class="p">(</span><span class="n">newRow</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">summ</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="n">params</span><span class="p">):</span>
            <span class="n">total</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">values</span><span class="p">:</span>
                <span class="n">total</span> <span class="o">+=</span> <span class="n">value</span>
            <span class="k">return</span> <span class="n">total</span>
        <span class="n">newRow</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">applyFunctionOnValuesFromRows</span><span class="p">(</span><span class="n">rownames</span><span class="p">,</span> <span class="n">summ</span><span class="p">,</span> <span class="n">newRow</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">newRow</span>

    <span class="k">def</span> <span class="nf">multiplyRows</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rownames</span><span class="p">,</span> <span class="n">newRow</span><span class="p">):</span></div>
<div class="viewcode-block" id="Sheet.multiplyRows"><a class="viewcode-back" href="../../../../API/JumpScale.lib.sheet.html#JumpScale.lib.sheet.Sheet.Sheet.multiplyRows">[docs]</a>        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        make procuct of rows</span>
<span class="sd">        @param rownames is list of rows to add specified by list or rownames</span>
<span class="sd">        @param newRow is the row where the result will be stored (can also be the name of the new row then row will be looked for)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">j</span><span class="o">.</span><span class="n">basetype</span><span class="o">.</span><span class="n">string</span><span class="o">.</span><span class="n">check</span><span class="p">(</span><span class="n">newRow</span><span class="p">):</span>
            <span class="n">newRow</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getRow</span><span class="p">(</span><span class="n">newRow</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">mult</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="n">params</span><span class="p">):</span>
            <span class="n">total</span> <span class="o">=</span> <span class="mf">1.0</span>
            <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">values</span><span class="p">:</span>
                <span class="n">total</span> <span class="o">=</span> <span class="n">total</span> <span class="o">*</span> <span class="n">value</span>
            <span class="k">return</span> <span class="n">total</span>

        <span class="n">newRow</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">applyFunctionOnValuesFromRows</span><span class="p">(</span><span class="n">rownames</span><span class="p">,</span> <span class="n">mult</span><span class="p">,</span> <span class="n">newRow</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">newRow</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span></div>
        <span class="n">result</span> <span class="o">=</span> <span class="s">&quot;&quot;</span>
        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">rows</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">+=</span> <span class="s">&quot;</span><span class="si">%s</span><span class="se">\n</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">row</span>
        <span class="k">return</span> <span class="n">result</span>

    <span class="n">__repr__</span> <span class="o">=</span> <span class="n">__str__</span>


<span class="k">class</span> <span class="nc">SheetFactory</span><span class="p">():</span></div>
<div class="viewcode-block" id="SheetFactory"><a class="viewcode-back" href="../../../../API/JumpScale.lib.sheet.html#JumpScale.lib.sheet.Sheet.SheetFactory">[docs]</a>
    <span class="k">def</span> <span class="nf">new</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">nrcols</span><span class="o">=</span><span class="mi">72</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="p">[],</span> <span class="n">period</span><span class="o">=</span><span class="s">&quot;M&quot;</span><span class="p">):</span>
<div class="viewcode-block" id="SheetFactory.new"><a class="viewcode-back" href="../../../../API/JumpScale.lib.sheet.html#JumpScale.lib.sheet.Sheet.SheetFactory.new">[docs]</a>        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        @param period is M,Q or Y</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">Sheet</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">nrcols</span><span class="o">=</span><span class="n">nrcols</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">,</span> <span class="n">period</span><span class="o">=</span><span class="n">period</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">getSheetsCollection</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span></div>
<div class="viewcode-block" id="SheetFactory.getSheetsCollection"><a class="viewcode-back" href="../../../../API/JumpScale.lib.sheet.html#JumpScale.lib.sheet.Sheet.SheetFactory.getSheetsCollection">[docs]</a>        <span class="k">return</span> <span class="n">Sheets</span><span class="p">()</span>
</pre></div></div></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../../../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../../../../index.html">Jumpscale Doc 7.0 documentation</a> &raquo;</li>
          <li><a href="../../../index.html" >Module code</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
    </div>
  </body>
</html>