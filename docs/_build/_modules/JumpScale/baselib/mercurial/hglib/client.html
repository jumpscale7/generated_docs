<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>JumpScale.baselib.mercurial.hglib.client &mdash; Jumpscale Doc 7.0 documentation</title>
    
    <link rel="stylesheet" href="../../../../../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../../../../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../../../',
        VERSION:     '7.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../../../_static/doctools.js"></script>
    <link rel="top" title="Jumpscale Doc 7.0 documentation" href="../../../../../index.html" />
    <link rel="up" title="JumpScale.baselib.mercurial.hglib" href="../hglib.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li><a href="../../../../../index.html">Jumpscale Doc 7.0 documentation</a> &raquo;</li>
          <li><a href="../../../../index.html" >Module code</a> &raquo;</li>
          <li><a href="../hglib.html" accesskey="U">JumpScale.baselib.mercurial.hglib</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <h1>Source code for JumpScale.baselib.mercurial.hglib.client</h1><div class="highlight"><pre>
<span class="kn">import</span> <span class="nn">subprocess</span><span class="o">,</span> <span class="nn">os</span><span class="o">,</span> <span class="nn">struct</span><span class="o">,</span> <span class="nn">cStringIO</span><span class="o">,</span> <span class="nn">re</span><span class="o">,</span> <span class="nn">datetime</span>
<span class="kn">import</span> <span class="nn">hglib</span><span class="o">,</span> <span class="nn">error</span><span class="o">,</span> <span class="nn">util</span><span class="o">,</span> <span class="nn">templates</span><span class="o">,</span> <span class="nn">merge</span><span class="o">,</span> <span class="nn">context</span>

<span class="kn">from</span> <span class="nn">util</span> <span class="kn">import</span> <span class="n">cmdbuilder</span>

<div class="viewcode-block" id="revision"><a class="viewcode-back" href="../../../../../API/JumpScale.baselib.mercurial.hglib.html#JumpScale.baselib.mercurial.hglib.client.revision">[docs]</a><span class="k">class</span> <span class="nc">revision</span><span class="p">(</span><span class="nb">tuple</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__new__</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">rev</span><span class="p">,</span> <span class="n">node</span><span class="p">,</span> <span class="n">tags</span><span class="p">,</span> <span class="n">branch</span><span class="p">,</span> <span class="n">author</span><span class="p">,</span> <span class="n">desc</span><span class="p">,</span> <span class="n">date</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">tuple</span><span class="o">.</span><span class="n">__new__</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="p">(</span><span class="n">rev</span><span class="p">,</span> <span class="n">node</span><span class="p">,</span> <span class="n">tags</span><span class="p">,</span> <span class="n">branch</span><span class="p">,</span> <span class="n">author</span><span class="p">,</span> <span class="n">desc</span><span class="p">,</span> <span class="n">date</span><span class="p">))</span>

    <span class="nd">@property</span>
<div class="viewcode-block" id="revision.rev"><a class="viewcode-back" href="../../../../../API/JumpScale.baselib.mercurial.hglib.html#JumpScale.baselib.mercurial.hglib.client.revision.rev">[docs]</a>    <span class="k">def</span> <span class="nf">rev</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</div>
    <span class="nd">@property</span>
<div class="viewcode-block" id="revision.node"><a class="viewcode-back" href="../../../../../API/JumpScale.baselib.mercurial.hglib.html#JumpScale.baselib.mercurial.hglib.client.revision.node">[docs]</a>    <span class="k">def</span> <span class="nf">node</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</div>
    <span class="nd">@property</span>
<div class="viewcode-block" id="revision.tags"><a class="viewcode-back" href="../../../../../API/JumpScale.baselib.mercurial.hglib.html#JumpScale.baselib.mercurial.hglib.client.revision.tags">[docs]</a>    <span class="k">def</span> <span class="nf">tags</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
</div>
    <span class="nd">@property</span>
<div class="viewcode-block" id="revision.branch"><a class="viewcode-back" href="../../../../../API/JumpScale.baselib.mercurial.hglib.html#JumpScale.baselib.mercurial.hglib.client.revision.branch">[docs]</a>    <span class="k">def</span> <span class="nf">branch</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
</div>
    <span class="nd">@property</span>
<div class="viewcode-block" id="revision.author"><a class="viewcode-back" href="../../../../../API/JumpScale.baselib.mercurial.hglib.html#JumpScale.baselib.mercurial.hglib.client.revision.author">[docs]</a>    <span class="k">def</span> <span class="nf">author</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span>
</div>
    <span class="nd">@property</span>
<div class="viewcode-block" id="revision.desc"><a class="viewcode-back" href="../../../../../API/JumpScale.baselib.mercurial.hglib.html#JumpScale.baselib.mercurial.hglib.client.revision.desc">[docs]</a>    <span class="k">def</span> <span class="nf">desc</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span>
</div>
    <span class="nd">@property</span>
<div class="viewcode-block" id="revision.date"><a class="viewcode-back" href="../../../../../API/JumpScale.baselib.mercurial.hglib.html#JumpScale.baselib.mercurial.hglib.client.revision.date">[docs]</a>    <span class="k">def</span> <span class="nf">date</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span>
</div></div>
<div class="viewcode-block" id="hgclient"><a class="viewcode-back" href="../../../../../API/JumpScale.baselib.mercurial.hglib.html#JumpScale.baselib.mercurial.hglib.client.hgclient">[docs]</a><span class="k">class</span> <span class="nc">hgclient</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="n">inputfmt</span> <span class="o">=</span> <span class="s">&#39;&gt;I&#39;</span>
    <span class="n">outputfmt</span> <span class="o">=</span> <span class="s">&#39;&gt;cI&#39;</span>
    <span class="n">outputfmtsize</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">calcsize</span><span class="p">(</span><span class="n">outputfmt</span><span class="p">)</span>
    <span class="n">retfmt</span> <span class="o">=</span> <span class="s">&#39;&gt;i&#39;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">encoding</span><span class="p">,</span> <span class="n">configs</span><span class="p">,</span> <span class="n">connect</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_args</span> <span class="o">=</span> <span class="p">[</span><span class="n">hglib</span><span class="o">.</span><span class="n">HGPATH</span><span class="p">,</span> <span class="s">&#39;serve&#39;</span><span class="p">,</span> <span class="s">&#39;--cmdserver&#39;</span><span class="p">,</span> <span class="s">&#39;pipe&#39;</span><span class="p">,</span>
                <span class="s">&#39;--config&#39;</span><span class="p">,</span> <span class="s">&#39;ui.interactive=False&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">path</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_args</span> <span class="o">+=</span> <span class="p">[</span><span class="s">&#39;-R&#39;</span><span class="p">,</span> <span class="n">path</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">configs</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_args</span> <span class="o">+=</span> <span class="p">[</span><span class="s">&#39;--config&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">configs</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_env</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;HGPLAIN&#39;</span><span class="p">:</span> <span class="s">&#39;1&#39;</span><span class="p">,</span> <span class="s">&#39;PYTHONPATH&#39;</span><span class="p">:</span> <span class="s">&#39;&#39;</span><span class="p">}</span>
        <span class="k">if</span> <span class="n">encoding</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_env</span><span class="p">[</span><span class="s">&#39;HGENCODING&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">encoding</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">server</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_version</span> <span class="o">=</span> <span class="bp">None</span>

        <span class="k">if</span> <span class="n">connect</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">open</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">__enter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="nf">__exit__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exc_type</span><span class="p">,</span> <span class="n">exc_val</span><span class="p">,</span> <span class="n">exc_tb</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_readhello</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; read the hello message the server sends when started &quot;&quot;&quot;</span>
        <span class="n">ch</span><span class="p">,</span> <span class="n">msg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_readchannel</span><span class="p">()</span>
        <span class="k">assert</span> <span class="n">ch</span> <span class="o">==</span> <span class="s">&#39;o&#39;</span>

        <span class="n">msg</span> <span class="o">=</span> <span class="n">msg</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">capabilities</span> <span class="o">=</span> <span class="n">msg</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="nb">len</span><span class="p">(</span><span class="s">&#39;capabilities: &#39;</span><span class="p">):]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">capabilities</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">error</span><span class="o">.</span><span class="n">ResponseError</span><span class="p">(</span><span class="s">&quot;bad hello message: expected &#39;capabilities: &#39;&quot;</span>
                                      <span class="s">&quot;, got </span><span class="si">%r</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">msg</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">capabilities</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">capabilities</span><span class="o">.</span><span class="n">split</span><span class="p">())</span>

        <span class="c"># at the very least the server should be able to run commands</span>
        <span class="k">assert</span> <span class="s">&#39;runcommand&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">capabilities</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_encoding</span> <span class="o">=</span> <span class="n">msg</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="nb">len</span><span class="p">(</span><span class="s">&#39;encoding: &#39;</span><span class="p">):]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_encoding</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">error</span><span class="o">.</span><span class="n">ResponseError</span><span class="p">(</span><span class="s">&quot;bad hello message: expected &#39;encoding: &#39;&quot;</span>
                                      <span class="s">&quot;, got </span><span class="si">%r</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">msg</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">_readchannel</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">hgclient</span><span class="o">.</span><span class="n">outputfmtsize</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">data</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">error</span><span class="o">.</span><span class="n">ServerError</span><span class="p">()</span>
        <span class="n">channel</span><span class="p">,</span> <span class="n">length</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="n">hgclient</span><span class="o">.</span><span class="n">outputfmt</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">channel</span> <span class="ow">in</span> <span class="s">&#39;IL&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">channel</span><span class="p">,</span> <span class="n">length</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">channel</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">length</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_parserevs</span><span class="p">(</span><span class="n">splitted</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; splitted is a list of fields according to our rev.style, where each 6</span>
<span class="sd">        fields compose one revision. &#39;&#39;&#39;</span>
        <span class="n">revs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">rev</span> <span class="ow">in</span> <span class="n">util</span><span class="o">.</span><span class="n">grouper</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="n">splitted</span><span class="p">):</span>
            <span class="c"># truncate the timezone and convert to a local datetime</span>
            <span class="n">posixtime</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">rev</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;.&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">dt</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">fromtimestamp</span><span class="p">(</span><span class="n">posixtime</span><span class="p">)</span>
            <span class="n">revs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">revision</span><span class="p">(</span><span class="n">rev</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">rev</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">rev</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">rev</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">rev</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span> <span class="n">rev</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span> <span class="n">dt</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">revs</span>

<div class="viewcode-block" id="hgclient.runcommand"><a class="viewcode-back" href="../../../../../API/JumpScale.baselib.mercurial.hglib.html#JumpScale.baselib.mercurial.hglib.client.hgclient.runcommand">[docs]</a>    <span class="k">def</span> <span class="nf">runcommand</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">inchannels</span><span class="p">,</span> <span class="n">outchannels</span><span class="p">):</span>
        <span class="k">def</span> <span class="nf">writeblock</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">stdin</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">struct</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">inputfmt</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">stdin</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">stdin</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">server</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">open</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">stdin</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;runcommand</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="n">writeblock</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\0</span><span class="s">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">args</span><span class="p">))</span>

        <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
            <span class="n">channel</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_readchannel</span><span class="p">()</span>

            <span class="c"># input channels</span>
            <span class="k">if</span> <span class="n">channel</span> <span class="ow">in</span> <span class="n">inchannels</span><span class="p">:</span>
                <span class="n">writeblock</span><span class="p">(</span><span class="n">inchannels</span><span class="p">[</span><span class="n">channel</span><span class="p">](</span><span class="n">data</span><span class="p">))</span>
            <span class="c"># output channels</span>
            <span class="k">elif</span> <span class="n">channel</span> <span class="ow">in</span> <span class="n">outchannels</span><span class="p">:</span>
                <span class="n">outchannels</span><span class="p">[</span><span class="n">channel</span><span class="p">](</span><span class="n">data</span><span class="p">)</span>
            <span class="c"># result channel, command finished</span>
            <span class="k">elif</span> <span class="n">channel</span> <span class="o">==</span> <span class="s">&#39;r&#39;</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">struct</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="n">hgclient</span><span class="o">.</span><span class="n">retfmt</span><span class="p">,</span> <span class="n">data</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="c"># a channel that we don&#39;t know and can&#39;t ignore</span>
            <span class="k">elif</span> <span class="n">channel</span><span class="o">.</span><span class="n">isupper</span><span class="p">():</span>
                <span class="k">raise</span> <span class="n">error</span><span class="o">.</span><span class="n">ResponseError</span><span class="p">(</span><span class="s">&quot;unexpected data on required channel &#39;</span><span class="si">%s</span><span class="s">&#39;&quot;</span>
                                          <span class="o">%</span> <span class="n">channel</span><span class="p">)</span>
            <span class="c"># optional channel</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">pass</span>
</div>
<div class="viewcode-block" id="hgclient.rawcommand"><a class="viewcode-back" href="../../../../../API/JumpScale.baselib.mercurial.hglib.html#JumpScale.baselib.mercurial.hglib.client.hgclient.rawcommand">[docs]</a>    <span class="k">def</span> <span class="nf">rawcommand</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">eh</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">prompt</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="nb">input</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        args is the cmdline (usually built using util.cmdbuilder)</span>

<span class="sd">        eh is an error handler that is passed the return code, stdout and stderr</span>
<span class="sd">        If no eh is given, we raise a CommandError if ret != 0</span>

<span class="sd">        prompt is used to reply to prompts by the server</span>
<span class="sd">        It receives the max number of bytes to return and the contents of stdout</span>
<span class="sd">        received so far</span>

<span class="sd">        input is used to reply to bulk data requests by the server</span>
<span class="sd">        It receives the max number of bytes to return</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">out</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="n">cStringIO</span><span class="o">.</span><span class="n">StringIO</span><span class="p">(),</span> <span class="n">cStringIO</span><span class="o">.</span><span class="n">StringIO</span><span class="p">()</span>
        <span class="n">outchannels</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;o&#39;</span> <span class="p">:</span> <span class="n">out</span><span class="o">.</span><span class="n">write</span><span class="p">,</span> <span class="s">&#39;e&#39;</span> <span class="p">:</span> <span class="n">err</span><span class="o">.</span><span class="n">write</span><span class="p">}</span>

        <span class="n">inchannels</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="n">prompt</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">def</span> <span class="nf">func</span><span class="p">(</span><span class="n">size</span><span class="p">):</span>
                <span class="n">reply</span> <span class="o">=</span> <span class="n">prompt</span><span class="p">(</span><span class="n">size</span><span class="p">,</span> <span class="n">out</span><span class="o">.</span><span class="n">getvalue</span><span class="p">())</span>
                <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">reply</span><span class="p">)</span>
            <span class="n">inchannels</span><span class="p">[</span><span class="s">&#39;L&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">func</span>
        <span class="k">if</span> <span class="nb">input</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">inchannels</span><span class="p">[</span><span class="s">&#39;I&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">input</span>

        <span class="n">ret</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">runcommand</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">inchannels</span><span class="p">,</span> <span class="n">outchannels</span><span class="p">)</span>
        <span class="n">out</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="n">out</span><span class="o">.</span><span class="n">getvalue</span><span class="p">(),</span> <span class="n">err</span><span class="o">.</span><span class="n">getvalue</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">ret</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">eh</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">error</span><span class="o">.</span><span class="n">CommandError</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">ret</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">err</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">eh</span><span class="p">(</span><span class="n">ret</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">err</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">out</span>
</div>
<div class="viewcode-block" id="hgclient.open"><a class="viewcode-back" href="../../../../../API/JumpScale.baselib.mercurial.hglib.html#JumpScale.baselib.mercurial.hglib.client.hgclient.open">[docs]</a>    <span class="k">def</span> <span class="nf">open</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">server</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&#39;server already open&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">server</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">popen</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_args</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_env</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_readhello</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span>
</div>
<div class="viewcode-block" id="hgclient.close"><a class="viewcode-back" href="../../../../../API/JumpScale.baselib.mercurial.hglib.html#JumpScale.baselib.mercurial.hglib.client.hgclient.close">[docs]</a>    <span class="k">def</span> <span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Closes the command server instance and waits for it to exit, returns the</span>
<span class="sd">        exit code.</span>

<span class="sd">        Attempting to call any function afterwards that needs to communicate with</span>
<span class="sd">        the server will raise a ValueError.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">stdin</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">wait</span><span class="p">()</span>
        <span class="n">ret</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">returncode</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">server</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="k">return</span> <span class="n">ret</span>
</div>
<div class="viewcode-block" id="hgclient.add"><a class="viewcode-back" href="../../../../../API/JumpScale.baselib.mercurial.hglib.html#JumpScale.baselib.mercurial.hglib.client.hgclient.add">[docs]</a>    <span class="k">def</span> <span class="nf">add</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">files</span><span class="o">=</span><span class="p">[],</span> <span class="n">dryrun</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">subrepos</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">include</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
            <span class="n">exclude</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add the specified files on the next commit.</span>
<span class="sd">        If no files are given, add all files to the repository.</span>

<span class="sd">        dryrun - do no perform actions</span>
<span class="sd">        subrepos - recurse into subrepositories</span>
<span class="sd">        include - include names matching the given patterns</span>
<span class="sd">        exclude - exclude names matching the given patterns</span>

<span class="sd">        Return whether all given files were added.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">files</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="n">files</span> <span class="o">=</span> <span class="p">[</span><span class="n">files</span><span class="p">]</span>

        <span class="n">args</span> <span class="o">=</span> <span class="n">cmdbuilder</span><span class="p">(</span><span class="s">&#39;add&#39;</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="n">dryrun</span><span class="p">,</span> <span class="n">S</span><span class="o">=</span><span class="n">subrepos</span><span class="p">,</span> <span class="n">I</span><span class="o">=</span><span class="n">include</span><span class="p">,</span> <span class="n">X</span><span class="o">=</span><span class="n">exclude</span><span class="p">,</span>
                          <span class="o">*</span><span class="n">files</span><span class="p">)</span>

        <span class="n">eh</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">reterrorhandler</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rawcommand</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">eh</span><span class="o">=</span><span class="n">eh</span><span class="p">)</span>

        <span class="k">return</span> <span class="nb">bool</span><span class="p">(</span><span class="n">eh</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="hgclient.addremove"><a class="viewcode-back" href="../../../../../API/JumpScale.baselib.mercurial.hglib.html#JumpScale.baselib.mercurial.hglib.client.hgclient.addremove">[docs]</a>    <span class="k">def</span> <span class="nf">addremove</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">files</span><span class="o">=</span><span class="p">[],</span> <span class="n">similarity</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">dryrun</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">include</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                  <span class="n">exclude</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add all new files and remove all missing files from the repository.</span>

<span class="sd">        New files are ignored if they match any of the patterns in &quot;.hgignore&quot;. As</span>
<span class="sd">        with add, these changes take effect at the next commit.</span>

<span class="sd">        similarity - used to detect renamed files. With a parameter</span>
<span class="sd">        greater than 0, this compares every removed file with every added file and</span>
<span class="sd">        records those similar enough as renames. This option takes a percentage</span>
<span class="sd">        between 0 (disabled) and 100 (files must be identical) as its parameter.</span>
<span class="sd">        Detecting renamed files this way can be expensive. After using this</span>
<span class="sd">        option, &quot;hg status -C&quot; can be used to check which files were identified as</span>
<span class="sd">        moved or renamed.</span>

<span class="sd">        dryrun - do no perform actions</span>
<span class="sd">        include - include names matching the given patterns</span>
<span class="sd">        exclude - exclude names matching the given patterns</span>

<span class="sd">        Return True if all files are successfully added.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">files</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="n">files</span> <span class="o">=</span> <span class="p">[</span><span class="n">files</span><span class="p">]</span>

        <span class="n">args</span> <span class="o">=</span> <span class="n">cmdbuilder</span><span class="p">(</span><span class="s">&#39;addremove&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="n">similarity</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="n">dryrun</span><span class="p">,</span> <span class="n">I</span><span class="o">=</span><span class="n">include</span><span class="p">,</span>
                          <span class="n">X</span><span class="o">=</span><span class="n">exclude</span><span class="p">,</span> <span class="o">*</span><span class="n">files</span><span class="p">)</span>

        <span class="n">eh</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">reterrorhandler</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rawcommand</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">eh</span><span class="o">=</span><span class="n">eh</span><span class="p">)</span>

        <span class="k">return</span> <span class="nb">bool</span><span class="p">(</span><span class="n">eh</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="hgclient.annotate"><a class="viewcode-back" href="../../../../../API/JumpScale.baselib.mercurial.hglib.html#JumpScale.baselib.mercurial.hglib.client.hgclient.annotate">[docs]</a>    <span class="k">def</span> <span class="nf">annotate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">files</span><span class="p">,</span> <span class="n">rev</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">nofollow</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">user</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
                 <span class="nb">file</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">date</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">number</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">changeset</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
                 <span class="n">line</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">include</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">exclude</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Show changeset information by line for each file in files.</span>

<span class="sd">        rev - annotate the specified revision</span>
<span class="sd">        nofollow - don&#39;t follow copies and renames</span>
<span class="sd">        text - treat all files as text</span>
<span class="sd">        user - list the author (long with -v)</span>
<span class="sd">        file - list the filename</span>
<span class="sd">        date - list the date</span>
<span class="sd">        number - list the revision number (default)</span>
<span class="sd">        changeset - list the changeset</span>
<span class="sd">        line - show line number at the first appearance</span>
<span class="sd">        include - include names matching the given patterns</span>
<span class="sd">        exclude - exclude names matching the given patterns</span>

<span class="sd">        Yields a (info, contents) tuple for each line in a file. Info is a space</span>
<span class="sd">        separated string according to the given options.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">files</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="n">files</span> <span class="o">=</span> <span class="p">[</span><span class="n">files</span><span class="p">]</span>

        <span class="n">args</span> <span class="o">=</span> <span class="n">cmdbuilder</span><span class="p">(</span><span class="s">&#39;annotate&#39;</span><span class="p">,</span> <span class="n">r</span><span class="o">=</span><span class="n">rev</span><span class="p">,</span> <span class="n">no_follow</span><span class="o">=</span><span class="n">nofollow</span><span class="p">,</span> <span class="n">a</span><span class="o">=</span><span class="n">text</span><span class="p">,</span>
                          <span class="n">u</span><span class="o">=</span><span class="n">user</span><span class="p">,</span> <span class="n">f</span><span class="o">=</span><span class="nb">file</span><span class="p">,</span> <span class="n">d</span><span class="o">=</span><span class="n">date</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="n">number</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">changeset</span><span class="p">,</span>
                          <span class="n">l</span><span class="o">=</span><span class="n">line</span><span class="p">,</span> <span class="n">v</span><span class="o">=</span><span class="n">verbose</span><span class="p">,</span> <span class="n">I</span><span class="o">=</span><span class="n">include</span><span class="p">,</span> <span class="n">X</span><span class="o">=</span><span class="n">exclude</span><span class="p">,</span> <span class="o">*</span><span class="n">files</span><span class="p">)</span>

        <span class="n">out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rawcommand</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">out</span><span class="o">.</span><span class="n">splitlines</span><span class="p">():</span>
            <span class="k">yield</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;: &#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="hgclient.archive"><a class="viewcode-back" href="../../../../../API/JumpScale.baselib.mercurial.hglib.html#JumpScale.baselib.mercurial.hglib.client.hgclient.archive">[docs]</a>    <span class="k">def</span> <span class="nf">archive</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dest</span><span class="p">,</span> <span class="n">rev</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">nodecode</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                <span class="n">subrepos</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">include</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">exclude</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create an unversioned archive of a repository revision.</span>

<span class="sd">        The exact name of the destination archive or directory is given using a</span>
<span class="sd">        format string; see export for details.</span>

<span class="sd">        Each member added to an archive file has a directory prefix prepended. Use</span>
<span class="sd">        prefix to specify a format string for the prefix. The default is the</span>
<span class="sd">        basename of the archive, with suffixes removed.</span>

<span class="sd">        dest - destination path</span>
<span class="sd">        rev - revision to distribute. The revision used is the parent of the</span>
<span class="sd">        working directory if one isn&#39;t given.</span>

<span class="sd">        nodecode - do not pass files through decoders</span>
<span class="sd">        prefix - directory prefix for files in archive</span>
<span class="sd">        type - type of distribution to create. The archive type is automatically</span>
<span class="sd">        detected based on file extension if one isn&#39;t given.</span>

<span class="sd">        Valid types are:</span>

<span class="sd">        &quot;files&quot;  a directory full of files (default)</span>
<span class="sd">        &quot;tar&quot;    tar archive, uncompressed</span>
<span class="sd">        &quot;tbz2&quot;   tar archive, compressed using bzip2</span>
<span class="sd">        &quot;tgz&quot;    tar archive, compressed using gzip</span>
<span class="sd">        &quot;uzip&quot;   zip archive, uncompressed</span>
<span class="sd">        &quot;zip&quot;    zip archive, compressed using deflate</span>

<span class="sd">        subrepos - recurse into subrepositories</span>
<span class="sd">        include - include names matching the given patterns</span>
<span class="sd">        exclude - exclude names matching the given patterns</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">args</span> <span class="o">=</span> <span class="n">cmdbuilder</span><span class="p">(</span><span class="s">&#39;archive&#39;</span><span class="p">,</span> <span class="n">dest</span><span class="p">,</span> <span class="n">r</span><span class="o">=</span><span class="n">rev</span><span class="p">,</span> <span class="n">no_decode</span><span class="o">=</span><span class="n">nodecode</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="n">prefix</span><span class="p">,</span>
                          <span class="n">t</span><span class="o">=</span><span class="nb">type</span><span class="p">,</span> <span class="n">S</span><span class="o">=</span><span class="n">subrepos</span><span class="p">,</span> <span class="n">I</span><span class="o">=</span><span class="n">include</span><span class="p">,</span> <span class="n">X</span><span class="o">=</span><span class="n">exclude</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">rawcommand</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="hgclient.backout"><a class="viewcode-back" href="../../../../../API/JumpScale.baselib.mercurial.hglib.html#JumpScale.baselib.mercurial.hglib.client.hgclient.backout">[docs]</a>    <span class="k">def</span> <span class="nf">backout</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rev</span><span class="p">,</span> <span class="n">merge</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">tool</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">message</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                <span class="n">logfile</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">date</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">user</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Prepare a new changeset with the effect of rev undone in the current</span>
<span class="sd">        working directory.</span>

<span class="sd">        If rev is the parent of the working directory, then this new changeset is</span>
<span class="sd">        committed automatically. Otherwise, hg needs to merge the changes and the</span>
<span class="sd">        merged result is left uncommitted.</span>

<span class="sd">        rev - revision to backout</span>
<span class="sd">        merge - merge with old dirstate parent after backout</span>
<span class="sd">        parent - parent to choose when backing out merge</span>
<span class="sd">        tool - specify merge tool</span>
<span class="sd">        message - use text as commit message</span>
<span class="sd">        logfile - read commit message from file</span>
<span class="sd">        date - record the specified date as commit date</span>
<span class="sd">        user - record the specified user as committer</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">message</span> <span class="ow">and</span> <span class="n">logfile</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;cannot specify both a message and a logfile&quot;</span><span class="p">)</span>

        <span class="n">args</span> <span class="o">=</span> <span class="n">cmdbuilder</span><span class="p">(</span><span class="s">&#39;backout&#39;</span><span class="p">,</span> <span class="n">r</span><span class="o">=</span><span class="n">rev</span><span class="p">,</span> <span class="n">merge</span><span class="o">=</span><span class="n">merge</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="n">parent</span><span class="p">,</span> <span class="n">t</span><span class="o">=</span><span class="n">tool</span><span class="p">,</span>
                          <span class="n">m</span><span class="o">=</span><span class="n">message</span><span class="p">,</span> <span class="n">l</span><span class="o">=</span><span class="n">logfile</span><span class="p">,</span> <span class="n">d</span><span class="o">=</span><span class="n">date</span><span class="p">,</span> <span class="n">u</span><span class="o">=</span><span class="n">user</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">rawcommand</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="hgclient.bookmark"><a class="viewcode-back" href="../../../../../API/JumpScale.baselib.mercurial.hglib.html#JumpScale.baselib.mercurial.hglib.client.hgclient.bookmark">[docs]</a>    <span class="k">def</span> <span class="nf">bookmark</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">rev</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">force</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">delete</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">inactive</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
                 <span class="n">rename</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set a bookmark on the working directory&#39;s parent revision or rev,</span>
<span class="sd">        with the given name.</span>

<span class="sd">        name - bookmark name</span>
<span class="sd">        rev - revision to bookmark</span>
<span class="sd">        force - bookmark even if another bookmark with the same name exists</span>
<span class="sd">        delete - delete the given bookmark</span>
<span class="sd">        inactive - do not mark the new bookmark active</span>
<span class="sd">        rename - rename the bookmark given by rename to name</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">args</span> <span class="o">=</span> <span class="n">cmdbuilder</span><span class="p">(</span><span class="s">&#39;bookmark&#39;</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">r</span><span class="o">=</span><span class="n">rev</span><span class="p">,</span> <span class="n">f</span><span class="o">=</span><span class="n">force</span><span class="p">,</span> <span class="n">d</span><span class="o">=</span><span class="n">delete</span><span class="p">,</span>
                          <span class="n">i</span><span class="o">=</span><span class="n">inactive</span><span class="p">,</span> <span class="n">m</span><span class="o">=</span><span class="n">rename</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">rawcommand</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="hgclient.bookmarks"><a class="viewcode-back" href="../../../../../API/JumpScale.baselib.mercurial.hglib.html#JumpScale.baselib.mercurial.hglib.client.hgclient.bookmarks">[docs]</a>    <span class="k">def</span> <span class="nf">bookmarks</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the bookmarks as a list of (name, rev, node) and the index of the</span>
<span class="sd">        current one.</span>

<span class="sd">        If there isn&#39;t a current one, -1 is returned as the index.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rawcommand</span><span class="p">([</span><span class="s">&#39;bookmarks&#39;</span><span class="p">])</span>

        <span class="n">bms</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">current</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
        <span class="k">if</span> <span class="n">out</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span> <span class="o">!=</span> <span class="s">&#39;no bookmarks set&#39;</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">out</span><span class="o">.</span><span class="n">splitlines</span><span class="p">():</span>
                <span class="n">iscurrent</span><span class="p">,</span> <span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">],</span> <span class="n">line</span><span class="p">[</span><span class="mi">3</span><span class="p">:]</span>
                <span class="k">if</span> <span class="s">&#39;*&#39;</span> <span class="ow">in</span> <span class="n">iscurrent</span><span class="p">:</span>
                    <span class="n">current</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">bms</span><span class="p">)</span>
                <span class="n">name</span><span class="p">,</span> <span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39; &#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                <span class="n">rev</span><span class="p">,</span> <span class="n">node</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;:&#39;</span><span class="p">)</span>
                <span class="n">bms</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">name</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">rev</span><span class="p">),</span> <span class="n">node</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">bms</span><span class="p">,</span> <span class="n">current</span>
</div>
<div class="viewcode-block" id="hgclient.branch"><a class="viewcode-back" href="../../../../../API/JumpScale.baselib.mercurial.hglib.html#JumpScale.baselib.mercurial.hglib.client.hgclient.branch">[docs]</a>    <span class="k">def</span> <span class="nf">branch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">clean</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">force</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        When name isn&#39;t given, return the current branch name. Otherwise set the</span>
<span class="sd">        working directory branch name (the branch will not exist in the repository</span>
<span class="sd">        until the next commit). Standard practice recommends that primary</span>
<span class="sd">        development take place on the &#39;default&#39; branch.</span>

<span class="sd">        When clean is True, reset and return the working directory branch to that</span>
<span class="sd">        of the parent of the working directory, negating a previous branch change.</span>

<span class="sd">        name - new branch name</span>
<span class="sd">        clean - reset branch name to parent branch name</span>
<span class="sd">        force - set branch name even if it shadows an existing branch</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">name</span> <span class="ow">and</span> <span class="n">clean</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&#39;cannot use both name and clean&#39;</span><span class="p">)</span>

        <span class="n">args</span> <span class="o">=</span> <span class="n">cmdbuilder</span><span class="p">(</span><span class="s">&#39;branch&#39;</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">f</span><span class="o">=</span><span class="n">force</span><span class="p">,</span> <span class="n">C</span><span class="o">=</span><span class="n">clean</span><span class="p">)</span>
        <span class="n">out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rawcommand</span><span class="p">(</span><span class="n">args</span><span class="p">)</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">name</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">name</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="n">clean</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">out</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c"># len(&#39;reset working directory to branch &#39;) == 34</span>
            <span class="k">return</span> <span class="n">out</span><span class="p">[</span><span class="mi">34</span><span class="p">:]</span>
</div>
<div class="viewcode-block" id="hgclient.branches"><a class="viewcode-back" href="../../../../../API/JumpScale.baselib.mercurial.hglib.html#JumpScale.baselib.mercurial.hglib.client.hgclient.branches">[docs]</a>    <span class="k">def</span> <span class="nf">branches</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">active</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">closed</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the repository&#39;s named branches as a list of (name, rev, node).</span>

<span class="sd">        active - show only branches that have unmerged heads</span>
<span class="sd">        closed - show normal and closed branches</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">args</span> <span class="o">=</span> <span class="n">cmdbuilder</span><span class="p">(</span><span class="s">&#39;branches&#39;</span><span class="p">,</span> <span class="n">a</span><span class="o">=</span><span class="n">active</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">closed</span><span class="p">)</span>
        <span class="n">out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rawcommand</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>

        <span class="n">branches</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">out</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span><span class="o">.</span><span class="n">splitlines</span><span class="p">():</span>
            <span class="n">namerev</span><span class="p">,</span> <span class="n">node</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">rsplit</span><span class="p">(</span><span class="s">&#39;:&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">name</span><span class="p">,</span> <span class="n">rev</span> <span class="o">=</span> <span class="n">namerev</span><span class="o">.</span><span class="n">rsplit</span><span class="p">(</span><span class="s">&#39; &#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">name</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span>
            <span class="n">node</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span> <span class="c"># get rid of &#39; (inactive)&#39;</span>
            <span class="n">branches</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">name</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">rev</span><span class="p">),</span> <span class="n">node</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">branches</span>
</div>
<div class="viewcode-block" id="hgclient.bundle"><a class="viewcode-back" href="../../../../../API/JumpScale.baselib.mercurial.hglib.html#JumpScale.baselib.mercurial.hglib.client.hgclient.bundle">[docs]</a>    <span class="k">def</span> <span class="nf">bundle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">file</span><span class="p">,</span> <span class="n">destrepo</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">rev</span><span class="o">=</span><span class="p">[],</span> <span class="n">branch</span><span class="o">=</span><span class="p">[],</span> <span class="n">base</span><span class="o">=</span><span class="p">[],</span> <span class="nb">all</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
               <span class="n">force</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">ssh</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">remotecmd</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">insecure</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generate a compressed changegroup file collecting changesets not known to</span>
<span class="sd">        be in another repository.</span>

<span class="sd">        If destrepo isn&#39;t given, then hg assumes the destination will have all</span>
<span class="sd">        the nodes you specify with base. To create a bundle containing all</span>
<span class="sd">        changesets, use all (or set base to &#39;null&#39;).</span>

<span class="sd">        file - destination file name</span>
<span class="sd">        destrepo - repository to look for changes</span>
<span class="sd">        rev - a changeset intended to be added to the destination</span>
<span class="sd">        branch - a specific branch you would like to bundle</span>
<span class="sd">        base - a base changeset assumed to be available at the destination</span>
<span class="sd">        all - bundle all changesets in the repository</span>
<span class="sd">        type - bundle compression type to use, available compression methods are:</span>
<span class="sd">        none, bzip2, and gzip (default: bzip2)</span>

<span class="sd">        force - run even when the destrepo is unrelated</span>
<span class="sd">        ssh - specify ssh command to use</span>
<span class="sd">        remotecmd - specify hg command to run on the remote side</span>
<span class="sd">        insecure - do not verify server certificate (ignoring web.cacerts config)</span>

<span class="sd">        Return True if a bundle was created, False if no changes were found.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">args</span> <span class="o">=</span> <span class="n">cmdbuilder</span><span class="p">(</span><span class="s">&#39;bundle&#39;</span><span class="p">,</span> <span class="nb">file</span><span class="p">,</span> <span class="n">destrepo</span><span class="p">,</span> <span class="n">f</span><span class="o">=</span><span class="n">force</span><span class="p">,</span> <span class="n">r</span><span class="o">=</span><span class="n">rev</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="n">branch</span><span class="p">,</span>
                          <span class="n">base</span><span class="o">=</span><span class="n">base</span><span class="p">,</span> <span class="n">a</span><span class="o">=</span><span class="nb">all</span><span class="p">,</span> <span class="n">t</span><span class="o">=</span><span class="nb">type</span><span class="p">,</span> <span class="n">e</span><span class="o">=</span><span class="n">ssh</span><span class="p">,</span> <span class="n">remotecmd</span><span class="o">=</span><span class="n">remotecmd</span><span class="p">,</span>
                          <span class="n">insecure</span><span class="o">=</span><span class="n">insecure</span><span class="p">)</span>

        <span class="n">eh</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">reterrorhandler</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rawcommand</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">eh</span><span class="o">=</span><span class="n">eh</span><span class="p">)</span>

        <span class="k">return</span> <span class="nb">bool</span><span class="p">(</span><span class="n">eh</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="hgclient.cat"><a class="viewcode-back" href="../../../../../API/JumpScale.baselib.mercurial.hglib.html#JumpScale.baselib.mercurial.hglib.client.hgclient.cat">[docs]</a>    <span class="k">def</span> <span class="nf">cat</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">files</span><span class="p">,</span> <span class="n">rev</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">output</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return a string containing the specified files as they were at the</span>
<span class="sd">        given revision. If no revision is given, the parent of the working</span>
<span class="sd">        directory is used, or tip if no revision is checked out.</span>

<span class="sd">        If output is given, writes the contents to the specified file.</span>
<span class="sd">        The name of the file is given using a format string. The formatting rules</span>
<span class="sd">        are the same as for the export command, with the following additions:</span>

<span class="sd">        &quot;%s&quot;  basename of file being printed</span>
<span class="sd">        &quot;%d&quot;  dirname of file being printed, or &#39;.&#39; if in repository root</span>
<span class="sd">        &quot;%p&quot;  root-relative path name of file being printed</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">args</span> <span class="o">=</span> <span class="n">cmdbuilder</span><span class="p">(</span><span class="s">&#39;cat&#39;</span><span class="p">,</span> <span class="n">r</span><span class="o">=</span><span class="n">rev</span><span class="p">,</span> <span class="n">o</span><span class="o">=</span><span class="n">output</span><span class="p">,</span> <span class="o">*</span><span class="n">files</span><span class="p">)</span>
        <span class="n">out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rawcommand</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">output</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">out</span>
</div>
<div class="viewcode-block" id="hgclient.clone"><a class="viewcode-back" href="../../../../../API/JumpScale.baselib.mercurial.hglib.html#JumpScale.baselib.mercurial.hglib.client.hgclient.clone">[docs]</a>    <span class="k">def</span> <span class="nf">clone</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="s">&#39;.&#39;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">branch</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">updaterev</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
              <span class="n">revrange</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create a copy of an existing repository specified by source in a new</span>
<span class="sd">        directory dest.</span>

<span class="sd">        If dest isn&#39;t specified, it defaults to the basename of source.</span>

<span class="sd">        branch - clone only the specified branch</span>
<span class="sd">        updaterev - revision, tag or branch to check out</span>
<span class="sd">        revrange - include the specified changeset</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">args</span> <span class="o">=</span> <span class="n">cmdbuilder</span><span class="p">(</span><span class="s">&#39;clone&#39;</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">dest</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="n">branch</span><span class="p">,</span> <span class="n">u</span><span class="o">=</span><span class="n">updaterev</span><span class="p">,</span> <span class="n">r</span><span class="o">=</span><span class="n">revrange</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rawcommand</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="hgclient.commit"><a class="viewcode-back" href="../../../../../API/JumpScale.baselib.mercurial.hglib.html#JumpScale.baselib.mercurial.hglib.client.hgclient.commit">[docs]</a>    <span class="k">def</span> <span class="nf">commit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">logfile</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">addremove</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">closebranch</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
               <span class="n">date</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">user</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">include</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">exclude</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Commit changes reported by status into the repository.</span>

<span class="sd">        message - the commit message</span>
<span class="sd">        logfile - read commit message from file</span>
<span class="sd">        addremove - mark new/missing files as added/removed before committing</span>
<span class="sd">        closebranch - mark a branch as closed, hiding it from the branch list</span>
<span class="sd">        date - record the specified date as commit date</span>
<span class="sd">        user - record the specified user as committer</span>
<span class="sd">        include - include names matching the given patterns</span>
<span class="sd">        exclude - exclude names matching the given patterns</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">message</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">and</span> <span class="n">logfile</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;must provide at least a message or a logfile&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">message</span> <span class="ow">and</span> <span class="n">logfile</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;cannot specify both a message and a logfile&quot;</span><span class="p">)</span>

        <span class="c"># --debug will print the committed cset</span>
        <span class="n">args</span> <span class="o">=</span> <span class="n">cmdbuilder</span><span class="p">(</span><span class="s">&#39;commit&#39;</span><span class="p">,</span> <span class="n">debug</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">m</span><span class="o">=</span><span class="n">message</span><span class="p">,</span> <span class="n">A</span><span class="o">=</span><span class="n">addremove</span><span class="p">,</span>
                          <span class="n">close_branch</span><span class="o">=</span><span class="n">closebranch</span><span class="p">,</span> <span class="n">d</span><span class="o">=</span><span class="n">date</span><span class="p">,</span> <span class="n">u</span><span class="o">=</span><span class="n">user</span><span class="p">,</span> <span class="n">l</span><span class="o">=</span><span class="n">logfile</span><span class="p">,</span>
                          <span class="n">I</span><span class="o">=</span><span class="n">include</span><span class="p">,</span> <span class="n">X</span><span class="o">=</span><span class="n">exclude</span><span class="p">)</span>

        <span class="n">out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rawcommand</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
        <span class="n">rev</span><span class="p">,</span> <span class="n">node</span> <span class="o">=</span> <span class="n">out</span><span class="o">.</span><span class="n">splitlines</span><span class="p">()[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">rsplit</span><span class="p">(</span><span class="s">&#39;:&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">rev</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="o">-</span><span class="mi">1</span><span class="p">]),</span> <span class="n">node</span>
</div>
<div class="viewcode-block" id="hgclient.config"><a class="viewcode-back" href="../../../../../API/JumpScale.baselib.mercurial.hglib.html#JumpScale.baselib.mercurial.hglib.client.hgclient.config">[docs]</a>    <span class="k">def</span> <span class="nf">config</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">names</span><span class="o">=</span><span class="p">[],</span> <span class="n">untrusted</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">showsource</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return a list of (section, key, value) config settings from all hgrc files</span>

<span class="sd">        When showsource is specified, return (source, section, key, value) where</span>
<span class="sd">        source is of the form filename:[line]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">def</span> <span class="nf">splitline</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
            <span class="n">k</span><span class="p">,</span> <span class="n">value</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;=&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">section</span><span class="p">,</span> <span class="n">key</span> <span class="o">=</span> <span class="n">k</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;.&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="k">return</span> <span class="p">(</span><span class="n">section</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">names</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="n">names</span><span class="p">]</span>

        <span class="n">args</span> <span class="o">=</span> <span class="n">cmdbuilder</span><span class="p">(</span><span class="s">&#39;showconfig&#39;</span><span class="p">,</span> <span class="n">u</span><span class="o">=</span><span class="n">untrusted</span><span class="p">,</span> <span class="n">debug</span><span class="o">=</span><span class="n">showsource</span><span class="p">,</span> <span class="o">*</span><span class="n">names</span><span class="p">)</span>
        <span class="n">out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rawcommand</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>

        <span class="n">conf</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">showsource</span><span class="p">:</span>
            <span class="n">out</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">skiplines</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="s">&#39;read config from: &#39;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">out</span><span class="o">.</span><span class="n">splitlines</span><span class="p">():</span>
                <span class="n">m</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s">r&quot;(.+?:(?:\d+:)?) (.*)&quot;</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span>
                <span class="n">t</span> <span class="o">=</span> <span class="n">splitline</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>
                <span class="n">conf</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">t</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">t</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">out</span><span class="o">.</span><span class="n">splitlines</span><span class="p">():</span>
                <span class="n">conf</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">splitline</span><span class="p">(</span><span class="n">line</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">conf</span>
</div>
    <span class="nd">@property</span>
<div class="viewcode-block" id="hgclient.encoding"><a class="viewcode-back" href="../../../../../API/JumpScale.baselib.mercurial.hglib.html#JumpScale.baselib.mercurial.hglib.client.hgclient.encoding">[docs]</a>    <span class="k">def</span> <span class="nf">encoding</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the server&#39;s encoding (as reported in the hello message).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="s">&#39;getencoding&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">capabilities</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">CapabilityError</span><span class="p">(</span><span class="s">&#39;getencoding&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_encoding</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">stdin</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;getencoding</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_encoding</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_readfromchannel</span><span class="p">(</span><span class="s">&#39;r&#39;</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_encoding</span>
</div>
<div class="viewcode-block" id="hgclient.copy"><a class="viewcode-back" href="../../../../../API/JumpScale.baselib.mercurial.hglib.html#JumpScale.baselib.mercurial.hglib.client.hgclient.copy">[docs]</a>    <span class="k">def</span> <span class="nf">copy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">dest</span><span class="p">,</span> <span class="n">after</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">force</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">dryrun</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
             <span class="n">include</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">exclude</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Mark dest as having copies of source files. If dest is a directory, copies</span>
<span class="sd">        are put in that directory. If dest is a file, then source must be a string.</span>

<span class="sd">        Returns True on success, False if errors are encountered.</span>

<span class="sd">        source - a file or a list of files</span>
<span class="sd">        dest - a destination file or directory</span>
<span class="sd">        after - record a copy that has already occurred</span>
<span class="sd">        force - forcibly copy over an existing managed file</span>
<span class="sd">        dryrun - do not perform actions, just print output</span>
<span class="sd">        include - include names matching the given patterns</span>
<span class="sd">        exclude - exclude names matching the given patterns</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="n">source</span> <span class="o">=</span> <span class="p">[</span><span class="n">source</span><span class="p">]</span>

        <span class="n">source</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dest</span><span class="p">)</span>
        <span class="n">args</span> <span class="o">=</span> <span class="n">cmdbuilder</span><span class="p">(</span><span class="s">&#39;copy&#39;</span><span class="p">,</span> <span class="n">A</span><span class="o">=</span><span class="n">after</span><span class="p">,</span> <span class="n">f</span><span class="o">=</span><span class="n">force</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="n">dryrun</span><span class="p">,</span>
                          <span class="n">I</span><span class="o">=</span><span class="n">include</span><span class="p">,</span> <span class="n">X</span><span class="o">=</span><span class="n">exclude</span><span class="p">,</span> <span class="o">*</span><span class="n">source</span><span class="p">)</span>

        <span class="n">eh</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">reterrorhandler</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rawcommand</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">eh</span><span class="o">=</span><span class="n">eh</span><span class="p">)</span>

        <span class="k">return</span> <span class="nb">bool</span><span class="p">(</span><span class="n">eh</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="hgclient.diff"><a class="viewcode-back" href="../../../../../API/JumpScale.baselib.mercurial.hglib.html#JumpScale.baselib.mercurial.hglib.client.hgclient.diff">[docs]</a>    <span class="k">def</span> <span class="nf">diff</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">files</span><span class="o">=</span><span class="p">[],</span> <span class="n">revs</span><span class="o">=</span><span class="p">[],</span> <span class="n">change</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
             <span class="n">git</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">nodates</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">showfunction</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">reverse</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
             <span class="n">ignoreallspace</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">ignorespacechange</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">ignoreblanklines</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
             <span class="n">unified</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">stat</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">subrepos</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">include</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">exclude</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return differences between revisions for the specified files.</span>

<span class="sd">        revs - a revision or a list of two revisions to diff</span>
<span class="sd">        change - change made by revision</span>
<span class="sd">        text - treat all files as text</span>
<span class="sd">        git - use git extended diff format</span>
<span class="sd">        nodates - omit dates from diff headers</span>
<span class="sd">        showfunction - show which function each change is in</span>
<span class="sd">        reverse - produce a diff that undoes the changes</span>
<span class="sd">        ignoreallspace - ignore white space when comparing lines</span>
<span class="sd">        ignorespacechange - ignore changes in the amount of white space</span>
<span class="sd">        ignoreblanklines - ignore changes whose lines are all blank</span>
<span class="sd">        unified - number of lines of context to show</span>
<span class="sd">        stat - output diffstat-style summary of changes</span>
<span class="sd">        subrepos - recurse into subrepositories</span>
<span class="sd">        include - include names matching the given patterns</span>
<span class="sd">        exclude - exclude names matching the given patterns</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">change</span> <span class="ow">and</span> <span class="n">revs</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&#39;cannot specify both change and rev&#39;</span><span class="p">)</span>

        <span class="n">args</span> <span class="o">=</span> <span class="n">cmdbuilder</span><span class="p">(</span><span class="s">&#39;diff&#39;</span><span class="p">,</span> <span class="n">r</span><span class="o">=</span><span class="n">revs</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">change</span><span class="p">,</span>
                          <span class="n">a</span><span class="o">=</span><span class="n">text</span><span class="p">,</span> <span class="n">g</span><span class="o">=</span><span class="n">git</span><span class="p">,</span> <span class="n">nodates</span><span class="o">=</span><span class="n">nodates</span><span class="p">,</span>
                          <span class="n">p</span><span class="o">=</span><span class="n">showfunction</span><span class="p">,</span> <span class="n">reverse</span><span class="o">=</span><span class="n">reverse</span><span class="p">,</span>
                          <span class="n">w</span><span class="o">=</span><span class="n">ignoreallspace</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="n">ignorespacechange</span><span class="p">,</span>
                          <span class="n">B</span><span class="o">=</span><span class="n">ignoreblanklines</span><span class="p">,</span> <span class="n">U</span><span class="o">=</span><span class="n">unified</span><span class="p">,</span> <span class="n">stat</span><span class="o">=</span><span class="n">stat</span><span class="p">,</span>
                          <span class="n">S</span><span class="o">=</span><span class="n">subrepos</span><span class="p">,</span> <span class="n">I</span><span class="o">=</span><span class="n">include</span><span class="p">,</span> <span class="n">X</span><span class="o">=</span><span class="n">exclude</span><span class="p">,</span> <span class="o">*</span><span class="n">files</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">rawcommand</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="hgclient.export"><a class="viewcode-back" href="../../../../../API/JumpScale.baselib.mercurial.hglib.html#JumpScale.baselib.mercurial.hglib.client.hgclient.export">[docs]</a>    <span class="k">def</span> <span class="nf">export</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">revs</span><span class="p">,</span> <span class="n">output</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">switchparent</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">git</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
               <span class="n">nodates</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the header and diffs for one or more changesets. When output is</span>
<span class="sd">        given, dumps to file. The name of the file is given using a format string.</span>
<span class="sd">        The formatting rules are as follows:</span>

<span class="sd">        &quot;%%&quot;  literal &quot;%&quot; character</span>
<span class="sd">        &quot;%H&quot;  changeset hash (40 hexadecimal digits)</span>
<span class="sd">        &quot;%N&quot;  number of patches being generated</span>
<span class="sd">        &quot;%R&quot;  changeset revision number</span>
<span class="sd">        &quot;%b&quot;  basename of the exporting repository</span>
<span class="sd">        &quot;%h&quot;  short-form changeset hash (12 hexadecimal digits)</span>
<span class="sd">        &quot;%n&quot;  zero-padded sequence number, starting at 1</span>
<span class="sd">        &quot;%r&quot;  zero-padded changeset revision number</span>

<span class="sd">        output - print output to file with formatted name</span>
<span class="sd">        switchparent - diff against the second parent</span>
<span class="sd">        rev - a revision or list of revisions to export</span>
<span class="sd">        text - treat all files as text</span>
<span class="sd">        git - use git extended diff format</span>
<span class="sd">        nodates - omit dates from diff headers</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">revs</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="n">revs</span> <span class="o">=</span> <span class="p">[</span><span class="n">revs</span><span class="p">]</span>
        <span class="n">args</span> <span class="o">=</span> <span class="n">cmdbuilder</span><span class="p">(</span><span class="s">&#39;export&#39;</span><span class="p">,</span> <span class="n">o</span><span class="o">=</span><span class="n">output</span><span class="p">,</span> <span class="n">switch_parent</span><span class="o">=</span><span class="n">switchparent</span><span class="p">,</span>
                          <span class="n">a</span><span class="o">=</span><span class="n">text</span><span class="p">,</span> <span class="n">g</span><span class="o">=</span><span class="n">git</span><span class="p">,</span> <span class="n">nodates</span><span class="o">=</span><span class="n">nodates</span><span class="p">,</span> <span class="o">*</span><span class="n">revs</span><span class="p">)</span>

        <span class="n">out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rawcommand</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">output</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">out</span>
</div>
<div class="viewcode-block" id="hgclient.forget"><a class="viewcode-back" href="../../../../../API/JumpScale.baselib.mercurial.hglib.html#JumpScale.baselib.mercurial.hglib.client.hgclient.forget">[docs]</a>    <span class="k">def</span> <span class="nf">forget</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">files</span><span class="p">,</span> <span class="n">include</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">exclude</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Mark the specified files so they will no longer be tracked after the next</span>
<span class="sd">        commit.</span>

<span class="sd">        This only removes files from the current branch, not from the entire</span>
<span class="sd">        project history, and it does not delete them from the working directory.</span>

<span class="sd">        Returns True on success.</span>

<span class="sd">        include - include names matching the given patterns</span>
<span class="sd">        exclude - exclude names matching the given patterns</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">files</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="n">files</span> <span class="o">=</span> <span class="p">[</span><span class="n">files</span><span class="p">]</span>

        <span class="n">args</span> <span class="o">=</span> <span class="n">cmdbuilder</span><span class="p">(</span><span class="s">&#39;forget&#39;</span><span class="p">,</span> <span class="n">I</span><span class="o">=</span><span class="n">include</span><span class="p">,</span> <span class="n">X</span><span class="o">=</span><span class="n">exclude</span><span class="p">,</span> <span class="o">*</span><span class="n">files</span><span class="p">)</span>

        <span class="n">eh</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">reterrorhandler</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rawcommand</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">eh</span><span class="o">=</span><span class="n">eh</span><span class="p">)</span>

        <span class="k">return</span> <span class="nb">bool</span><span class="p">(</span><span class="n">eh</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="hgclient.grep"><a class="viewcode-back" href="../../../../../API/JumpScale.baselib.mercurial.hglib.html#JumpScale.baselib.mercurial.hglib.client.hgclient.grep">[docs]</a>    <span class="k">def</span> <span class="nf">grep</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pattern</span><span class="p">,</span> <span class="n">files</span><span class="o">=</span><span class="p">[],</span> <span class="nb">all</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">follow</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
             <span class="n">ignorecase</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">fileswithmatches</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">line</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">user</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
             <span class="n">date</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">include</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">exclude</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Search for a pattern in specified files and revisions.</span>

<span class="sd">        This behaves differently than Unix grep. It only accepts Python/Perl</span>
<span class="sd">        regexps. It searches repository history, not the working directory.</span>
<span class="sd">        It always prints the revision number in which a match appears.</span>

<span class="sd">        Yields (filename, revision, [line, [match status, [user, [date, [match]]]]])</span>
<span class="sd">        per match depending on the given options.</span>

<span class="sd">        all - print all revisions that match</span>
<span class="sd">        text - treat all files as text</span>
<span class="sd">        follow - follow changeset history, or file history across copies and renames</span>
<span class="sd">        ignorecase - ignore case when matching</span>
<span class="sd">        fileswithmatches - return only filenames and revisions that match</span>
<span class="sd">        line - return line numbers in the result tuple</span>
<span class="sd">        user - return the author in the result tuple</span>
<span class="sd">        date - return the date in the result tuple</span>
<span class="sd">        include - include names matching the given patterns</span>
<span class="sd">        exclude - exclude names matching the given patterns</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">files</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="n">files</span> <span class="o">=</span> <span class="p">[</span><span class="n">files</span><span class="p">]</span>

        <span class="n">args</span> <span class="o">=</span> <span class="n">cmdbuilder</span><span class="p">(</span><span class="s">&#39;grep&#39;</span><span class="p">,</span> <span class="nb">all</span><span class="o">=</span><span class="nb">all</span><span class="p">,</span> <span class="n">a</span><span class="o">=</span><span class="n">text</span><span class="p">,</span> <span class="n">f</span><span class="o">=</span><span class="n">follow</span><span class="p">,</span> <span class="n">i</span><span class="o">=</span><span class="n">ignorecase</span><span class="p">,</span>
                          <span class="n">l</span><span class="o">=</span><span class="n">fileswithmatches</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="n">line</span><span class="p">,</span> <span class="n">u</span><span class="o">=</span><span class="n">user</span><span class="p">,</span> <span class="n">d</span><span class="o">=</span><span class="n">date</span><span class="p">,</span>
                          <span class="n">I</span><span class="o">=</span><span class="n">include</span><span class="p">,</span> <span class="n">X</span><span class="o">=</span><span class="n">exclude</span><span class="p">,</span> <span class="o">*</span><span class="p">[</span><span class="n">pattern</span><span class="p">]</span> <span class="o">+</span> <span class="n">files</span><span class="p">)</span>
        <span class="n">args</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;-0&#39;</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">eh</span><span class="p">(</span><span class="n">ret</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">err</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">ret</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">error</span><span class="o">.</span><span class="n">CommandError</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">ret</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">err</span><span class="p">)</span>
            <span class="k">return</span> <span class="s">&#39;&#39;</span>

        <span class="n">out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rawcommand</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">eh</span><span class="o">=</span><span class="n">eh</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\0</span><span class="s">&#39;</span><span class="p">)</span>

        <span class="n">fieldcount</span> <span class="o">=</span> <span class="mi">3</span>
        <span class="k">if</span> <span class="n">user</span><span class="p">:</span>
            <span class="n">fieldcount</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">date</span><span class="p">:</span>
            <span class="n">fieldcount</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">line</span><span class="p">:</span>
            <span class="n">fieldcount</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="nb">all</span><span class="p">:</span>
            <span class="n">fieldcount</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">fileswithmatches</span><span class="p">:</span>
            <span class="n">fieldcount</span> <span class="o">-=</span> <span class="mi">1</span>

        <span class="k">return</span> <span class="n">util</span><span class="o">.</span><span class="n">grouper</span><span class="p">(</span><span class="n">fieldcount</span><span class="p">,</span> <span class="n">out</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="hgclient.heads"><a class="viewcode-back" href="../../../../../API/JumpScale.baselib.mercurial.hglib.html#JumpScale.baselib.mercurial.hglib.client.hgclient.heads">[docs]</a>    <span class="k">def</span> <span class="nf">heads</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rev</span><span class="o">=</span><span class="p">[],</span> <span class="n">startrev</span><span class="o">=</span><span class="p">[],</span> <span class="n">topological</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">closed</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return a list of current repository heads or branch heads.</span>

<span class="sd">        rev - return only branch heads on the branches associated with the specified</span>
<span class="sd">        changesets.</span>

<span class="sd">        startrev - return only heads which are descendants of the given revs.</span>
<span class="sd">        topological - named branch mechanics will be ignored and only changesets</span>
<span class="sd">        without children will be shown.</span>

<span class="sd">        closed - normal and closed branch heads.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">rev</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="n">rev</span> <span class="o">=</span> <span class="p">[</span><span class="n">rev</span><span class="p">]</span>

        <span class="n">args</span> <span class="o">=</span> <span class="n">cmdbuilder</span><span class="p">(</span><span class="s">&#39;heads&#39;</span><span class="p">,</span> <span class="n">r</span><span class="o">=</span><span class="n">startrev</span><span class="p">,</span> <span class="n">t</span><span class="o">=</span><span class="n">topological</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">closed</span><span class="p">,</span>
                          <span class="n">template</span><span class="o">=</span><span class="n">templates</span><span class="o">.</span><span class="n">changeset</span><span class="p">,</span> <span class="o">*</span><span class="n">rev</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">eh</span><span class="p">(</span><span class="n">ret</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">err</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">ret</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">error</span><span class="o">.</span><span class="n">CommandError</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">ret</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">err</span><span class="p">)</span>
            <span class="k">return</span> <span class="s">&#39;&#39;</span>

        <span class="n">out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rawcommand</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">eh</span><span class="o">=</span><span class="n">eh</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\0</span><span class="s">&#39;</span><span class="p">)[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parserevs</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="hgclient.identify"><a class="viewcode-back" href="../../../../../API/JumpScale.baselib.mercurial.hglib.html#JumpScale.baselib.mercurial.hglib.client.hgclient.identify">[docs]</a>    <span class="k">def</span> <span class="nf">identify</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rev</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">num</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">branch</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
                 <span class="n">tags</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">bookmarks</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return a summary string identifying the repository state at rev using one or</span>
<span class="sd">        two parent hash identifiers, followed by a &quot;+&quot; if the working directory has</span>
<span class="sd">        uncommitted changes, the branch name (if not default), a list of tags, and</span>
<span class="sd">        a list of bookmarks.</span>

<span class="sd">        When rev is not given, return a summary string of the current state of the</span>
<span class="sd">        repository.</span>

<span class="sd">        Specifying source as a repository root or Mercurial bundle will cause</span>
<span class="sd">        lookup to operate on that repository/bundle.</span>

<span class="sd">        num - show local revision number</span>
<span class="sd">        id - show global revision id</span>
<span class="sd">        branch - show branch</span>
<span class="sd">        tags - show tags</span>
<span class="sd">        bookmarks - show bookmarks</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">args</span> <span class="o">=</span> <span class="n">cmdbuilder</span><span class="p">(</span><span class="s">&#39;identify&#39;</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">r</span><span class="o">=</span><span class="n">rev</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="n">num</span><span class="p">,</span> <span class="n">i</span><span class="o">=</span><span class="nb">id</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="n">branch</span><span class="p">,</span> <span class="n">t</span><span class="o">=</span><span class="n">tags</span><span class="p">,</span>
                          <span class="n">B</span><span class="o">=</span><span class="n">bookmarks</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">rawcommand</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="hgclient.import_"><a class="viewcode-back" href="../../../../../API/JumpScale.baselib.mercurial.hglib.html#JumpScale.baselib.mercurial.hglib.client.hgclient.import_">[docs]</a>    <span class="k">def</span> <span class="nf">import_</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">patches</span><span class="p">,</span> <span class="n">strip</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">force</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">nocommit</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
                <span class="n">bypass</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">exact</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">importbranch</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">message</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                <span class="n">date</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">user</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">similarity</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Import the specified patches which can be a list of file names or a</span>
<span class="sd">        file-like object and commit them individually (unless nocommit is</span>
<span class="sd">        specified).</span>

<span class="sd">        strip - directory strip option for patch. This has the same meaning as the</span>
<span class="sd">        corresponding patch option (default: 1)</span>

<span class="sd">        force - skip check for outstanding uncommitted changes</span>
<span class="sd">        nocommit - don&#39;t commit, just update the working directory</span>
<span class="sd">        bypass - apply patch without touching the working directory</span>
<span class="sd">        exact - apply patch to the nodes from which it was generated</span>
<span class="sd">        importbranch - use any branch information in patch (implied by exact)</span>
<span class="sd">        message - the commit message</span>
<span class="sd">        date - record the specified date as commit date</span>
<span class="sd">        user - record the specified user as committer</span>
<span class="sd">        similarity - guess renamed files by similarity (0&lt;=s&lt;=100)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">patches</span><span class="p">,</span> <span class="s">&#39;read&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">patches</span><span class="p">,</span> <span class="s">&#39;readline&#39;</span><span class="p">):</span>
            <span class="n">patch</span> <span class="o">=</span> <span class="n">patches</span>

            <span class="k">def</span> <span class="nf">readline</span><span class="p">(</span><span class="n">size</span><span class="p">,</span> <span class="n">output</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">patch</span><span class="o">.</span><span class="n">readline</span><span class="p">(</span><span class="n">size</span><span class="p">)</span>

            <span class="n">stdin</span> <span class="o">=</span> <span class="bp">True</span>
            <span class="n">patches</span> <span class="o">=</span> <span class="p">()</span>
            <span class="n">prompt</span> <span class="o">=</span> <span class="n">readline</span>
            <span class="nb">input</span> <span class="o">=</span> <span class="n">patch</span><span class="o">.</span><span class="n">read</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">stdin</span> <span class="o">=</span> <span class="bp">False</span>
            <span class="n">prompt</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="nb">input</span> <span class="o">=</span> <span class="bp">None</span>

        <span class="n">args</span> <span class="o">=</span> <span class="n">cmdbuilder</span><span class="p">(</span><span class="s">&#39;import&#39;</span><span class="p">,</span> <span class="n">strip</span><span class="o">=</span><span class="n">strip</span><span class="p">,</span> <span class="n">force</span><span class="o">=</span><span class="n">force</span><span class="p">,</span>
                          <span class="n">no_commit</span><span class="o">=</span><span class="n">nocommit</span><span class="p">,</span> <span class="n">bypass</span><span class="o">=</span><span class="n">bypass</span><span class="p">,</span> <span class="n">exact</span><span class="o">=</span><span class="n">exact</span><span class="p">,</span>
                          <span class="n">import_branch</span><span class="o">=</span><span class="n">importbranch</span><span class="p">,</span> <span class="n">message</span><span class="o">=</span><span class="n">message</span><span class="p">,</span>
                          <span class="n">date</span><span class="o">=</span><span class="n">date</span><span class="p">,</span> <span class="n">user</span><span class="o">=</span><span class="n">user</span><span class="p">,</span> <span class="n">similarity</span><span class="o">=</span><span class="n">similarity</span><span class="p">,</span> <span class="n">_</span><span class="o">=</span><span class="n">stdin</span><span class="p">,</span>
                          <span class="o">*</span><span class="n">patches</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">rawcommand</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">prompt</span><span class="o">=</span><span class="n">prompt</span><span class="p">,</span> <span class="nb">input</span><span class="o">=</span><span class="nb">input</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="hgclient.incoming"><a class="viewcode-back" href="../../../../../API/JumpScale.baselib.mercurial.hglib.html#JumpScale.baselib.mercurial.hglib.client.hgclient.incoming">[docs]</a>    <span class="k">def</span> <span class="nf">incoming</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">revrange</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">force</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">newest</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
                 <span class="n">bundle</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">bookmarks</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">branch</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">limit</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                 <span class="n">nomerges</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">subrepos</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return new changesets found in the specified path or the default pull</span>
<span class="sd">        location.</span>

<span class="sd">        When bookmarks=True, return a list of (name, node) of incoming bookmarks.</span>

<span class="sd">        revrange - a remote changeset or list of changesets intended to be added</span>
<span class="sd">        force - run even if remote repository is unrelated</span>
<span class="sd">        newest - show newest record first</span>
<span class="sd">        bundle - avoid downloading the changesets twice and store the bundles into</span>
<span class="sd">        the specified file.</span>

<span class="sd">        bookmarks - compare bookmarks (this changes the return value)</span>
<span class="sd">        branch - a specific branch you would like to pull</span>
<span class="sd">        limit - limit number of changes returned</span>
<span class="sd">        nomerges - do not show merges</span>
<span class="sd">        ssh - specify ssh command to use</span>
<span class="sd">        remotecmd - specify hg command to run on the remote side</span>
<span class="sd">        insecure- do not verify server certificate (ignoring web.cacerts config)</span>
<span class="sd">        subrepos - recurse into subrepositories</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">args</span> <span class="o">=</span> <span class="n">cmdbuilder</span><span class="p">(</span><span class="s">&#39;incoming&#39;</span><span class="p">,</span>
                          <span class="n">path</span><span class="p">,</span>
                          <span class="n">template</span><span class="o">=</span><span class="n">templates</span><span class="o">.</span><span class="n">changeset</span><span class="p">,</span> <span class="n">r</span><span class="o">=</span><span class="n">revrange</span><span class="p">,</span>
                          <span class="n">f</span><span class="o">=</span><span class="n">force</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="n">newest</span><span class="p">,</span> <span class="n">bundle</span><span class="o">=</span><span class="n">bundle</span><span class="p">,</span>
                          <span class="n">B</span><span class="o">=</span><span class="n">bookmarks</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="n">branch</span><span class="p">,</span> <span class="n">l</span><span class="o">=</span><span class="n">limit</span><span class="p">,</span> <span class="n">M</span><span class="o">=</span><span class="n">nomerges</span><span class="p">,</span> <span class="n">S</span><span class="o">=</span><span class="n">subrepos</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">eh</span><span class="p">(</span><span class="n">ret</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">err</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">ret</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">error</span><span class="o">.</span><span class="n">CommandError</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">ret</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">err</span><span class="p">)</span>

        <span class="n">out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rawcommand</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">eh</span><span class="o">=</span><span class="n">eh</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">out</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[]</span>

        <span class="n">out</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">eatlines</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">bookmarks</span><span class="p">:</span>
            <span class="n">bms</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">out</span><span class="o">.</span><span class="n">splitlines</span><span class="p">():</span>
                <span class="n">bms</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()))</span>
            <span class="k">return</span> <span class="n">bms</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">out</span> <span class="o">=</span> <span class="n">out</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\0</span><span class="s">&#39;</span><span class="p">)[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parserevs</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="hgclient.log"><a class="viewcode-back" href="../../../../../API/JumpScale.baselib.mercurial.hglib.html#JumpScale.baselib.mercurial.hglib.client.hgclient.log">[docs]</a>    <span class="k">def</span> <span class="nf">log</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">revrange</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">files</span><span class="o">=</span><span class="p">[],</span> <span class="n">follow</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">followfirst</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
            <span class="n">date</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">copies</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">keyword</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">removed</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">onlymerges</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
            <span class="n">user</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">branch</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">prune</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">hidden</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">limit</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
            <span class="n">nomerges</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">include</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">exclude</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the revision history of the specified files or the entire project.</span>

<span class="sd">        File history is shown without following rename or copy history of files.</span>
<span class="sd">        Use follow with a filename to follow history across renames and copies.</span>
<span class="sd">        follow without a filename will only show ancestors or descendants of the</span>
<span class="sd">        starting revision. followfirst only follows the first parent of merge</span>
<span class="sd">        revisions.</span>

<span class="sd">        If revrange isn&#39;t specified, the default is &quot;tip:0&quot; unless follow is set,</span>
<span class="sd">        in which case the working directory parent is used as the starting</span>
<span class="sd">        revision.</span>

<span class="sd">        The returned changeset is a named tuple with the following string fields:</span>
<span class="sd">            - rev</span>
<span class="sd">            - node</span>
<span class="sd">            - tags (space delimited)</span>
<span class="sd">            - branch</span>
<span class="sd">            - author</span>
<span class="sd">            - desc</span>

<span class="sd">        follow - follow changeset history, or file history across copies and renames</span>
<span class="sd">        followfirst - only follow the first parent of merge changesets</span>
<span class="sd">        date - show revisions matching date spec</span>
<span class="sd">        copies - show copied files</span>
<span class="sd">        keyword - do case-insensitive search for a given text</span>
<span class="sd">        removed - include revisions where files were removed</span>
<span class="sd">        onlymerges - show only merges</span>
<span class="sd">        user - revisions committed by user</span>
<span class="sd">        branch - show changesets within the given named branch</span>
<span class="sd">        prune - do not display revision or any of its ancestors</span>
<span class="sd">        hidden - show hidden changesets</span>
<span class="sd">        limit - limit number of changes displayed</span>
<span class="sd">        nomerges - do not show merges</span>
<span class="sd">        include - include names matching the given patterns</span>
<span class="sd">        exclude - exclude names matching the given patterns</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">args</span> <span class="o">=</span> <span class="n">cmdbuilder</span><span class="p">(</span><span class="s">&#39;log&#39;</span><span class="p">,</span> <span class="n">template</span><span class="o">=</span><span class="n">templates</span><span class="o">.</span><span class="n">changeset</span><span class="p">,</span>
                          <span class="n">r</span><span class="o">=</span><span class="n">revrange</span><span class="p">,</span> <span class="n">f</span><span class="o">=</span><span class="n">follow</span><span class="p">,</span> <span class="n">follow_first</span><span class="o">=</span><span class="n">followfirst</span><span class="p">,</span>
                          <span class="n">d</span><span class="o">=</span><span class="n">date</span><span class="p">,</span> <span class="n">C</span><span class="o">=</span><span class="n">copies</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="n">keyword</span><span class="p">,</span> <span class="n">removed</span><span class="o">=</span><span class="n">removed</span><span class="p">,</span>
                          <span class="n">m</span><span class="o">=</span><span class="n">onlymerges</span><span class="p">,</span> <span class="n">u</span><span class="o">=</span><span class="n">user</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="n">branch</span><span class="p">,</span> <span class="n">P</span><span class="o">=</span><span class="n">prune</span><span class="p">,</span> <span class="n">h</span><span class="o">=</span><span class="n">hidden</span><span class="p">,</span>
                          <span class="n">l</span><span class="o">=</span><span class="n">limit</span><span class="p">,</span> <span class="n">M</span><span class="o">=</span><span class="n">nomerges</span><span class="p">,</span> <span class="n">I</span><span class="o">=</span><span class="n">include</span><span class="p">,</span> <span class="n">X</span><span class="o">=</span><span class="n">exclude</span><span class="p">,</span> <span class="o">*</span><span class="n">files</span><span class="p">)</span>

        <span class="n">out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rawcommand</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
        <span class="n">out</span> <span class="o">=</span> <span class="n">out</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\0</span><span class="s">&#39;</span><span class="p">)[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parserevs</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="hgclient.manifest"><a class="viewcode-back" href="../../../../../API/JumpScale.baselib.mercurial.hglib.html#JumpScale.baselib.mercurial.hglib.client.hgclient.manifest">[docs]</a>    <span class="k">def</span> <span class="nf">manifest</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rev</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="nb">all</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Yields (nodeid, permission, executable, symlink, file path) tuples for</span>
<span class="sd">        version controlled files for the given revision. If no revision is given,</span>
<span class="sd">        the first parent of the working directory is used, or the null revision if</span>
<span class="sd">        no revision is checked out.</span>

<span class="sd">        When all is True, all files from all revisions are yielded (just the name).</span>
<span class="sd">        This includes deleted and renamed files.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">args</span> <span class="o">=</span> <span class="n">cmdbuilder</span><span class="p">(</span><span class="s">&#39;manifest&#39;</span><span class="p">,</span> <span class="n">r</span><span class="o">=</span><span class="n">rev</span><span class="p">,</span> <span class="nb">all</span><span class="o">=</span><span class="nb">all</span><span class="p">,</span> <span class="n">debug</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

        <span class="n">out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rawcommand</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">all</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">out</span><span class="o">.</span><span class="n">splitlines</span><span class="p">():</span>
                <span class="k">yield</span> <span class="n">line</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">out</span><span class="o">.</span><span class="n">splitlines</span><span class="p">():</span>
                <span class="n">node</span> <span class="o">=</span> <span class="n">line</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">40</span><span class="p">]</span>
                <span class="n">perm</span> <span class="o">=</span> <span class="n">line</span><span class="p">[</span><span class="mi">41</span><span class="p">:</span><span class="mi">44</span><span class="p">]</span>
                <span class="n">symlink</span> <span class="o">=</span> <span class="n">line</span><span class="p">[</span><span class="mi">45</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;@&#39;</span>
                <span class="n">executable</span> <span class="o">=</span> <span class="n">line</span><span class="p">[</span><span class="mi">45</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;*&#39;</span>
                <span class="k">yield</span> <span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">perm</span><span class="p">,</span> <span class="n">executable</span><span class="p">,</span> <span class="n">symlink</span><span class="p">,</span> <span class="n">line</span><span class="p">[</span><span class="mi">47</span><span class="p">:])</span>
</div>
<div class="viewcode-block" id="hgclient.merge"><a class="viewcode-back" href="../../../../../API/JumpScale.baselib.mercurial.hglib.html#JumpScale.baselib.mercurial.hglib.client.hgclient.merge">[docs]</a>    <span class="k">def</span> <span class="nf">merge</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rev</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">force</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">tool</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">cb</span><span class="o">=</span><span class="n">merge</span><span class="o">.</span><span class="n">handlers</span><span class="o">.</span><span class="n">abort</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Merge working directory with rev. If no revision is specified, the working</span>
<span class="sd">        directory&#39;s parent is a head revision, and the current branch contains</span>
<span class="sd">        exactly one other head, the other head is merged with by default.</span>

<span class="sd">        The current working directory is updated with all changes made in the</span>
<span class="sd">        requested revision since the last common predecessor revision.</span>

<span class="sd">        Files that changed between either parent are marked as changed for the</span>
<span class="sd">        next commit and a commit must be performed before any further updates to</span>
<span class="sd">        the repository are allowed. The next commit will have two parents.</span>

<span class="sd">        force - force a merge with outstanding changes</span>
<span class="sd">        tool - can be used to specify the merge tool used for file merges. It</span>
<span class="sd">        overrides the HGMERGE environment variable and your configuration files.</span>

<span class="sd">        cb - controls the behaviour when Mercurial prompts what to do with regard</span>
<span class="sd">        to a specific file, e.g. when one parent modified a file and the other</span>
<span class="sd">        removed it. It can be one of merge.handlers, or a function that gets a</span>
<span class="sd">        single argument which are the contents of stdout. It should return one</span>
<span class="sd">        of the expected choices (a single character).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c"># we can&#39;t really use --preview since merge doesn&#39;t support --template</span>
        <span class="n">args</span> <span class="o">=</span> <span class="n">cmdbuilder</span><span class="p">(</span><span class="s">&#39;merge&#39;</span><span class="p">,</span> <span class="n">r</span><span class="o">=</span><span class="n">rev</span><span class="p">,</span> <span class="n">f</span><span class="o">=</span><span class="n">force</span><span class="p">,</span> <span class="n">t</span><span class="o">=</span><span class="n">tool</span><span class="p">)</span>

        <span class="n">prompt</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="k">if</span> <span class="n">cb</span> <span class="ow">is</span> <span class="n">merge</span><span class="o">.</span><span class="n">handlers</span><span class="o">.</span><span class="n">abort</span><span class="p">:</span>
            <span class="n">prompt</span> <span class="o">=</span> <span class="n">cb</span>
        <span class="k">elif</span> <span class="n">cb</span> <span class="ow">is</span> <span class="n">merge</span><span class="o">.</span><span class="n">handlers</span><span class="o">.</span><span class="n">noninteractive</span><span class="p">:</span>
            <span class="n">args</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;-y&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">prompt</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">size</span><span class="p">,</span> <span class="n">output</span><span class="p">:</span> <span class="n">cb</span><span class="p">(</span><span class="n">output</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">rawcommand</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">prompt</span><span class="o">=</span><span class="n">prompt</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="hgclient.move"><a class="viewcode-back" href="../../../../../API/JumpScale.baselib.mercurial.hglib.html#JumpScale.baselib.mercurial.hglib.client.hgclient.move">[docs]</a>    <span class="k">def</span> <span class="nf">move</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">dest</span><span class="p">,</span> <span class="n">after</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">force</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">dryrun</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
             <span class="n">include</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">exclude</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Mark dest as copies of source; mark source for deletion. If dest is a</span>
<span class="sd">        directory, copies are put in that directory. If dest is a file, then source</span>
<span class="sd">        must be a string.</span>

<span class="sd">        Returns True on success, False if errors are encountered.</span>

<span class="sd">        source - a file or a list of files</span>
<span class="sd">        dest - a destination file or directory</span>
<span class="sd">        after - record a rename that has already occurred</span>
<span class="sd">        force - forcibly copy over an existing managed file</span>
<span class="sd">        dryrun - do not perform actions, just print output</span>
<span class="sd">        include - include names matching the given patterns</span>
<span class="sd">        exclude - exclude names matching the given patterns</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="n">source</span> <span class="o">=</span> <span class="p">[</span><span class="n">source</span><span class="p">]</span>

        <span class="n">source</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dest</span><span class="p">)</span>
        <span class="n">args</span> <span class="o">=</span> <span class="n">cmdbuilder</span><span class="p">(</span><span class="s">&#39;move&#39;</span><span class="p">,</span> <span class="n">A</span><span class="o">=</span><span class="n">after</span><span class="p">,</span> <span class="n">f</span><span class="o">=</span><span class="n">force</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="n">dryrun</span><span class="p">,</span>
                          <span class="n">I</span><span class="o">=</span><span class="n">include</span><span class="p">,</span> <span class="n">X</span><span class="o">=</span><span class="n">exclude</span><span class="p">,</span> <span class="o">*</span><span class="n">source</span><span class="p">)</span>

        <span class="n">eh</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">reterrorhandler</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rawcommand</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">eh</span><span class="o">=</span><span class="n">eh</span><span class="p">)</span>

        <span class="k">return</span> <span class="nb">bool</span><span class="p">(</span><span class="n">eh</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="hgclient.outgoing"><a class="viewcode-back" href="../../../../../API/JumpScale.baselib.mercurial.hglib.html#JumpScale.baselib.mercurial.hglib.client.hgclient.outgoing">[docs]</a>    <span class="k">def</span> <span class="nf">outgoing</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">revrange</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">force</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">newest</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
                 <span class="n">bookmarks</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">branch</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">limit</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">nomerges</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
                 <span class="n">subrepos</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return changesets not found in the specified path or the default push</span>
<span class="sd">        location.</span>

<span class="sd">        When bookmarks=True, return a list of (name, node) of bookmarks that will</span>
<span class="sd">        be pushed.</span>

<span class="sd">        revrange - a (list of) changeset intended to be included in the destination</span>
<span class="sd">        force - run even when the destination is unrelated</span>
<span class="sd">        newest - show newest record first</span>
<span class="sd">        branch - a specific branch you would like to push</span>
<span class="sd">        limit - limit number of changes displayed</span>
<span class="sd">        nomerges - do not show merges</span>
<span class="sd">        ssh - specify ssh command to use</span>
<span class="sd">        remotecmd - specify hg command to run on the remote side</span>
<span class="sd">        insecure - do not verify server certificate (ignoring web.cacerts config)</span>
<span class="sd">        subrepos - recurse into subrepositories</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">args</span> <span class="o">=</span> <span class="n">cmdbuilder</span><span class="p">(</span><span class="s">&#39;outgoing&#39;</span><span class="p">,</span>
                          <span class="n">path</span><span class="p">,</span>
                          <span class="n">template</span><span class="o">=</span><span class="n">templates</span><span class="o">.</span><span class="n">changeset</span><span class="p">,</span> <span class="n">r</span><span class="o">=</span><span class="n">revrange</span><span class="p">,</span>
                          <span class="n">f</span><span class="o">=</span><span class="n">force</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="n">newest</span><span class="p">,</span> <span class="n">B</span><span class="o">=</span><span class="n">bookmarks</span><span class="p">,</span>
                          <span class="n">b</span><span class="o">=</span><span class="n">branch</span><span class="p">,</span> <span class="n">S</span><span class="o">=</span><span class="n">subrepos</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">eh</span><span class="p">(</span><span class="n">ret</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">err</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">ret</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">error</span><span class="o">.</span><span class="n">CommandError</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">ret</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">err</span><span class="p">)</span>

        <span class="n">out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rawcommand</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">eh</span><span class="o">=</span><span class="n">eh</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">out</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[]</span>

        <span class="n">out</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">eatlines</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">bookmarks</span><span class="p">:</span>
            <span class="n">bms</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">out</span><span class="o">.</span><span class="n">splitlines</span><span class="p">():</span>
                <span class="n">bms</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()))</span>
            <span class="k">return</span> <span class="n">bms</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">out</span> <span class="o">=</span> <span class="n">out</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\0</span><span class="s">&#39;</span><span class="p">)[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parserevs</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="hgclient.parents"><a class="viewcode-back" href="../../../../../API/JumpScale.baselib.mercurial.hglib.html#JumpScale.baselib.mercurial.hglib.client.hgclient.parents">[docs]</a>    <span class="k">def</span> <span class="nf">parents</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rev</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="nb">file</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the working directory&#39;s parent revisions. If rev is given, the</span>
<span class="sd">        parent of that revision will be printed. If file is given, the revision</span>
<span class="sd">        in which the file was last changed (before the working directory revision</span>
<span class="sd">        or the revision specified by rev) is returned.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">args</span> <span class="o">=</span> <span class="n">cmdbuilder</span><span class="p">(</span><span class="s">&#39;parents&#39;</span><span class="p">,</span> <span class="nb">file</span><span class="p">,</span> <span class="n">template</span><span class="o">=</span><span class="n">templates</span><span class="o">.</span><span class="n">changeset</span><span class="p">,</span> <span class="n">r</span><span class="o">=</span><span class="n">rev</span><span class="p">)</span>

        <span class="n">out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rawcommand</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">out</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="n">out</span> <span class="o">=</span> <span class="n">out</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\0</span><span class="s">&#39;</span><span class="p">)[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parserevs</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="hgclient.paths"><a class="viewcode-back" href="../../../../../API/JumpScale.baselib.mercurial.hglib.html#JumpScale.baselib.mercurial.hglib.client.hgclient.paths">[docs]</a>    <span class="k">def</span> <span class="nf">paths</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the definition of given symbolic path name. If no name is given,</span>
<span class="sd">        return a dictionary of pathname : url of all available names.</span>

<span class="sd">        Path names are defined in the [paths] section of your configuration file</span>
<span class="sd">        and in &quot;/etc/mercurial/hgrc&quot;. If run inside a repository, &quot;.hg/hgrc&quot; is</span>
<span class="sd">        used, too.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">name</span><span class="p">:</span>
            <span class="n">out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rawcommand</span><span class="p">([</span><span class="s">&#39;paths&#39;</span><span class="p">])</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">out</span><span class="p">:</span>
                <span class="k">return</span> <span class="p">{}</span>

            <span class="k">return</span> <span class="nb">dict</span><span class="p">([</span><span class="n">s</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39; = &#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">out</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">args</span> <span class="o">=</span> <span class="n">cmdbuilder</span><span class="p">(</span><span class="s">&#39;paths&#39;</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
            <span class="n">out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rawcommand</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">out</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="hgclient.pull"><a class="viewcode-back" href="../../../../../API/JumpScale.baselib.mercurial.hglib.html#JumpScale.baselib.mercurial.hglib.client.hgclient.pull">[docs]</a>    <span class="k">def</span> <span class="nf">pull</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">rev</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">update</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">force</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">bookmark</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
             <span class="n">branch</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">ssh</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">remotecmd</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">insecure</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">tool</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Pull changes from a remote repository.</span>

<span class="sd">        This finds all changes from the repository specified by source and adds</span>
<span class="sd">        them to this repository. If source is omitted, the &#39;default&#39; path will be</span>
<span class="sd">        used. By default, this does not update the copy of the project in the</span>
<span class="sd">        working directory.</span>

<span class="sd">        Returns True on success, False if update was given and there were</span>
<span class="sd">        unresolved files.</span>

<span class="sd">        update - update to new branch head if changesets were pulled</span>
<span class="sd">        force - run even when remote repository is unrelated</span>
<span class="sd">        rev - a (list of) remote changeset intended to be added</span>
<span class="sd">        bookmark - (list of) bookmark to pull</span>
<span class="sd">        branch - a (list of) specific branch you would like to pull</span>
<span class="sd">        ssh - specify ssh command to use</span>
<span class="sd">        remotecmd - specify hg command to run on the remote side</span>
<span class="sd">        insecure - do not verify server certificate (ignoring web.cacerts config)</span>
<span class="sd">        tool - specify merge tool for rebase</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">args</span> <span class="o">=</span> <span class="n">cmdbuilder</span><span class="p">(</span><span class="s">&#39;pull&#39;</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">r</span><span class="o">=</span><span class="n">rev</span><span class="p">,</span> <span class="n">u</span><span class="o">=</span><span class="n">update</span><span class="p">,</span> <span class="n">f</span><span class="o">=</span><span class="n">force</span><span class="p">,</span> <span class="n">B</span><span class="o">=</span><span class="n">bookmark</span><span class="p">,</span>
                          <span class="n">b</span><span class="o">=</span><span class="n">branch</span><span class="p">,</span> <span class="n">e</span><span class="o">=</span><span class="n">ssh</span><span class="p">,</span> <span class="n">remotecmd</span><span class="o">=</span><span class="n">remotecmd</span><span class="p">,</span> <span class="n">insecure</span><span class="o">=</span><span class="n">insecure</span><span class="p">,</span>
                          <span class="n">t</span><span class="o">=</span><span class="n">tool</span><span class="p">)</span>

        <span class="n">eh</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">reterrorhandler</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rawcommand</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">eh</span><span class="o">=</span><span class="n">eh</span><span class="p">)</span>

        <span class="k">return</span> <span class="nb">bool</span><span class="p">(</span><span class="n">eh</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="hgclient.push"><a class="viewcode-back" href="../../../../../API/JumpScale.baselib.mercurial.hglib.html#JumpScale.baselib.mercurial.hglib.client.hgclient.push">[docs]</a>    <span class="k">def</span> <span class="nf">push</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">rev</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">force</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">bookmark</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">branch</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
             <span class="n">newbranch</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">ssh</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">remotecmd</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">insecure</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Push changesets from this repository to the specified destination.</span>

<span class="sd">        This operation is symmetrical to pull: it is identical to a pull in the</span>
<span class="sd">        destination repository from the current one.</span>

<span class="sd">        Returns True if push was successful, False if nothing to push.</span>

<span class="sd">        rev - the (list of) specified revision and all its ancestors will be pushed</span>
<span class="sd">        to the remote repository.</span>

<span class="sd">        force - override the default behavior and push all changesets on all</span>
<span class="sd">        branches.</span>

<span class="sd">        bookmark - (list of) bookmark to push</span>
<span class="sd">        branch - a (list of) specific branch you would like to push</span>
<span class="sd">        newbranch - allows push to create a new named branch that is not present at</span>
<span class="sd">        the destination. This allows you to only create a new branch without</span>
<span class="sd">        forcing other changes.</span>

<span class="sd">        ssh - specify ssh command to use</span>
<span class="sd">        remotecmd - specify hg command to run on the remote side</span>
<span class="sd">        insecure - do not verify server certificate (ignoring web.cacerts config)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">args</span> <span class="o">=</span> <span class="n">cmdbuilder</span><span class="p">(</span><span class="s">&#39;push&#39;</span><span class="p">,</span> <span class="n">dest</span><span class="p">,</span> <span class="n">r</span><span class="o">=</span><span class="n">rev</span><span class="p">,</span> <span class="n">f</span><span class="o">=</span><span class="n">force</span><span class="p">,</span> <span class="n">B</span><span class="o">=</span><span class="n">bookmark</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="n">branch</span><span class="p">,</span>
                          <span class="n">new_branch</span><span class="o">=</span><span class="n">newbranch</span><span class="p">,</span> <span class="n">e</span><span class="o">=</span><span class="n">ssh</span><span class="p">,</span> <span class="n">remotecmd</span><span class="o">=</span><span class="n">remotecmd</span><span class="p">,</span>
                          <span class="n">insecure</span><span class="o">=</span><span class="n">insecure</span><span class="p">)</span>

        <span class="n">eh</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">reterrorhandler</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rawcommand</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">eh</span><span class="o">=</span><span class="n">eh</span><span class="p">)</span>

        <span class="k">return</span> <span class="nb">bool</span><span class="p">(</span><span class="n">eh</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="hgclient.remove"><a class="viewcode-back" href="../../../../../API/JumpScale.baselib.mercurial.hglib.html#JumpScale.baselib.mercurial.hglib.client.hgclient.remove">[docs]</a>    <span class="k">def</span> <span class="nf">remove</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">files</span><span class="p">,</span> <span class="n">after</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">force</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">include</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">exclude</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Schedule the indicated files for removal from the repository. This only</span>
<span class="sd">        removes files from the current branch, not from the entire project history.</span>

<span class="sd">        Returns True on success, False if any warnings encountered.</span>

<span class="sd">        after - used to remove only files that have already been deleted</span>
<span class="sd">        force - remove (and delete) file even if added or modified</span>
<span class="sd">        include - include names matching the given patterns</span>
<span class="sd">        exclude - exclude names matching the given patterns</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">files</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="n">files</span> <span class="o">=</span> <span class="p">[</span><span class="n">files</span><span class="p">]</span>

        <span class="n">args</span> <span class="o">=</span> <span class="n">cmdbuilder</span><span class="p">(</span><span class="s">&#39;remove&#39;</span><span class="p">,</span> <span class="n">A</span><span class="o">=</span><span class="n">after</span><span class="p">,</span> <span class="n">f</span><span class="o">=</span><span class="n">force</span><span class="p">,</span> <span class="n">I</span><span class="o">=</span><span class="n">include</span><span class="p">,</span> <span class="n">X</span><span class="o">=</span><span class="n">exclude</span><span class="p">,</span>
                          <span class="o">*</span><span class="n">files</span><span class="p">)</span>

        <span class="n">eh</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">reterrorhandler</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rawcommand</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">eh</span><span class="o">=</span><span class="n">eh</span><span class="p">)</span>

        <span class="k">return</span> <span class="nb">bool</span><span class="p">(</span><span class="n">eh</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="hgclient.resolve"><a class="viewcode-back" href="../../../../../API/JumpScale.baselib.mercurial.hglib.html#JumpScale.baselib.mercurial.hglib.client.hgclient.resolve">[docs]</a>    <span class="k">def</span> <span class="nf">resolve</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">file</span><span class="o">=</span><span class="p">[],</span> <span class="nb">all</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">listfiles</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">mark</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">unmark</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
                <span class="n">tool</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">include</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">exclude</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Redo merges or set/view the merge status of given files.</span>

<span class="sd">        Returns True on success, False if any files fail a resolve attempt.</span>

<span class="sd">        When listfiles is True, returns a list of (code, file path) of resolved</span>
<span class="sd">        and unresolved files. Code will be &#39;R&#39; or &#39;U&#39; accordingly.</span>

<span class="sd">        all - select all unresolved files</span>
<span class="sd">        mark - mark files as resolved</span>
<span class="sd">        unmark - mark files as unresolved</span>
<span class="sd">        tool - specify merge tool</span>
<span class="sd">        include - include names matching the given patterns</span>
<span class="sd">        exclude - exclude names matching the given patterns</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="nb">file</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="nb">file</span> <span class="o">=</span> <span class="p">[</span><span class="nb">file</span><span class="p">]</span>

        <span class="n">args</span> <span class="o">=</span> <span class="n">cmdbuilder</span><span class="p">(</span><span class="s">&#39;resolve&#39;</span><span class="p">,</span> <span class="n">a</span><span class="o">=</span><span class="nb">all</span><span class="p">,</span> <span class="n">l</span><span class="o">=</span><span class="n">listfiles</span><span class="p">,</span> <span class="n">m</span><span class="o">=</span><span class="n">mark</span><span class="p">,</span> <span class="n">u</span><span class="o">=</span><span class="n">unmark</span><span class="p">,</span>
                          <span class="n">t</span><span class="o">=</span><span class="n">tool</span><span class="p">,</span> <span class="n">I</span><span class="o">=</span><span class="n">include</span><span class="p">,</span> <span class="n">X</span><span class="o">=</span><span class="n">exclude</span><span class="p">,</span> <span class="o">*</span><span class="nb">file</span><span class="p">)</span>

        <span class="n">out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rawcommand</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">listfiles</span><span class="p">:</span>
            <span class="n">l</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">out</span><span class="o">.</span><span class="n">splitlines</span><span class="p">():</span>
                <span class="n">l</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39; &#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)))</span>
            <span class="k">return</span> <span class="n">l</span>
</div>
<div class="viewcode-block" id="hgclient.revert"><a class="viewcode-back" href="../../../../../API/JumpScale.baselib.mercurial.hglib.html#JumpScale.baselib.mercurial.hglib.client.hgclient.revert">[docs]</a>    <span class="k">def</span> <span class="nf">revert</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">files</span><span class="p">,</span> <span class="n">rev</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="nb">all</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">date</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">nobackup</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
               <span class="n">dryrun</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">include</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">exclude</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        With no revision specified, revert the specified files or directories to</span>
<span class="sd">        the contents they had in the parent of the working directory. This</span>
<span class="sd">        restores the contents of files to an unmodified state and unschedules</span>
<span class="sd">        adds, removes, copies, and renames. If the working directory has two</span>
<span class="sd">        parents, you must explicitly specify a revision.</span>

<span class="sd">        Specifying rev or date will revert the given files or directories to their</span>
<span class="sd">        states as of a specific revision. Because revert does not change the</span>
<span class="sd">        working directory parents, this will cause these files to appear modified.</span>
<span class="sd">        This can be helpful to &quot;back out&quot; some or all of an earlier change.</span>

<span class="sd">        Modified files are saved with a .orig suffix before reverting. To disable</span>
<span class="sd">        these backups, use nobackup.</span>

<span class="sd">        Returns True on success.</span>

<span class="sd">        all - revert all changes when no arguments given</span>
<span class="sd">        date - tipmost revision matching date</span>
<span class="sd">        rev - revert to the specified revision</span>
<span class="sd">        nobackup - do not save backup copies of files</span>
<span class="sd">        include - include names matching the given patterns</span>
<span class="sd">        exclude - exclude names matching the given patterns</span>
<span class="sd">        dryrun - do not perform actions, just print output</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">files</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="n">files</span> <span class="o">=</span> <span class="p">[</span><span class="n">files</span><span class="p">]</span>

        <span class="n">args</span> <span class="o">=</span> <span class="n">cmdbuilder</span><span class="p">(</span><span class="s">&#39;revert&#39;</span><span class="p">,</span> <span class="n">r</span><span class="o">=</span><span class="n">rev</span><span class="p">,</span> <span class="n">a</span><span class="o">=</span><span class="nb">all</span><span class="p">,</span> <span class="n">d</span><span class="o">=</span><span class="n">date</span><span class="p">,</span>
                          <span class="n">no_backup</span><span class="o">=</span><span class="n">nobackup</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="n">dryrun</span><span class="p">,</span> <span class="n">I</span><span class="o">=</span><span class="n">include</span><span class="p">,</span> <span class="n">X</span><span class="o">=</span><span class="n">exclude</span><span class="p">,</span>
                          <span class="o">*</span><span class="n">files</span><span class="p">)</span>

        <span class="n">eh</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">reterrorhandler</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rawcommand</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">eh</span><span class="o">=</span><span class="n">eh</span><span class="p">)</span>

        <span class="k">return</span> <span class="nb">bool</span><span class="p">(</span><span class="n">eh</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="hgclient.root"><a class="viewcode-back" href="../../../../../API/JumpScale.baselib.mercurial.hglib.html#JumpScale.baselib.mercurial.hglib.client.hgclient.root">[docs]</a>    <span class="k">def</span> <span class="nf">root</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the root directory of the current repository.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">rawcommand</span><span class="p">([</span><span class="s">&#39;root&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="hgclient.status"><a class="viewcode-back" href="../../../../../API/JumpScale.baselib.mercurial.hglib.html#JumpScale.baselib.mercurial.hglib.client.hgclient.status">[docs]</a>    <span class="k">def</span> <span class="nf">status</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rev</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">change</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="nb">all</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">modified</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">added</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
               <span class="n">removed</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">deleted</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">clean</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">unknown</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
               <span class="n">ignored</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">copies</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">subrepos</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">include</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
               <span class="n">exclude</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return status of files in the repository as a list of (code, file path)</span>
<span class="sd">        where code can be:</span>

<span class="sd">                M = modified</span>
<span class="sd">                A = added</span>
<span class="sd">                R = removed</span>
<span class="sd">                C = clean</span>
<span class="sd">                ! = missing (deleted by non-hg command, but still tracked)</span>
<span class="sd">                ? = untracked</span>
<span class="sd">                I = ignored</span>
<span class="sd">                  = origin of the previous file listed as A (added)</span>

<span class="sd">        rev - show difference from (list of) revision</span>
<span class="sd">        change - list the changed files of a revision</span>
<span class="sd">        all - show status of all files</span>
<span class="sd">        modified - show only modified files</span>
<span class="sd">        added - show only added files</span>
<span class="sd">        removed - show only removed files</span>
<span class="sd">        deleted - show only deleted (but tracked) files</span>
<span class="sd">        clean - show only files without changes</span>
<span class="sd">        unknown - show only unknown (not tracked) files</span>
<span class="sd">        ignored - show only ignored files</span>
<span class="sd">        copies - show source of copied files</span>
<span class="sd">        subrepos - recurse into subrepositories</span>
<span class="sd">        include - include names matching the given patterns</span>
<span class="sd">        exclude - exclude names matching the given patterns</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">rev</span> <span class="ow">and</span> <span class="n">change</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&#39;cannot specify both rev and change&#39;</span><span class="p">)</span>

        <span class="n">args</span> <span class="o">=</span> <span class="n">cmdbuilder</span><span class="p">(</span><span class="s">&#39;status&#39;</span><span class="p">,</span> <span class="n">rev</span><span class="o">=</span><span class="n">rev</span><span class="p">,</span> <span class="n">change</span><span class="o">=</span><span class="n">change</span><span class="p">,</span> <span class="n">A</span><span class="o">=</span><span class="nb">all</span><span class="p">,</span> <span class="n">m</span><span class="o">=</span><span class="n">modified</span><span class="p">,</span>
                          <span class="n">a</span><span class="o">=</span><span class="n">added</span><span class="p">,</span> <span class="n">r</span><span class="o">=</span><span class="n">removed</span><span class="p">,</span> <span class="n">d</span><span class="o">=</span><span class="n">deleted</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">clean</span><span class="p">,</span> <span class="n">u</span><span class="o">=</span><span class="n">unknown</span><span class="p">,</span>
                          <span class="n">i</span><span class="o">=</span><span class="n">ignored</span><span class="p">,</span> <span class="n">C</span><span class="o">=</span><span class="n">copies</span><span class="p">,</span> <span class="n">S</span><span class="o">=</span><span class="n">subrepos</span><span class="p">,</span> <span class="n">I</span><span class="o">=</span><span class="n">include</span><span class="p">,</span> <span class="n">X</span><span class="o">=</span><span class="n">exclude</span><span class="p">)</span>

        <span class="n">args</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;-0&#39;</span><span class="p">)</span>

        <span class="n">out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rawcommand</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
        <span class="n">l</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">out</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\0</span><span class="s">&#39;</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">entry</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">entry</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39; &#39;</span><span class="p">:</span>
                    <span class="n">l</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s">&#39; &#39;</span><span class="p">,</span> <span class="n">entry</span><span class="p">[</span><span class="mi">2</span><span class="p">:]))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">l</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="n">entry</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39; &#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)))</span>

        <span class="k">return</span> <span class="n">l</span>
</div>
<div class="viewcode-block" id="hgclient.tag"><a class="viewcode-back" href="../../../../../API/JumpScale.baselib.mercurial.hglib.html#JumpScale.baselib.mercurial.hglib.client.hgclient.tag">[docs]</a>    <span class="k">def</span> <span class="nf">tag</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">names</span><span class="p">,</span> <span class="n">rev</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">message</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">force</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">local</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
            <span class="n">remove</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">date</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">user</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add one or more tags specified by names for the current or given revision.</span>

<span class="sd">        Changing an existing tag is normally disallowed; use force to override.</span>

<span class="sd">        Tag commits are usually made at the head of a branch. If the parent of the</span>
<span class="sd">        working directory is not a branch head, a CommandError will be raised.</span>
<span class="sd">        force can be specified to force the tag commit to be based on a non-head</span>
<span class="sd">        changeset.</span>

<span class="sd">        local - make the tag local</span>
<span class="sd">        rev - revision to tag</span>
<span class="sd">        remove - remove a tag</span>
<span class="sd">        message - set commit message</span>
<span class="sd">        date - record the specified date as commit date</span>
<span class="sd">        user - record the specified user as committer</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">names</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="n">names</span><span class="p">]</span>

        <span class="n">args</span> <span class="o">=</span> <span class="n">cmdbuilder</span><span class="p">(</span><span class="s">&#39;tag&#39;</span><span class="p">,</span> <span class="n">r</span><span class="o">=</span><span class="n">rev</span><span class="p">,</span> <span class="n">m</span><span class="o">=</span><span class="n">message</span><span class="p">,</span> <span class="n">f</span><span class="o">=</span><span class="n">force</span><span class="p">,</span> <span class="n">l</span><span class="o">=</span><span class="n">local</span><span class="p">,</span>
                          <span class="n">remove</span><span class="o">=</span><span class="n">remove</span><span class="p">,</span> <span class="n">d</span><span class="o">=</span><span class="n">date</span><span class="p">,</span> <span class="n">u</span><span class="o">=</span><span class="n">user</span><span class="p">,</span> <span class="o">*</span><span class="n">names</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">rawcommand</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="hgclient.tags"><a class="viewcode-back" href="../../../../../API/JumpScale.baselib.mercurial.hglib.html#JumpScale.baselib.mercurial.hglib.client.hgclient.tags">[docs]</a>    <span class="k">def</span> <span class="nf">tags</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return a list of repository tags as: (name, rev, node, islocal)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">args</span> <span class="o">=</span> <span class="n">cmdbuilder</span><span class="p">(</span><span class="s">&#39;tags&#39;</span><span class="p">,</span> <span class="n">v</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

        <span class="n">out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rawcommand</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>

        <span class="n">t</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">out</span><span class="o">.</span><span class="n">splitlines</span><span class="p">():</span>
            <span class="n">taglocal</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s">&#39; local&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">taglocal</span><span class="p">:</span>
                <span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="p">[:</span><span class="o">-</span><span class="mi">6</span><span class="p">]</span>
            <span class="n">name</span><span class="p">,</span> <span class="n">rev</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">rsplit</span><span class="p">(</span><span class="s">&#39; &#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">rev</span><span class="p">,</span> <span class="n">node</span> <span class="o">=</span> <span class="n">rev</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;:&#39;</span><span class="p">)</span>
            <span class="n">t</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">name</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(),</span> <span class="nb">int</span><span class="p">(</span><span class="n">rev</span><span class="p">),</span> <span class="n">node</span><span class="p">,</span> <span class="n">taglocal</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">t</span>
</div>
<div class="viewcode-block" id="hgclient.summary"><a class="viewcode-back" href="../../../../../API/JumpScale.baselib.mercurial.hglib.html#JumpScale.baselib.mercurial.hglib.client.hgclient.summary">[docs]</a>    <span class="k">def</span> <span class="nf">summary</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">remote</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return a dictionary with a brief summary of the working directory state,</span>
<span class="sd">        including parents, branch, commit status, and available updates.</span>

<span class="sd">            &#39;parent&#39; : a list of (rev, node, tags, message)</span>
<span class="sd">            &#39;branch&#39; : the current branch</span>
<span class="sd">            &#39;commit&#39; : True if the working directory is clean, False otherwise</span>
<span class="sd">            &#39;update&#39; : number of available updates,</span>
<span class="sd">            [&#39;remote&#39; : (in, in bookmarks, out, out bookmarks),]</span>
<span class="sd">            [&#39;mq&#39;: (applied, unapplied) mq patches,]</span>

<span class="sd">            unparsed entries will be of them form key : value</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">args</span> <span class="o">=</span> <span class="n">cmdbuilder</span><span class="p">(</span><span class="s">&#39;summary&#39;</span><span class="p">,</span> <span class="n">remote</span><span class="o">=</span><span class="n">remote</span><span class="p">)</span>

        <span class="n">out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rawcommand</span><span class="p">(</span><span class="n">args</span><span class="p">)</span><span class="o">.</span><span class="n">splitlines</span><span class="p">()</span>

        <span class="n">d</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">while</span> <span class="n">out</span><span class="p">:</span>
            <span class="n">line</span> <span class="o">=</span> <span class="n">out</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;: &#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="s">&#39;parent&#39;</span><span class="p">:</span>
                <span class="n">parent</span><span class="p">,</span> <span class="n">tags</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39; &#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                <span class="n">rev</span><span class="p">,</span> <span class="n">node</span> <span class="o">=</span> <span class="n">parent</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;:&#39;</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">tags</span><span class="p">:</span>
                    <span class="n">tags</span> <span class="o">=</span> <span class="n">tags</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39; (empty repository)&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">tags</span> <span class="o">=</span> <span class="bp">None</span>

                <span class="n">value</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="p">[])</span>

                <span class="k">if</span> <span class="n">rev</span> <span class="o">==</span> <span class="s">&#39;-1&#39;</span><span class="p">:</span>
                    <span class="n">value</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="nb">int</span><span class="p">(</span><span class="n">rev</span><span class="p">),</span> <span class="n">node</span><span class="p">,</span> <span class="n">tags</span><span class="p">,</span> <span class="bp">None</span><span class="p">))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">message</span> <span class="o">=</span> <span class="n">out</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)[</span><span class="mi">1</span><span class="p">:]</span>
                    <span class="n">value</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="nb">int</span><span class="p">(</span><span class="n">rev</span><span class="p">),</span> <span class="n">node</span><span class="p">,</span> <span class="n">tags</span><span class="p">,</span> <span class="n">message</span><span class="p">))</span>
            <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s">&#39;branch&#39;</span><span class="p">:</span>
                <span class="k">pass</span>
            <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s">&#39;commit&#39;</span><span class="p">:</span>
                <span class="n">value</span> <span class="o">=</span> <span class="n">value</span> <span class="o">==</span> <span class="s">&#39;(clean)&#39;</span>
            <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s">&#39;update&#39;</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">value</span> <span class="o">==</span> <span class="s">&#39;(current)&#39;</span><span class="p">:</span>
                    <span class="n">value</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">value</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">value</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39; &#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
            <span class="k">elif</span> <span class="n">remote</span> <span class="ow">and</span> <span class="n">name</span> <span class="o">==</span> <span class="s">&#39;remote&#39;</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">value</span> <span class="o">==</span> <span class="s">&#39;(synced)&#39;</span><span class="p">:</span>
                    <span class="n">value</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">inc</span> <span class="o">=</span> <span class="n">incb</span> <span class="o">=</span> <span class="n">out_</span> <span class="o">=</span> <span class="n">outb</span> <span class="o">=</span> <span class="mi">0</span>

                    <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">value</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;, &#39;</span><span class="p">):</span>
                        <span class="n">count</span><span class="p">,</span> <span class="n">v</span> <span class="o">=</span> <span class="n">v</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39; &#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">v</span> <span class="o">==</span> <span class="s">&#39;outgoing&#39;</span><span class="p">:</span>
                            <span class="n">out_</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">count</span><span class="p">)</span>
                        <span class="k">elif</span> <span class="n">v</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s">&#39;incoming&#39;</span><span class="p">):</span>
                            <span class="n">inc</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">count</span><span class="p">)</span>
                        <span class="k">elif</span> <span class="n">v</span> <span class="o">==</span> <span class="s">&#39;incoming bookmarks&#39;</span><span class="p">:</span>
                            <span class="n">incb</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">count</span><span class="p">)</span>
                        <span class="k">elif</span> <span class="n">v</span> <span class="o">==</span> <span class="s">&#39;outgoing bookmarks&#39;</span><span class="p">:</span>
                            <span class="n">outb</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">count</span><span class="p">)</span>

                    <span class="n">value</span> <span class="o">=</span> <span class="n">inc</span><span class="p">,</span> <span class="n">incb</span><span class="p">,</span> <span class="n">out_</span><span class="p">,</span> <span class="n">outb</span>
            <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s">&#39;mq&#39;</span><span class="p">:</span>
                <span class="n">applied</span> <span class="o">=</span> <span class="n">unapplied</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">value</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;, &#39;</span><span class="p">):</span>
                    <span class="n">count</span><span class="p">,</span> <span class="n">v</span> <span class="o">=</span> <span class="n">v</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39; &#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">v</span> <span class="o">==</span> <span class="s">&#39;applied&#39;</span><span class="p">:</span>
                        <span class="n">applied</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">count</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="n">v</span> <span class="o">==</span> <span class="s">&#39;unapplied&#39;</span><span class="p">:</span>
                        <span class="n">unapplied</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">count</span><span class="p">)</span>
                <span class="n">value</span> <span class="o">=</span> <span class="n">applied</span><span class="p">,</span> <span class="n">unapplied</span>

            <span class="n">d</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

        <span class="k">return</span> <span class="n">d</span>
</div>
<div class="viewcode-block" id="hgclient.tip"><a class="viewcode-back" href="../../../../../API/JumpScale.baselib.mercurial.hglib.html#JumpScale.baselib.mercurial.hglib.client.hgclient.tip">[docs]</a>    <span class="k">def</span> <span class="nf">tip</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the tip revision (usually just called the tip) which is the</span>
<span class="sd">        changeset most recently added to the repository (and therefore the most</span>
<span class="sd">        recently changed head).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">args</span> <span class="o">=</span> <span class="n">cmdbuilder</span><span class="p">(</span><span class="s">&#39;tip&#39;</span><span class="p">,</span> <span class="n">template</span><span class="o">=</span><span class="n">templates</span><span class="o">.</span><span class="n">changeset</span><span class="p">)</span>
        <span class="n">out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rawcommand</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
        <span class="n">out</span> <span class="o">=</span> <span class="n">out</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\0</span><span class="s">&#39;</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parserevs</span><span class="p">(</span><span class="n">out</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</div>
<div class="viewcode-block" id="hgclient.update"><a class="viewcode-back" href="../../../../../API/JumpScale.baselib.mercurial.hglib.html#JumpScale.baselib.mercurial.hglib.client.hgclient.update">[docs]</a>    <span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rev</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">clean</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">check</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">date</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Update the repository&#39;s working directory to changeset specified by rev.</span>
<span class="sd">        If rev isn&#39;t specified, update to the tip of the current named branch.</span>

<span class="sd">        Return the number of files (updated, merged, removed, unresolved)</span>

<span class="sd">        clean - discard uncommitted changes (no backup)</span>
<span class="sd">        check - update across branches if no uncommitted changes</span>
<span class="sd">        date - tipmost revision matching date</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">clean</span> <span class="ow">and</span> <span class="n">check</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&#39;clean and check cannot both be True&#39;</span><span class="p">)</span>

        <span class="n">args</span> <span class="o">=</span> <span class="n">cmdbuilder</span><span class="p">(</span><span class="s">&#39;update&#39;</span><span class="p">,</span> <span class="n">r</span><span class="o">=</span><span class="n">rev</span><span class="p">,</span> <span class="n">C</span><span class="o">=</span><span class="n">clean</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">check</span><span class="p">,</span> <span class="n">d</span><span class="o">=</span><span class="n">date</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">eh</span><span class="p">(</span><span class="n">ret</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">err</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">ret</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">out</span>

            <span class="k">raise</span> <span class="n">error</span><span class="o">.</span><span class="n">CommandError</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">ret</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">err</span><span class="p">)</span>


        <span class="n">out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rawcommand</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">eh</span><span class="o">=</span><span class="n">eh</span><span class="p">)</span>

        <span class="n">m</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s">r&#39;^(\d+).+, (\d+).+, (\d+).+, (\d+)&#39;</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">MULTILINE</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span><span class="nb">list</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">groups</span><span class="p">())))</span>
</div>
    <span class="nd">@property</span>
<div class="viewcode-block" id="hgclient.version"><a class="viewcode-back" href="../../../../../API/JumpScale.baselib.mercurial.hglib.html#JumpScale.baselib.mercurial.hglib.client.hgclient.version">[docs]</a>    <span class="k">def</span> <span class="nf">version</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return hg version that runs the command server as a 4 fielded tuple: major,</span>
<span class="sd">        minor, micro and local build info. e.g. (1, 9, 1, &#39;+4-3095db9f5c2c&#39;)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_version</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">v</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rawcommand</span><span class="p">(</span><span class="n">cmdbuilder</span><span class="p">(</span><span class="s">&#39;version&#39;</span><span class="p">,</span> <span class="n">q</span><span class="o">=</span><span class="bp">True</span><span class="p">))</span>
            <span class="n">v</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s">r&#39;.*?(\d+)\.(\d+)\.?(\d+)?(\+[0-9a-f-]+)?&#39;</span><span class="p">,</span>
                              <span class="n">v</span><span class="p">)</span><span class="o">.</span><span class="n">groups</span><span class="p">())</span>

            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
                    <span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_version</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_version</span>
</div>
    <span class="k">def</span> <span class="nf">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">changeid</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">context</span><span class="o">.</span><span class="n">changectx</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">changeid</span><span class="p">)</span></div>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../../../../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../../../genindex.html" title="General Index"
             >index</a></li>
        <li><a href="../../../../../index.html">Jumpscale Doc 7.0 documentation</a> &raquo;</li>
          <li><a href="../../../../index.html" >Module code</a> &raquo;</li>
          <li><a href="../hglib.html" >JumpScale.baselib.mercurial.hglib</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
    </div>
  </body>
</html>