<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>JumpScale.baselib.jpackages.JPackageClient &mdash; Jumpscale Doc 7.0 documentation</title>
    
    <link rel="stylesheet" href="../../../../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../../../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../../',
        VERSION:     '7.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../../_static/doctools.js"></script>
    <link rel="top" title="Jumpscale Doc 7.0 documentation" href="../../../../index.html" />
    <link rel="up" title="Module code" href="../../../index.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li><a href="../../../../index.html">Jumpscale Doc 7.0 documentation</a> &raquo;</li>
          <li><a href="../../../index.html" accesskey="U">Module code</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <h1>Source code for JumpScale.baselib.jpackages.JPackageClient</h1><div class="highlight"><pre>
<span class="kn">import</span> <span class="nn">math</span>
<span class="kn">from</span> <span class="nn">JumpScale</span> <span class="kn">import</span> <span class="n">j</span>
<span class="kn">from</span> <span class="nn">JPackageObject</span> <span class="kn">import</span> <span class="n">JPackageObject</span>
<span class="kn">import</span> <span class="nn">copy</span>

<div class="viewcode-block" id="JPackageClient"><a class="viewcode-back" href="../../../../API/JumpScale.baselib.jpackages.html#JumpScale.baselib.jpackages.JPackageClient.JPackageClient">[docs]</a><span class="k">class</span> <span class="nc">JPackageClient</span><span class="p">():</span>
    <span class="n">sourcesFile</span> <span class="o">=</span> <span class="bp">None</span>

    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    methods to deal with jpackages, seen from client level</span>

<span class="sd">    @qlocation j.packages</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__init</span><span class="o">=</span><span class="bp">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">redis</span><span class="o">=</span><span class="n">j</span><span class="o">.</span><span class="n">application</span><span class="o">.</span><span class="n">redis</span>

    <span class="k">def</span> <span class="nf">__getChildObjectsExamples</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">res</span><span class="o">=</span><span class="p">{}</span>
        <span class="n">res</span><span class="p">[</span><span class="s">&quot;j.packages._object.jpackage&quot;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">findByName</span><span class="p">(</span><span class="s">&quot;core&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">res</span>        

    <span class="k">def</span> <span class="nf">_init</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__init</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="kn">from</span> <span class="nn">Domain</span> <span class="kn">import</span> <span class="n">Domain</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__init</span><span class="o">=</span><span class="bp">True</span>

        <span class="c"># try:</span>
        <span class="c">#     import JumpScale.baselib.expect</span>
        <span class="c"># except:</span>
        <span class="c">#     pass</span>
            
        <span class="kn">from</span> <span class="nn">JumpScale.baselib</span> <span class="kn">import</span> <span class="n">platforms</span>

        <span class="kn">import</span> <span class="nn">JumpScale.baselib.actions</span>
        <span class="kn">import</span> <span class="nn">JumpScale.baselib.bitbucket</span>
        <span class="kn">import</span> <span class="nn">JumpScale.baselib.mercurial</span>
        <span class="kn">import</span> <span class="nn">JumpScale.baselib.taskletengine</span>
        <span class="kn">import</span> <span class="nn">JumpScale.baselib.blobstor</span>
        <span class="kn">import</span> <span class="nn">JumpScale.baselib.cloudsystemfs</span>            

        <span class="c"># if j.application.config.exists(&quot;jumpscale.paths.jpackages.files&quot;):</span>
        <span class="c">#     self.packageDirFiles=j.application.config.get(&quot;jumpscale.paths.jpackages.files&quot;)</span>
        <span class="c"># else:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">packageDirFiles</span><span class="o">=</span><span class="n">j</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">joinPaths</span><span class="p">(</span><span class="n">j</span><span class="o">.</span><span class="n">dirs</span><span class="o">.</span><span class="n">packageDir</span><span class="p">,</span> <span class="s">&quot;files&quot;</span><span class="p">)</span>

        <span class="c"># if hasattr(&quot;j&quot;,&quot;basepath&quot;):</span>
        <span class="c">#     self.packageDirFiles=self.packageDirFiles.replace(&quot;$base&quot;,j.basepath)</span>

        <span class="k">if</span> <span class="n">j</span><span class="o">.</span><span class="n">application</span><span class="o">.</span><span class="n">sandbox</span><span class="p">:</span>
            <span class="n">j</span><span class="o">.</span><span class="n">dirs</span><span class="o">.</span><span class="n">packageDirMD</span><span class="o">=</span><span class="n">j</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">joinPaths</span><span class="p">(</span><span class="n">j</span><span class="o">.</span><span class="n">dirs</span><span class="o">.</span><span class="n">baseDir</span><span class="p">,</span><span class="s">&quot;jpackages&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">j</span><span class="o">.</span><span class="n">dirs</span><span class="o">.</span><span class="n">packageDirMD</span><span class="o">=</span><span class="n">j</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">joinPaths</span><span class="p">(</span><span class="n">j</span><span class="o">.</span><span class="n">dirs</span><span class="o">.</span><span class="n">varDir</span><span class="p">,</span> <span class="s">&quot;jpackages&quot;</span><span class="p">,</span><span class="s">&quot;metadata&quot;</span><span class="p">)</span>

        <span class="n">j</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">createDir</span><span class="p">(</span><span class="n">j</span><span class="o">.</span><span class="n">dirs</span><span class="o">.</span><span class="n">packageDirMD</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">domains</span><span class="o">=</span><span class="p">[]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_metadatadirTmp</span><span class="o">=</span><span class="n">j</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">joinPaths</span><span class="p">(</span><span class="n">j</span><span class="o">.</span><span class="n">dirs</span><span class="o">.</span><span class="n">varDir</span><span class="p">,</span><span class="s">&quot;tmp&quot;</span><span class="p">,</span><span class="s">&quot;jpackages&quot;</span><span class="p">,</span><span class="s">&quot;md&quot;</span><span class="p">)</span>

        <span class="n">j</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">createDir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_metadatadirTmp</span><span class="p">)</span>        
        <span class="c"># can&#39;t ask username here</span>
        <span class="c"># because jumpscale is not interactive yet</span>
        <span class="c"># So we ask the username/passwd lazy in the domain object</span>
        <span class="c"># j.packages.markConfigurationPending=self._runPendingReconfigeFiles</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reloadconfig</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">enableConsoleLogging</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">logenable</span><span class="o">=</span><span class="bp">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">loglevel</span><span class="o">=</span><span class="mi">5</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">errors</span><span class="o">=</span><span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">inInstall</span><span class="o">=</span><span class="p">[]</span> <span class="c">#jpackages which are being installed</span>

<div class="viewcode-block" id="JPackageClient.reportError"><a class="viewcode-back" href="../../../../API/JumpScale.baselib.jpackages.html#JumpScale.baselib.jpackages.JPackageClient.JPackageClient.reportError">[docs]</a>    <span class="k">def</span> <span class="nf">reportError</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">msg</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="JPackageClient.log"><a class="viewcode-back" href="../../../../API/JumpScale.baselib.jpackages.html#JumpScale.baselib.jpackages.JPackageClient.JPackageClient.log">[docs]</a>    <span class="k">def</span> <span class="nf">log</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">msg</span><span class="p">,</span><span class="n">category</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">,</span><span class="n">level</span><span class="o">=</span><span class="mi">5</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s">&#39;loglevel&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">loglevel</span> <span class="o">=</span> <span class="mi">5</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s">&#39;logenable&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logenable</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="k">if</span> <span class="n">level</span><span class="o">&lt;</span><span class="bp">self</span><span class="o">.</span><span class="n">loglevel</span><span class="o">+</span><span class="mi">1</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">logenable</span><span class="p">:</span>
            <span class="n">j</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span><span class="n">category</span><span class="o">=</span><span class="s">&quot;jpackage.</span><span class="si">%s</span><span class="s">&quot;</span><span class="o">%</span><span class="n">category</span><span class="p">,</span><span class="n">level</span><span class="o">=</span><span class="n">level</span><span class="p">)</span>        

</div>
<div class="viewcode-block" id="JPackageClient.enableConsoleLogging"><a class="viewcode-back" href="../../../../API/JumpScale.baselib.jpackages.html#JumpScale.baselib.jpackages.JPackageClient.JPackageClient.enableConsoleLogging">[docs]</a>    <span class="k">def</span> <span class="nf">enableConsoleLogging</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">j</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">consoleloglevel</span><span class="o">=</span><span class="mi">6</span>
        <span class="n">j</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">consolelogCategories</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&quot;jpackage&quot;</span><span class="p">)</span>
        <span class="n">j</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">consolelogCategories</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&quot;blobstor&quot;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="JPackageClient.getJPackageMetadataScanner"><a class="viewcode-back" href="../../../../API/JumpScale.baselib.jpackages.html#JumpScale.baselib.jpackages.JPackageClient.JPackageClient.getJPackageMetadataScanner">[docs]</a>    <span class="k">def</span> <span class="nf">getJPackageMetadataScanner</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        returns tool which can be  used to scan the jpackages repo&#39;s and manipulate them</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_init</span><span class="p">()</span>
        
        <span class="kn">from</span> <span class="nn">core.jpackages.JPackageMetadataScanner</span> <span class="kn">import</span> <span class="n">JPackageMetadataScanner</span>
        <span class="k">return</span> <span class="n">JPackageMetadataScanner</span><span class="p">()</span>
</div>
    <span class="k">def</span> <span class="nf">_renew</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">j</span><span class="o">.</span><span class="n">packages</span> <span class="o">=</span> <span class="n">JPackageClient</span><span class="p">()</span>

<div class="viewcode-block" id="JPackageClient.checkProtectedDirs"><a class="viewcode-back" href="../../../../API/JumpScale.baselib.jpackages.html#JumpScale.baselib.jpackages.JPackageClient.JPackageClient.checkProtectedDirs">[docs]</a>    <span class="k">def</span> <span class="nf">checkProtectedDirs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">redo</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span><span class="n">checkInteractive</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        recreate the config file for protected dirs (means directories linked to code repo&#39;s)</span>
<span class="sd">        by executing this command you are sure that no development data will be overwritten</span>
<span class="sd">        @param redo means, restart from existing links in qbase, do not use the config file</span>
<span class="sd">        @checkInteractive if False, will not ask just execute on it</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s">&quot;reimplement&quot;</span><span class="p">)</span>
        <span class="n">result</span><span class="p">,</span><span class="n">llist</span><span class="o">=</span><span class="n">j</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">&quot;find /opt/qbase5 -type l&quot;</span><span class="p">)</span>
        <span class="n">lines</span><span class="o">=</span><span class="p">[</span><span class="n">item</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">llist</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span> <span class="k">if</span> <span class="n">item</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">&lt;&gt;</span><span class="s">&quot;&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
            <span class="n">cfgpath</span><span class="o">=</span><span class="n">j</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">joinPaths</span><span class="p">(</span><span class="n">j</span><span class="o">.</span><span class="n">dirs</span><span class="o">.</span><span class="n">cfgDir</span><span class="p">,</span><span class="s">&quot;debug&quot;</span><span class="p">,</span><span class="s">&quot;protecteddirs&quot;</span><span class="p">,</span><span class="s">&quot;protected.cfg&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">redo</span><span class="o">==</span><span class="bp">False</span> <span class="ow">and</span> <span class="n">j</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">cfgpath</span><span class="p">):</span>
                <span class="n">llist</span><span class="o">=</span><span class="n">j</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">fileGetContents</span><span class="p">(</span><span class="n">cfgpath</span><span class="p">)</span>
                <span class="n">lines</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">item</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">llist</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span> <span class="k">if</span> <span class="n">item</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">&lt;&gt;</span><span class="s">&quot;&quot;</span><span class="p">])</span>
            <span class="n">prev</span><span class="o">=</span><span class="s">&quot;&quot;</span>
            <span class="n">lines2</span><span class="o">=</span><span class="p">[]</span>
            <span class="n">lines</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">line</span><span class="o">&lt;&gt;</span><span class="n">prev</span><span class="p">:</span>
                    <span class="n">lines2</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
                <span class="n">prev</span><span class="o">=</span><span class="n">line</span>
            <span class="n">out</span><span class="o">=</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">lines2</span><span class="p">)</span>
            <span class="n">do</span><span class="o">=</span><span class="bp">False</span>
            <span class="k">if</span> <span class="n">checkInteractive</span><span class="p">:</span> 
                <span class="k">if</span> <span class="n">j</span><span class="o">.</span><span class="n">console</span><span class="o">.</span><span class="n">askYesNo</span><span class="p">(</span><span class="s">&quot;Do you want to make sure that existing linked dirs are not overwritten by installer? </span><span class="se">\n</span><span class="s">(if yes the linked dirs will be put in protected dir configuration)</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">):</span>
                    <span class="n">do</span><span class="o">=</span><span class="bp">True</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">do</span><span class="o">=</span><span class="bp">True</span>
            <span class="k">if</span> <span class="n">do</span><span class="p">:</span>
                <span class="n">j</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">writeFile</span><span class="p">(</span><span class="n">cfgpath</span><span class="p">,</span><span class="n">out</span><span class="p">)</span>     
</div>
<div class="viewcode-block" id="JPackageClient.reloadconfig"><a class="viewcode-back" href="../../../../API/JumpScale.baselib.jpackages.html#JumpScale.baselib.jpackages.JPackageClient.JPackageClient.reloadconfig">[docs]</a>    <span class="k">def</span> <span class="nf">reloadconfig</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Reload all jpackages config data from disk</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">__init</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_init</span><span class="p">()</span>

        <span class="kn">from</span> <span class="nn">Domain</span> <span class="kn">import</span> <span class="n">Domain</span>
        <span class="n">cfgpath</span><span class="o">=</span><span class="n">j</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">joinPaths</span><span class="p">(</span><span class="n">j</span><span class="o">.</span><span class="n">dirs</span><span class="o">.</span><span class="n">cfgDir</span><span class="p">,</span> <span class="s">&#39;jpackages&#39;</span><span class="p">,</span> <span class="s">&#39;sources.cfg&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">j</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">cfgpath</span><span class="p">):</span>
            <span class="n">j</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">createDir</span><span class="p">(</span><span class="n">j</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">getDirName</span><span class="p">(</span><span class="n">cfgpath</span><span class="p">))</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s">&quot;did not find jpackage sources file on </span><span class="si">%s</span><span class="s">&quot;</span><span class="o">%</span><span class="n">cfgpath</span><span class="p">)</span>            
        <span class="k">else</span><span class="p">:</span>
            <span class="n">cfg</span> <span class="o">=</span> <span class="n">j</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">inifile</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">cfgpath</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sourcesConfig</span><span class="o">=</span><span class="n">cfg</span>
            <span class="n">domainDict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">domains</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">domains</span><span class="p">:</span> 
                <span class="n">domainDict</span><span class="p">[</span><span class="n">domains</span><span class="o">.</span><span class="n">domainname</span><span class="p">]</span> <span class="o">=</span> <span class="n">domains</span>
            <span class="k">for</span> <span class="n">domain</span> <span class="ow">in</span> <span class="n">cfg</span><span class="o">.</span><span class="n">getSections</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">domain</span> <span class="ow">in</span> <span class="n">domainDict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">domains</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">domainDict</span><span class="p">[</span><span class="n">domain</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">domains</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Domain</span><span class="p">(</span><span class="n">domainname</span><span class="o">=</span><span class="n">domain</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="JPackageClient.create"><a class="viewcode-back" href="../../../../API/JumpScale.baselib.jpackages.html#JumpScale.baselib.jpackages.JPackageClient.JPackageClient.create">[docs]</a>    <span class="k">def</span> <span class="nf">create</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">domain</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">,</span> <span class="n">version</span><span class="o">=</span><span class="s">&quot;1.0&quot;</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">,</span> <span class="n">supportedPlatforms</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates a new jpackages4, this includes all standard tasklets, a config file and a description.wiki file</span>
<span class="sd">        @param domain:      string - The domain the new jpackages should reside in</span>
<span class="sd">        @param name:        string - The name of the new jpackages</span>
<span class="sd">        @param version:     string - The version of the new jpackages</span>
<span class="sd">        @param description: string - The description of the new jpackages (is stored in the description.wiki file)</span>
<span class="sd">        @param supportedPlatforms  [&quot;linux&quot;,...] other examples win,win32,linux64 see j.system.platformtype</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_init</span><span class="p">()</span>    
        <span class="k">if</span> <span class="n">j</span><span class="o">.</span><span class="n">application</span><span class="o">.</span><span class="n">shellconfig</span><span class="o">.</span><span class="n">interactive</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">domain</span><span class="p">:</span>
                <span class="n">domain</span>  <span class="o">=</span> <span class="n">j</span><span class="o">.</span><span class="n">console</span><span class="o">.</span><span class="n">askChoice</span><span class="p">(</span><span class="n">j</span><span class="o">.</span><span class="n">packages</span><span class="o">.</span><span class="n">getDomainNames</span><span class="p">(),</span> <span class="s">&quot;Please select a domain&quot;</span><span class="p">)</span>
            <span class="n">j</span><span class="o">.</span><span class="n">packages</span><span class="o">.</span><span class="n">getDomainObject</span><span class="p">(</span><span class="n">domain</span><span class="p">)</span><span class="o">.</span><span class="n">_ensureDomainCanBeUpdated</span><span class="p">()</span> <span class="c">#@question what does this do?</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">name</span><span class="p">:</span>
                <span class="n">name</span>    <span class="o">=</span> <span class="n">j</span><span class="o">.</span><span class="n">console</span><span class="o">.</span><span class="n">askString</span><span class="p">(</span><span class="s">&quot;Please provide a name&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">version</span><span class="p">:</span>
                <span class="n">version</span> <span class="o">=</span> <span class="n">j</span><span class="o">.</span><span class="n">console</span><span class="o">.</span><span class="n">askString</span><span class="p">(</span><span class="s">&quot;Please provide a version&quot;</span><span class="p">,</span><span class="s">&quot;1.0&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">description</span><span class="p">:</span>
                <span class="n">description</span> <span class="o">=</span> <span class="n">j</span><span class="o">.</span><span class="n">console</span><span class="o">.</span><span class="n">askString</span><span class="p">(</span><span class="s">&quot;Please provide a description&quot;</span><span class="p">,</span><span class="s">&quot;&quot;</span><span class="p">)</span>

            <span class="k">while</span> <span class="ow">not</span> <span class="n">supportedPlatforms</span><span class="p">:</span>
                <span class="n">supportedPlatforms</span> <span class="o">=</span> <span class="n">j</span><span class="o">.</span><span class="n">console</span><span class="o">.</span><span class="n">askChoiceMultiple</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">j</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">platformtype</span><span class="o">.</span><span class="n">getPlatforms</span><span class="p">()),</span> <span class="s">&#39;Please enumerate the supported platforms&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">domain</span><span class="o">==</span><span class="s">&quot;&quot;</span> <span class="ow">or</span> <span class="n">name</span><span class="o">==</span><span class="s">&quot;&quot;</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s">&quot;domain or name at least needs to be specified&quot;</span><span class="p">)</span>

        <span class="n">supportedPlatforms</span><span class="o">=</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">item</span><span class="p">)</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">supportedPlatforms</span><span class="p">]</span>
        <span class="c"># Create one in the repo</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">domain</span> <span class="ow">in</span> <span class="n">j</span><span class="o">.</span><span class="n">packages</span><span class="o">.</span><span class="n">getDomainNames</span><span class="p">():</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s">&#39;Provided domain is nonexistent on this system&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">getDomainObject</span><span class="p">(</span><span class="n">domain</span><span class="p">)</span><span class="o">.</span><span class="n">metadataFromTgz</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s">&#39;The meta data for domain &#39;</span> <span class="o">+</span> <span class="n">domain</span> <span class="o">+</span> <span class="s">&#39; is coming from a tgz, you cannot create new packages in it.&#39;</span><span class="p">)</span>
        <span class="n">jp</span>      <span class="o">=</span> <span class="n">JPackageObject</span><span class="p">(</span><span class="n">domain</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">version</span><span class="p">)</span>
        <span class="c">#jp.prepareForUpdatingFiles(suppressErrors=True)</span>
        <span class="n">jp</span><span class="o">.</span><span class="n">supportedPlatforms</span> <span class="o">=</span> <span class="n">supportedPlatforms</span>
        <span class="n">jp</span><span class="o">.</span><span class="n">description</span><span class="o">=</span><span class="n">description</span>
        <span class="n">jp</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
        <span class="n">j</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">createDir</span><span class="p">(</span><span class="n">jp</span><span class="o">.</span><span class="n">getPathFiles</span><span class="p">())</span>
        <span class="n">j</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">createDir</span><span class="p">(</span><span class="n">j</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">joinPaths</span><span class="p">(</span><span class="n">jp</span><span class="o">.</span><span class="n">getPathFiles</span><span class="p">(),</span><span class="s">&quot;generic&quot;</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">pl</span> <span class="ow">in</span> <span class="n">supportedPlatforms</span><span class="p">:</span>
            <span class="n">j</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">createDir</span><span class="p">(</span><span class="n">j</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">joinPaths</span><span class="p">(</span><span class="n">jp</span><span class="o">.</span><span class="n">getPathFiles</span><span class="p">(),</span><span class="s">&quot;</span><span class="si">%s</span><span class="s">&quot;</span><span class="o">%</span><span class="n">pl</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">jp</span>


<span class="c">############################################################</span>
<span class="c">##################  GET FUNCTIONS  #########################</span>
<span class="c">############################################################</span>
</div>
<div class="viewcode-block" id="JPackageClient.getTypePath"><a class="viewcode-back" href="../../../../API/JumpScale.baselib.jpackages.html#JumpScale.baselib.jpackages.JPackageClient.JPackageClient.getTypePath">[docs]</a>    <span class="k">def</span> <span class="nf">getTypePath</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ttype</span><span class="p">,</span> <span class="n">relativepath</span><span class="p">,</span><span class="n">jp</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">ttype</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&#39;sitepackages&#39;</span><span class="p">,</span> <span class="s">&#39;site-packages&#39;</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">j</span><span class="o">.</span><span class="n">application</span><span class="o">.</span><span class="n">sandbox</span><span class="p">:</span>
                <span class="n">base</span><span class="o">=</span><span class="n">j</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">joinPaths</span><span class="p">(</span><span class="n">j</span><span class="o">.</span><span class="n">dirs</span><span class="o">.</span><span class="n">baseDir</span><span class="p">,</span><span class="s">&quot;libext&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">base</span><span class="o">=</span><span class="n">j</span><span class="o">.</span><span class="n">application</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;python.paths.local.sitepackages&quot;</span><span class="p">)</span>
            <span class="n">systemdest</span> <span class="o">=</span> <span class="n">j</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">joinPaths</span><span class="p">(</span><span class="n">base</span><span class="p">,</span> <span class="n">relativepath</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">ttype</span><span class="o">==</span><span class="s">&quot;root&quot;</span><span class="p">:</span>
            <span class="n">systemdest</span> <span class="o">=</span> <span class="s">&quot;/</span><span class="si">%s</span><span class="s">&quot;</span><span class="o">%</span><span class="n">relativepath</span><span class="o">.</span><span class="n">lstrip</span><span class="p">(</span><span class="s">&quot;/&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">ttype</span><span class="o">==</span><span class="s">&quot;base&quot;</span><span class="p">:</span>
            <span class="n">systemdest</span> <span class="o">=</span> <span class="n">j</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">joinPaths</span><span class="p">(</span><span class="n">j</span><span class="o">.</span><span class="n">dirs</span><span class="o">.</span><span class="n">baseDir</span><span class="p">,</span> <span class="n">relativepath</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">ttype</span><span class="o">==</span><span class="s">&quot;app&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">jp</span><span class="o">==</span><span class="bp">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s">&quot;getTypePath doesnt have access to jp object, jp==None&quot;</span><span class="p">)</span>
            <span class="c"># if jp.hrd_instance==None:                </span>
            <span class="c">#     raise RuntimeError(&quot;Cannot link jpackage, did not find instance version.&quot;) </span>
            <span class="k">if</span> <span class="n">jp</span><span class="o">.</span><span class="n">hrd_instance</span><span class="o">&lt;&gt;</span><span class="bp">None</span><span class="p">:</span>
                <span class="n">path</span> <span class="o">=</span> <span class="n">jp</span><span class="o">.</span><span class="n">getAppPath</span><span class="p">()</span>
                <span class="n">systemdest</span> <span class="o">=</span> <span class="n">j</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">joinPaths</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">relativepath</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">systemdest</span><span class="o">=</span><span class="bp">None</span>
        <span class="k">elif</span> <span class="n">ttype</span><span class="o">==</span><span class="s">&quot;apps&quot;</span><span class="p">:</span>
            <span class="n">systemdest</span> <span class="o">=</span> <span class="n">j</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">joinPaths</span><span class="p">(</span><span class="n">j</span><span class="o">.</span><span class="n">dirs</span><span class="o">.</span><span class="n">baseDir</span><span class="p">,</span><span class="s">&quot;apps&quot;</span><span class="p">,</span><span class="n">relativepath</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">ttype</span><span class="o">==</span><span class="s">&quot;cfg&quot;</span><span class="p">:</span>
            <span class="n">systemdest</span> <span class="o">=</span> <span class="n">j</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">joinPaths</span><span class="p">(</span><span class="n">j</span><span class="o">.</span><span class="n">dirs</span><span class="o">.</span><span class="n">cfgDir</span><span class="p">,</span> <span class="n">relativepath</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">ttype</span><span class="o">==</span><span class="s">&quot;code&quot;</span><span class="p">:</span>
            <span class="n">systemdest</span> <span class="o">=</span> <span class="n">j</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">joinPaths</span><span class="p">(</span><span class="n">j</span><span class="o">.</span><span class="n">dirs</span><span class="o">.</span><span class="n">codeDir</span><span class="p">,</span> <span class="n">relativepath</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">ttype</span><span class="o">==</span><span class="s">&quot;var&quot;</span><span class="p">:</span>
            <span class="n">systemdest</span> <span class="o">=</span> <span class="n">j</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">joinPaths</span><span class="p">(</span><span class="n">j</span><span class="o">.</span><span class="n">dirs</span><span class="o">.</span><span class="n">varDir</span><span class="p">,</span> <span class="n">relativepath</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">ttype</span><span class="o">==</span><span class="s">&quot;jslib&quot;</span><span class="p">:</span>
            <span class="n">systemdest</span> <span class="o">=</span> <span class="n">j</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">joinPaths</span><span class="p">(</span><span class="n">j</span><span class="o">.</span><span class="n">dirs</span><span class="o">.</span><span class="n">jsLibDir</span><span class="p">,</span> <span class="n">relativepath</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">ttype</span><span class="o">==</span><span class="s">&quot;lib&quot;</span><span class="p">:</span>
            <span class="n">systemdest</span> <span class="o">=</span> <span class="n">j</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">joinPaths</span><span class="p">(</span><span class="n">j</span><span class="o">.</span><span class="n">dirs</span><span class="o">.</span><span class="n">libDir</span><span class="p">,</span> <span class="n">relativepath</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">ttype</span><span class="o">==</span><span class="s">&quot;libext&quot;</span><span class="p">:</span>
            <span class="n">systemdest</span> <span class="o">=</span> <span class="n">j</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">joinPaths</span><span class="p">(</span><span class="n">j</span><span class="o">.</span><span class="n">dirs</span><span class="o">.</span><span class="n">libExtDir</span><span class="p">,</span> <span class="n">relativepath</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">ttype</span><span class="o">==</span><span class="s">&quot;jsbin&quot;</span><span class="p">:</span>
            <span class="n">systemdest</span> <span class="o">=</span> <span class="n">j</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">joinPaths</span><span class="p">(</span><span class="n">j</span><span class="o">.</span><span class="n">dirs</span><span class="o">.</span><span class="n">binDir</span><span class="p">,</span> <span class="n">relativepath</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">ttype</span><span class="o">==</span><span class="s">&quot;opt&quot;</span><span class="p">:</span>
            <span class="n">base</span><span class="o">=</span><span class="s">&quot;/opt&quot;</span>
            <span class="n">systemdest</span> <span class="o">=</span> <span class="n">j</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">joinPaths</span><span class="p">(</span><span class="n">base</span><span class="p">,</span> <span class="n">relativepath</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">ttype</span><span class="o">==</span><span class="s">&quot;deb&quot;</span><span class="p">:</span>
            <span class="n">systemdest</span> <span class="o">=</span> <span class="s">&quot;/tmp&quot;</span>
        <span class="k">elif</span> <span class="n">ttype</span><span class="o">==</span><span class="s">&quot;etc&quot;</span><span class="p">:</span>
            <span class="n">base</span><span class="o">=</span><span class="s">&quot;/etc&quot;</span>
            <span class="n">systemdest</span> <span class="o">=</span> <span class="n">j</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">joinPaths</span><span class="p">(</span><span class="n">base</span><span class="p">,</span> <span class="n">relativepath</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">ttype</span><span class="o">==</span><span class="s">&quot;tmp&quot;</span><span class="p">:</span>
            <span class="n">systemdest</span> <span class="o">=</span> <span class="n">j</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">joinPaths</span><span class="p">(</span><span class="n">j</span><span class="o">.</span><span class="n">dirs</span><span class="o">.</span><span class="n">tmpDir</span><span class="p">,</span> <span class="n">relativepath</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">ttype</span><span class="o">==</span><span class="s">&quot;bin&quot;</span><span class="p">:</span>            
            <span class="n">base</span><span class="o">=</span><span class="n">j</span><span class="o">.</span><span class="n">application</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;bin.local&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">base</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">==</span><span class="s">&quot;&quot;</span><span class="p">:</span>
                <span class="n">base</span><span class="o">=</span><span class="s">&quot;/usr/local/bin/&quot;</span>
            <span class="n">systemdest</span> <span class="o">=</span> <span class="n">j</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">joinPaths</span><span class="p">(</span><span class="n">base</span><span class="p">,</span> <span class="n">relativepath</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">base</span><span class="o">=</span><span class="n">j</span><span class="o">.</span><span class="n">application</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">applyOnContent</span><span class="p">(</span><span class="n">ttype</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">base</span><span class="o">==</span><span class="n">ttype</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s">&quot;Could not find ttype:</span><span class="si">%s</span><span class="s"> for </span><span class="si">%s</span><span class="s">, needs to be root,base,etc,bin,deb&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">ttype</span><span class="p">,</span><span class="bp">self</span><span class="p">))</span>
            <span class="n">systemdest</span> <span class="o">=</span> <span class="n">j</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">joinPaths</span><span class="p">(</span><span class="n">base</span><span class="p">,</span> <span class="n">relativepath</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">systemdest</span>
</div>
<div class="viewcode-block" id="JPackageClient.getActionNamesClass"><a class="viewcode-back" href="../../../../API/JumpScale.baselib.jpackages.html#JumpScale.baselib.jpackages.JPackageClient.JPackageClient.getActionNamesClass">[docs]</a>    <span class="k">def</span> <span class="nf">getActionNamesClass</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        these actions can be applied on jpackage without knowing the jpackage instance</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">res</span><span class="o">=</span><span class="p">[</span><span class="s">&quot;code.commit&quot;</span><span class="p">,</span><span class="s">&quot;code.package&quot;</span><span class="p">,</span><span class="s">&quot;code.push&quot;</span><span class="p">,</span><span class="s">&quot;code.update&quot;</span><span class="p">,</span><span class="s">&quot;process.depcheck&quot;</span><span class="p">,</span><span class="s">&quot;upload&quot;</span><span class="p">,</span> <span class="s">&quot;install.download&quot;</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">res</span>
</div>
<div class="viewcode-block" id="JPackageClient.getActionNamesInstance"><a class="viewcode-back" href="../../../../API/JumpScale.baselib.jpackages.html#JumpScale.baselib.jpackages.JPackageClient.JPackageClient.getActionNamesInstance">[docs]</a>    <span class="k">def</span> <span class="nf">getActionNamesInstance</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">res</span><span class="o">=</span><span class="p">[</span><span class="s">&quot;code.export&quot;</span><span class="p">,</span><span class="s">&quot;code.link&quot;</span><span class="p">,</span><span class="s">&quot;data.export&quot;</span><span class="p">,</span><span class="s">&quot;data.import&quot;</span><span class="p">,</span><span class="s">&quot;data.logrotate&quot;</span><span class="p">,</span><span class="s">&quot;install.configure&quot;</span><span class="p">,</span><span class="s">&quot;install.copy&quot;</span><span class="p">,</span><span class="s">&quot;install.download&quot;</span><span class="p">,</span>\
            <span class="s">&quot;install.post&quot;</span><span class="p">,</span><span class="s">&quot;install.prepare&quot;</span><span class="p">,</span><span class="s">&quot;monitor.getstats&quot;</span><span class="p">,</span><span class="s">&quot;monitor.up.local&quot;</span><span class="p">,</span><span class="s">&quot;monitor.up.net&quot;</span><span class="p">,</span>\
            <span class="s">&quot;process.configure&quot;</span><span class="p">,</span><span class="s">&quot;process.kill&quot;</span><span class="p">,</span><span class="s">&quot;process.start&quot;</span><span class="p">,</span><span class="s">&quot;process.stop&quot;</span><span class="p">,</span><span class="s">&quot;process.unconfigure&quot;</span><span class="p">,</span><span class="s">&quot;uninstall&quot;</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">res</span>
</div>
<div class="viewcode-block" id="JPackageClient.get"><a class="viewcode-back" href="../../../../API/JumpScale.baselib.jpackages.html#JumpScale.baselib.jpackages.JPackageClient.JPackageClient.get">[docs]</a>    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">domain</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">version</span><span class="p">,</span><span class="n">instance</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns a jpackages </span>
<span class="sd">        @param domain:  string - The domain the jpackages is part from</span>
<span class="sd">        @param name:    string - The name of the jpackages</span>
<span class="sd">        @param version: string - The version of the jpackages</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">domain</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&quot;jp_&quot;</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s">&quot;domain should not start with jp_&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_init</span><span class="p">()</span>
        <span class="c"># return a package from the default repo</span>
        <span class="n">key</span> <span class="o">=</span> <span class="s">&#39;</span><span class="si">%s%s%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">domain</span><span class="p">,</span><span class="n">name</span><span class="p">,</span><span class="n">version</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_getcache</span><span class="o">.</span><span class="n">has_key</span><span class="p">(</span><span class="n">key</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_getcache</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">domain</span><span class="p">,</span><span class="n">name</span><span class="p">,</span><span class="n">version</span><span class="p">)</span><span class="o">==</span><span class="bp">False</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s">&quot;Could not find package </span><span class="si">%s</span><span class="s">.&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">getMetadataPath</span><span class="p">(</span><span class="n">domain</span><span class="p">,</span><span class="n">name</span><span class="p">,</span><span class="n">version</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_getcache</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">=</span><span class="n">JPackageObject</span><span class="p">(</span><span class="n">domain</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">version</span><span class="p">,</span><span class="n">instance</span><span class="o">=</span><span class="n">instance</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_getcache</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>

                    </div>
<div class="viewcode-block" id="JPackageClient.exists"><a class="viewcode-back" href="../../../../API/JumpScale.baselib.jpackages.html#JumpScale.baselib.jpackages.JPackageClient.JPackageClient.exists">[docs]</a>    <span class="k">def</span> <span class="nf">exists</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">domain</span><span class="p">,</span><span class="n">name</span><span class="p">,</span><span class="n">version</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Checks whether the jpackages&#39;s metadata path is currently present on your system</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_init</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">j</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getMetadataPath</span><span class="p">(</span><span class="n">domain</span><span class="p">,</span><span class="n">name</span><span class="p">,</span><span class="n">version</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="JPackageClient.getInstalledPackages"><a class="viewcode-back" href="../../../../API/JumpScale.baselib.jpackages.html#JumpScale.baselib.jpackages.JPackageClient.JPackageClient.getInstalledPackages">[docs]</a>    <span class="k">def</span> <span class="nf">getInstalledPackages</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns a list of all currently installed packages on your system</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_init</span><span class="p">()</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">p</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">getJPackageObjects</span><span class="p">(</span><span class="n">j</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">platformtype</span><span class="o">.</span><span class="n">myplatform</span><span class="p">)</span> <span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="n">isInstalled</span><span class="p">()]</span>
</div>
<div class="viewcode-block" id="JPackageClient.getDebugPackages"><a class="viewcode-back" href="../../../../API/JumpScale.baselib.jpackages.html#JumpScale.baselib.jpackages.JPackageClient.JPackageClient.getDebugPackages">[docs]</a>    <span class="k">def</span> <span class="nf">getDebugPackages</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns a list of all currently installed packages on your system</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_init</span><span class="p">()</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">p</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">getJPackageObjects</span><span class="p">(</span><span class="n">j</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">platformtype</span><span class="o">.</span><span class="n">myplatform</span><span class="p">)</span> <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">debugMode</span><span class="p">)</span><span class="o">==</span><span class="mi">1</span><span class="p">]</span>
</div>
    <span class="k">def</span> <span class="nf">getPackagesWithBrokenDependencies</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns a list of all jpackages which have dependencies that cannot be resolved</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_init</span><span class="p">()</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">package</span> <span class="k">for</span> <span class="n">package</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">getJPackageObjects</span><span class="p">()</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">package</span><span class="o">.</span><span class="n">getBrokenDependencies</span><span class="p">())</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span>
    
<div class="viewcode-block" id="JPackageClient.getPendingReconfigurationPackages"><a class="viewcode-back" href="../../../../API/JumpScale.baselib.jpackages.html#JumpScale.baselib.jpackages.JPackageClient.JPackageClient.getPendingReconfigurationPackages">[docs]</a>    <span class="k">def</span> <span class="nf">getPendingReconfigurationPackages</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns a List of all jpackages that are pending for configuration</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_init</span><span class="p">()</span>
        <span class="k">return</span> <span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">jpackages</span><span class="p">:</span> <span class="n">jpackages</span><span class="o">.</span><span class="n">isPendingReconfiguration</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">getJPackageObjects</span><span class="p">())</span>

<span class="c">#############################################################</span>
<span class="c">######################  DOMAINS  ############################</span>
<span class="c">#############################################################</span>
</div>
<div class="viewcode-block" id="JPackageClient.getDomainObject"><a class="viewcode-back" href="../../../../API/JumpScale.baselib.jpackages.html#JumpScale.baselib.jpackages.JPackageClient.JPackageClient.getDomainObject">[docs]</a>    <span class="k">def</span> <span class="nf">getDomainObject</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">domain</span><span class="p">,</span><span class="n">qualityLevel</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get provided domain as an object</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_init</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">qualityLevel</span><span class="o">==</span><span class="bp">None</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">domains</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">item</span><span class="o">.</span><span class="n">domainname</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">==</span><span class="n">domain</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
                    <span class="k">return</span> <span class="n">item</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">Domain</span><span class="p">(</span><span class="n">domain</span><span class="p">,</span><span class="n">qualityLevel</span><span class="p">)</span>
        
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s">&quot;Could not find jpackages domain </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">domain</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="JPackageClient.getDomainNames"><a class="viewcode-back" href="../../../../API/JumpScale.baselib.jpackages.html#JumpScale.baselib.jpackages.JPackageClient.JPackageClient.getDomainNames">[docs]</a>    <span class="k">def</span> <span class="nf">getDomainNames</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns a list of all domains present in the sources.cfg file</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_init</span><span class="p">()</span>
        <span class="n">result</span><span class="o">=</span><span class="p">[]</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">domains</span><span class="p">:</span>
            <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">domainname</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span>


<span class="c">############################################################</span>
<span class="c">###################  GET PATH FUNCTIONS  ###################</span>
<span class="c">############################################################</span>
</div>
<div class="viewcode-block" id="JPackageClient.getJPActionsPath"><a class="viewcode-back" href="../../../../API/JumpScale.baselib.jpackages.html#JumpScale.baselib.jpackages.JPackageClient.JPackageClient.getJPActionsPath">[docs]</a>    <span class="k">def</span> <span class="nf">getJPActionsPath</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">domain</span><span class="p">,</span><span class="n">name</span><span class="p">,</span><span class="n">instance</span><span class="p">,</span><span class="n">fromtmp</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the metadatapath for the provided jpackages</span>
<span class="sd">        if fromtmp is True, then tmp directorypath will be returned</span>

<span class="sd">        @param domain:  string - The domain of the jpackages</span>
<span class="sd">        @param name:    string - The name of the jpackages</span>
<span class="sd">        @param fromtmp: boolean</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">fromtmp</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_metadatadirTmp</span>
            <span class="k">return</span> <span class="n">j</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">joinPaths</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_metadatadirTmp</span><span class="p">,</span><span class="n">domain</span><span class="p">,</span><span class="n">name</span><span class="p">,</span><span class="nb">str</span><span class="p">(</span><span class="n">instance</span><span class="p">),</span><span class="s">&quot;actions&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">j</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">joinPaths</span><span class="p">(</span><span class="n">j</span><span class="o">.</span><span class="n">dirs</span><span class="o">.</span><span class="n">packageDir</span><span class="p">,</span> <span class="s">&quot;instance&quot;</span><span class="p">,</span> <span class="n">domain</span><span class="p">,</span><span class="n">name</span><span class="p">,</span><span class="nb">str</span><span class="p">(</span><span class="n">instance</span><span class="p">),</span><span class="s">&quot;actions&quot;</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="JPackageClient.getJPActiveInstancePath"><a class="viewcode-back" href="../../../../API/JumpScale.baselib.jpackages.html#JumpScale.baselib.jpackages.JPackageClient.JPackageClient.getJPActiveInstancePath">[docs]</a>    <span class="k">def</span> <span class="nf">getJPActiveInstancePath</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">domain</span><span class="p">,</span><span class="n">name</span><span class="p">,</span><span class="n">instance</span><span class="p">,</span><span class="n">fromtmp</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the metadatapath for the provided jpackages in active mode</span>

<span class="sd">        @param domain:  string - The domain of the jpackages</span>
<span class="sd">        @param name:    string - The name of the jpackages</span>
<span class="sd">        @param fromtmp: boolean</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">fromtmp</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_metadatadirTmp</span>
            <span class="n">p</span><span class="o">=</span><span class="n">j</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">joinPaths</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_metadatadirTmp</span><span class="p">,</span><span class="n">domain</span><span class="p">,</span><span class="n">name</span><span class="p">,</span><span class="nb">str</span><span class="p">(</span><span class="n">instance</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">p</span><span class="o">=</span><span class="n">j</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">joinPaths</span><span class="p">(</span><span class="n">j</span><span class="o">.</span><span class="n">dirs</span><span class="o">.</span><span class="n">packageDir</span><span class="p">,</span> <span class="s">&quot;instance&quot;</span><span class="p">,</span> <span class="n">domain</span><span class="p">,</span><span class="n">name</span><span class="p">,</span><span class="nb">str</span><span class="p">(</span><span class="n">instance</span><span class="p">))</span>
        <span class="c"># j.system.fs.createDir(j.system.fs.joinPaths(p,&quot;hrdactive&quot;))</span>
        <span class="k">return</span> <span class="n">p</span>

</div>
<div class="viewcode-block" id="JPackageClient.getJPActiveHRDPath"><a class="viewcode-back" href="../../../../API/JumpScale.baselib.jpackages.html#JumpScale.baselib.jpackages.JPackageClient.JPackageClient.getJPActiveHRDPath">[docs]</a>    <span class="k">def</span> <span class="nf">getJPActiveHRDPath</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">domain</span><span class="p">,</span><span class="n">name</span><span class="p">,</span><span class="n">instance</span><span class="p">,</span><span class="n">fromtmp</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the metadatapath for the provided jpackages</span>
<span class="sd">        if fromtmp is True, then tmp directorypath will be returned</span>

<span class="sd">        @param domain:  string - The domain of the jpackages</span>
<span class="sd">        @param name:    string - The name of the jpackages</span>
<span class="sd">        @param version: string - The version of the jpackages</span>
<span class="sd">        @param fromtmp: boolean</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">fromtmp</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_metadatadirTmp</span>
            <span class="k">return</span> <span class="n">j</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">joinPaths</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_metadatadirTmp</span><span class="p">,</span><span class="n">domain</span><span class="p">,</span><span class="n">name</span><span class="p">,</span><span class="nb">str</span><span class="p">(</span><span class="n">instance</span><span class="p">),</span><span class="s">&quot;hrdactive&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">j</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">joinPaths</span><span class="p">(</span><span class="n">j</span><span class="o">.</span><span class="n">dirs</span><span class="o">.</span><span class="n">packageDir</span><span class="p">,</span> <span class="s">&quot;instance&quot;</span><span class="p">,</span> <span class="n">domain</span><span class="p">,</span><span class="n">name</span><span class="p">,</span><span class="nb">str</span><span class="p">(</span><span class="n">instance</span><span class="p">),</span><span class="s">&quot;hrdactive&quot;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="JPackageClient.getMetadataPath"><a class="viewcode-back" href="../../../../API/JumpScale.baselib.jpackages.html#JumpScale.baselib.jpackages.JPackageClient.JPackageClient.getMetadataPath">[docs]</a>    <span class="k">def</span> <span class="nf">getMetadataPath</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">domain</span><span class="p">,</span><span class="n">name</span><span class="p">,</span><span class="n">version</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the metadatapath for the provided jpackages for active state</span>

<span class="sd">        @param domain:  string - The domain of the jpackages</span>
<span class="sd">        @param name:    string - The name of the jpackages</span>
<span class="sd">        @param version: string - The version of the jpackages</span>
<span class="sd">        @param fromtmp: boolean</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">j</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">joinPaths</span><span class="p">(</span><span class="n">j</span><span class="o">.</span><span class="n">dirs</span><span class="o">.</span><span class="n">packageDirMD</span><span class="p">,</span> <span class="n">domain</span><span class="p">,</span><span class="n">name</span><span class="p">,</span><span class="n">version</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="JPackageClient.getDataPath"><a class="viewcode-back" href="../../../../API/JumpScale.baselib.jpackages.html#JumpScale.baselib.jpackages.JPackageClient.JPackageClient.getDataPath">[docs]</a>    <span class="k">def</span> <span class="nf">getDataPath</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">domain</span><span class="p">,</span><span class="n">name</span><span class="p">,</span><span class="n">version</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the filesdatapath for the provided jpackages</span>
<span class="sd">        @param domain:  string - The domain of the jpackages</span>
<span class="sd">        @param name:    string - The name of the jpackages</span>
<span class="sd">        @param version: string - The version of the jpackages</span>
<span class="sd">        &quot;&quot;&quot;</span>        
        <span class="k">return</span> <span class="n">j</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">joinPaths</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">packageDirFiles</span><span class="p">,</span> <span class="n">domain</span><span class="p">,</span><span class="n">name</span><span class="p">,</span><span class="n">version</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="JPackageClient.getMetaTarPath"><a class="viewcode-back" href="../../../../API/JumpScale.baselib.jpackages.html#JumpScale.baselib.jpackages.JPackageClient.JPackageClient.getMetaTarPath">[docs]</a>    <span class="k">def</span> <span class="nf">getMetaTarPath</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">domainName</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the metatarsdatapath for the provided domain</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">j</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">joinPaths</span><span class="p">(</span><span class="n">j</span><span class="o">.</span><span class="n">dirs</span><span class="o">.</span><span class="n">packageDir</span><span class="p">,</span> <span class="s">&quot;metatars&quot;</span><span class="p">,</span> <span class="n">domainName</span><span class="p">)</span>


<span class="c">############################################################</span>
<span class="c">######################  CACHING  ###########################</span>
<span class="c">############################################################</span>
</div>
    <span class="n">_getcache</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">def</span> <span class="nf">_deleteFromCache</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">domain</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">version</span><span class="p">):</span>
        <span class="c">#called by a package when we call delete on it so it can be garbage collected</span>
        <span class="n">key</span> <span class="o">=</span> <span class="s">&#39;</span><span class="si">%s%s%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">domain</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">version</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_getcache</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>



<span class="c">############################################################</span>
<span class="c">##########################  FIND  ##########################</span>
<span class="c">############################################################</span>

<div class="viewcode-block" id="JPackageClient.findNewest"><a class="viewcode-back" href="../../../../API/JumpScale.baselib.jpackages.html#JumpScale.baselib.jpackages.JPackageClient.JPackageClient.findNewest">[docs]</a>    <span class="k">def</span> <span class="nf">findNewest</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">domain</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">,</span><span class="n">name</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">,</span> <span class="n">minversion</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">,</span><span class="n">maxversion</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">,</span><span class="n">platform</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">returnNoneIfNotFound</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Find the newest jpackages which matches the criteria</span>
<span class="sd">        If more than 1 jpackages matches -&gt; error</span>
<span class="sd">        If no jpackages match and not returnNoneIfNotFound -&gt; error</span>
<span class="sd">        @param name:       string - The name of jpackages you are looking for</span>
<span class="sd">        @param domain:     string - The domain of the jpackages you are looking for</span>
<span class="sd">        @param minversion: string - The minimum version the jpackages must have</span>
<span class="sd">        @param maxversion: string - The maximum version the jpackages can have</span>
<span class="sd">        @param platform:   string - Which platform the jpackages must run on</span>
<span class="sd">        @param returnNoneIfNotFound: boolean - if true, will return None object if no jpackages have been found</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">results</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">domain</span><span class="o">=</span><span class="n">domain</span><span class="p">,</span><span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>

        <span class="c"># results=[]</span>
        <span class="c"># for item in results0:    </span>
        <span class="c">#     if item.supportsPlatform(platform=None):</span>
        <span class="c">#         results.append(item)</span>

        <span class="n">namefound</span><span class="o">=</span><span class="s">&quot;&quot;</span>
        <span class="n">domainfound</span><span class="o">=</span><span class="s">&quot;&quot;</span>
        <span class="k">if</span> <span class="n">minversion</span><span class="o">==</span><span class="s">&quot;&quot;</span><span class="p">:</span>
            <span class="n">minversion</span><span class="o">=</span><span class="s">&quot;0&quot;</span>
        <span class="k">if</span> <span class="n">maxversion</span><span class="o">==</span><span class="s">&quot;&quot;</span> <span class="ow">or</span> <span class="n">maxversion</span><span class="o">==</span><span class="s">&quot;0&quot;</span><span class="p">:</span>
            <span class="n">maxversion</span><span class="o">=</span><span class="s">&quot;100.100.100&quot;</span>
        <span class="c">#look for duplicates</span>
        <span class="k">for</span> <span class="n">jp</span> <span class="ow">in</span> <span class="n">results</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">namefound</span><span class="o">==</span><span class="s">&quot;&quot;</span><span class="p">:</span>
                <span class="n">namefound</span><span class="o">=</span><span class="n">jp</span><span class="o">.</span><span class="n">name</span>
            <span class="k">if</span> <span class="n">domainfound</span><span class="o">==</span><span class="s">&quot;&quot;</span><span class="p">:</span>
                <span class="n">domainfound</span><span class="o">=</span><span class="n">jp</span><span class="o">.</span><span class="n">domain</span>
            <span class="k">if</span> <span class="n">jp</span><span class="o">.</span><span class="n">domain</span><span class="o">&lt;&gt;</span><span class="n">domainfound</span> <span class="ow">or</span> <span class="n">jp</span><span class="o">.</span><span class="n">name</span><span class="o">&lt;&gt;</span><span class="n">namefound</span><span class="p">:</span>
                <span class="n">packagesStr</span><span class="o">=</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span>
                <span class="k">for</span> <span class="n">jp2</span> <span class="ow">in</span> <span class="n">results</span><span class="p">:</span>
                    <span class="n">packagesStr</span><span class="o">=</span><span class="s">&quot;    </span><span class="si">%s</span><span class="se">\n</span><span class="s">&quot;</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="n">jp2</span><span class="p">)</span>
                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s">&quot;Found more than 1 jpackages matching the criteria.</span><span class="se">\n</span><span class="s"> </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">packagesStr</span><span class="p">)</span>
        <span class="c">#check for version match</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">results</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">returnNoneIfNotFound</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">None</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s">&quot;Did not find jpackages with criteria domain:</span><span class="si">%s</span><span class="s">, name:</span><span class="si">%s</span><span class="s">, platform:</span><span class="si">%s</span><span class="s"> (independant from version)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">domain</span><span class="p">,</span><span class="n">name</span><span class="p">,</span><span class="n">platform</span><span class="p">))</span>

        <span class="c"># filter packages so they are between min and max version bounds</span>
        <span class="n">result</span><span class="o">=</span><span class="p">[</span><span class="n">jp</span> <span class="k">for</span> <span class="n">jp</span> <span class="ow">in</span> <span class="n">results</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_getVersionAsInt</span><span class="p">(</span><span class="n">minversion</span><span class="p">)</span><span class="o">&lt;=</span><span class="bp">self</span><span class="o">.</span><span class="n">_getVersionAsInt</span><span class="p">(</span><span class="n">jp</span><span class="o">.</span><span class="n">version</span><span class="p">)</span><span class="o">&lt;=</span><span class="bp">self</span><span class="o">.</span><span class="n">_getVersionAsInt</span><span class="p">(</span><span class="n">maxversion</span><span class="p">)]</span>
        <span class="n">result</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="k">lambda</span> <span class="n">jp1</span><span class="p">,</span> <span class="n">jp2</span><span class="p">:</span> <span class="o">-</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_getVersionAsInt</span><span class="p">(</span><span class="n">jp1</span><span class="o">.</span><span class="n">version</span><span class="p">)</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_getVersionAsInt</span><span class="p">(</span><span class="n">jp2</span><span class="o">.</span><span class="n">version</span><span class="p">)))</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">result</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">returnNoneIfNotFound</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">None</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s">&quot;Did not find jpackages with criteria domain:</span><span class="si">%s</span><span class="s">, name:</span><span class="si">%s</span><span class="s">, minversion:</span><span class="si">%s</span><span class="s">, maxversion:</span><span class="si">%s</span><span class="s">, platform:</span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">domain</span><span class="p">,</span><span class="n">name</span><span class="p">,</span><span class="n">minversion</span><span class="p">,</span><span class="n">maxversion</span><span class="p">,</span><span class="n">platform</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

</div>
<div class="viewcode-block" id="JPackageClient.findByName"><a class="viewcode-back" href="../../../../API/JumpScale.baselib.jpackages.html#JumpScale.baselib.jpackages.JPackageClient.JPackageClient.findByName">[docs]</a>    <span class="k">def</span> <span class="nf">findByName</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">name</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        name is part of jpackage, if none found return None, if more than 1 found raise error, name is part of name</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="c"># if name.find(&quot;*&quot;)==-1:</span>
        <span class="c">#     name+=&quot;*&quot;</span>
        <span class="n">res</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span><span class="n">domain</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">interactive</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">res</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">j</span><span class="o">.</span><span class="n">events</span><span class="o">.</span><span class="n">opserror_critical</span><span class="p">(</span><span class="s">&quot;Found more than 1 jpackage with name &#39;</span><span class="si">%s</span><span class="s">&#39; cannot continue, only 1 allowed.</span><span class="se">\n</span><span class="si">%s</span><span class="s">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">name</span><span class="p">,</span><span class="n">res</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">res</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    </div>
<div class="viewcode-block" id="JPackageClient.find"><a class="viewcode-back" href="../../../../API/JumpScale.baselib.jpackages.html#JumpScale.baselib.jpackages.JPackageClient.JPackageClient.find">[docs]</a>    <span class="k">def</span> <span class="nf">find</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">domain</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">name</span><span class="o">=</span><span class="bp">None</span> <span class="p">,</span> <span class="n">version</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">,</span> <span class="n">platform</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">onlyone</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span><span class="n">installed</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">instance</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">expandInstances</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span><span class="n">interactive</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; </span>
<span class="sd">        @domain, if none will ask for domain</span>

<span class="sd">        &quot;&quot;&quot;</span>        

        <span class="k">def</span> <span class="nf">raiseError</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span><span class="n">domain</span><span class="p">,</span><span class="n">name</span><span class="p">,</span><span class="n">version</span><span class="p">,</span><span class="n">platform</span><span class="p">,</span><span class="n">installed</span><span class="p">,</span><span class="n">instance</span><span class="p">):</span>
            <span class="n">msg2</span><span class="o">=</span><span class="s">&quot;Jpackage find failed for following arguments</span><span class="se">\n</span><span class="s">&quot;</span>
            <span class="n">msg2</span><span class="o">+=</span><span class="s">&quot;- domain:</span><span class="si">%s</span><span class="se">\n</span><span class="s">&quot;</span><span class="o">%</span><span class="n">domain</span>
            <span class="n">msg2</span><span class="o">+=</span><span class="s">&quot;- name:</span><span class="si">%s</span><span class="se">\n</span><span class="s">&quot;</span><span class="o">%</span><span class="n">name</span>
            <span class="n">msg2</span><span class="o">+=</span><span class="s">&quot;- version:</span><span class="si">%s</span><span class="se">\n</span><span class="s">&quot;</span><span class="o">%</span><span class="n">version</span>
            <span class="n">msg2</span><span class="o">+=</span><span class="s">&quot;- platform:</span><span class="si">%s</span><span class="se">\n</span><span class="s">&quot;</span><span class="o">%</span><span class="n">platform</span>
            <span class="n">msg2</span><span class="o">+=</span><span class="s">&quot;- installed:</span><span class="si">%s</span><span class="se">\n</span><span class="s">&quot;</span><span class="o">%</span><span class="n">installed</span>
            <span class="n">msg2</span><span class="o">+=</span><span class="s">&quot;- instance:</span><span class="si">%s</span><span class="se">\n</span><span class="s">&quot;</span><span class="o">%</span><span class="n">instance</span>
            <span class="n">msg2</span><span class="o">+=</span><span class="s">&quot;ERROR:</span><span class="se">\n</span><span class="si">%s</span><span class="se">\n</span><span class="s">&quot;</span><span class="o">%</span><span class="n">msg</span>
            <span class="n">j</span><span class="o">.</span><span class="n">events</span><span class="o">.</span><span class="n">inputerror_critical</span><span class="p">(</span><span class="n">msg2</span><span class="p">,</span><span class="s">&quot;jpackage.find&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_init</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">interactive</span> <span class="ow">and</span> <span class="n">domain</span><span class="o">==</span><span class="bp">None</span><span class="p">:</span>
            <span class="n">domains</span><span class="o">=</span><span class="n">j</span><span class="o">.</span><span class="n">console</span><span class="o">.</span><span class="n">askChoiceMultiple</span><span class="p">(</span><span class="n">j</span><span class="o">.</span><span class="n">packages</span><span class="o">.</span><span class="n">getDomainNames</span><span class="p">())</span>
            <span class="n">result</span><span class="o">=</span><span class="p">[]</span>
            <span class="k">for</span> <span class="n">domain</span> <span class="ow">in</span> <span class="n">domains</span><span class="p">:</span>
                <span class="n">result</span><span class="o">+=</span><span class="bp">self</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">domain</span><span class="o">=</span><span class="n">domain</span><span class="p">,</span><span class="n">name</span><span class="o">=</span><span class="n">name</span> <span class="p">,</span> <span class="n">version</span><span class="o">=</span><span class="n">version</span><span class="p">,</span> <span class="n">platform</span><span class="o">=</span><span class="n">platform</span><span class="p">,</span><span class="n">onlyone</span><span class="o">=</span><span class="n">onlyone</span><span class="p">,</span><span class="n">installed</span><span class="o">=</span><span class="n">installed</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">result</span>

        <span class="k">if</span> <span class="n">interactive</span> <span class="ow">and</span> <span class="n">name</span><span class="o">==</span><span class="bp">None</span><span class="p">:</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">j</span><span class="o">.</span><span class="n">console</span><span class="o">.</span><span class="n">askString</span><span class="p">(</span><span class="s">&quot;Please provide the name or part of the name of the package to search for (e.g *extension* -&gt; lots of extensions)&quot;</span><span class="p">)</span>

        <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_find</span><span class="p">(</span><span class="n">domain</span><span class="o">=</span><span class="n">domain</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">version</span><span class="o">=</span><span class="n">version</span><span class="p">)</span>        
        
        <span class="k">if</span> <span class="n">res</span><span class="o">==</span><span class="p">[]:</span>
            <span class="n">raiseError</span><span class="p">(</span><span class="s">&#39;No packages found, did you forget to run &quot;jpackage mdupdate&quot;?&#39;</span><span class="p">,</span><span class="n">domain</span><span class="p">,</span><span class="n">name</span><span class="p">,</span><span class="n">version</span><span class="p">,</span><span class="n">platform</span><span class="p">,</span><span class="n">installed</span><span class="p">,</span><span class="n">instance</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">installed</span><span class="o">==</span><span class="bp">False</span> <span class="ow">and</span> <span class="n">instance</span><span class="o">&lt;&gt;</span><span class="bp">None</span><span class="p">:</span>
            <span class="n">msg</span><span class="o">=</span><span class="s">&quot;Cannot find a jpackage which is not installed and a instance specified (method find got installed==False &amp; instance specified).&quot;</span>
            <span class="n">raiseError</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span><span class="n">domain</span><span class="p">,</span><span class="n">name</span><span class="p">,</span><span class="n">version</span><span class="p">,</span><span class="n">platform</span><span class="p">,</span><span class="n">installed</span><span class="p">,</span><span class="n">instance</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">installed</span><span class="o">==</span><span class="bp">True</span><span class="p">:</span>
            <span class="n">res</span><span class="o">=</span><span class="p">[</span><span class="n">item</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">res</span> <span class="k">if</span> <span class="n">item</span><span class="o">.</span><span class="n">isInstalled</span><span class="p">(</span><span class="n">hrdcheck</span><span class="o">=</span><span class="bp">False</span><span class="p">)]</span>

        <span class="k">if</span> <span class="n">installed</span><span class="o">==</span><span class="bp">False</span><span class="p">:</span>
            <span class="n">res</span><span class="o">=</span><span class="p">[</span><span class="n">item</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">res</span> <span class="k">if</span> <span class="n">item</span><span class="o">.</span><span class="n">isInstalled</span><span class="p">(</span><span class="n">hrdcheck</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span><span class="o">==</span><span class="bp">False</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">instance</span><span class="o">&lt;&gt;</span><span class="bp">None</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">res</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">msg</span><span class="o">=</span><span class="s">&quot;Cannot find a jpackage for specified instance when more than 1 candidate found, specify domain &amp; name &amp; version more specific&quot;</span>
            <span class="n">raiseError</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span><span class="n">domain</span><span class="p">,</span><span class="n">name</span><span class="p">,</span><span class="n">version</span><span class="p">,</span><span class="n">platform</span><span class="p">,</span><span class="n">installed</span><span class="p">,</span><span class="n">instance</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">expandInstances</span><span class="p">:</span>
            <span class="c">#now check if there are instances</span>
            <span class="n">res2</span><span class="o">=</span><span class="p">[]</span>
            <span class="k">for</span> <span class="n">jp</span> <span class="ow">in</span> <span class="n">res</span><span class="p">:</span>
                <span class="n">root</span><span class="o">=</span><span class="n">j</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">joinPaths</span><span class="p">(</span><span class="n">j</span><span class="o">.</span><span class="n">dirs</span><span class="o">.</span><span class="n">packageDir</span><span class="p">,</span> <span class="s">&quot;instance&quot;</span><span class="p">,</span> <span class="n">jp</span><span class="o">.</span><span class="n">domain</span><span class="p">,</span><span class="n">jp</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">j</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="n">root</span><span class="p">):</span>
                    <span class="n">dirs</span><span class="o">=</span><span class="n">j</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">listDirsInDir</span><span class="p">(</span><span class="n">root</span><span class="p">,</span><span class="bp">False</span><span class="p">,</span><span class="bp">True</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">instancename</span> <span class="ow">in</span> <span class="n">dirs</span><span class="p">:</span>
                        <span class="n">jp2</span><span class="o">=</span><span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">jp</span><span class="p">)</span>
                        <span class="n">jp2</span><span class="o">.</span><span class="n">instance</span><span class="o">=</span><span class="n">instancename</span>
                        <span class="n">res2</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">jp2</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">res2</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">jp</span><span class="p">)</span>
            <span class="n">res</span><span class="o">=</span><span class="n">res2</span>

            <span class="k">if</span> <span class="n">instance</span><span class="o">&lt;&gt;</span><span class="bp">None</span><span class="p">:</span>
                <span class="n">res</span><span class="o">=</span><span class="p">[</span><span class="n">item</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">res</span> <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">instance</span><span class="p">)</span><span class="o">==</span><span class="n">instance</span><span class="p">]</span>

        <span class="c">#sort jpackages</span>
        <span class="n">tosortmeta</span><span class="o">=</span><span class="p">{}</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">res</span><span class="p">:</span>
            <span class="n">tosortmeta</span><span class="p">[</span><span class="s">&quot;</span><span class="si">%s</span><span class="s">_</span><span class="si">%s</span><span class="s">_</span><span class="si">%s</span><span class="s">_</span><span class="si">%s</span><span class="s">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">name</span><span class="p">,</span><span class="n">item</span><span class="o">.</span><span class="n">domain</span><span class="p">,</span><span class="n">item</span><span class="o">.</span><span class="n">version</span><span class="p">,</span><span class="n">item</span><span class="o">.</span><span class="n">instance</span><span class="p">)]</span><span class="o">=</span><span class="n">item</span>
        <span class="n">tosort</span><span class="o">=</span><span class="n">tosortmeta</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
        <span class="n">tosort</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
        <span class="n">res</span><span class="o">=</span><span class="p">[]</span>
        <span class="k">for</span> <span class="n">sortedkey</span> <span class="ow">in</span> <span class="n">tosort</span><span class="p">:</span>
            <span class="n">res</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tosortmeta</span><span class="p">[</span><span class="n">sortedkey</span><span class="p">])</span>

        <span class="k">if</span> <span class="n">onlyone</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">res</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">res</span> <span class="o">=</span> <span class="p">[</span><span class="n">j</span><span class="o">.</span><span class="n">console</span><span class="o">.</span><span class="n">askChoice</span><span class="p">(</span><span class="n">res</span><span class="p">,</span> <span class="s">&quot;Multiple packages found, please choose one&quot;</span><span class="p">)]</span>

        <span class="k">return</span> <span class="n">res</span>
</div>
    <span class="k">def</span> <span class="nf">_find</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">domain</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">,</span><span class="n">name</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">,</span> <span class="n">version</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Tries to find a package based on the provided criteria</span>
<span class="sd">        You may also use a wildcard to provide the name or domain (*partofname*)</span>
<span class="sd">        @param domain:  string - The name of jpackages domain, when using * means partial name</span>
<span class="sd">        @param name:    string - The name of the jpackages you are looking for, when using * means partial name</span>
<span class="sd">        @param version: string - The version of the jpackages you are looking for</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="n">j</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s">&quot;Find jpackages domain:</span><span class="si">%s</span><span class="s"> name:</span><span class="si">%s</span><span class="s"> version:</span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span><span class="p">(</span><span class="n">domain</span><span class="p">,</span><span class="n">name</span><span class="p">,</span><span class="n">version</span><span class="p">))</span>
        <span class="c">#work with some functional methods works faster than doing the check everytime</span>
        <span class="k">def</span> <span class="nf">findPartial</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span><span class="n">text</span><span class="p">):</span>
            <span class="n">pattern</span><span class="o">=</span><span class="n">pattern</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&quot;*&quot;</span><span class="p">,</span><span class="s">&quot;&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">text</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">pattern</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span><span class="o">&lt;&gt;-</span><span class="mi">1</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">True</span>
            <span class="k">return</span> <span class="bp">False</span>

        <span class="k">def</span> <span class="nf">findFull</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span><span class="n">text</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">pattern</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">==</span><span class="n">text</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>

        <span class="k">def</span> <span class="nf">alwaysReturnTrue</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span><span class="n">text</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">True</span>

        <span class="n">domainFindMethod</span><span class="o">=</span><span class="n">alwaysReturnTrue</span>
        <span class="n">nameFindMethod</span><span class="o">=</span><span class="n">alwaysReturnTrue</span>
        <span class="n">versionFindMethod</span><span class="o">=</span><span class="n">alwaysReturnTrue</span>

        <span class="k">if</span> <span class="n">domain</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">domain</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&quot;*&quot;</span><span class="p">)</span><span class="o">&lt;&gt;-</span><span class="mi">1</span><span class="p">:</span>
                <span class="n">domainFindMethod</span><span class="o">=</span><span class="n">findPartial</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">domainFindMethod</span><span class="o">=</span><span class="n">findFull</span>
        <span class="k">if</span> <span class="n">name</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">name</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&quot;*&quot;</span><span class="p">)</span><span class="o">&lt;&gt;-</span><span class="mi">1</span><span class="p">:</span>
                <span class="n">nameFindMethod</span><span class="o">=</span><span class="n">findPartial</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">nameFindMethod</span><span class="o">=</span><span class="n">findFull</span>
        <span class="k">if</span> <span class="n">version</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">version</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&quot;*&quot;</span><span class="p">)</span><span class="o">&lt;&gt;-</span><span class="mi">1</span><span class="p">:</span>
                <span class="n">versionFindMethod</span><span class="o">=</span><span class="n">findPartial</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">versionFindMethod</span><span class="o">=</span><span class="n">findFull</span>

        <span class="n">result</span><span class="o">=</span><span class="p">[]</span>
        
        <span class="k">for</span> <span class="n">p_domain</span><span class="p">,</span> <span class="n">p_name</span><span class="p">,</span> <span class="n">p_version</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_getJPackageTuples</span><span class="p">():</span>
            <span class="c"># print (p_domain, p_name, p_version)</span>
            <span class="k">if</span> <span class="n">domainFindMethod</span><span class="p">(</span><span class="n">domain</span><span class="p">,</span><span class="n">p_domain</span><span class="p">)</span> <span class="ow">and</span> <span class="n">nameFindMethod</span><span class="p">(</span><span class="n">name</span><span class="p">,</span><span class="n">p_name</span><span class="p">)</span> <span class="ow">and</span> <span class="n">versionFindMethod</span><span class="p">(</span><span class="n">version</span><span class="p">,</span><span class="n">p_version</span><span class="p">):</span>
                <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">p_domain</span><span class="p">,</span> <span class="n">p_name</span><span class="p">,</span> <span class="n">p_version</span><span class="p">])</span>

        <span class="n">result2</span><span class="o">=</span><span class="p">[]</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">result</span><span class="p">:</span>
                <span class="n">result2</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">item</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">item</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>
        <span class="k">return</span> <span class="n">result2</span>

    <span class="c"># Used in getJPackageObjects and that is use in find</span>
    <span class="k">def</span> <span class="nf">_getJPackageTuples</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_init</span><span class="p">()</span>
        <span class="n">res</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
        <span class="n">domains</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">getDomainNames</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">domainName</span> <span class="ow">in</span> <span class="n">domains</span><span class="p">:</span>
            <span class="n">domainpath</span><span class="o">=</span><span class="n">j</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">joinPaths</span><span class="p">(</span><span class="n">j</span><span class="o">.</span><span class="n">dirs</span><span class="o">.</span><span class="n">packageDirMD</span><span class="p">,</span> <span class="n">domainName</span><span class="p">)</span>
            
            <span class="k">if</span> <span class="n">j</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">domainpath</span><span class="p">):</span> <span class="c">#this follows the link</span>
                <span class="n">packages</span><span class="o">=</span> <span class="p">[</span><span class="n">p</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">j</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">listDirsInDir</span><span class="p">(</span><span class="n">domainpath</span><span class="p">,</span><span class="n">dirNameOnly</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span> <span class="k">if</span> <span class="n">p</span> <span class="o">!=</span> <span class="s">&#39;.hg&#39;</span><span class="p">]</span> <span class="c"># skip hg file</span>
                <span class="k">for</span> <span class="n">packagename</span> <span class="ow">in</span> <span class="n">packages</span><span class="p">:</span>
                    <span class="n">packagepath</span><span class="o">=</span><span class="n">j</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">joinPaths</span><span class="p">(</span><span class="n">domainpath</span><span class="p">,</span><span class="n">packagename</span><span class="p">)</span>
                    <span class="n">versions</span><span class="o">=</span><span class="n">j</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">listDirsInDir</span><span class="p">(</span><span class="n">packagepath</span><span class="p">,</span><span class="n">dirNameOnly</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">version</span> <span class="ow">in</span> <span class="n">versions</span><span class="p">:</span>
                        <span class="n">hrdfile</span> <span class="o">=</span> <span class="n">j</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">joinPaths</span><span class="p">(</span><span class="n">packagepath</span><span class="p">,</span> <span class="n">version</span><span class="p">,</span> <span class="s">&#39;hrd&#39;</span><span class="p">,</span> <span class="s">&#39;main.hrd&#39;</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">j</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">hrdfile</span><span class="p">):</span>
                            <span class="n">res</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">domainName</span><span class="p">,</span><span class="n">packagename</span><span class="p">,</span><span class="n">version</span><span class="p">])</span>

        <span class="k">return</span> <span class="n">res</span>

<div class="viewcode-block" id="JPackageClient.getJPackageObjects"><a class="viewcode-back" href="../../../../API/JumpScale.baselib.jpackages.html#JumpScale.baselib.jpackages.JPackageClient.JPackageClient.getJPackageObjects">[docs]</a>    <span class="k">def</span> <span class="nf">getJPackageObjects</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">platform</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">domain</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns a list of jpackages objects for specified platform &amp; domain</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_init</span><span class="p">()</span>
        <span class="n">packageObjects</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="o">*</span><span class="n">p</span><span class="p">)</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_getJPackageTuples</span><span class="p">()]</span>
        <span class="k">if</span> <span class="n">platform</span><span class="o">==</span><span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[</span><span class="n">p</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">packageObjects</span> <span class="k">if</span> <span class="p">(</span><span class="n">domain</span> <span class="o">==</span> <span class="bp">None</span> <span class="ow">or</span> <span class="n">p</span><span class="o">.</span><span class="n">domain</span> <span class="o">==</span> <span class="n">domain</span><span class="p">)]</span>

        <span class="k">def</span> <span class="nf">hasPlatform</span><span class="p">(</span><span class="n">package</span><span class="p">):</span>
            <span class="k">return</span> <span class="nb">any</span><span class="p">([</span><span class="n">supported</span> <span class="ow">in</span> <span class="n">j</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">platformtype</span><span class="o">.</span><span class="n">getParents</span><span class="p">(</span><span class="n">platform</span><span class="p">)</span> <span class="k">for</span> <span class="n">supported</span> <span class="ow">in</span> <span class="n">package</span><span class="o">.</span><span class="n">supportedPlatforms</span><span class="p">])</span>

        <span class="k">return</span> <span class="p">[</span><span class="n">p</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">packageObjects</span> <span class="k">if</span> <span class="n">hasPlatform</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">domain</span> <span class="o">==</span> <span class="bp">None</span> <span class="ow">or</span> <span class="n">p</span><span class="o">.</span><span class="n">domain</span> <span class="o">==</span> <span class="n">domain</span><span class="p">)]</span>
</div>
<div class="viewcode-block" id="JPackageClient.getPackagesWithBrokenDependencies"><a class="viewcode-back" href="../../../../API/JumpScale.baselib.jpackages.html#JumpScale.baselib.jpackages.JPackageClient.JPackageClient.getPackagesWithBrokenDependencies">[docs]</a>    <span class="k">def</span> <span class="nf">getPackagesWithBrokenDependencies</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">p</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">j</span><span class="o">.</span><span class="n">packages</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;*&#39;</span><span class="p">)</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">getBrokenDependencies</span><span class="p">())</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span>


<span class="c">############################################################</span>
<span class="c">#################  UPDATE / PUBLISH  #######################</span>
<span class="c">############################################################</span>
</div>
<div class="viewcode-block" id="JPackageClient.updateAll"><a class="viewcode-back" href="../../../../API/JumpScale.baselib.jpackages.html#JumpScale.baselib.jpackages.JPackageClient.JPackageClient.updateAll">[docs]</a>    <span class="k">def</span> <span class="nf">updateAll</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Updates all installed jpackages to the latest builds.</span>
<span class="sd">        The latest meta information is retrieved from the repository and based on this information,</span>
<span class="sd">        The install packages that have a buildnr that has been outdated our reinstall, thust updating them to the latest build.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_init</span><span class="p">()</span>
        <span class="c"># update all meta information:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">updateMetaData</span><span class="p">()</span>
        <span class="c"># iterate over all install packages and install them</span>
        <span class="c"># only when they are outdated will they truly install</span>
        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">getInstalledPackages</span><span class="p">():</span>
            <span class="n">p</span><span class="o">.</span><span class="n">install</span><span class="p">()</span>
    </div>
<div class="viewcode-block" id="JPackageClient.updateMetaDataAll"><a class="viewcode-back" href="../../../../API/JumpScale.baselib.jpackages.html#JumpScale.baselib.jpackages.JPackageClient.JPackageClient.updateMetaDataAll">[docs]</a>    <span class="k">def</span> <span class="nf">updateMetaDataAll</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">force</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Updates the metadata information of all jpackages</span>
<span class="sd">        This used to be called updateJPackage list</span>
<span class="sd">        @param is force True then local changes will be lost if any</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_init</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">updateMetaData</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">,</span><span class="n">force</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="JPackageClient.mergeMetaDataAll"><a class="viewcode-back" href="../../../../API/JumpScale.baselib.jpackages.html#JumpScale.baselib.jpackages.JPackageClient.JPackageClient.mergeMetaDataAll">[docs]</a>    <span class="k">def</span> <span class="nf">mergeMetaDataAll</span><span class="p">(</span><span class="bp">self</span><span class="p">,):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Tries to merge the metadata information of all jpackages with info on remote repo.</span>
<span class="sd">        This used to be called updateJPackage list</span>
<span class="sd">        &quot;&quot;&quot;</span>        
        <span class="bp">self</span><span class="o">.</span><span class="n">_init</span><span class="p">()</span>
        <span class="n">j</span><span class="o">.</span><span class="n">packages</span><span class="o">.</span><span class="n">mergeMetaData</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">)</span>        
        </div>
<div class="viewcode-block" id="JPackageClient.updateMetaDataForDomain"><a class="viewcode-back" href="../../../../API/JumpScale.baselib.jpackages.html#JumpScale.baselib.jpackages.JPackageClient.JPackageClient.updateMetaDataForDomain">[docs]</a>    <span class="k">def</span> <span class="nf">updateMetaDataForDomain</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">domainName</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Updates the meta information of specific domain</span>
<span class="sd">        This used to be called updateJPackage list</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_init</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">domainName</span><span class="o">==</span><span class="s">&quot;&quot;</span><span class="p">:</span>
            <span class="n">domainName</span> <span class="o">=</span> <span class="n">j</span><span class="o">.</span><span class="n">console</span><span class="o">.</span><span class="n">askChoice</span><span class="p">(</span><span class="n">j</span><span class="o">.</span><span class="n">packages</span><span class="o">.</span><span class="n">getDomainNames</span><span class="p">(),</span> <span class="s">&quot;Please choose a domain&quot;</span><span class="p">)</span>
        <span class="n">j</span><span class="o">.</span><span class="n">packages</span><span class="o">.</span><span class="n">getDomainObject</span><span class="p">(</span><span class="n">domainName</span><span class="p">)</span><span class="o">.</span><span class="n">updateMetadata</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">)</span>        

</div>
<div class="viewcode-block" id="JPackageClient.linkMetaData"><a class="viewcode-back" href="../../../../API/JumpScale.baselib.jpackages.html#JumpScale.baselib.jpackages.JPackageClient.JPackageClient.linkMetaData">[docs]</a>    <span class="k">def</span> <span class="nf">linkMetaData</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">domain</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Does an link of the meta information repo for each domain</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_init</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">resetState</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">domain</span><span class="o">&lt;&gt;</span><span class="s">&quot;&quot;</span><span class="p">:</span>
            <span class="n">j</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s">&quot;link metadata information for jpackages domain </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">domain</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">d</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">getDomainObject</span><span class="p">(</span><span class="n">domain</span><span class="p">)</span>
            <span class="n">d</span><span class="o">.</span><span class="n">linkMetadata</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">domainnames</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">getDomainNames</span><span class="p">()</span>            
            <span class="k">for</span> <span class="n">domainName</span> <span class="ow">in</span> <span class="n">domainnames</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">linkMetaData</span><span class="p">(</span><span class="n">domainName</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="JPackageClient.switchMetaData"><a class="viewcode-back" href="../../../../API/JumpScale.baselib.jpackages.html#JumpScale.baselib.jpackages.JPackageClient.JPackageClient.switchMetaData">[docs]</a>    <span class="k">def</span> <span class="nf">switchMetaData</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">toQualitylevel</span><span class="p">,</span><span class="n">domain</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">,</span><span class="n">disableDebug</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_init</span><span class="p">()</span>
        <span class="c"># self.resetState()</span>
        <span class="k">if</span> <span class="n">domain</span><span class="o">&lt;&gt;</span><span class="s">&quot;&quot;</span><span class="p">:</span>
            <span class="n">j</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s">&quot;Switch metadata quality level for jpackages domain </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">domain</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">d</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">getDomainObject</span><span class="p">(</span><span class="n">domain</span><span class="p">)</span>
            <span class="c"># from IPython import embed</span>
            <span class="c"># print &quot;DEBUG NOW switchMetaData&quot;</span>
            <span class="c"># embed()</span>
            
        <span class="k">else</span><span class="p">:</span>
            <span class="n">domainnames</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">getDomainNames</span><span class="p">()</span>            
            <span class="k">for</span> <span class="n">domainName</span> <span class="ow">in</span> <span class="n">domainnames</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">switchMetaData</span><span class="p">(</span><span class="n">toQualitylevel</span><span class="p">,</span> <span class="n">domainName</span><span class="p">,</span><span class="n">setDebugOff</span><span class="p">)</span>
</div>
    <span class="k">def</span> <span class="nf">_finddomain</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">name</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">cat</span> <span class="ow">in</span> <span class="n">j</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">listDirsInDir</span><span class="p">(</span><span class="s">&quot;/opt/code/&quot;</span><span class="p">,</span> <span class="n">recursive</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">dirNameOnly</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">findDirectorySymlinks</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">dname</span> <span class="ow">in</span> <span class="n">j</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">listDirsInDir</span><span class="p">(</span><span class="s">&quot;/opt/code/</span><span class="si">%s</span><span class="s">&quot;</span><span class="o">%</span><span class="n">cat</span><span class="p">,</span> <span class="n">recursive</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">dirNameOnly</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">findDirectorySymlinks</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">dname</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&quot;__jp_&quot;</span><span class="p">)</span><span class="o">&lt;&gt;-</span><span class="mi">1</span><span class="p">:</span>
                    <span class="n">dname2</span><span class="o">=</span><span class="n">dname</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&quot;__jp_&quot;</span><span class="p">,</span><span class="mi">1</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">dname2</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">==</span><span class="n">name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
                        <span class="k">return</span> <span class="s">&quot;/opt/code/</span><span class="si">%s</span><span class="s">/</span><span class="si">%s</span><span class="s">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">cat</span><span class="p">,</span><span class="n">dname</span><span class="p">)</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s">&quot;could not find domain for name:&#39;</span><span class="si">%s</span><span class="s">&#39;&quot;</span><span class="o">%</span><span class="n">name</span><span class="p">)</span>

<div class="viewcode-block" id="JPackageClient.disableDebugMetaData"><a class="viewcode-back" href="../../../../API/JumpScale.baselib.jpackages.html#JumpScale.baselib.jpackages.JPackageClient.JPackageClient.disableDebugMetaData">[docs]</a>    <span class="k">def</span> <span class="nf">disableDebugMetaData</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">qualitylevel</span><span class="p">,</span><span class="n">domain</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_init</span><span class="p">()</span>        
        <span class="c"># self.resetState()</span>
        <span class="k">if</span> <span class="n">domain</span><span class="o">&lt;&gt;</span><span class="s">&quot;&quot;</span><span class="p">:</span>
            <span class="n">j</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s">&quot;Disable debug mode for jpackages domain </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">domain</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

            <span class="n">path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_finddomain</span><span class="p">(</span><span class="n">domain</span><span class="p">)</span>
            <span class="c"># print &quot;JPACKAGEDOM:%s&quot;%path</span>
            <span class="n">dpath</span><span class="o">=</span><span class="s">&quot;</span><span class="si">%s</span><span class="s">/</span><span class="si">%s</span><span class="s">/&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">path</span><span class="p">,</span><span class="n">qualitylevel</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="n">j</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">listFilesInDir</span><span class="p">(</span><span class="n">dpath</span><span class="p">,</span><span class="bp">True</span><span class="p">,</span><span class="s">&quot;main.hrd&quot;</span><span class="p">):</span>
                <span class="n">hrd</span><span class="o">=</span><span class="n">j</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">hrd</span><span class="o">.</span><span class="n">getHRD</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
                <span class="n">hrd</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s">&quot;jp.debug&quot;</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">domainnames</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">getDomainNames</span><span class="p">()</span>            
            <span class="k">for</span> <span class="n">domainName</span> <span class="ow">in</span> <span class="n">domainnames</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">disableDebugMetaData</span><span class="p">(</span><span class="n">domainName</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="JPackageClient.updateMetaData"><a class="viewcode-back" href="../../../../API/JumpScale.baselib.jpackages.html#JumpScale.baselib.jpackages.JPackageClient.JPackageClient.updateMetaData">[docs]</a>    <span class="k">def</span> <span class="nf">updateMetaData</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">domain</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">,</span><span class="n">force</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Does an update of the meta information repo for each domain</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_init</span><span class="p">()</span>
        <span class="c"># self.resetState()</span>
        <span class="k">if</span> <span class="n">domain</span><span class="o">&lt;&gt;</span><span class="s">&quot;&quot;</span><span class="p">:</span>
            <span class="n">j</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s">&quot;Update metadata information for jpackages domain </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">domain</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">d</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">getDomainObject</span><span class="p">(</span><span class="n">domain</span><span class="p">)</span>
            <span class="n">d</span><span class="o">.</span><span class="n">updateMetadata</span><span class="p">(</span><span class="n">force</span><span class="o">=</span><span class="n">force</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">domainnames</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">getDomainNames</span><span class="p">()</span>            
            <span class="k">for</span> <span class="n">domainName</span> <span class="ow">in</span> <span class="n">domainnames</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">updateMetaData</span><span class="p">(</span><span class="n">domainName</span><span class="p">,</span> <span class="n">force</span><span class="o">=</span><span class="n">force</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="JPackageClient.mergeMetaData"><a class="viewcode-back" href="../../../../API/JumpScale.baselib.jpackages.html#JumpScale.baselib.jpackages.JPackageClient.JPackageClient.mergeMetaData">[docs]</a>    <span class="k">def</span> <span class="nf">mergeMetaData</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">domain</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">,</span> <span class="n">commitMessage</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Does an update of the meta information repo for each domain</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_init</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">j</span><span class="o">.</span><span class="n">application</span><span class="o">.</span><span class="n">shellconfig</span><span class="o">.</span><span class="n">interactive</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">commitMessage</span> <span class="o">==</span> <span class="s">&#39;&#39;</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s">&#39;Need commit message&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">domain</span><span class="o">&lt;&gt;</span><span class="s">&quot;&quot;</span><span class="p">:</span>
            <span class="n">j</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s">&quot;Merge metadata information for jpackages domain </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">domain</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">d</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">getDomainObject</span><span class="p">(</span><span class="n">domain</span><span class="p">)</span>
            <span class="n">d</span><span class="o">.</span><span class="n">mergeMetadata</span><span class="p">(</span><span class="n">commitMessage</span><span class="o">=</span><span class="n">commitMessage</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">domainName</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">getDomainNames</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">mergeMetaData</span><span class="p">(</span><span class="n">domainName</span><span class="p">,</span> <span class="n">commitMessage</span><span class="o">=</span><span class="n">commitMessage</span><span class="p">)</span>
</div>
    <span class="k">def</span> <span class="nf">_getQualityLevels</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">domain</span><span class="p">):</span>
        <span class="n">cfg</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sourcesConfig</span>        
        <span class="n">bitbucketreponame</span><span class="o">=</span><span class="n">cfg</span><span class="o">.</span><span class="n">getValue</span><span class="p">(</span> <span class="n">domain</span><span class="p">,</span> <span class="s">&#39;bitbucketreponame&#39;</span><span class="p">)</span>
        <span class="n">bitbucketaccount</span><span class="o">=</span><span class="n">cfg</span><span class="o">.</span><span class="n">getValue</span><span class="p">(</span> <span class="n">domain</span><span class="p">,</span> <span class="s">&#39;bitbucketaccount&#39;</span><span class="p">)</span>      
        <span class="n">qualityLevels</span><span class="o">=</span><span class="n">j</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">listDirsInDir</span><span class="p">(</span><span class="n">j</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">joinPaths</span><span class="p">(</span><span class="n">j</span><span class="o">.</span><span class="n">dirs</span><span class="o">.</span><span class="n">codeDir</span><span class="p">,</span><span class="n">bitbucketaccount</span><span class="p">,</span><span class="n">bitbucketreponame</span><span class="p">),</span><span class="n">dirNameOnly</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>        
        <span class="n">qualityLevels</span><span class="o">=</span><span class="p">[</span><span class="n">item</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">qualityLevels</span> <span class="k">if</span> <span class="n">item</span><span class="o">&lt;&gt;</span><span class="s">&quot;.hg&quot;</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">qualityLevels</span>
    
    <span class="k">def</span> <span class="nf">_getMetadataDir</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">domain</span><span class="p">,</span><span class="n">qualityLevel</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">descr</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">):</span>
        <span class="n">cfg</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sourcesConfig</span>        
        <span class="n">bitbucketreponame</span><span class="o">=</span><span class="n">cfg</span><span class="o">.</span><span class="n">getValue</span><span class="p">(</span> <span class="n">domain</span><span class="p">,</span> <span class="s">&#39;bitbucketreponame&#39;</span><span class="p">)</span>
        <span class="n">bitbucketaccount</span><span class="o">=</span><span class="n">cfg</span><span class="o">.</span><span class="n">getValue</span><span class="p">(</span> <span class="n">domain</span><span class="p">,</span> <span class="s">&#39;bitbucketaccount&#39;</span><span class="p">)</span>      
        <span class="k">if</span> <span class="n">descr</span><span class="o">==</span><span class="s">&quot;&quot;</span><span class="p">:</span>
            <span class="n">descr</span><span class="o">=</span><span class="s">&quot;please select your qualitylevel&quot;</span>
        <span class="k">if</span> <span class="n">qualityLevel</span><span class="o">==</span><span class="bp">None</span> <span class="ow">or</span> <span class="n">qualityLevel</span><span class="o">==</span><span class="s">&quot;&quot;</span><span class="p">:</span>
            <span class="n">qualityLevel</span><span class="o">=</span><span class="n">j</span><span class="o">.</span><span class="n">console</span><span class="o">.</span><span class="n">askChoice</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_getQualityLevels</span><span class="p">(</span><span class="n">domain</span><span class="p">),</span><span class="n">descr</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">j</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">joinPaths</span><span class="p">(</span><span class="n">j</span><span class="o">.</span><span class="n">dirs</span><span class="o">.</span><span class="n">codeDir</span><span class="p">,</span><span class="n">bitbucketaccount</span><span class="p">,</span><span class="n">bitbucketreponame</span><span class="p">,</span><span class="n">qualityLevel</span><span class="p">)</span>      

<div class="viewcode-block" id="JPackageClient.metadataDeleteQualityLevel"><a class="viewcode-back" href="../../../../API/JumpScale.baselib.jpackages.html#JumpScale.baselib.jpackages.JPackageClient.JPackageClient.metadataDeleteQualityLevel">[docs]</a>    <span class="k">def</span> <span class="nf">metadataDeleteQualityLevel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">domain</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">,</span><span class="n">qualityLevel</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Delete a quality level </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_init</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">domain</span><span class="o">&lt;&gt;</span><span class="s">&quot;&quot;</span><span class="p">:</span>
            <span class="n">j</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s">&quot;Delete quality level </span><span class="si">%s</span><span class="s"> for </span><span class="si">%s</span><span class="s">.&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">qualityLevel</span><span class="p">,</span><span class="n">domain</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">metadataPath</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_getMetadataDir</span><span class="p">(</span><span class="n">domain</span><span class="p">,</span><span class="n">qualityLevel</span><span class="p">)</span>            
            <span class="n">j</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">removeDirTree</span><span class="p">(</span><span class="n">metadataPath</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">j</span><span class="o">.</span><span class="n">application</span><span class="o">.</span><span class="n">shellconfig</span><span class="o">.</span><span class="n">interactive</span><span class="p">:</span>
                <span class="n">domainnames</span><span class="o">=</span><span class="n">j</span><span class="o">.</span><span class="n">console</span><span class="o">.</span><span class="n">askChoiceMultiple</span><span class="p">(</span><span class="n">j</span><span class="o">.</span><span class="n">packages</span><span class="o">.</span><span class="n">getDomainNames</span><span class="p">())</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">domainnames</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">getDomainNames</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">domainName</span> <span class="ow">in</span> <span class="n">domainnames</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">metadataDeleteQualityLevel</span><span class="p">(</span><span class="n">domainName</span><span class="p">,</span><span class="n">qualityLevel</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="JPackageClient.metadataCreateQualityLevel"><a class="viewcode-back" href="../../../../API/JumpScale.baselib.jpackages.html#JumpScale.baselib.jpackages.JPackageClient.JPackageClient.metadataCreateQualityLevel">[docs]</a>    <span class="k">def</span> <span class="nf">metadataCreateQualityLevel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">domain</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">,</span><span class="n">qualityLevelFrom</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">qualityLevelTo</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">force</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span><span class="n">link</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create a quality level starting from the qualitylevelFrom e.g. unstable to beta</span>
<span class="sd">        @param link if True will link the jpackages otherwise copy</span>
<span class="sd">        @param force, will delete the destination</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_init</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">domain</span><span class="o">&lt;&gt;</span><span class="s">&quot;&quot;</span><span class="p">:</span>
            <span class="n">j</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s">&quot;Create quality level for </span><span class="si">%s</span><span class="s"> from </span><span class="si">%s</span><span class="s"> to </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">domain</span><span class="p">,</span><span class="n">qualityLevelFrom</span><span class="p">,</span><span class="n">qualityLevelTo</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">metadataFrom</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_getMetadataDir</span><span class="p">(</span><span class="n">domain</span><span class="p">,</span><span class="n">qualityLevelFrom</span><span class="p">,</span><span class="s">&quot;please select your qualitylevel where you want to copy from for domain </span><span class="si">%s</span><span class="s">.&quot;</span> <span class="o">%</span> <span class="n">domain</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">qualityLevelTo</span><span class="o">==</span><span class="bp">None</span> <span class="ow">or</span> <span class="n">qualityLevelTo</span><span class="o">==</span><span class="s">&quot;&quot;</span><span class="p">:</span>
                <span class="n">qualityLevelTo</span><span class="o">=</span><span class="n">j</span><span class="o">.</span><span class="n">console</span><span class="o">.</span><span class="n">askString</span><span class="p">(</span><span class="s">&quot;Please specify qualitylevel you would like to create for domain </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">domain</span><span class="p">)</span>                
            <span class="n">metadataTo</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_getMetadataDir</span><span class="p">(</span><span class="n">domain</span><span class="p">,</span><span class="n">qualityLevelTo</span><span class="p">)</span>
            <span class="n">dirsfrom</span><span class="o">=</span><span class="n">j</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">listDirsInDir</span><span class="p">(</span><span class="n">metadataFrom</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">j</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">metadataTo</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">force</span> <span class="ow">or</span> <span class="n">j</span><span class="o">.</span><span class="n">console</span><span class="o">.</span><span class="n">askYesNo</span><span class="p">(</span><span class="s">&quot;metadata dir </span><span class="si">%s</span><span class="s"> exists, ok to remove?&quot;</span> <span class="o">%</span> <span class="n">metadataTo</span><span class="p">):</span>
                    <span class="n">j</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">removeDirTree</span><span class="p">(</span><span class="n">metadataTo</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s">&quot;Cannot continue to create metadata for new qualitylevel, because dest dir exists&quot;</span><span class="p">)</span>
            <span class="n">j</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">createDir</span><span class="p">(</span><span class="n">metadataTo</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">dirsfrom</span><span class="p">:</span>
                <span class="k">while</span> <span class="n">j</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">isLink</span><span class="p">(</span><span class="n">item</span><span class="p">):</span>
                    <span class="c">#look for source of link                </span>
                    <span class="n">item</span><span class="o">=</span><span class="n">j</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">readlink</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
                <span class="n">dirname</span><span class="o">=</span><span class="n">j</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">getDirName</span><span class="p">(</span> <span class="n">item</span><span class="o">+</span><span class="s">&quot;/&quot;</span><span class="p">,</span> <span class="n">lastOnly</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">link</span><span class="p">:</span>
                    <span class="n">j</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">symlink</span><span class="p">(</span> <span class="n">item</span><span class="p">,</span><span class="n">j</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">joinPaths</span><span class="p">(</span><span class="n">metadataTo</span><span class="p">,</span><span class="n">dirname</span><span class="p">),</span><span class="n">overwriteTarget</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">j</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">copyDirTree</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">j</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">joinPaths</span><span class="p">(</span><span class="n">metadataTo</span><span class="p">,</span><span class="n">dirname</span><span class="p">),</span> <span class="n">keepsymlinks</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">eraseDestination</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">j</span><span class="o">.</span><span class="n">application</span><span class="o">.</span><span class="n">shellconfig</span><span class="o">.</span><span class="n">interactive</span><span class="p">:</span>
                <span class="n">domainnames</span><span class="o">=</span><span class="n">j</span><span class="o">.</span><span class="n">console</span><span class="o">.</span><span class="n">askChoiceMultiple</span><span class="p">(</span><span class="n">j</span><span class="o">.</span><span class="n">packages</span><span class="o">.</span><span class="n">getDomainNames</span><span class="p">())</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">domainnames</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">getDomainNames</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">domainName</span> <span class="ow">in</span> <span class="n">domainnames</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">metadataCreateQualityLevel</span><span class="p">(</span><span class="n">domainName</span><span class="p">,</span><span class="n">qualityLevelFrom</span><span class="p">,</span><span class="n">qualityLevelTo</span><span class="p">,</span><span class="n">force</span><span class="p">,</span><span class="n">link</span><span class="p">)</span>

                
   </div>
<div class="viewcode-block" id="JPackageClient.publishMetaDataAsTarGz"><a class="viewcode-back" href="../../../../API/JumpScale.baselib.jpackages.html#JumpScale.baselib.jpackages.JPackageClient.JPackageClient.publishMetaDataAsTarGz">[docs]</a>    <span class="k">def</span> <span class="nf">publishMetaDataAsTarGz</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">domain</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">,</span><span class="n">qualityLevel</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Compresses the meta data of a domain into a tar and upload that tar to the bundleUpload server.</span>
<span class="sd">        After this the that uptain there metadata as a tar can download the latest metadata.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_init</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">domains</span><span class="o">==</span><span class="p">[]:</span>
            <span class="n">domains</span><span class="o">=</span><span class="n">j</span><span class="o">.</span><span class="n">console</span><span class="o">.</span><span class="n">askChoiceMultiple</span><span class="p">(</span><span class="n">j</span><span class="o">.</span><span class="n">packages</span><span class="o">.</span><span class="n">getDomainNames</span><span class="p">(),</span> <span class="s">&quot;Please select a domain&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">domains</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">domain</span> <span class="ow">in</span> <span class="n">domains</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">publishMetaDataAsTarGz</span><span class="p">(</span><span class="n">domain</span><span class="o">=</span><span class="n">domain</span><span class="p">,</span><span class="n">qualityLevel</span><span class="o">=</span><span class="n">qualityLevel</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">j</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s">&quot;Push metadata information for jpackages domain </span><span class="si">%s</span><span class="s"> to reposerver.&quot;</span> <span class="o">%</span> <span class="n">domain</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">qualityLevel</span><span class="o">==</span><span class="s">&quot;all&quot;</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">ql</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_getQualityLevels</span><span class="p">(</span><span class="n">domain</span><span class="p">):</span>
                    <span class="n">d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getDomainObject</span><span class="p">(</span><span class="n">domain</span><span class="p">,</span><span class="n">qualityLevel</span><span class="o">=</span><span class="n">ql</span><span class="p">)</span>
                    <span class="n">d</span><span class="o">.</span><span class="n">publishMetaDataAsTarGz</span><span class="p">()</span>                
            <span class="k">else</span><span class="p">:</span>
                <span class="n">d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getDomainObject</span><span class="p">(</span><span class="n">domain</span><span class="p">,</span><span class="n">qualityLevel</span><span class="o">=</span><span class="n">qualityLevel</span><span class="p">)</span>
                <span class="n">d</span><span class="o">.</span><span class="n">publishMetaDataAsTarGz</span><span class="p">()</span>
           </div>
<div class="viewcode-block" id="JPackageClient.publish"><a class="viewcode-back" href="../../../../API/JumpScale.baselib.jpackages.html#JumpScale.baselib.jpackages.JPackageClient.JPackageClient.publish">[docs]</a>    <span class="k">def</span> <span class="nf">publish</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">commitMessage</span><span class="p">,</span><span class="n">domain</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Publishes all domains&#39; bundles &amp; metadata (if no domain specified)</span>
<span class="sd">        @param commitMessage: string - The commit message you want to assign to the publish</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_init</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">domain</span><span class="o">==</span><span class="s">&quot;&quot;</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">domain</span> <span class="ow">in</span> <span class="n">j</span><span class="o">.</span><span class="n">packages</span><span class="o">.</span><span class="n">getDomainNames</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">publish</span><span class="p">(</span> <span class="n">commitMessage</span><span class="o">=</span><span class="n">commitMessage</span><span class="p">,</span><span class="n">domain</span><span class="o">=</span><span class="n">domain</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">domainobject</span><span class="o">=</span><span class="n">j</span><span class="o">.</span><span class="n">packages</span><span class="o">.</span><span class="n">getDomainObject</span><span class="p">(</span><span class="n">domain</span><span class="p">)</span>
            <span class="n">domainobject</span><span class="o">.</span><span class="n">publish</span><span class="p">(</span><span class="n">commitMessage</span><span class="o">=</span><span class="n">commitMessage</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="JPackageClient.publishAll"><a class="viewcode-back" href="../../../../API/JumpScale.baselib.jpackages.html#JumpScale.baselib.jpackages.JPackageClient.JPackageClient.publishAll">[docs]</a>    <span class="k">def</span> <span class="nf">publishAll</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">commitMessage</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Publish metadata &amp; bundles for all domains, for more informartion see publishDomain</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_init</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">commitMessage</span><span class="p">:</span>
            <span class="n">commitMessage</span> <span class="o">=</span> <span class="n">j</span><span class="o">.</span><span class="n">console</span><span class="o">.</span><span class="n">askString</span><span class="p">(</span><span class="s">&#39;please enter a commit message&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">domain</span> <span class="ow">in</span> <span class="n">j</span><span class="o">.</span><span class="n">packages</span><span class="o">.</span><span class="n">getDomainNames</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">publishDomain</span><span class="p">(</span><span class="n">domain</span><span class="p">,</span> <span class="n">commitMessage</span><span class="o">=</span><span class="n">commitMessage</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="JPackageClient.publishDomain"><a class="viewcode-back" href="../../../../API/JumpScale.baselib.jpackages.html#JumpScale.baselib.jpackages.JPackageClient.JPackageClient.publishDomain">[docs]</a>    <span class="k">def</span> <span class="nf">publishDomain</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">domain</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">,</span> <span class="n">commitMessage</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Publish metadata &amp; bundles for a domain. </span>
<span class="sd">        To publish a domain means to make your local changes to the corresponding domain available to other users.</span>
<span class="sd">        A domain can be changed in the following ways: a new package is created in it, a package in it is modified, a package in it is deleted.</span>
<span class="sd">        To make the changes available to others the new metadata is uploaded to the mercurial servers and for the packages whos files </span>
<span class="sd">        have been modified,</span>
<span class="sd">        new bundles are created and uploaded to the blobstor server</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_init</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">domain</span><span class="o">==</span><span class="s">&quot;&quot;</span><span class="p">:</span>
            <span class="n">domain</span><span class="o">=</span><span class="n">j</span><span class="o">.</span><span class="n">console</span><span class="o">.</span><span class="n">askChoice</span><span class="p">(</span><span class="n">j</span><span class="o">.</span><span class="n">packages</span><span class="o">.</span><span class="n">getDomainNames</span><span class="p">(),</span> <span class="s">&quot;Please select a domain&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">getDomainObject</span><span class="p">(</span><span class="n">domain</span><span class="p">)</span><span class="o">.</span><span class="n">_ensureDomainCanBeUpdated</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">getDomainObject</span><span class="p">(</span><span class="n">domain</span><span class="p">)</span><span class="o">.</span><span class="n">publish</span><span class="p">(</span><span class="n">commitMessage</span><span class="o">=</span><span class="n">commitMessage</span><span class="p">)</span>


<span class="c">##########################################################</span>
<span class="c">####################  RECONFIGURE  #######################</span>
<span class="c">##########################################################</span>
</div>
    <span class="k">def</span> <span class="nf">_setHasPackagesPendingConfiguration</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="nb">file</span> <span class="o">=</span> <span class="n">j</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">joinPaths</span><span class="p">(</span><span class="n">j</span><span class="o">.</span><span class="n">dirs</span><span class="o">.</span><span class="n">baseDir</span><span class="p">,</span> <span class="s">&#39;cfg&#39;</span><span class="p">,</span> <span class="s">&#39;jpackages&#39;</span><span class="p">,</span> <span class="s">&#39;reconfigure.cfg&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">j</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="nb">file</span><span class="p">):</span>
            <span class="n">ini_file</span> <span class="o">=</span> <span class="n">j</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">inifile</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="nb">file</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ini_file</span> <span class="o">=</span> <span class="n">j</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">inifile</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="nb">file</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">ini_file</span><span class="o">.</span><span class="n">checkSection</span><span class="p">(</span><span class="s">&#39;main&#39;</span><span class="p">):</span>
            <span class="n">ini_file</span><span class="o">.</span><span class="n">addSection</span><span class="p">(</span><span class="s">&#39;main&#39;</span><span class="p">)</span>


        <span class="n">ini_file</span><span class="o">.</span><span class="n">setParam</span><span class="p">(</span><span class="s">&quot;main&quot;</span><span class="p">,</span><span class="s">&quot;hasPackagesPendingConfiguration&quot;</span><span class="p">,</span> <span class="s">&quot;1&quot;</span> <span class="k">if</span> <span class="n">value</span> <span class="k">else</span> <span class="s">&quot;0&quot;</span><span class="p">)</span>
        <span class="n">ini_file</span><span class="o">.</span><span class="n">write</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_hasPackagesPendingConfiguration</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">file</span> <span class="o">=</span> <span class="n">j</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">joinPaths</span><span class="p">(</span><span class="n">j</span><span class="o">.</span><span class="n">dirs</span><span class="o">.</span><span class="n">baseDir</span><span class="p">,</span> <span class="s">&#39;cfg&#39;</span><span class="p">,</span> <span class="s">&#39;jpackages&#39;</span><span class="p">,</span> <span class="s">&#39;reconfigure.cfg&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">j</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="nb">file</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">False</span>
        <span class="n">ini_file</span> <span class="o">=</span> <span class="n">j</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">inifile</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="nb">file</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">ini_file</span><span class="o">.</span><span class="n">checkSection</span><span class="p">(</span><span class="s">&#39;main&#39;</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">ini_file</span><span class="o">.</span><span class="n">getValue</span><span class="p">(</span><span class="s">&quot;main&quot;</span><span class="p">,</span><span class="s">&quot;hasPackagesPendingConfiguration&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s">&#39;1&#39;</span>

        <span class="k">return</span> <span class="bp">False</span>

<div class="viewcode-block" id="JPackageClient.runConfigurationPending"><a class="viewcode-back" href="../../../../API/JumpScale.baselib.jpackages.html#JumpScale.baselib.jpackages.JPackageClient.JPackageClient.runConfigurationPending">[docs]</a>    <span class="k">def</span> <span class="nf">runConfigurationPending</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c">#@todo prob need to redo this and use redis or so, this is completely reloading all</span>
        <span class="c"># from IPython import embed</span>
        <span class="c"># print &quot;DEBUG NOW runConfigurationPending&quot;</span>
        <span class="c"># embed()</span>
        
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_hasPackagesPendingConfiguration</span><span class="p">():</span>
            <span class="k">return</span>

        <span class="c"># Get all packages that need reconfiguring and reconfigure them</span>
        <span class="c"># We store the state to reconfigure them in their state files</span>
        <span class="n">configuredPackages</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="n">currentPlatform</span> <span class="o">=</span> <span class="n">PlatformType</span><span class="o">.</span><span class="n">findPlatformType</span><span class="p">()</span>

        <span class="k">def</span> <span class="nf">configure</span><span class="p">(</span><span class="n">package</span><span class="p">):</span>
            <span class="c"># If already processed return</span>
            <span class="k">if</span> <span class="n">package</span> <span class="ow">in</span> <span class="n">configuredPackages</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">True</span>
            <span class="n">configuredPackages</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">package</span><span class="p">)</span>

            <span class="c"># first make sure depending packages are configured</span>
            <span class="k">for</span> <span class="n">dp</span> <span class="ow">in</span> <span class="n">package</span><span class="o">.</span><span class="n">getDependencies</span><span class="p">(</span><span class="n">recursive</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">platform</span><span class="o">=</span><span class="n">currentPlatform</span><span class="p">):</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">configure</span><span class="p">(</span><span class="n">dp</span><span class="p">):</span>
                    <span class="k">return</span> <span class="bp">False</span>

            <span class="c"># now configure the package</span>
            <span class="k">if</span> <span class="n">package</span><span class="o">.</span><span class="n">isPendingReconfiguration</span><span class="p">():</span>
                <span class="n">j</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s">&quot;jpackages </span><span class="si">%s</span><span class="s"> </span><span class="si">%s</span><span class="s"> </span><span class="si">%s</span><span class="s"> needs reconfiguration&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">package</span><span class="o">.</span><span class="n">domain</span><span class="p">,</span><span class="n">package</span><span class="o">.</span><span class="n">name</span><span class="p">,</span><span class="n">package</span><span class="o">.</span><span class="n">version</span><span class="p">),</span><span class="mi">3</span><span class="p">)</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">package</span><span class="o">.</span><span class="n">configure</span><span class="p">()</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="n">j</span><span class="o">.</span><span class="n">debugging</span><span class="o">.</span><span class="n">printTraceBack</span><span class="p">(</span><span class="s">&#39;Got error while reconfiguring &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">package</span><span class="p">))</span>
                    <span class="k">if</span> <span class="n">j</span><span class="o">.</span><span class="n">console</span><span class="o">.</span><span class="n">askChoice</span><span class="p">([</span><span class="s">&#39;Skip this one&#39;</span><span class="p">,</span> <span class="s">&#39;Go to shell&#39;</span><span class="p">],</span> <span class="s">&#39;What do you want to do?&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="s">&#39;Skip this one&#39;</span><span class="p">:</span>
                        <span class="k">return</span> <span class="bp">True</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">return</span> <span class="bp">False</span>
            <span class="k">return</span> <span class="bp">True</span>


        <span class="n">pendingPackages</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getPendingReconfigurationPackages</span><span class="p">()</span>
        <span class="n">hasPendingConfiguration</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">pendingPackages</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">configure</span><span class="p">(</span><span class="n">p</span><span class="p">):</span>
                <span class="n">hasPendingConfiguration</span> <span class="o">=</span> <span class="bp">True</span>
                <span class="k">break</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_setHasPackagesPendingConfiguration</span><span class="p">(</span><span class="n">hasPendingConfiguration</span><span class="p">)</span>


<span class="c">############################################################</span>
<span class="c">################  SUPPORTING FUNCTIONS  ####################</span>
<span class="c">############################################################</span>
</div>
    <span class="k">def</span> <span class="nf">_getVersionAsInt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">version</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        @param version is string</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">version</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&quot;,&quot;</span><span class="p">)</span><span class="o">&lt;&gt;-</span><span class="mi">1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s">&quot;version string can only contain numbers and . e.g. 1.1.1&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">version</span><span class="o">==</span><span class="s">&quot;&quot;</span><span class="p">:</span>
            <span class="n">version</span><span class="o">=</span><span class="s">&quot;0&quot;</span>
        <span class="k">if</span> <span class="n">version</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&quot;.&quot;</span><span class="p">)</span><span class="o">&lt;&gt;-</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">versions</span><span class="o">=</span><span class="n">version</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&quot;.&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">versions</span><span class="o">=</span><span class="p">[</span><span class="n">version</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">versions</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">4</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s">&quot;max level of versionlevels = 4 e.g. max 1.1.1.1&quot;</span><span class="p">)</span>
        <span class="c">#make sure always 4 levels of versions for comparison</span>
        <span class="k">while</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">versions</span><span class="p">)</span><span class="o">&lt;</span><span class="mi">4</span><span class="p">):</span>
            <span class="n">versions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&quot;0&quot;</span><span class="p">)</span>
        <span class="n">result</span><span class="o">=</span><span class="mi">0</span>
        <span class="k">for</span> <span class="n">counter</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">versions</span><span class="p">)):</span>
            <span class="n">level</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">versions</span><span class="p">)</span><span class="o">-</span><span class="n">counter</span><span class="o">-</span><span class="mi">1</span>
            <span class="k">if</span> <span class="n">versions</span><span class="p">[</span><span class="n">counter</span><span class="p">]</span><span class="o">==</span><span class="s">&quot;&quot;</span><span class="p">:</span>
                <span class="n">versions</span><span class="p">[</span><span class="n">counter</span><span class="p">]</span><span class="o">=</span><span class="s">&quot;0&quot;</span>
            <span class="n">result</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">result</span><span class="o">+</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">pow</span><span class="p">(</span><span class="mi">1000</span><span class="p">,</span><span class="n">level</span><span class="p">)</span><span class="o">*</span><span class="nb">int</span><span class="p">(</span><span class="n">versions</span><span class="p">[</span><span class="n">counter</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">())))</span>
        <span class="k">return</span> <span class="n">result</span>

<div class="viewcode-block" id="JPackageClient.pm_getJPackageConfig"><a class="viewcode-back" href="../../../../API/JumpScale.baselib.jpackages.html#JumpScale.baselib.jpackages.JPackageClient.JPackageClient.pm_getJPackageConfig">[docs]</a>    <span class="k">def</span> <span class="nf">pm_getJPackageConfig</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">jpackagesMDPath</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">JPackageConfig</span><span class="p">(</span><span class="n">jpackagesMDPath</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="JPackageClient.makeDependencyGraph"><a class="viewcode-back" href="../../../../API/JumpScale.baselib.jpackages.html#JumpScale.baselib.jpackages.JPackageClient.JPackageClient.makeDependencyGraph">[docs]</a>    <span class="k">def</span> <span class="nf">makeDependencyGraph</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Creates a graphical visualization of all dependencies between the JPackackages of all domains.</span>
<span class="sd">        This helps to quickly view and debug the dependencies and avoid errors.</span>
<span class="sd">        The target audience are the developers of accross groups and domains that depend on each others packages.</span>
<span class="sd">        </span>
<span class="sd">        The graph can be found here:   </span>
<span class="sd">        /opt/qbase5/var/jpackages/metadata/dependencyGraph.png</span>
<span class="sd">        </span>
<span class="sd">        Notes:  </span>
<span class="sd">        The graph omits the constraints, such as version numbers and platform.</span>
<span class="sd">        </span>
<span class="sd">        For completeness, a second graph is created that shows packages without andy dependencies (both ways). </span>
<span class="sd">        See: dependencyGraph_singleNodes.png</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="kn">from</span> <span class="nn">pygraphviz</span> <span class="kn">import</span> <span class="n">AGraph</span>  <span class="c">#import only here to avoid overhead</span>
        
        <span class="k">def</span> <span class="nf">_getPackageTagName</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">separator</span><span class="o">=</span><span class="s">&#39; - &#39;</span><span class="p">):</span>
            <span class="n">n</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">name</span>
            <span class="c">#n += &#39;\\n&#39;</span>
            <span class="c">#n  += obj.domain</span>
            <span class="k">return</span> <span class="n">n</span>

        <span class="n">j</span><span class="o">.</span><span class="n">console</span><span class="o">.</span><span class="n">echo</span><span class="p">(</span><span class="s">&quot;Making Dependency graph ... please wait.&quot;</span><span class="p">)</span>
    
        <span class="n">platform</span> <span class="o">=</span> <span class="n">PlatformType</span><span class="o">.</span><span class="n">getByName</span><span class="p">(</span><span class="s">&#39;generic&#39;</span><span class="p">)</span>
           
        <span class="n">g</span><span class="o">=</span><span class="n">AGraph</span><span class="p">(</span><span class="n">strict</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span><span class="n">directed</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">compound</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        
        <span class="n">g</span><span class="o">.</span><span class="n">graph_attr</span><span class="p">[</span><span class="s">&#39;rankdir&#39;</span><span class="p">]</span><span class="o">=</span><span class="s">&#39;LR&#39;</span>
        <span class="n">g</span><span class="o">.</span><span class="n">graph_attr</span><span class="p">[</span><span class="s">&#39;ratio&#39;</span><span class="p">]</span><span class="o">=</span><span class="mf">1.3</span>
    
        <span class="c">#Generate the graph</span>
        <span class="k">for</span> <span class="n">pack</span> <span class="ow">in</span> <span class="n">j</span><span class="o">.</span><span class="n">packages</span><span class="o">.</span><span class="n">getJPackageObjects</span><span class="p">():</span>
            <span class="n">dn</span><span class="o">=</span> <span class="s">&#39;cluster_&#39;</span><span class="o">+</span><span class="n">pack</span><span class="o">.</span><span class="n">domain</span>
            <span class="n">s</span><span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">add_subgraph</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="n">dn</span><span class="p">)</span>
            <span class="n">s</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="n">_getPackageTagName</span><span class="p">(</span><span class="n">pack</span><span class="p">))</span>
            
            <span class="n">x</span><span class="o">=</span><span class="n">g</span><span class="o">.</span><span class="n">get_node</span><span class="p">(</span><span class="n">_getPackageTagName</span><span class="p">(</span><span class="n">pack</span><span class="p">))</span>
            <span class="n">x</span><span class="o">.</span><span class="n">attr</span><span class="p">[</span><span class="s">&#39;label&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">_getPackageTagName</span><span class="p">(</span><span class="n">pack</span><span class="p">)</span>
            
            <span class="n">depList</span><span class="o">=</span> <span class="n">pack</span><span class="o">.</span><span class="n">getDependencies</span><span class="p">(</span><span class="n">platform</span><span class="p">,</span> <span class="n">recursive</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">dep</span> <span class="ow">in</span> <span class="n">depList</span><span class="p">:</span>
                <span class="n">g</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="n">_getPackageTagName</span><span class="p">(</span><span class="n">dep</span><span class="p">))</span>
                <span class="n">g</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">_getPackageTagName</span><span class="p">(</span><span class="n">pack</span><span class="p">),</span><span class="n">_getPackageTagName</span><span class="p">(</span><span class="n">dep</span><span class="p">))</span>
       
        <span class="c">#Separate nodes with and without links</span>
        <span class="n">singleNodes</span><span class="o">=</span><span class="p">[]</span>
        <span class="n">linkedNodes</span><span class="o">=</span><span class="p">[]</span>
        <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">g</span><span class="o">.</span><span class="n">nodes</span><span class="p">():</span>
            <span class="n">c</span><span class="o">=</span><span class="p">[]</span>
            <span class="n">c</span><span class="o">=</span><span class="n">g</span><span class="o">.</span><span class="n">neighbors</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">c</span><span class="o">==</span><span class="p">[]:</span>
                <span class="n">singleNodes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">linkedNodes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
     
        <span class="c">#Add the domain name to the graph</span>
        <span class="k">for</span> <span class="n">pack</span> <span class="ow">in</span> <span class="n">j</span><span class="o">.</span><span class="n">packages</span><span class="o">.</span><span class="n">getJPackageObjects</span><span class="p">():</span>
            <span class="n">n</span><span class="o">=</span><span class="n">pack</span><span class="o">.</span><span class="n">domain</span>
            <span class="n">dn</span><span class="o">=</span> <span class="s">&#39;cluster_&#39;</span><span class="o">+</span><span class="n">pack</span><span class="o">.</span><span class="n">domain</span>       
    
            <span class="n">s</span><span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">add_subgraph</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">dn</span><span class="p">)</span>
            <span class="n">s</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
                        
            <span class="n">x</span><span class="o">=</span><span class="n">g</span><span class="o">.</span><span class="n">get_node</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
            <span class="n">x</span><span class="o">.</span><span class="n">attr</span><span class="p">[</span><span class="s">&#39;label&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">n</span>
            <span class="n">x</span><span class="o">.</span><span class="n">attr</span><span class="p">[</span><span class="s">&#39;style&#39;</span><span class="p">]</span><span class="o">=</span><span class="s">&#39;filled&#39;</span>
            <span class="n">x</span><span class="o">.</span><span class="n">attr</span><span class="p">[</span><span class="s">&#39;shape&#39;</span><span class="p">]</span><span class="o">=</span><span class="s">&#39;box&#39;</span>
            
        <span class="c">#Create a second version, for the graph of single nodes</span>
        <span class="n">stemp</span><span class="o">=</span><span class="n">g</span><span class="o">.</span><span class="n">to_string</span><span class="p">()</span>        
        <span class="n">s</span><span class="o">=</span><span class="n">AGraph</span><span class="p">(</span><span class="n">stemp</span><span class="p">)</span>    
        
        <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">singleNodes</span><span class="p">:</span>
            <span class="n">g</span><span class="o">.</span><span class="n">delete_node</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
    
        <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">linkedNodes</span><span class="p">:</span>
            <span class="n">s</span><span class="o">.</span><span class="n">delete_node</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
        
        <span class="n">g</span><span class="o">.</span><span class="n">layout</span><span class="p">(</span><span class="n">prog</span><span class="o">=</span><span class="s">&#39;dot&#39;</span><span class="p">)</span>    
        <span class="n">graphPath</span> <span class="o">=</span> <span class="n">j</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">joinPaths</span><span class="p">(</span><span class="n">j</span><span class="o">.</span><span class="n">dirs</span><span class="o">.</span><span class="n">packageDirMD</span><span class="p">,</span><span class="s">&#39;dependencyGraph.png&#39;</span><span class="p">)</span>
        <span class="n">g</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="n">graphPath</span><span class="p">)</span>
    
        <span class="n">s</span><span class="o">.</span><span class="n">layout</span><span class="p">(</span><span class="n">prog</span><span class="o">=</span><span class="s">&#39;dot&#39;</span><span class="p">)</span>
        <span class="n">graphPath</span> <span class="o">=</span> <span class="n">j</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">joinPaths</span><span class="p">(</span><span class="n">j</span><span class="o">.</span><span class="n">dirs</span><span class="o">.</span><span class="n">packageDirMD</span><span class="p">,</span><span class="s">&#39;dependencyGraph_singleNodes.png&#39;</span><span class="p">)</span>
        <span class="n">s</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="n">graphPath</span><span class="p">)</span>

        <span class="n">j</span><span class="o">.</span><span class="n">console</span><span class="o">.</span><span class="n">echo</span><span class="p">(</span><span class="s">&quot;Dependency graph successfully created. Open file at /opt/qbase5/var/jpackages/metadata/dependencyGraph.png&quot;</span><span class="p">)</span>

<span class="c">############################################################</span>
<span class="c">################  RECOVERY FUNCTIONS  ####################</span>
<span class="c">############################################################</span></div>
<div class="viewcode-block" id="JPackageClient.uploadLocalJpackagesToBlobStor"><a class="viewcode-back" href="../../../../API/JumpScale.baselib.jpackages.html#JumpScale.baselib.jpackages.JPackageClient.JPackageClient.uploadLocalJpackagesToBlobStor">[docs]</a>    <span class="k">def</span> <span class="nf">uploadLocalJpackagesToBlobStor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">blobservername</span><span class="o">=</span><span class="s">&quot;jpackages_remote&quot;</span><span class="p">,</span><span class="n">history</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">jp</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">getJPackageObjects</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">history</span><span class="o">==</span><span class="bp">False</span><span class="p">:</span>
                <span class="n">jp</span><span class="o">.</span><span class="n">uploadExistingBlobs</span><span class="p">(</span><span class="n">blobservername</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">jp</span><span class="o">.</span><span class="n">uploadExistingBlobsFromHistory</span><span class="p">(</span><span class="n">blobservername</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="JPackageClient.checkJpackagesExistsOnRemoteBlobStor"><a class="viewcode-back" href="../../../../API/JumpScale.baselib.jpackages.html#JumpScale.baselib.jpackages.JPackageClient.JPackageClient.checkJpackagesExistsOnRemoteBlobStor">[docs]</a>    <span class="k">def</span> <span class="nf">checkJpackagesExistsOnRemoteBlobStor</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">notfound2</span><span class="o">=</span><span class="p">[]</span>
        <span class="k">print</span> <span class="s">&quot;JPACKAGES WITH INCOMPLETE BLOBSTOR&quot;</span>
        <span class="k">for</span> <span class="n">jp</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">getJPackageObjects</span><span class="p">():</span>
            <span class="n">notfound</span><span class="o">=</span><span class="n">jp</span><span class="o">.</span><span class="n">checkExistingBlobs</span><span class="p">(</span><span class="s">&quot;jpackages_remote&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">notfound</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
                <span class="n">notf</span><span class="o">=</span><span class="p">[</span><span class="n">jp</span><span class="o">.</span><span class="n">domain</span><span class="p">,</span><span class="n">jp</span><span class="o">.</span><span class="n">name</span><span class="p">,</span><span class="n">jp</span><span class="o">.</span><span class="n">buildNr</span><span class="p">,</span><span class="s">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">notfound</span><span class="p">)]</span>
                <span class="k">print</span> <span class="n">notf</span>
                <span class="n">notfound2</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">notf</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">notfound2</span>
</pre></div></div></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../../../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../../genindex.html" title="General Index"
             >index</a></li>
        <li><a href="../../../../index.html">Jumpscale Doc 7.0 documentation</a> &raquo;</li>
          <li><a href="../../../index.html" >Module code</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
    </div>
  </body>
</html>