<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>JumpScale.core.logging.LogHandler &mdash; Jumpscale Doc 7.0 documentation</title>
    
    <link rel="stylesheet" href="../../../../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../../../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../../',
        VERSION:     '7.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../../_static/doctools.js"></script>
    <link rel="top" title="Jumpscale Doc 7.0 documentation" href="../../../../index.html" />
    <link rel="up" title="Module code" href="../../../index.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../../../../index.html">Jumpscale Doc 7.0 documentation</a> &raquo;</li>
          <li><a href="../../../index.html" accesskey="U">Module code</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <h1>Source code for JumpScale.core.logging.LogHandler</h1><div class="highlight"><pre>
<span class="kn">import</span> <span class="nn">itertools</span>
<span class="kn">import</span> <span class="nn">functools</span>
<span class="kn">from</span> <span class="nn">JumpScale</span> <span class="kn">import</span> <span class="n">j</span>
<span class="kn">from</span> <span class="nn">.logtargets.LogTargetFS</span> <span class="kn">import</span> <span class="n">LogTargetFS</span>
<span class="kn">from</span> <span class="nn">.logtargets.LogTargetStdOut</span> <span class="kn">import</span> <span class="n">LogTargetStdOut</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">traceback</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>

<span class="k">try</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">cStringIO</span> <span class="kn">import</span> <span class="n">StringIO</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="kn">from</span> <span class="nn">StringIO</span> <span class="kn">import</span> <span class="n">StringIO</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="kn">from</span> <span class="nn">io</span> <span class="kn">import</span> <span class="n">StringIO</span>


<span class="c"># from logtargets.LogTargetFS import LogTargetFS</span>
<span class="c"># from logtargets.LogTargetStdOut import LogTargetStdOut</span>
<span class="c">#@todo P3 low prio, to get log handlers back working</span>

<span class="n">SAFE_CHARS_REGEX</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s">&quot;[^ -~</span><span class="se">\n</span><span class="s">]&quot;</span><span class="p">)</span>


<div class="viewcode-block" id="toolStripNonAsciFromText"><a class="viewcode-back" href="../../../../API/JumpScale.core.logging.html#JumpScale.core.logging.LogHandler.toolStripNonAsciFromText">[docs]</a><span class="k">def</span> <span class="nf">toolStripNonAsciFromText</span><span class="p">(</span><span class="n">text</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Filter out characters not between &#39; &#39; and &#39;~&#39; with an exception for</span>
<span class="sd">    newlines.</span>

<span class="sd">    @param text: text to strip characters from</span>
<span class="sd">    @type text: basestring</span>
<span class="sd">    @return: the stripped text</span>
<span class="sd">    @rtype: basestring</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">SAFE_CHARS_REGEX</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="LogUtils"><a class="viewcode-back" href="../../../../API/JumpScale.core.logging.html#JumpScale.core.logging.LogHandler.LogUtils">[docs]</a><span class="k">class</span> <span class="nc">LogUtils</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Some log related utilities.</span>
<span class="sd">    &quot;&quot;&quot;</span>
<div class="viewcode-block" id="LogUtils.trace"><a class="viewcode-back" href="../../../../API/JumpScale.core.logging.html#JumpScale.core.logging.LogHandler.LogUtils.trace">[docs]</a>    <span class="k">def</span> <span class="nf">trace</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">enabled</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Decorator factory. Use enabled to avoid the logging overhead when it&#39;s</span>
<span class="sd">        not needed. Do not the tracing can *not* be enabled or disabled at</span>
<span class="sd">        runtime.</span>

<span class="sd">        Typical usage:</span>

<span class="sd">        TRACING_ENABLED = True</span>

<span class="sd">        @j.logger.utils.trace(level=3, enabled=TRACING_ENABLED)</span>
<span class="sd">        def myFunc(arg1, arg2=12):</span>
<span class="sd">            ...</span>

<span class="sd">        @param level: level to log the calls on</span>
<span class="sd">        @type level: int</span>
<span class="sd">        @param enabled: whether or not to disable the tracing</span>
<span class="sd">        @type enabled: boolean</span>
<span class="sd">        @return: decorator factory</span>
<span class="sd">        @rtype: callable</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">enabled</span><span class="p">:</span>
            <span class="k">def</span> <span class="nf">decorator</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
                <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">                Decorator to log how and when the wrapped function is called.</span>

<span class="sd">                @param func: function to be wrapped</span>
<span class="sd">                @type func: callable</span>
<span class="sd">                @return: wrapped function</span>
<span class="sd">                @rtype: callable</span>
<span class="sd">                &quot;&quot;&quot;</span>
                <span class="nd">@functools.wraps</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
                <span class="k">def</span> <span class="nf">wrappedFunc</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
                    <span class="n">argiter</span> <span class="o">=</span> <span class="n">itertools</span><span class="o">.</span><span class="n">chain</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="p">[</span><span class="s">&quot;</span><span class="si">%s</span><span class="s">=</span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span>
                                                     <span class="n">kwargs</span><span class="o">.</span><span class="n">iteritems</span><span class="p">()])</span>
                    <span class="n">descr</span> <span class="o">=</span> <span class="s">&quot;</span><span class="si">%s</span><span class="s">(</span><span class="si">%s</span><span class="s">)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">func</span><span class="o">.</span><span class="n">__name__</span><span class="p">,</span> <span class="s">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">argiter</span><span class="p">))</span>
                    <span class="n">j</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s">&quot;Calling &quot;</span> <span class="o">+</span> <span class="n">descr</span><span class="p">,</span> <span class="n">level</span><span class="p">)</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="k">return</span> <span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
                    <span class="k">finally</span><span class="p">:</span>
                        <span class="n">j</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s">&quot;Called &quot;</span> <span class="o">+</span> <span class="n">descr</span><span class="p">,</span> <span class="n">level</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">wrappedFunc</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">def</span> <span class="nf">decorator</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">func</span>
        <span class="k">return</span> <span class="n">decorator</span>
</div></div>
<div class="viewcode-block" id="LogItem"><a class="viewcode-back" href="../../../../API/JumpScale.core.logging.html#JumpScale.core.logging.LogHandler.LogItem">[docs]</a><span class="k">class</span> <span class="nc">LogItem</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">,</span> <span class="n">category</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">,</span> <span class="n">tags</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">jid</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">,</span> <span class="n">parentjid</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">,</span> <span class="n">masterjid</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">,</span> <span class="n">private</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">epoch</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">message</span> <span class="o">=</span> <span class="n">message</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\r\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="s">&quot;/n&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="s">&quot;/n&quot;</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">level</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">level</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">level</span><span class="o">=</span><span class="mi">5</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">category</span> <span class="o">=</span> <span class="n">category</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&quot;.&quot;</span><span class="p">,</span> <span class="s">&quot;_&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">j</span><span class="o">.</span><span class="n">application</span><span class="o">.</span><span class="n">whoAmI</span><span class="p">:</span>
            
            <span class="bp">self</span><span class="o">.</span><span class="n">gid</span> <span class="o">=</span> <span class="n">j</span><span class="o">.</span><span class="n">application</span><span class="o">.</span><span class="n">whoAmI</span><span class="o">.</span><span class="n">gid</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">nid</span> <span class="o">=</span> <span class="n">j</span><span class="o">.</span><span class="n">application</span><span class="o">.</span><span class="n">whoAmI</span><span class="o">.</span><span class="n">nid</span>            
            <span class="bp">self</span><span class="o">.</span><span class="n">pid</span> <span class="o">=</span> <span class="n">j</span><span class="o">.</span><span class="n">application</span><span class="o">.</span><span class="n">whoAmI</span><span class="o">.</span><span class="n">pid</span>
            <span class="c"># if hasattr(j, &#39;core&#39;) and hasattr(j.core, &#39;grid&#39;) and hasattr(j.core.grid, &#39;aid&#39;):</span>
            <span class="c">#     self.aid = j.core.grid.aid</span>
            <span class="c"># else:</span>
            <span class="c">#     self.aid = 0</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">appname</span> <span class="o">=</span> <span class="n">j</span><span class="o">.</span><span class="n">application</span><span class="o">.</span><span class="n">appname</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tags</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">tags</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\r\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="s">&quot;/n&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="s">&quot;/n&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&quot;|&quot;</span><span class="p">,</span> <span class="s">&quot;/|&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">jid</span><span class="o">==</span><span class="s">&quot;&quot;</span> <span class="ow">and</span> <span class="n">j</span><span class="o">.</span><span class="n">application</span><span class="o">.</span><span class="n">jid</span><span class="o">&lt;&gt;</span><span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">jid</span><span class="o">=</span><span class="n">j</span><span class="o">.</span><span class="n">application</span><span class="o">.</span><span class="n">jid</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">jid</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">jid</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parentjid</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">parentjid</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">masterjid</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">masterjid</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">epoch</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">epoch</span><span class="p">)</span> <span class="ow">or</span> <span class="n">j</span><span class="o">.</span><span class="n">base</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">getTimeEpoch</span><span class="p">()</span>
        <span class="n">j</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">order</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="c"># if j.logger.order &gt; 10000:</span>
        <span class="c">#     j.logger.order = 1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">order</span> <span class="o">=</span> <span class="n">j</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">order</span>
        <span class="k">if</span> <span class="n">private</span> <span class="o">==</span> <span class="bp">True</span> <span class="ow">or</span> <span class="nb">int</span><span class="p">(</span><span class="n">private</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">private</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">private</span> <span class="o">=</span> <span class="mi">0</span>

<div class="viewcode-block" id="LogItem.getSetGuid"><a class="viewcode-back" href="../../../../API/JumpScale.core.logging.html#JumpScale.core.logging.LogHandler.LogItem.getSetGuid">[docs]</a>    <span class="k">def</span> <span class="nf">getSetGuid</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        use osis to define &amp; set unique guid (sometimes also id)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gid</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gid</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pid</span><span class="o">&lt;&gt;</span><span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">guid</span> <span class="o">=</span> <span class="s">&quot;</span><span class="si">%s</span><span class="s">_</span><span class="si">%s</span><span class="s">_</span><span class="si">%s</span><span class="s">&quot;</span><span class="o">%</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gid</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">pid</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">order</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">guid</span> <span class="o">=</span> <span class="s">&quot;</span><span class="si">%s</span><span class="s">_</span><span class="si">%s</span><span class="s">_</span><span class="si">%s</span><span class="s">_</span><span class="si">%s</span><span class="s">&quot;</span><span class="o">%</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gid</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">nid</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">epoch</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">order</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">guid</span>
</div>
<div class="viewcode-block" id="LogItem.toJson"><a class="viewcode-back" href="../../../../API/JumpScale.core.logging.html#JumpScale.core.logging.LogHandler.LogItem.toJson">[docs]</a>    <span class="k">def</span> <span class="nf">toJson</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">j</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">serializers</span><span class="o">.</span><span class="n">ujson</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__dict__</span><span class="p">)</span>
</div>
    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">category</span><span class="o">!=</span><span class="s">&quot;&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="s">&quot;</span><span class="si">%s</span><span class="s">: </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">category</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&quot;_&quot;</span><span class="p">,</span><span class="s">&quot;.&quot;</span><span class="p">),</span><span class="bp">self</span><span class="o">.</span><span class="n">message</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ttime</span><span class="o">=</span><span class="n">time</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s">&quot;%H:%M:%S: &quot;</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">fromtimestamp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">epoch</span><span class="p">)</span><span class="o">.</span><span class="n">timetuple</span><span class="p">())</span>
            <span class="n">message</span><span class="o">=</span><span class="s">&quot;</span><span class="si">%s</span><span class="s"> </span><span class="si">%s</span><span class="s"> </span><span class="si">%s%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">level</span><span class="p">,</span> <span class="n">j</span><span class="o">.</span><span class="n">application</span><span class="o">.</span><span class="n">appname</span> <span class="p">,</span> <span class="n">ttime</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">message</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">message</span>

    <span class="n">__repr__</span> <span class="o">=</span> <span class="n">__str__</span>
</div>
<div class="viewcode-block" id="LogItemFromDict"><a class="viewcode-back" href="../../../../API/JumpScale.core.logging.html#JumpScale.core.logging.LogHandler.LogItemFromDict">[docs]</a><span class="k">class</span> <span class="nc">LogItemFromDict</span><span class="p">(</span><span class="n">LogItem</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">ddict</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__dict__</span><span class="o">=</span><span class="n">ddict</span>
</div>
<div class="viewcode-block" id="LogHandler"><a class="viewcode-back" href="../../../../API/JumpScale.core.logging.html#JumpScale.core.logging.LogHandler.LogHandler">[docs]</a><span class="k">class</span> <span class="nc">LogHandler</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        This empties the log targets</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">utils</span> <span class="o">=</span> <span class="n">LogUtils</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>        

<div class="viewcode-block" id="LogHandler.getLogObjectFromDict"><a class="viewcode-back" href="../../../../API/JumpScale.core.logging.html#JumpScale.core.logging.LogHandler.LogHandler.getLogObjectFromDict">[docs]</a>    <span class="k">def</span> <span class="nf">getLogObjectFromDict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ddict</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">LogItemFromDict</span><span class="p">(</span><span class="n">ddict</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="LogHandler.nologger"><a class="viewcode-back" href="../../../../API/JumpScale.core.logging.html#JumpScale.core.logging.LogHandler.LogHandler.nologger">[docs]</a>    <span class="k">def</span> <span class="nf">nologger</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">func</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Decorator to disable logging for a specific method (probably not thread safe)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">def</span> <span class="nf">wrapper</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
            <span class="n">previousvalue</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">enabled</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">enabled</span> <span class="o">=</span> <span class="bp">False</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="k">finally</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">enabled</span> <span class="o">=</span> <span class="n">previousvalue</span>
        <span class="k">return</span> <span class="n">wrapper</span>
</div>
<div class="viewcode-block" id="LogHandler.nostdout"><a class="viewcode-back" href="../../../../API/JumpScale.core.logging.html#JumpScale.core.logging.LogHandler.LogHandler.nostdout">[docs]</a>    <span class="k">def</span> <span class="nf">nostdout</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">class</span> <span class="nc">NoStdout</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
            <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_original_stderr</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_original_stdout</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_buffer</span> <span class="o">=</span> <span class="n">StringIO</span><span class="p">()</span>

            <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">func</span><span class="p">):</span>
                <span class="k">def</span> <span class="nf">wrapper</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
                    <span class="k">with</span> <span class="bp">self</span><span class="p">:</span>
                        <span class="k">return</span> <span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">wrapper</span>

            <span class="k">def</span> <span class="nf">__enter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
                <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_buffer</span>
                <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_buffer</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_buffer</span>

            <span class="k">def</span> <span class="nf">__exit__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
                <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_original_stdout</span>
                <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_original_stderr</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_buffer</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">NoStdout</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="LogHandler.reset"><a class="viewcode-back" href="../../../../API/JumpScale.core.logging.html#JumpScale.core.logging.LogHandler.LogHandler.reset">[docs]</a>    <span class="k">def</span> <span class="nf">reset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">maxlevel</span> <span class="o">=</span> <span class="mi">6</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">consoleloglevel</span> <span class="o">=</span> <span class="mi">2</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">consolelogCategories</span><span class="o">=</span><span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lastmessage</span> <span class="o">=</span> <span class="s">&quot;&quot;</span>
        <span class="c"># self.lastloglevel=0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nolog</span> <span class="o">=</span> <span class="bp">False</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_lastcleanuptime</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_lastinittime</span> <span class="o">=</span> <span class="mi">9999999999</span>  <span class="c"># every 5 seconds want to reinit the logger to make sure all targets which are available are connected</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">logTargets</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">inlog</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">enabled</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logTargetLogForwarder</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">order</span> <span class="o">=</span> <span class="mi">0</span>
</div>
<div class="viewcode-block" id="LogHandler.addConsoleLogCategory"><a class="viewcode-back" href="../../../../API/JumpScale.core.logging.html#JumpScale.core.logging.LogHandler.LogHandler.addConsoleLogCategory">[docs]</a>    <span class="k">def</span> <span class="nf">addConsoleLogCategory</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">category</span><span class="p">):</span>
        <span class="n">category</span><span class="o">=</span><span class="n">category</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">category</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">consolelogCategories</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">consolelogCategories</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">category</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="LogHandler.addLogTargetStdOut"><a class="viewcode-back" href="../../../../API/JumpScale.core.logging.html#JumpScale.core.logging.LogHandler.LogHandler.addLogTargetStdOut">[docs]</a>    <span class="k">def</span> <span class="nf">addLogTargetStdOut</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logTargetAdd</span><span class="p">(</span><span class="n">LogTargetStdOut</span><span class="p">())</span>
</div>
<div class="viewcode-block" id="LogHandler.addLogTargetLocalFS"><a class="viewcode-back" href="../../../../API/JumpScale.core.logging.html#JumpScale.core.logging.LogHandler.LogHandler.addLogTargetLocalFS">[docs]</a>    <span class="k">def</span> <span class="nf">addLogTargetLocalFS</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logTargetAdd</span><span class="p">(</span><span class="n">LogTargetFS</span><span class="p">())</span>
</div>
<div class="viewcode-block" id="LogHandler.setLogTargetLogForwarder"><a class="viewcode-back" href="../../../../API/JumpScale.core.logging.html#JumpScale.core.logging.LogHandler.LogHandler.setLogTargetLogForwarder">[docs]</a>    <span class="k">def</span> <span class="nf">setLogTargetLogForwarder</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">serverip</span><span class="o">=</span><span class="s">&quot;127.0.0.1&quot;</span><span class="p">,</span><span class="n">port</span><span class="o">=</span><span class="mi">7768</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        there will be only logging to stdout (if q.loghandler.consoleloglevel set properly)</span>
<span class="sd">        &amp; to the LogForwarder</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">logtargets.LogTargetLogForwarder</span> <span class="kn">import</span> <span class="n">LogTargetLogForwarder</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logs</span><span class="o">=</span><span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">inlog</span><span class="o">=</span><span class="bp">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">order</span><span class="o">=</span><span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logTargetLogForwarder</span> <span class="o">=</span> <span class="n">LogTargetLogForwarder</span><span class="p">(</span><span class="n">serverip</span><span class="o">=</span><span class="n">serverip</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="n">port</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="LogHandler.disable"><a class="viewcode-back" href="../../../../API/JumpScale.core.logging.html#JumpScale.core.logging.LogHandler.LogHandler.disable">[docs]</a>    <span class="k">def</span> <span class="nf">disable</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">enabled</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">logTargets</span><span class="p">:</span>
            <span class="n">t</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logTargets</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">if</span> <span class="s">&quot;console&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">__dict__</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">console</span><span class="o">.</span><span class="n">disconnect</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">console</span> <span class="o">=</span> <span class="bp">None</span>
</div>
    <span class="k">def</span> <span class="nf">_init</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        called by jumpscale</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span>  <span class="c"># need to rewrite logging</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_lastinittime</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nolog</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="n">inifile</span> <span class="o">=</span> <span class="n">j</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">getInifile</span><span class="p">(</span><span class="s">&quot;main&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">inifile</span><span class="o">.</span><span class="n">checkParam</span><span class="p">(</span><span class="s">&quot;main&quot;</span><span class="p">,</span> <span class="s">&quot;lastlogcleanup&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="bp">False</span><span class="p">:</span>
            <span class="n">inifile</span><span class="o">.</span><span class="n">setParam</span><span class="p">(</span><span class="s">&quot;main&quot;</span><span class="p">,</span> <span class="s">&quot;lastlogcleanup&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_lastcleanuptime</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">inifile</span><span class="o">.</span><span class="n">getValue</span><span class="p">(</span><span class="s">&quot;main&quot;</span><span class="p">,</span> <span class="s">&quot;lastlogcleanup&quot;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nolog</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="kn">from</span> <span class="nn">logtargets.LogTargetToJumpScaleLogConsole</span> <span class="kn">import</span> <span class="n">LogTargetToJumpScaleLogConsole</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logTargetAdd</span><span class="p">(</span><span class="n">LogTargetToJumpScaleLogConsole</span><span class="p">())</span>

<div class="viewcode-block" id="LogHandler.checktargets"><a class="viewcode-back" href="../../../../API/JumpScale.core.logging.html#JumpScale.core.logging.LogHandler.LogHandler.checktargets">[docs]</a>    <span class="k">def</span> <span class="nf">checktargets</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        only execute this every 120 secs</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c"># check which loggers are not working</span>
        <span class="k">for</span> <span class="n">target</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">logTargets</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">target</span><span class="o">.</span><span class="n">enabled</span> <span class="o">==</span> <span class="bp">False</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">target</span><span class="o">.</span><span class="n">open</span><span class="p">()</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="n">target</span><span class="o">.</span><span class="n">enabled</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cleanup</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="LogHandler.log"><a class="viewcode-back" href="../../../../API/JumpScale.core.logging.html#JumpScale.core.logging.LogHandler.LogHandler.log">[docs]</a>    <span class="k">def</span> <span class="nf">log</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">category</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">,</span> <span class="n">tags</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">,</span> <span class="n">jid</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">,</span> <span class="n">parentjid</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">,</span><span class="n">masterjid</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">,</span> <span class="n">private</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        send to all log targets</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c"># print &quot;log: enabled:%s level:%s %s&quot;%(self.enabled,level,message)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">enabled</span><span class="p">:</span>
            <span class="k">return</span>
            
        <span class="n">log</span> <span class="o">=</span> <span class="n">LogItem</span><span class="p">(</span><span class="n">message</span><span class="o">=</span><span class="n">message</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="n">level</span><span class="p">,</span> <span class="n">category</span><span class="o">=</span><span class="n">category</span><span class="p">,</span> <span class="n">tags</span><span class="o">=</span><span class="n">tags</span><span class="p">,</span> <span class="n">jid</span><span class="o">=</span><span class="n">jid</span><span class="p">,</span> <span class="n">parentjid</span><span class="o">=</span><span class="n">parentjid</span><span class="p">,</span><span class="n">masterjid</span><span class="o">=</span><span class="n">masterjid</span><span class="p">,</span> <span class="n">private</span><span class="o">=</span><span class="n">private</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">level</span> <span class="o">&lt;</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">consoleloglevel</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">consolelogCategories</span><span class="o">&lt;&gt;</span><span class="p">[]:</span>
                <span class="k">for</span> <span class="n">consolecat</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">consolelogCategories</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">log</span><span class="o">.</span><span class="n">category</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">consolecat</span><span class="p">)</span><span class="o">&lt;&gt;-</span><span class="mi">1</span><span class="p">:</span>
                        <span class="n">ccat</span><span class="o">=</span><span class="n">log</span><span class="o">.</span><span class="n">category</span>
                        <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">ccat</span><span class="p">)</span><span class="o">&lt;</span><span class="mi">25</span><span class="p">:</span>
                            <span class="n">ccat</span><span class="o">+=</span><span class="s">&quot; &quot;</span>
                        <span class="n">ccat</span><span class="o">=</span><span class="n">ccat</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">25</span><span class="p">]</span>
                        <span class="n">j</span><span class="o">.</span><span class="n">console</span><span class="o">.</span><span class="n">echo</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%s</span><span class="s"> :: </span><span class="si">%s</span><span class="s">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">ccat</span><span class="p">,</span><span class="n">log</span><span class="o">.</span><span class="n">message</span><span class="p">),</span> <span class="n">log</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
                        <span class="k">break</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">j</span><span class="o">.</span><span class="n">console</span><span class="o">.</span><span class="n">echo</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">log</span><span class="p">),</span> <span class="n">log</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">logTargetLogForwarder</span> <span class="o">!=</span> <span class="bp">False</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">logTargetLogForwarder</span><span class="o">.</span><span class="n">enabled</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logTargetLogForwarder</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">log</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="c"># print &quot;level:%s %s&quot; % (level,message)</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">nolog</span><span class="p">:</span>
                <span class="k">return</span>
            <span class="c"># if message&lt;&gt;&quot;&quot; and message[-1]&lt;&gt;&quot;\n&quot;:</span>
            <span class="c">#    message+=&quot;\n&quot;</span>

            <span class="k">if</span> <span class="n">level</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">maxlevel</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span>
                <span class="k">if</span> <span class="s">&quot;transaction&quot;</span> <span class="ow">in</span> <span class="n">j</span><span class="o">.</span><span class="n">__dict__</span> <span class="ow">and</span> <span class="n">j</span><span class="o">.</span><span class="n">transaction</span><span class="o">.</span><span class="n">activeTransaction</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">j</span><span class="o">.</span><span class="n">transaction</span><span class="o">.</span><span class="n">activeTransaction</span><span class="o">.</span><span class="n">logs</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">250</span><span class="p">:</span>
                        <span class="n">j</span><span class="o">.</span><span class="n">transaction</span><span class="o">.</span><span class="n">activeTransaction</span><span class="o">.</span><span class="n">logs</span> <span class="o">=</span> <span class="n">j</span><span class="o">.</span><span class="n">transaction</span><span class="o">.</span><span class="n">activeTransaction</span><span class="o">.</span><span class="n">logs</span><span class="p">[</span><span class="o">-</span><span class="mi">200</span><span class="p">:]</span>
                    <span class="n">j</span><span class="o">.</span><span class="n">transaction</span><span class="o">.</span><span class="n">activeTransaction</span><span class="o">.</span><span class="n">logs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">log</span><span class="p">)</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">logs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">log</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">logs</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">100</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">logs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">logs</span><span class="p">[</span><span class="o">-</span><span class="mi">50</span><span class="p">:]</span>

                <span class="c"># log to logtargets                </span>
                <span class="k">for</span> <span class="n">logtarget</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">logTargets</span><span class="p">:</span>
                    <span class="k">if</span> <span class="p">(</span><span class="nb">hasattr</span><span class="p">(</span><span class="n">logtarget</span><span class="p">,</span> <span class="s">&#39;maxlevel&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">level</span> <span class="o">&gt;</span> <span class="n">logtarget</span><span class="o">.</span><span class="n">maxlevel</span><span class="p">):</span>
                        <span class="k">continue</span>
                    <span class="k">if</span> <span class="p">(</span><span class="nb">hasattr</span><span class="p">(</span><span class="n">logtarget</span><span class="p">,</span> <span class="s">&#39;enabled&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">logtarget</span><span class="o">.</span><span class="n">enabled</span><span class="p">):</span>
                        <span class="k">continue</span>
                    <span class="n">logtarget</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">log</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="LogHandler.exception"><a class="viewcode-back" href="../../../../API/JumpScale.core.logging.html#JumpScale.core.logging.LogHandler.LogHandler.exception">[docs]</a>    <span class="k">def</span> <span class="nf">exception</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="mi">5</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Log `message` and the current exception traceback</span>

<span class="sd">        The current exception is retrieved automatically. There is no need to pass it.</span>

<span class="sd">        @param message: The message to log</span>
<span class="sd">        @type message: string</span>
<span class="sd">        @param level: The log level</span>
<span class="sd">        @type level: int</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ei</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">exc_info</span><span class="p">()</span>
        <span class="n">sio</span> <span class="o">=</span> <span class="n">StringIO</span><span class="p">()</span>
        <span class="n">traceback</span><span class="o">.</span><span class="n">print_exception</span><span class="p">(</span><span class="n">ei</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ei</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">ei</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="bp">None</span><span class="p">,</span> <span class="n">sio</span><span class="p">)</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">sio</span><span class="o">.</span><span class="n">getvalue</span><span class="p">()</span>
        <span class="n">sio</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="n">level</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">level</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="LogHandler.clear"><a class="viewcode-back" href="../../../../API/JumpScale.core.logging.html#JumpScale.core.logging.LogHandler.LogHandler.clear">[docs]</a>    <span class="k">def</span> <span class="nf">clear</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logs</span> <span class="o">=</span> <span class="p">[]</span>
</div>
<div class="viewcode-block" id="LogHandler.close"><a class="viewcode-back" href="../../../../API/JumpScale.core.logging.html#JumpScale.core.logging.LogHandler.LogHandler.close">[docs]</a>    <span class="k">def</span> <span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># for old logtargets</span>
        <span class="k">for</span> <span class="n">logtarget</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">logTargets</span><span class="p">:</span>
            <span class="n">logtarget</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="LogHandler.cleanup"><a class="viewcode-back" href="../../../../API/JumpScale.core.logging.html#JumpScale.core.logging.LogHandler.LogHandler.cleanup">[docs]</a>    <span class="k">def</span> <span class="nf">cleanup</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Cleanup your logs</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s">&#39;_fallbackLogger&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_fallbackLogger</span><span class="p">,</span> <span class="s">&#39;cleanup&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_fallbackLogger</span><span class="o">.</span><span class="n">cleanup</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">logtarget</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">logTargets</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">logtarget</span><span class="p">,</span> <span class="s">&#39;cleanup&#39;</span><span class="p">):</span>
                <span class="n">logtarget</span><span class="o">.</span><span class="n">cleanup</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="LogHandler.logTargetAdd"><a class="viewcode-back" href="../../../../API/JumpScale.core.logging.html#JumpScale.core.logging.LogHandler.LogHandler.logTargetAdd">[docs]</a>    <span class="k">def</span> <span class="nf">logTargetAdd</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">logtarget</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add a LogTarget object</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">count</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">logTargets</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="n">logtarget</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">count</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logTargets</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">logtarget</span><span class="p">)</span>
</pre></div></div></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../../../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../../../../index.html">Jumpscale Doc 7.0 documentation</a> &raquo;</li>
          <li><a href="../../../index.html" >Module code</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
    </div>
  </body>
</html>